///////////////////////////////////////////////////////////////////////////////
//          Town Influence Extender
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
//    This script makes town influence extending, depending on how many 
//    villagers are living in the specified town.
//
///////////////////////////////////////////////////////////////////////////////

define script TownInfluenceCombiner(PlayerID)
define script TownInfluenceExtender
define script TownInfluenceScriptmanager

run script TownInfluenceScriptmanager


begin script TownInfluenceScriptmanager

start

    //run background script TownInfluenceCombiner(0) Unused Crashy, not working
    run background script TownInfluenceExtender

end script TownInfluenceScriptmanager


begin script TownInfluenceCombiner(PlayerID)

    Building = 0
    Counter = 0
    Counter2 = 0
    MainTown = 0
    Town[16]
    TownSize = 0
    Villager = 0

start

if PlayerID == 0
    MainTown = get town with id 0
elsif PlayerID == 1

elsif PlayerID == 2

elsif PlayerID == 3

end if

wait 5 seconds

set player 0 town get town with id 8 capture reason LAST_CAPTURE_AGGRESSIVE

begin loop
    if Counter > 14
        Counter = 0
    end if
    Town[Counter] = get town with id Counter
    if Town[Counter] != MainTown and PLAYER of Town[Counter] == PlayerID
        TownSize = size of Town[Counter]
        force while TownSize > size of Town[Counter]
            Villager = get living villager at {Town[Counter]} radius 250
            PLAYER of Villager = PlayerID
            attach Villager to MainTown
            TownSize--
        end while
        Counter2 = 0
        begin loop
            Building = 0
            Building = get building ABODE_A in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_B in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_C in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_D in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_E in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building SKYSCRAPER in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building MELEE_ARMOURY in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building RANGED_ARMOURY in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_ALTAR in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_STORAGE_PIT in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_CRECHE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_SHRINE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_TEMPLE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_PUB in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_CREATURE_PEN in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_WORKSHOP in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_STUDY in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_UNIVERSITY in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_PRISON in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_AMPITHEATRE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_GRAVEYARD in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_OLD_PERSONS_HOME in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_BATHHOUSE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_SMELTER in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_GRANARY in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_LUMBERMILL in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_MARKET_POT in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_MARKET_STATUE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_MARKET_PLANT in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_WALLTOWER_TECH0 in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_WALLTOWER_TECH1 in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_GATEHOUSE in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building ABODE_NUMBER_GATEHOUSE_F in Town[Counter] min built 0.0
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = get WONDER EPIC_WONDER_NUMBER_HURRICANE in Town[Counter]
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get WONDER EPIC_WONDER_NUMBER_SIREN in Town[Counter]
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get WONDER EPIC_WONDER_NUMBER_EARTHQUAKE in Town[Counter]
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get WONDER EPIC_WONDER_NUMBER_VOLCANO in Town[Counter]
            if Building exists
                PLAYER of Building = PlayerID
                attach Building to MainTown
            end if
            Building = 0
            Building = get building TOWN_CENTRE in Town[Counter] min built 0.0
            if Building exists
                if PLAYER of Town[Counter] == 0
                    //set player 1 town Town[Counter] capture reason LAST_CAPTURE_AGGRESSIVE
                    //wait 5 seconds
                end if
                attach Building to MainTown
            end if
            Counter2++
            until Counter2 > 250
        end loop
    end if
    Counter++
end loop

end script TownInfluenceCombiner


begin script TownInfluenceExtender

    TownCounter = 0
    Town[15]//15 Towns max. supported
    TownInfluence[15]
    TownEnemyInfluence[15]
    TownSize = 0

start

begin loop

    if TownCounter >= 14
        TownCounter = 0
    end if

    Town[TownCounter] = get town with id TownCounter
    if PLAYER of Town[TownCounter] == 0
        if size of Town[TownCounter] >= 40 and TownInfluence[TownCounter] == 0
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 5 / 2

        elsif size of Town[TownCounter] < 40 and TownInfluence[TownCounter] == 1
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 0 / 2

        end if
        
        if size of Town[TownCounter] >= 80 and TownInfluence[TownCounter] == 1
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 10 / 2

        elsif size of Town[TownCounter] < 80 and TownInfluence[TownCounter] == 2
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 5 / 2

        end if

        if size of Town[TownCounter] >= 120 and TownInfluence[TownCounter] == 2
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 15 / 2

        elsif size of Town[TownCounter] < 120 and TownInfluence[TownCounter] == 3
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 10 / 2

        end if

        if size of Town[TownCounter] >= 160 and TownInfluence[TownCounter] == 3
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 20 / 2

        elsif size of Town[TownCounter] < 160 and TownInfluence[TownCounter] == 4
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 15 / 2

        end if

        if size of Town[TownCounter] >= 200 and TownInfluence[TownCounter] == 4
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 25 / 2

        elsif size of Town[TownCounter] < 200 and TownInfluence[TownCounter] == 5
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 20 / 2

        end if

        if size of Town[TownCounter] >= 240 and TownInfluence[TownCounter] == 5
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 30 / 2

        elsif size of Town[TownCounter] < 240 and TownInfluence[TownCounter] == 6
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 25 / 2

        end if
        
        if size of Town[TownCounter] >= 280 and TownInfluence[TownCounter] == 6
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 35 / 2

        elsif size of Town[TownCounter] < 280 and TownInfluence[TownCounter] == 7
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 30 / 2

        end if

        if size of Town[TownCounter] >= 320 and TownInfluence[TownCounter] == 7
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 40 / 2

        elsif size of Town[TownCounter] < 320 and TownInfluence[TownCounter] == 8
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 35 / 2

        end if

        if size of Town[TownCounter] >= 360 and TownInfluence[TownCounter] == 8
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 45 / 2

        elsif size of Town[TownCounter] < 360 and TownInfluence[TownCounter] == 9
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 40 / 2

        end if

        if size of Town[TownCounter] >= 400 and TownInfluence[TownCounter] == 9
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 50 / 2

        elsif size of Town[TownCounter] < 400 and TownInfluence[TownCounter] == 10
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 45 / 2

        end if

        if size of Town[TownCounter] >= 440 and TownInfluence[TownCounter] == 10
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 55 / 2

        elsif size of Town[TownCounter] < 440 and TownInfluence[TownCounter] == 11
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 50 / 2

        end if
        
        if size of Town[TownCounter] >= 480 and TownInfluence[TownCounter] == 11
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 60 / 2

        elsif size of Town[TownCounter] < 480 and TownInfluence[TownCounter] == 12
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 55 / 2

        end if

        if size of Town[TownCounter] >= 520 and TownInfluence[TownCounter] == 12
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 65 / 2

        elsif size of Town[TownCounter] < 520 and TownInfluence[TownCounter] == 13
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 60 / 2

        end if

        if size of Town[TownCounter] >= 560 and TownInfluence[TownCounter] == 13
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 70 / 2

        elsif size of Town[TownCounter] < 560 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 65 / 2

        end if

        if size of Town[TownCounter] >= 600 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 75 / 2

        elsif size of Town[TownCounter] < 600 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 70 / 2

        end if

        if size of Town[TownCounter] >= 640 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 80 / 2

        elsif size of Town[TownCounter] < 640 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 75 / 2

        end if

        if size of Town[TownCounter] >= 680 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 85 / 2

        elsif size of Town[TownCounter] < 680 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 80 / 2

        end if

        if size of Town[TownCounter] >= 720 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 90 / 2

        elsif size of Town[TownCounter] < 720 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 85 / 2

        end if
    else //Reset if town has been captured
        TownInfluence[TownCounter] = 0
    end if

    if PLAYER of Town[TownCounter] >= 1 and PLAYER of Town[TownCounter] < 7
        if size of Town[TownCounter] >= 40 and TownInfluence[TownCounter] == 0
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 5 / 4

        elsif size of Town[TownCounter] < 40 and TownInfluence[TownCounter] == 1
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 0 / 4

        end if
        
        if size of Town[TownCounter] >= 80 and TownInfluence[TownCounter] == 1
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 10 / 4

        elsif size of Town[TownCounter] < 80 and TownInfluence[TownCounter] == 2
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 5 / 4

        end if

        if size of Town[TownCounter] >= 120 and TownInfluence[TownCounter] == 2
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 15 / 4

        elsif size of Town[TownCounter] < 120 and TownInfluence[TownCounter] == 3
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 10 / 4

        end if

        if size of Town[TownCounter] >= 160 and TownInfluence[TownCounter] == 3
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 20 / 4

        elsif size of Town[TownCounter] < 160 and TownInfluence[TownCounter] == 4
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 15 / 4

        end if

        if size of Town[TownCounter] >= 200 and TownInfluence[TownCounter] == 4
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 25 / 4

        elsif size of Town[TownCounter] < 200 and TownInfluence[TownCounter] == 5
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 20 / 4

        end if

        if size of Town[TownCounter] >= 240 and TownInfluence[TownCounter] == 5
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 30 / 4

        elsif size of Town[TownCounter] < 240 and TownInfluence[TownCounter] == 6
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 25 / 4

        end if
        
        if size of Town[TownCounter] >= 280 and TownInfluence[TownCounter] == 6
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 35 / 4

        elsif size of Town[TownCounter] < 280 and TownInfluence[TownCounter] == 7
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 30 / 4

        end if

        if size of Town[TownCounter] >= 320 and TownInfluence[TownCounter] == 7
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 40 / 4

        elsif size of Town[TownCounter] < 320 and TownInfluence[TownCounter] == 8
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 35 / 4

        end if

        if size of Town[TownCounter] >= 360 and TownInfluence[TownCounter] == 8
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 45 / 4

        elsif size of Town[TownCounter] < 360 and TownInfluence[TownCounter] == 9
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 40 / 4

        end if

        if size of Town[TownCounter] >= 400 and TownInfluence[TownCounter] == 9
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 50 / 4

        elsif size of Town[TownCounter] < 400 and TownInfluence[TownCounter] == 10
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 45 / 4

        end if

        if size of Town[TownCounter] >= 440 and TownInfluence[TownCounter] == 10
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 55 / 4

        elsif size of Town[TownCounter] < 440 and TownInfluence[TownCounter] == 11
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 50 / 4

        end if
        
        if size of Town[TownCounter] >= 480 and TownInfluence[TownCounter] == 11
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 60 / 4

        elsif size of Town[TownCounter] < 480 and TownInfluence[TownCounter] == 12
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 55 / 4

        end if

        if size of Town[TownCounter] >= 520 and TownInfluence[TownCounter] == 12
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 65 / 4

        elsif size of Town[TownCounter] < 520 and TownInfluence[TownCounter] == 13
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 60 / 4

        end if

        if size of Town[TownCounter] >= 560 and TownInfluence[TownCounter] == 13
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 70 / 4

        elsif size of Town[TownCounter] < 560 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 65 / 4

        end if

        if size of Town[TownCounter] >= 600 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 75 / 4

        elsif size of Town[TownCounter] < 600 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 70 / 4

        end if

        if size of Town[TownCounter] >= 640 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 80 / 4

        elsif size of Town[TownCounter] < 640 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 75 / 4

        end if

        if size of Town[TownCounter] >= 680 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 85 / 4

        elsif size of Town[TownCounter] < 680 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 80 / 4

        end if

        if size of Town[TownCounter] >= 720 and TownInfluence[TownCounter] == 14
            TownInfluence[TownCounter] += 1
            extend town Town[TownCounter] influence by 90 / 4

        elsif size of Town[TownCounter] < 720 and TownInfluence[TownCounter] == 15
            TownInfluence[TownCounter] -= 1
            extend town Town[TownCounter] influence by 85 / 4

        end if
    else //Reset if town has been captured
        TownEnemyInfluence[TownCounter] = 0
    end if

    TownCounter++
end loop

end script TownInfluenceExtender