///////////////////////////////////////////////////////////////////////////////
//    Land 20 Script-Manager
//    ~~~~~~~~~~~~~~~~~~~~~~~~~
//
//    Start date:     28.03.18            By: Boxhead
//    Update date:    06.04.18            By: Boxhead
///////////////////////////////////////////////////////////////////////////////

define script Land2001Script
define script LC2001_ScriptManager
define script LC2001_SetupCreature

run script Land2001Script

begin script Land2001Script
    
    
start
    
    set toolbar state to MENU_TOOLBAR_STATE_CLOSED
    set interaction SCRIPT_INTERFACE_LEVEL_NORMAL
    
    enable creature icon visible
    enable can use destruction tool    
    enable toolbar
    enable interface action MANACOST_BALANCE_TYPE_GODBUILD
    enable interface action MANACOST_BALANCE_TYPE_ENTERTIMECHANGE
    enable interface action MANACOST_BALANCE_TYPE_PERHOURCHANGED
    enable villager interaction manager
    enable disciple placedown speech
    //disable MENU_TOOLBAR_CREATURE_TEACH menu
    disable script controlled migration player 0

    // Reset the players objectives so none get carried over from the previous land
    reset all objectives for player 0

//----Patch fix for player clicking the creature learning menu----//
    enable MENU_TOOLBAR_CREATURE_TEACH menu
    enable MENU_TOOLBAR_CREATURE_ROLE menu

    enable interface action MANACOST_BALANCE_TYPE_INITIATECREATUREFIST
    enable tribute visual
    enable toolbar
    enable game can be lost
    enable personalisations
    enable load screen

    run background script LC2001_ScriptManager
    
    if DEBUG == 1
        set player 0 alignment 1.0
        increment tribute by 9999999999
        set research ABODE_NUMBER_C available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_ALTAR available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_STORAGE_PIT available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_CREATURE_PEN available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_FIELD available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_WALLTOWER_TECH0 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_WATER_RAIN available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_MELEE_ARMOURY available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ABODE_NUMBER_TEMPLE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_HAND_MULTIPICKUP available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_A available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_B available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_D available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_E available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_SKYSCRAPER available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_CRECHE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_SHRINE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_PUB available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_TOWN_CENTRE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_RANGED_ARMOURY available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_WORKSHOP available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_STUDY available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_UNIVERSITY available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_PRISON available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_SMELTER available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_GRANARY available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_LUMBERMILL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_MARKET_POT available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_MARKET_STATUE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_MARKET_PLANT available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_AMPITHEATRE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_GRAVEYARD available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_OLD_PERSONS_HOME available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_BATHHOUSE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_WALLTOWER_TECH1 available to RESEARCH_AVAILABILITY_NOT_AVAILABLE
        set research ARTEFACT_ABODE_NUMBER_GATEHOUSE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_ABODE_NUMBER_GATEHOUSE_F available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EPIC_WONDER_NUMBER_HURRICANE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EPIC_WONDER_NUMBER_EARTHQUAKE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EPIC_WONDER_NUMBER_VOLCANO available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EPIC_WONDER_NUMBER_SIREN available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_LIFE_HEAL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_LIFE_LIFE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_DEATH_DECAY available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_DEATH_DEATH available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_FIRE_FIRE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_FIRE_LAVA available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_EARTH_TREMOR available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_EARTH_METEOR available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_AIR_WIND available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_AIR_TEMPEST available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_MAGIC_TYPE_WATER_STORM available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_MAGIC_TYPE_HEAL available to RESEARCH_AVAILABILITY_NOT_AVAILABLE
        set research ARTEFACT_CREATURE_MAGIC_TYPE_WATER available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_MAGIC_TYPE_FIREBALL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_MAGIC_TYPE_LIGHTNING available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_TOY_GOOD available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_TOY_NEUTRAL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_TOY_EVIL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_BUILDER_1 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_BUILDER_2 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_BUILDER_3 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_BUILDER_4 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_GATHERER_1 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_GATHERER_2 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_GATHERER_3 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_GATHERER_4 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_SOLDIER_1 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_SOLDIER_2 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_SOLDIER_3 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_SOLDIER_4  available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_ENTERTAINER_1 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_ENTERTAINER_2 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_ENTERTAINER_3 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_CREATURE_ROLE_ENTERTAINER_4 available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_FERTILITY_STATUE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_FOUNTAIN available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_STREETLAMP available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_TORTURE_PIT available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_COLUMN available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_GARDEN available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_WELL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_SPIKE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_EMBELLISHMENT_INFO_GREEK_MIRACLE_ENHANCER available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_HAND_FISTING available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_HAND_GESTURES available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_AGE_OF_GODS available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_BARREN_SEAS available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_FATE_OF_THE_EGYPTIANS available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_FRAGMENT available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_GODLESS_MIRACLES available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_IMMORTAL available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_MISSIONARIES available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_ORIGIN_OF_CREATURES available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_PARCHMENT available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_POWER_OF_THE_AZTECS available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_GREEKS available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_JAPANESE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_NORSE available to RESEARCH_AVAILABILITY_RESEARCHED
        set research ARTEFACT_TOME_PROPHECY available to RESEARCH_AVAILABILITY_RESEARCHED
    end if

    wait until 1 !=1

end script Land2001Script

begin script LC2001_ScriptManager

PlayerAlignment = 0
VisitedLand20 = 0
AtmosMixer = create mixer

Town0 = get town with id 0
Town1 = get town with id 1
Town2 = get town with id 2
Town3 = get town with id 3
Town4 = get town with id 4
Town5 = get town with id 5

start

    VisitedLand20 = persistent data "VISTED_LAND20"
    enable global influence
    set atmos volume 0
    set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_MAP to 0.0
    set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_POSITIONAL to 0.0
    set player 0 mana 50000

    reset all objectives for player 0

    add resource RESOURCE_TYPE_ORE 2500 to Town0
    add resource RESOURCE_TYPE_WOOD 2500 to Town0
    add resource RESOURCE_TYPE_FOOD 4000 to Town0
    add resource RESOURCE_TYPE_ORE 2500 to Town1
    add resource RESOURCE_TYPE_WOOD 2500 to Town1
    add resource RESOURCE_TYPE_FOOD 4000 to Town1
    add resource RESOURCE_TYPE_ORE 2500 to Town2
    add resource RESOURCE_TYPE_WOOD 2500 to Town2
    add resource RESOURCE_TYPE_FOOD 4000 to Town2
    add resource RESOURCE_TYPE_ORE 2500 to Town3
    add resource RESOURCE_TYPE_WOOD 2500 to Town3
    add resource RESOURCE_TYPE_FOOD 4000 to Town3
    add resource RESOURCE_TYPE_ORE 2500 to Town4
    add resource RESOURCE_TYPE_WOOD 2500 to Town4
    add resource RESOURCE_TYPE_FOOD 4000 to Town4
    add resource RESOURCE_TYPE_ORE 2500 to Town5
    add resource RESOURCE_TYPE_WOOD 2500 to Town5
    add resource RESOURCE_TYPE_FOOD 4000 to Town5

    if Intro == 0
        disable load screen
        set fade red 0 green 0 blue 0 time 0
        set fade in time 4
        wait 2 seconds
        IntroFinished = 1
    else
        if VisitedLand20 == 0
            run background script LC2001_Intro
            PD_ForcedSaving = 1
            wait until PD_ForcedSaving == 0 or 10 seconds
            stop script "SavePersistentDataSetData"
            set persistent data "ABORTED_LAND4" to 1
            set persistent data "VISTED_LAND20" to 1
            run script SavePersistentDataGetData
        else
            PD_ForcedSaving = 1
            wait until PD_ForcedSaving == 0 or 10 seconds
            begin cinema
                set camera position to {1198.61,215.00,1145.66}
                set camera focus to {1288.42,170.00,1129.34}
                disable load screen
                set fade red 0 green 0 blue 0 time 0
                set fade in time 4
            end cinema
        end if
    end if

    set atmos volume 0.45
    set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_MAP to 0.6
    set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_POSITIONAL to 0.6

    run background script PlayerMana(0)
    run background script DifficultySelection
    run background script DifficultySelectionSkirmish
    run background script LC2001_SetupCreature
    run background script MapLoader
    run background script SkirmishLoader

end script LC2001_ScriptManager

begin script LC2001_SetupCreature
    Alignment = 0
    Creature = 0
    CreaturePos    = marker at {1281.37,1119.57}
start

    //Load the creature and get it into global
    Creature = persistent data "PLAYER_CREATURE_TYPE"
    if Creature == variable CREATURE_TYPE_LION
        Creature = create CREATURE CREATURE_TYPE_LION at {CreaturePos}
        set player 0 creature to Creature

    elsif Creature == variable CREATURE_TYPE_APE
        Creature = create CREATURE CREATURE_TYPE_APE at {CreaturePos}
        set player 0 creature to Creature

    elsif Creature == variable CREATURE_TYPE_GORILLA
        Creature = create CREATURE CREATURE_TYPE_GORILLA at {CreaturePos}
        set player 0 creature to Creature

    elsif Creature == variable CREATURE_TYPE_WOLF
        Creature = create CREATURE CREATURE_TYPE_WOLF at {CreaturePos}
        set player 0 creature to Creature

    elsif Creature == variable CREATURE_TYPE_COW
        Creature = create CREATURE CREATURE_TYPE_COW at {CreaturePos}
        set player 0 creature to Creature

    else// L2PlayersCreatureCheck == variable CREATURE_TYPE_TIGER
        Creature = create CREATURE CREATURE_TYPE_TIGER at {CreaturePos}
        set player 0 creature to Creature

    end if

    set creature Creature happiness to maximum

    AGE of Creature = persistent data "CREATURE_AGE"
    HEIGHT of Creature = persistent data "CREATURE_SIZE"
    STRENGTH of Creature = persistent data "CREATURE_STRENGTH"
    ALIGNMENT of Creature = persistent data "CREATURE_ALIGNMENT"
    FATNESS of Creature = persistent data "CREATURE_FATNESS"

    release Creature

end script LC2001_SetupCreature