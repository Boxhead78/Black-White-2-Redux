///////////////////////////////////////////////////////////////////////////////
//    Land 8 Japanese Troop-Management
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//    Globals
//-----------------------------------------------------------------------------

define LC8_NUM_OF_DEFENDERS                = 0 //Unused
define LC8_NUM_OF_PLATOONS                = 55
define LC8_NUM_OF_SIEGE_CATAPULTS         = 35
define LC8_NUM_OF_WALL_ARCHERS            = 20
//Army Types
define Melee                             = 0
define Ranged                            = 1
//Army Behaivours
define Attacker                          = 0
define Escort                            = 1
define Conqueror                         = 2 //Nearest Settlement Attacker
define Patrol                            = 3
define PatrolLinked                      = 4
define Special                           = 5

define script LC8_StaticPlatoonsController
define script LC8_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)
define script LC8_ArmyBehaivours(Platoon,Type,Task,DefendObject,AttackingPoint,AttackingPointFallBack,PatrolRoute,Town)
define script LC8_MoveCatapultThenAttack(SiegeWeapon,Type,Waypoint1,Waypoint2,Waypoint3)
define script Waypoints

global LC8_Defender[LC8_NUM_OF_DEFENDERS]
global LC8_Platoon[LC8_NUM_OF_PLATOONS]
global LC8_SiegeCatapult[LC8_NUM_OF_SIEGE_CATAPULTS]
global LC8_WallArcher[LC8_NUM_OF_WALL_ARCHERS]
global LC8_StaticPlatoonCounter = 0

global PlatoonPos[19]
global StaticSiegePos[10]
global AttackPos[5]
global SiegePlatoonPos[3]
global SiegeRoute1[3]
global SiegeRoute2[3]
global SiegeRoute3[3]
global SiegeRoute4[3]
global SiegeRoute5[3]
global LS_PrePos[7]//7 Platoons, 6 Siege Weapons
global LS_AttackPos[7]
global LS_SiegeRoute1[3]
global LS_SiegeRoute2[3]
global LS_SiegeRoute3[3]
global LS_SiegeRoute4[3]
global LS_SiegeRoute5[3]
global LS_SiegeRoute6[3]
global PortalPos[1]
global PlayerWallPos[2]
global StaticPlatoonGoodPos[4]
global StaticPlatoonGoodWaypoint = 0
global StaticPlatoonEvilPos[3]
global StaticPlatoonEvilWaypoint = 0

global SiegeAttackPrePos[4]
global SiegeAttackPos[4]

global PatrolRouteA[4]
global WaypointsA = 0
global PatrolRouteB[4]
global WaypointsB = 0

//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
//    Setting up waypoints for AI actions
//-----------------------------------------------------------------------------

run script Waypoints

begin script Waypoints

start

    SiegeAttackPrePos[0] = marker at {1765.98,44.97,1253.20}

    SiegeAttackPos[0] = marker at {2063.16,55.61,1297.50}

    PlayerWallPos[0] = marker at {1296.29,151.23,864.95}
    PlayerWallPos[1] = marker at {1660.86,158.43,799.39}

    PlatoonPos[0] = marker at {1827.59,124.62,1850.60}
    PlatoonPos[1] = marker at {1615.74,144.03,2013.94}
    PlatoonPos[2] = marker at {1757.16,157.46,1981.57}
    PlatoonPos[3] = marker at {1236.15,120.61,1073.94}
    PlatoonPos[4] = marker at {1718.42,103.21,1162.01}
    PlatoonPos[5] = marker at {712.54,149.03,2107.67}
    PlatoonPos[6] = marker at {873.14,135.72,2072.00}
    PlatoonPos[7] = marker at {606.60,166.39,2055.45}
    PlatoonPos[8] = marker at {1338.61,71.29,1564.18}
    PlatoonPos[9] = marker at {1244.36,75.33,1644.25}
    PlatoonPos[10] = marker at {1827.71,146.73,1357.82}
    PlatoonPos[11] = marker at {1885.18,149.56,1413.33}
    PlatoonPos[12] = marker at {979.36,88.56,1347.32}
    PlatoonPos[13] = marker at {969.13,88.64,1446.79}
    PlatoonPos[14] = marker at {1403.51,134.12,972.46}
    PlatoonPos[15] = marker at {1439.65,132.05,991.67}
    
    PortalPos[0] = marker at {1170.67,128.59,2157.00}

    AttackPos[0] = marker at {1286.18,151.75,864.69}//FrontAttackpos
    AttackPos[1] = marker at {1212.43,120.48,1059.18}//FrontFallBack
    AttackPos[2] = marker at {1652.18,158.72,801.23}//BackdoorAttackpos
    AttackPos[3] = marker at {1703.65,126.25,988.27}//BackdoorFallBack

    //JapaneseTown2
    LS_PrePos[0] = marker at {1252.06,97.66,1248.33}
    LS_PrePos[1] = marker at {1293.16,95.90,1240.47}
    LS_PrePos[2] = marker at {1335.27,98.86,1236.22}
    LS_PrePos[3] = marker at {1367.86,101.35,1275.84}
    //JapaneseTown1
    LS_PrePos[4] = marker at {1031.41,88.59,1442.04}
    //JapaneseCapital
    LS_PrePos[5] = marker at {1718.75,103.36,1226.78}
    LS_PrePos[6] = marker at {1759.75,103.49,1224.12}

    //JapaneseTown2
    LS_AttackPos[0] = marker at {1213.78,136.38,926.88}
    LS_AttackPos[1] = marker at {1260.07,133.71,948.31}
    LS_AttackPos[2] = marker at {1316.87,141.31,910.64}
    LS_AttackPos[3] = marker at {1330.49,147.70,877.53}
    //JapaneseTown1
    LS_AttackPos[4] = marker at {1281.97,146.60,884.18}
    //JapaneseCapital
    LS_AttackPos[5] = marker at {1649.72,153.32,840.40}
    LS_AttackPos[6] = marker at {1687.64,156.13,801.26}

    //JapaneseTown2 to PlayerTown
    LS_SiegeRoute1[0] = marker at {1344.31,87.49,1363.58}//Not variable
    LS_SiegeRoute1[1] = marker at {1299.17,92.81,1282.63}
    LS_SiegeRoute1[2] = marker at {1267.89,133.44,958.69}

    LS_SiegeRoute2[0] = marker at {LS_SiegeRoute1[0]}//Not variable
    LS_SiegeRoute2[1] = marker at {LS_SiegeRoute1[1]} + {-20,0,-20}
    LS_SiegeRoute2[2] = marker at {LS_SiegeRoute1[2]} + {-20,0,-20}

    LS_SiegeRoute3[0] = marker at {LS_SiegeRoute1[0]}//Not variable
    LS_SiegeRoute3[1] = marker at {LS_SiegeRoute1[1]} + {20,0,20}
    LS_SiegeRoute3[2] = marker at {LS_SiegeRoute1[2]} + {20,0,20}

    //JapaneseTown1 to PlayerTown
    LS_SiegeRoute4[0] = marker at {756.71,132.93,1906.53}//Not variable
    LS_SiegeRoute4[1] = marker at {1221.86,107.41,1175.57}
    LS_SiegeRoute4[2] = marker at {1247.19,130.90,971.85}

    LS_SiegeRoute5[0] = marker at {LS_SiegeRoute4[0]}//Not variable
    LS_SiegeRoute5[2] = marker at {LS_SiegeRoute4[1]} + {20,0,20}
    LS_SiegeRoute5[3] = marker at {LS_SiegeRoute4[2]} + {20,0,20}

    //JapaneseCapital to PlayerTown
    LS_SiegeRoute6[0] = marker at {1758.82,124.19,1772.07}//Not variable
    LS_SiegeRoute6[1] = marker at {1732.82,101.31,1200.37}
    LS_SiegeRoute6[2] = marker at {1673.42,148.02,853.58}

    //JapaneseTown2 to PlayerTown
    SiegeRoute1[0] = marker at {1344.73,87.27,1368.25}//Not variable
    SiegeRoute1[1] = marker at {1253.45,117.15,1109.68}
    SiegeRoute1[2] = marker at {1270.96,133.33,963.45}

    SiegeRoute2[0] = marker at {LS_SiegeRoute6[0]}//Not variable
    SiegeRoute2[1] = marker at {LS_SiegeRoute6[2]}
    SiegeRoute2[2] = marker at {LS_SiegeRoute6[3]}

    SiegeRoute3[0] = marker at {LS_SiegeRoute4[0]}//Not variable
    SiegeRoute3[1] = marker at {LS_SiegeRoute4[2]}
    SiegeRoute3[2] = marker at {LS_SiegeRoute4[3]}

    SiegeRoute4[0] = marker at {LS_SiegeRoute6[0]}//Not variable
    SiegeRoute4[1] = marker at {LS_SiegeRoute6[2]} + {20,0,20}
    SiegeRoute4[2] = marker at {LS_SiegeRoute6[3]} + {20,0,20}

    SiegeRoute5[0] = marker at {LS_SiegeRoute4[0]}//Not variable
    SiegeRoute5[1] = marker at {LS_SiegeRoute4[2]} + {20,0,20}
    SiegeRoute5[2] = marker at {LS_SiegeRoute4[3]} + {20,0,20}
    
    SiegePlatoonPos[0] = marker at {1338.13,88.79,1329.34}//JapaneseTown2
    SiegePlatoonPos[1] = marker at {770.09,127.70,1872.93}//JapaneseTown1
    SiegePlatoonPos[2] = marker at {1764.26,124.24,1745.59}//JapaneseCapital

    PatrolRouteA[0] = marker at {1759.00,127.23,1654.08}
    PatrolRouteA[1] = marker at {1577.86,108.41,1460.40}
    PatrolRouteA[2] = marker at {1741.90,102.17,1214.74}
    PatrolRouteA[3] = marker at {1889.29,149.56,1426.75}

    PatrolRouteB[0] = marker at {1690.80,103.50,1195.26}
    PatrolRouteB[1] = marker at {1309.47,96.06,1246.81}
    PatrolRouteB[2] = marker at {1222.77,106.90,1180.37}
    PatrolRouteB[3] = marker at {1077.65,92.85,1283.15}

    StaticSiegePos[0] = marker at {1848.84,174.41,1964.97}
    StaticSiegePos[1] = marker at {1824.88,174.47,1990.92}
    StaticSiegePos[2] = marker at {1765.23,145.61,1884.40}
    StaticSiegePos[3] = marker at {1288.69,87.85,1474.26}
    StaticSiegePos[4] = marker at {1221.62,85.39,1579.82}
    StaticSiegePos[5] = marker at {712.89,149.06,2069.05}
    StaticSiegePos[6] = marker at {753.45,148.94,2078.80}

    WaypointsA = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}

    add {PatrolRouteA[0]} to waypoint list WaypointsA
    add {PatrolRouteA[1]} to waypoint list WaypointsA
    add {PatrolRouteA[2]} to waypoint list WaypointsA
    add {PatrolRouteA[3]} to waypoint list WaypointsA

    WaypointsB = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}

    add {PatrolRouteB[0]} to waypoint list WaypointsB
    add {PatrolRouteB[1]} to waypoint list WaypointsB
    add {PatrolRouteB[2]} to waypoint list WaypointsB
    add {PatrolRouteB[3]} to waypoint list WaypointsB

    //Waypoints nearby own towns
    StaticPlatoonGoodPos[0] = marker at {891.78,103.11,1589.13}
    StaticPlatoonGoodPos[1] = marker at {1203.28,105.15,1208.84}
    StaticPlatoonGoodPos[2] = marker at {1718.70,106.65,1134.59}
    StaticPlatoonGoodPos[3] = marker at {1777.27,128.29,1635.99}
    //Waypoints nearby neutral towns which is likely to be taken by player
    StaticPlatoonEvilPos[0] = marker at {1824.06,142.37,1332.10}
    StaticPlatoonEvilPos[1] = marker at {961.39,88.53,1359.46}
    StaticPlatoonEvilPos[2] = marker at {1767.11,127.19,1654.39}

end script Waypoints

//-----------------------------------------------------------------------------

begin script LC8_StaticPlatoonsController

start

begin loop
    wait 15 seconds
    if get StaticPlatoonsActionTimer time remaining <= 0
        StaticPlatoonGoodWaypoint = StaticPlatoonGoodPos[number from 0 to 3]
        StaticPlatoonEvilWaypoint = StaticPlatoonEvilPos[number from 0 to 2]
        wait 60 seconds //Give platoons 60 seconds to react to new orders
        StaticPlatoonsActionTimer = create timer for number from 300 to 1200 seconds
    end if
end loop

end script LC8_StaticPlatoonsController

begin script LC8_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)

    ThisStaticPlatoonActionTimer = create timer for 0 seconds
    ThisStaticPlatoonActive = 0
    ThisStaticPlatoonWaypoint = 0
    ThisOriginTownEmergency = 0
    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    PlayerSettlement = 0
    ThresholdStatic = 0

start

LC8_StaticPlatoonCounter++

begin loop

    if Type == Melee
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    if get ThisStaticPlatoonActionTimer time remaining <= 0
        ThisStaticPlatoonActionTimer = create timer for number from 25 to 35 seconds
        //If emergency in OriginTown go defend it
        PlayerPlatoon1 = get platoon of player 0 nearest {OriginTown} radius 500
        Catapult = get siege weapon of player 0 nearest {OriginTown} radius 500
        PlayerCreature = get distance from {OriginTown} to {oCreature}
        if PlayerPlatoon1 exists or Catapult exists or (PlayerCreature <= 500 and HEALTH of oCreature > 0.00)
            ThisOriginTownEmergency = 1
        else
            ThisOriginTownEmergency = 0
        end if
        if ThisOriginTownEmergency == 1
            if ThisStaticPlatoonActive == 1
                StaticPlatoonsActive--
                ThisStaticPlatoonActive = 0
            end if
        end if
    end if

    if get StaticPlatoonsActionTimer time remaining <= 0
        //say "DEBUG: StaticPlatoonsActive = $d" with number StaticPlatoonsActive
        if get ThisStaticPlatoonActionTimer time remaining <= 5
            wait 5 seconds
            if number from 1 to 4 == 4
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 0 and StaticPlatoonsActive <= LC8_StaticPlatoonCounter * 0.2 //20% of all static platoons max
                    StaticPlatoonsActive++
                    ThisStaticPlatoonActive = 1
                end if
            else
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 1
                    StaticPlatoonsActive--
                    ThisStaticPlatoonActive = 0
                end if
            end if
        end if
    end if

    if ThisStaticPlatoonActive == 0 and get size of Platoon action queue < 1 and ({Platoon} not near {Pos} radius 25 or get player 0 influence at {Pos} > 0)
        if get player 0 influence at {Pos} > 0
            ThresholdStatic = 10
            begin loop
                Pos = marker at {Pos} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {Pos} and get player 0 influence at {Pos} == 0) or ThresholdStatic > 999
            end loop
        end if
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Pos} to Platoon action queue
    elsif ThisStaticPlatoonActive == 1 and get size of Platoon action queue < 1 and ({Platoon} not near {ThisStaticPlatoonWaypoint} radius 25 or ThisStaticPlatoonWaypoint == 0 or get player 0 influence at {Pos} > 0)
        if PlayerAlignmentFinal < 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonEvilWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        elsif PlayerAlignmentFinal >= 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonGoodWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        end if
    end if

    until Platoon not exists
end loop

LC8_StaticPlatoonCounter--

end script LC8_StaticPlatoonsActions

begin script LC8_ArmyBehaivours(Platoon,Type,Task,DefendObject,AttackingPoint,AttackingPointFallBack,PatrolRoute,Town)

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    TestSiege = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    PlayerSettlement = 0
    Armory = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    myTimer = create timer for 0 seconds
    Threshold = 0

start

//Group Attackers up first
if Platoon == LC8_Platoon[22] or Platoon == LC8_Platoon[23] or Platoon == LC8_Platoon[24]
    wait until LC8_Platoon[22] exists and LC8_Platoon[23] exists and LC8_Platoon[24] exists and LC8_SiegeCatapult[7] exists and ({LC8_SiegeCatapult[7]} near {JapaneseTown2} radius 300) and LC8_SiegeCatapult[8] exists and ({LC8_SiegeCatapult[8]} near {JapaneseTown2} radius 300)
    if Platoon == LC8_Platoon[22]
        DefendObject = LC8_SiegeCatapult[7]
    elsif Platoon == LC8_Platoon[23]
        DefendObject = LC8_SiegeCatapult[8]
    end if
end if

if Platoon == LC8_Platoon[32] or Platoon == LC8_Platoon[33]
    wait until LC8_Platoon[32] exists and LC8_Platoon[33] exists and LC8_SiegeCatapult[15] exists and LC8_SiegeCatapult[16] exists and ({LC8_SiegeCatapult[15]} near {JapaneseCapital} radius 500) and ({LC8_SiegeCatapult[16]} near {JapaneseCapital} radius 500)
end if

if Platoon == LC8_Platoon[34] or Platoon == LC8_Platoon[35]
    wait until LC8_Platoon[34] exists and LC8_Platoon[35] exists and LC8_SiegeCatapult[17] exists and LC8_SiegeCatapult[18] exists and ({LC8_SiegeCatapult[17]} near {JapaneseTown1} radius 500) and ({LC8_SiegeCatapult[18]} near {JapaneseTown1} radius 500)
end if

begin loop

    if Type == Melee and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    PlayerSettlement = get nearest town at {Platoon} for player 0 radius 500
    //Not a Armory, it's a towncentre.
    Armory = get building ABODE_NUMBER_TOWN_CENTRE in PlayerSettlement min built 1.0
    if Armory exists and PlayerSettlement != PlayerTown and PLAYER of PlayerSettlement == 0 and Task != Conqueror and HEALTH of Armory == 1.0 and not variable get town PlayerSettlement status == variable TOWN_STATUS_MIGRATION_STARTED
        if Platoon can navigate to object Armory
            if TownCapturePlatoons[2] < 2
                TownCapturePlatoons[2]++
                clear Platoon action queue
                set Platoon attack PlayerSettlement with severity 0.3 for takeover
                a = 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 150
                    PlayerCreature = get distance from {Platoon} to {oCreature}
                    if PlayerPlatoon1 exists
                        a = 0
                    elsif PlayerCreature <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                        a = 0
                    elsif not Platoon can navigate to object Armory
                        a = 0
                    elsif Platoon not exists
                        a = 0
                    end if
                    until a == 0 or Platoon not exists or PLAYER of PlayerSettlement == 1
                end loop
                TownCapturePlatoons[2]--
            end if
            clear Platoon action queue
        end if
    end if

    if Task == Attacker
        //if get size of Platoon action queue < 1
            if Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                wait number from 5 to 25 seconds
                a = 1
                clear Platoon action queue
                Number = number from 1 to 4
                if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                    AttackMode = 1
                    set Platoon attack PlayerTown with severity 0.2
                elsif Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[0] < 2
                        TownCapturePlatoons[0]++
                        set Platoon attack PlayerTown with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 150
                    TestCreature2 = get distance from {Platoon} to {MyCreature}
                    NumPat1 = get number of villagers in platoon Platoon
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not Platoon can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif not Platoon can navigate to object oTownCentre
                            a = 0
                        elsif Platoon not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or Platoon not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[0]--
                end if
                clear Platoon action queue
            elsif Platoon can navigate to {AttackingPoint} and not {Platoon} near {AttackingPoint} radius 25 and get player 0 influence at {AttackingPoint} == 0
                clear Platoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint} to Platoon action queue
            elsif not {Platoon} near {AttackingPointFallBack} radius 25
                clear Platoon action queue
                if get player 0 influence at {AttackingPointFallBack} > 0
                    begin loop
                        AttackingPointFallBack = marker at {AttackingPointFallBack} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                        Threshold += 5
                        until (Platoon can navigate to {AttackingPointFallBack} and get player 0 influence at {AttackingPointFallBack} == 0) or Threshold > 999
                    end loop
                    Threshold = 1
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPointFallBack} to Platoon action queue
            end if
        //end if

    elsif Task == Escort
        if DefendObject exists
            clear Platoon action queue
            add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
            begin loop
                TestCreature2 = get distance from {Platoon} to {oCreature}
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 150
                PlayerSettlement = get nearest town at {Platoon} for player 0 radius 500
                Armory = get building ABODE_NUMBER_TOWN_CENTRE in PlayerSettlement min built 1.0
                if Armory exists and HEALTH of Armory == 1.0 and not variable get town PlayerSettlement status == variable TOWN_STATUS_MIGRATION_STARTED //Armory needs to exist, else game will crash
                    if PlayerSettlement == PlayerTown or not Platoon can navigate to object Armory
                        PlayerSettlement = 0
                    end if
                end if
                until TestCreature2 <= 150 or PlayerPlatoon1 exists or Platoon not exists or PlayerSettlement exists or DefendObject not exists
            end loop
        elsif DefendObject not exists
            if Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                wait number from 5 to 25 seconds
                a = 1
                clear Platoon action queue
                Number = number from 1 to 4
                if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                    AttackMode = 1
                    set Platoon attack PlayerTown with severity 0.2
                elsif Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                            Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[0] < 2
                        TownCapturePlatoons[0]++
                        set Platoon attack PlayerTown with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 150
                    TestCreature2 = get distance from {Platoon} to {MyCreature}
                    NumPat1 = get number of villagers in platoon Platoon
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not Platoon can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif not Platoon can navigate to object oTownCentre
                            a = 0
                        elsif Platoon not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or Platoon not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[0]--
                end if
                clear Platoon action queue
            elsif Platoon can navigate to {AttackingPoint} and not {Platoon} near {AttackingPoint} radius 25 and get player 0 influence at {AttackingPoint} == 0
                clear Platoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint} to Platoon action queue
            elsif not {Platoon} near {AttackingPointFallBack} radius 25
                clear Platoon action queue
                if get player 0 influence at {AttackingPointFallBack} > 0
                    begin loop
                        AttackingPointFallBack = marker at {AttackingPointFallBack} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                        Threshold += 5
                        until (Platoon can navigate to {AttackingPointFallBack} and get player 0 influence at {AttackingPointFallBack} == 0) or Threshold > 999
                    end loop
                    Threshold = 1
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPointFallBack} to Platoon action queue
            end if
        end if

    elsif Task == Conqueror
        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        //DefendObject = LC8_SiegeCatapult[11]
        if not Platoon can navigate to object oTownCentre and DefendObject exists
            AttackingPoint = marker at {DefendObject} + {number from 20 to -20,0,number from 20 to -20}
            clear Platoon action queue 
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint} to Platoon action queue
            wait 10 seconds
        end if

        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        //if get size of Platoon action queue < 1
            if Platoon can navigate to object oTownCentre
                wait number from 5 to 25 seconds
                a = 1
                clear Platoon action queue
                Number = number from 3 to 5
                if Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[1] < 2
                        TownCapturePlatoons[1]++
                        set Platoon attack NearestSettlement with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 150
                    TestCreature2 = get distance from {Platoon} to {MyCreature}
                    NumPat1 = get number of villagers in platoon Platoon
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not Platoon can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town NearestSettlement is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town NearestSettlement is under takeover from player 1
                            a = 0
                        elsif not Platoon can navigate to object oTownCentre
                            a = 0
                        elsif Platoon not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town NearestSettlement is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or Platoon not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[1]--
                end if
                clear Platoon action queue
            else
                clear Platoon action queue
            end if
        //end if

    elsif Task == Patrol
        //Platoons use old code

    elsif Task == PatrolLinked
        //Platoons use old code

    elsif Task == Special
        //if get size of Platoon action queue < 1
            if LC8_LargeSiegeLaunchAttack == 1
                if Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                    wait number from 5 to 25 seconds
                    a = 1
                    clear Platoon action queue
                    Number = number from 1 to 4
                    if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                        AttackMode = 1
                        set Platoon attack PlayerTown with severity 0.2
                    elsif Number == 3 or Number == 4 //Destroy value buildings
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get building ALTAR in PlayerTown min built 0.75
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get building TEMPLE in PlayerTown min built 0.75
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get building CREATURE_PEN in PlayerTown min built 0.75
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get building UNIVERSITY in PlayerTown min built 0.75
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 7
                                Building = get building BATHHOUSE in PlayerTown min built 0.75
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 8
                                Building = get building AMPITHEATRE in PlayerTown min built 0.75
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                    else //Capture Town
                        AttackMode = 0
                        if TownCapturePlatoons[0] < 2
                            TownCapturePlatoons[0]++
                            set Platoon attack PlayerTown with severity 0.3 for takeover
                        else
                            a = 0
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 150
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                                a = 0
                            elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                                a = 0
                            elsif not Platoon can navigate to object oTownCentre
                                a = 0
                            elsif Platoon not exists
                                a = 0
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 0
                            elsif AttackMode == 2 and Building not exists
                                a = 0
                            elsif AttackMode == 2 and HEALTH of Building < 0.1
                                a = 0
                            elsif AttackMode == 2 and Building == 0
                                a = 0
                            elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 0
                            end if
                        //end if
                        until a == 0 or Platoon not exists
                    end loop
                    if AttackMode == 0
                        TownCapturePlatoons[0]--
                    end if
                    clear Platoon action queue
                elsif Platoon can navigate to {AttackingPoint} and not {Platoon} near {AttackingPoint} radius 25 and get player 0 influence at {AttackingPoint} == 0
                    clear Platoon action queue
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint} to Platoon action queue
                elsif not {Platoon} near {AttackingPointFallBack} radius 25
                    clear Platoon action queue
                    if get player 0 influence at {AttackingPointFallBack} > 0
                        begin loop
                            AttackingPointFallBack = marker at {AttackingPointFallBack} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                            Threshold += 5
                            until (Platoon can navigate to {AttackingPointFallBack} and get player 0 influence at {AttackingPointFallBack} == 0) or Threshold > 999
                        end loop
                        Threshold = 1
                    end if
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPointFallBack} to Platoon action queue
                end if
            elsif not {Platoon} near {AttackingPointFallBack} and LC8_LargeSiegeLaunchAttack == 0
                clear Platoon action queue
                if get player 0 influence at {AttackingPointFallBack} > 0
                    begin loop
                        AttackingPointFallBack = marker at {AttackingPointFallBack} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                        Threshold += 5
                        until (Platoon can navigate to {AttackingPointFallBack} and get player 0 influence at {AttackingPointFallBack} == 0) or Threshold > 999
                    end loop
                    Threshold = 1
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPointFallBack} to Platoon action queue
            end if
        //end if

    end if

    until Platoon not exists
end loop

end script LC8_ArmyBehaivours

begin script LC8_MoveCatapultThenAttack(SiegeWeapon,Type,Waypoint1,Waypoint2,Waypoint3)

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    Town0 = get town with id 0
    Town5 = get town with id 5
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in Town0 min built 1.0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in Town5 min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in Town5 min built 1.0
    Player1Town = 0
    a = 1
    AISiege = 0    
    WaypointMain[7]
    WaypointRouteMain = 0
    Counter = 0
    Town8 = get town with id 8
    Catapult = 0
    AttackingTown = 2
    NumPat5 = 0
    h = 1
    Player0Town0 = 0
    Timer = create timer for 0 seconds
    oWall = 0
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    AIPlatoon = 0
    Target = 0
    PointOn = 0
    CatapultMoveTimer1 = create timer for 0 seconds
    AttackTimer = 0
    ActionTimer = create timer for 0 seconds
    Wall1 = 0
    Wall2 = 0
    House = 0
    SiegeOnPointTimer = create timer for 0 seconds
    SiegeWeaponPoint = 0
    SiegeStucked = 0
    GateHouse = 0
    SiegeAttacking = 0
    AttackTownTimer = create timer for 0 seconds
    PlayerSettlement = 0

start

//begin loop

    a = 1
    PointOn = 0
    SiegeAttacking = 0
    SiegeStucked = 0

    //Group up here
    if SiegeWeapon == LC8_SiegeCatapult[7] or SiegeWeapon == LC8_SiegeCatapult[8]
        wait until LC8_Platoon[22] exists and LC8_Platoon[23] exists and LC8_Platoon[24] exists and LC8_SiegeCatapult[7] exists and LC8_SiegeCatapult[8] exists
    end if

    if SiegeWeapon == LC8_SiegeCatapult[15] or SiegeWeapon == LC8_SiegeCatapult[16]
        wait until LC8_Platoon[32] exists and LC8_Platoon[33] exists and LC8_SiegeCatapult[15] exists and LC8_SiegeCatapult[16] exists
    end if

    if SiegeWeapon == LC8_SiegeCatapult[17] or SiegeWeapon == LC8_SiegeCatapult[18]
        wait until LC8_Platoon[34] exists and LC8_Platoon[35] exists and LC8_SiegeCatapult[17] exists and LC8_SiegeCatapult[18] exists
    end if

    disable siege weapon SiegeWeapon auto attack

    if Type != Conqueror
        begin loop
            if PointOn != 3
                if SiegeWeapon exists
                    if get SiegeOnPointTimer time remaining <= 0
                        SiegeWeaponPoint = marker at {SiegeWeapon}
                        SiegeOnPointTimer = create timer for 40 seconds
                    elsif get SiegeOnPointTimer time remaining <= 5
                        if {SiegeWeapon} near {SiegeWeaponPoint} radius 10
                            clear siege weapon SiegeWeapon action queue
                            delete SiegeWeapon
                            SiegeStucked = 1
                        end if
                    end if
                    if get CatapultMoveTimer1 time remaining <= 0
                        if get size of SiegeWeapon action queue < 1

                            if PointOn == 0
                                if SiegeWeapon can navigate to {Waypoint1}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {Waypoint1} to siege weapon SiegeWeapon action queue
                                end if
                    
                            elsif PointOn == 1
                                if SiegeWeapon can navigate to {Waypoint2}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {Waypoint2} to siege weapon SiegeWeapon action queue
                                end if

                            elsif PointOn == 2
                                if SiegeWeapon can navigate to {Waypoint3}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {Waypoint3} to siege weapon SiegeWeapon action queue
                                end if

                            CatapultMoveTimer1 = create timer for 10 seconds
                            
                            end if
                        end if
                    end if        

                    if {SiegeWeapon} near {Waypoint1} radius 15 and PointOn != 1
                        PointOn = 1
                    elsif {SiegeWeapon} near {Waypoint2} radius 15 and PointOn != 2
                        PointOn = 2
                    elsif {SiegeWeapon} near {Waypoint3} radius 15 and PointOn != 3
                        PointOn = 3
                    elsif (not SiegeWeapon can navigate to {Waypoint3} or get player 0 influence at {Waypoint3} > 0) and {SiegeWeapon} near {Waypoint2} radius 15 and PointOn != 3
                        PointOn = 3
                    end if
                end if
            end if

            if get ActionTimer time remaining <= 0 and PointOn == 3
                enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                House = get building ALTAR in PlayerTown min built 0.75
                if House exists and PLAYER of House == 0 and SiegeWeapon can navigate to object oTownCentre
                    NumPat1 = number from 1 to 5
                else
                    NumPat1 = number from 1 to 3
                end if
                if NumPat1 == 1 or NumPat1 == 2
                    GateHouse = get HOUSE GATEHOUSE at {SiegeWeapon} radius 250
                    if GateHouse not exists
                        GateHouse = get HOUSE GATEHOUSE_F at {SiegeWeapon} radius 250
                    end if
                    if GateHouse exists and PLAYER of GateHouse == 0
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {GateHouse} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                    else
                        GateHouse = get random abode of type GATEHOUSE in town PlayerTown
                        if GateHouse not exists
                            GateHouse = get random abode of type GATEHOUSE_F in town PlayerTown
                        end if
                        if GateHouse exists and PLAYER of GateHouse == 0
                            clear siege weapon SiegeWeapon action queue
                            Target = marker at get target from {SiegeWeapon} to {GateHouse} distance 10 angle 180
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            ActionTimer = create timer for 0.025 seconds
                        end if
                    end if
                elsif NumPat1 == 3
                    Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                    if Wall1 exists and PLAYER of Wall1 == 0
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {Wall1} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                else
                    House = get building ALTAR in PlayerTown min built 0.75
                    if House exists and PLAYER of House == 0 and SiegeWeapon can navigate to object oTownCentre
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {House} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using House to siege weapon SiegeWeapon action queue
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                end if
            end if

            until SiegeWeapon not exists
        end loop
    else    
        begin loop
            if get SiegeOnPointTimer time remaining <= 0
                SiegeWeaponPoint = marker at {SiegeWeapon}
                SiegeOnPointTimer = create timer for 160 seconds
            elsif get SiegeOnPointTimer time remaining <= 5 and not {SiegeWeapon} near {NearestSettlement} radius 400
                if {SiegeWeapon} near {SiegeWeaponPoint} radius 10
                    clear siege weapon SiegeWeapon action queue
                    delete SiegeWeapon
                    SiegeStucked = 1
                end if
            end if
            if get ActionTimer time remaining <= 0
                ActionTimer = create timer for 60 seconds
                NumPat1 = number from 1 to 7
                if NumPat1 == 1 or NumPat1 == 2
                    GateHouse = get HOUSE GATEHOUSE at {SiegeWeapon} radius 250
                    if GateHouse not exists
                        GateHouse = get HOUSE GATEHOUSE_F at {SiegeWeapon} radius 250
                    end if
                    if GateHouse exists and PLAYER of GateHouse == 0
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {GateHouse} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                    else
                        GateHouse = get random abode of type GATEHOUSE in town PlayerTown
                        if GateHouse not exists
                            GateHouse = get random abode of type GATEHOUSE_F in town PlayerTown
                        end if
                        if GateHouse exists and PLAYER of GateHouse == 0
                            clear siege weapon SiegeWeapon action queue
                            Target = marker at get target from {SiegeWeapon} to {GateHouse} distance 10 angle 180
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            ActionTimer = create timer for 0.025 seconds
                        end if
                    end if
                elsif NumPat1 == 3
                    Wall1 = get wall segment nearest {NearestSettlement} radius 400
                    if Wall1 exists and PLAYER of Wall1 == 0
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {Wall1} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                elsif NumPat1 == 4 or NumPat1 == 5
                    House = get building ALTAR in NearestSettlement min built 0.75
                    if House exists and PLAYER of House == 0 and SiegeWeapon can navigate to object oTownCentre
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {House} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using House to siege weapon SiegeWeapon action queue
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                elsif NumPat1 == 6
                    House = get building STORAGE_YARD in NearestSettlement min built 0.75
                    if House exists and PLAYER of House == 0 and SiegeWeapon can navigate to object oTownCentre
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {House} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using House to siege weapon SiegeWeapon action queue
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                else
                    House = get building TEMPLE in NearestSettlement min built 0.75
                    if House exists and PLAYER of House == 0 and SiegeWeapon can navigate to object oTownCentre
                        clear siege weapon SiegeWeapon action queue
                        Target = marker at get target from {SiegeWeapon} to {House} distance 10 angle 180
                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using House to siege weapon SiegeWeapon action queue
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                end if
            end if
            until SiegeWeapon not exists
        end loop
    end if

//end loop

end script LC8_MoveCatapultThenAttack

begin script LC8_Platoon10Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    PlayerSettlement = 0
    myTimer = create timer for 0 seconds
    
start

begin loop    

    if LC8_Platoon[10] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[10] exists
    end if
        
    PlayerCreature = get distance from {LC8_Platoon[10]} to {oCreature}
    if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[10] can navigate to {oCreature}
        clear LC8_Platoon[10] action queue
        begin loop
            PlayerCreature = get distance from {LC8_Platoon[10]} to {oCreature}
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[10] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[10]
            until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[10] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
        end loop
        clear LC8_Platoon[10] action queue
    end if
        
    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[10]} radius 200
    Catapult = get siege weapon of player 0 nearest {LC8_Platoon[10]} radius 150
    if PlayerPlatoon1 exists and LC8_Platoon[10] can navigate to {PlayerPlatoon1}
        clear LC8_Platoon[10] action queue
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[10]} radius 200 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[10] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[10]
            HeTeste1 = get number of villagers in platoon PlayerPlatoon1
            until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[10] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
        end loop
        clear LC8_Platoon[10] action queue
    elsif Catapult exists and LC8_Platoon[10] can navigate to {Catapult}
        clear LC8_Platoon[10] action queue
        a = 0
        begin loop
            Catapult = get siege weapon of player 0 nearest {LC8_Platoon[10]} radius 150 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC8_Platoon[10] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[10]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[10]} radius 200
            if PlayerPlatoon1 exists and LC8_Platoon[10] can navigate to {PlayerPlatoon1}
                a = 1
            end if
            until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[10] can navigate to {Catapult} or a == 1 or Catapult not exists
        end loop
        clear LC8_Platoon[10] action queue
        a = 0
    end if
        
    if {LC8_Platoon[10]} near {PatrolRouteA[0]} radius 10 or get myTimer time remaining <= 0
        myTimer = create timer for 120 seconds
        clear LC8_Platoon[10] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteA[1]} to LC8_Platoon[10] action queue
        wait 5 seconds
    elsif {LC8_Platoon[10]} near {PatrolRouteA[1]} radius 10
        clear LC8_Platoon[10] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteA[2]} to LC8_Platoon[10] action queue
        wait 5 seconds
    elsif {LC8_Platoon[10]} near {PatrolRouteA[2]} radius 10
        clear LC8_Platoon[10] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteA[3]} to LC8_Platoon[10] action queue
        wait 5 seconds
    elsif {LC8_Platoon[10]} near {PatrolRouteA[3]} radius 10
        clear LC8_Platoon[10] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteA[0]} to LC8_Platoon[10] action queue
        wait 5 seconds
    end if
        
end loop

end script LC8_Platoon10Actions

begin script LC8_Platoon11Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    PlayerSettlement = 0
    myTimer = create timer for 0 seconds
    
start

begin loop    

    if LC8_Platoon[11] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[11] exists
    end if
        
    PlayerCreature = get distance from {LC8_Platoon[11]} to {oCreature}
    if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[11] can navigate to {oCreature}
        clear LC8_Platoon[11] action queue
        begin loop
            PlayerCreature = get distance from {LC8_Platoon[11]} to {oCreature}
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[11] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[11]
            until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[11] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
        end loop
        clear LC8_Platoon[11] action queue
    end if
        
    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[11]} radius 200
    Catapult = get siege weapon of player 0 nearest {LC8_Platoon[11]} radius 150
    if PlayerPlatoon1 exists and LC8_Platoon[11] can navigate to {PlayerPlatoon1}
        clear LC8_Platoon[11] action queue
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[11]} radius 200 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[11] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[11]
            HeTeste1 = get number of villagers in platoon PlayerPlatoon1
            until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[11] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
        end loop
        clear LC8_Platoon[11] action queue
    elsif Catapult exists and LC8_Platoon[11] can navigate to {Catapult}
        clear LC8_Platoon[11] action queue
        a = 0
        begin loop
            Catapult = get siege weapon of player 0 nearest {LC8_Platoon[11]} radius 150 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC8_Platoon[11] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[11]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[11]} radius 200
            if PlayerPlatoon1 exists and LC8_Platoon[11] can navigate to {PlayerPlatoon1}
                a = 1
            end if
            until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[11] can navigate to {Catapult} or a == 1 or Catapult not exists
        end loop
        clear LC8_Platoon[11] action queue
        a = 0
    end if
        
    if {LC8_Platoon[11]} near {PatrolRouteB[0]} radius 10 or get myTimer time remaining <= 0
        myTimer = create timer for 120 seconds
        clear LC8_Platoon[11] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteB[3]} to LC8_Platoon[11] action queue
        wait 5 seconds
    elsif {LC8_Platoon[11]} near {PatrolRouteB[3]} radius 10
        clear LC8_Platoon[11] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteB[0]} to LC8_Platoon[11] action queue
        wait 5 seconds
    end if
        
end loop

end script LC8_Platoon11Actions

begin script LC8_Platoon42Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    PlayerSettlement = 0
    myTimer = create timer for 0 seconds
    
start

begin loop    

    if LC8_Platoon[42] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[42] exists
    end if
        
    PlayerCreature = get distance from {LC8_Platoon[42]} to {oCreature}
    if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[42] can navigate to {oCreature}
        clear LC8_Platoon[42] action queue
        begin loop
            PlayerCreature = get distance from {LC8_Platoon[42]} to {oCreature}
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[42] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[42]
            until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[42] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
        end loop
        clear LC8_Platoon[42] action queue
    end if
        
    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[42]} radius 200
    Catapult = get siege weapon of player 0 nearest {LC8_Platoon[42]} radius 150
    if PlayerPlatoon1 exists and LC8_Platoon[42] can navigate to {PlayerPlatoon1}
        clear LC8_Platoon[42] action queue
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[42]} radius 200 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[42] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[42]
            HeTeste1 = get number of villagers in platoon PlayerPlatoon1
            until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[42] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
        end loop
        clear LC8_Platoon[42] action queue
    elsif Catapult exists and LC8_Platoon[42] can navigate to {Catapult}
        clear LC8_Platoon[42] action queue
        a = 0
        begin loop
            Catapult = get siege weapon of player 0 nearest {LC8_Platoon[42]} radius 150 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC8_Platoon[42] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[42]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[42]} radius 200
            if PlayerPlatoon1 exists and LC8_Platoon[42] can navigate to {PlayerPlatoon1}
                a = 1
            end if
            until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[42] can navigate to {Catapult} or a == 1 or Catapult not exists
        end loop
        clear LC8_Platoon[42] action queue
        a = 0
    end if
        
    if LC8_Platoon[11] exists
        if get size of LC8_Platoon[42] action queue < 1
            add action PLATOON_AGENDA_ACTION_LINK_TO_ARMY_MEMBER using LC8_Platoon[11] to LC8_Platoon[42] action queue
        end if
    else
        if {LC8_Platoon[42]} near {PatrolRouteB[0]} radius 10 or get myTimer time remaining <= 0
            myTimer = create timer for 120 seconds
            clear LC8_Platoon[42] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteB[3]} to LC8_Platoon[42] action queue
            wait 5 seconds
        elsif {LC8_Platoon[42]} near {PatrolRouteB[3]} radius 10
            clear LC8_Platoon[42] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PatrolRouteB[0]} to LC8_Platoon[42] action queue
            wait 5 seconds
        end if
    end if
        
end loop

end script LC8_Platoon42Actions

begin script LC8_Platoon38Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    PlayerSettlement = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    
start

begin loop
    a = 0
    wait until LC8_Platoon[38] exists
    begin loop

        PlayerCreature = get distance from {LC8_Platoon[38]} to {oCreature}
        if PlayerCreature <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[38] can navigate to {oCreature}
            clear LC8_Platoon[38] action queue
            begin loop
                PlayerCreature = get distance from {LC8_Platoon[38]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[38] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[38]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[38] can navigate to {oCreature} or PlayerCreature > 150 * 1.25
            end loop
            clear LC8_Platoon[38] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[38]} radius 150
        Catapult = get siege weapon of player 0 nearest {LC8_Platoon[38]} radius 150
        if PlayerPlatoon1 exists and LC8_Platoon[38] can navigate to {PlayerPlatoon1}
            clear LC8_Platoon[38] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[38]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[38] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[38]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[38] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC8_Platoon[38] action queue
        elsif Catapult exists and LC8_Platoon[38] can navigate to {Catapult}
            clear LC8_Platoon[38] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC8_Platoon[38]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC8_Platoon[38] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[38]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[38]} radius 150
                if PlayerPlatoon1 exists and LC8_Platoon[38] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[38] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC8_Platoon[38] action queue
            a = 0
        end if
        
        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        if not LC8_Platoon[38] can navigate to object oTownCentre and LC8_SiegeCatapult[19] exists
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {LC8_SiegeCatapult[19]} + {20,0,20} to LC8_Platoon[38] action queue
            wait 5 seconds
        end if

        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        //if get size of LC8_Platoon[38] action queue < 1
            if LC8_Platoon[38] can navigate to object oTownCentre
                wait number from 5 to 25 seconds
                a = 1
                clear LC8_Platoon[38] action queue
                Number = number from 3 to 5
                if Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[38] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[38] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[38] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[38] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[38] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in NearestSettlement min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[38] action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[1] < 2
                        TownCapturePlatoons[1]++
                        set LC8_Platoon[38] attack NearestSettlement with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[38]} radius 150
                    TestCreature2 = get distance from {LC8_Platoon[38]} to {MyCreature}
                    NumPat1 = get number of villagers in platoon LC8_Platoon[38]
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC8_Platoon[38] can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town NearestSettlement is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town NearestSettlement is under takeover from player 1
                            a = 0
                        elsif not LC8_Platoon[38] can navigate to object oTownCentre
                            a = 0
                        elsif LC8_Platoon[38] not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town NearestSettlement is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC8_Platoon[38] not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[1]--
                end if
                clear LC8_Platoon[38] action queue
            else
                clear LC8_Platoon[38] action queue
            end if
        //end if

        until LC8_Platoon[38] not exists
    end loop
    if LC8_Platoon[38] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[38] exists
    end if
end loop

end script LC8_Platoon38Actions

begin script LC8_Platoon39Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    PlayerSettlement = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    
start

begin loop
    a = 0
    wait until LC8_Platoon[39] exists
    begin loop

        PlayerCreature = get distance from {LC8_Platoon[39]} to {oCreature}
        if PlayerCreature <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[39] can navigate to {oCreature}
            clear LC8_Platoon[39] action queue
            begin loop
                PlayerCreature = get distance from {LC8_Platoon[39]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[39] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[39]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[39] can navigate to {oCreature} or PlayerCreature > 150 * 1.25
            end loop
            clear LC8_Platoon[39] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[39]} radius 150
        Catapult = get siege weapon of player 0 nearest {LC8_Platoon[39]} radius 50
        if PlayerPlatoon1 exists and LC8_Platoon[39] can navigate to {PlayerPlatoon1}
            clear LC8_Platoon[39] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[39]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[39] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[39]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[39] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC8_Platoon[39] action queue
        elsif Catapult exists and LC8_Platoon[39] can navigate to {Catapult}
            clear LC8_Platoon[39] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC8_Platoon[39]} radius 50 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC8_Platoon[39] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[39]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[39]} radius 150
                if PlayerPlatoon1 exists and LC8_Platoon[39] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[39] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC8_Platoon[39] action queue
            a = 0
        end if

        //if get size of LC8_Platoon[39] action queue < 1
            if PlatoonArrived[0] == 0
                clear LC8_Platoon[39] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PortalPos[0]} to LC8_Platoon[39] action queue
            elsif LC8_Platoon[39] can navigate to object oTownCentre
                wait number from 5 to 25 seconds
                a = 1
                clear LC8_Platoon[39] action queue
                Number = number from 1 to 4
                if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                    AttackMode = 1
                    set LC8_Platoon[39] attack PlayerTown with severity 0.2
                elsif Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[39] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[39] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[39] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[39] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[39] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[39] action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[0] < 2
                        TownCapturePlatoons[0]++
                        set LC8_Platoon[39] attack PlayerTown with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[39]} radius 150
                    TestCreature2 = get distance from {LC8_Platoon[39]} to {MyCreature}
                    NumPat1 = get number of villagers in platoon LC8_Platoon[39]
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC8_Platoon[39] can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif not LC8_Platoon[39] can navigate to object oTownCentre
                            a = 0
                        elsif LC8_Platoon[39] not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC8_Platoon[39] not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[0]--
                end if
                clear LC8_Platoon[39] action queue
            elsif LC8_Platoon[39] can navigate to {AttackPos[2]} + {20,0,20}
                clear LC8_Platoon[39] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[2]} + {20,0,20} to LC8_Platoon[39] action queue
            elsif not {LC8_Platoon[39]} near {AttackPos[3]} + {20,0,20} radius 25
                clear LC8_Platoon[39] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[3]} + {20,0,20} to LC8_Platoon[39] action queue
            end if
        //end if

        until LC8_Platoon[39] not exists
    end loop
    if LC8_Platoon[39] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[39] exists
    end if
end loop

end script LC8_Platoon39Actions

begin script LC8_Platoon40Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    PlayerSettlement = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    
start

begin loop
    a = 0
    wait until LC8_Platoon[40] exists
    begin loop

        PlayerCreature = get distance from {LC8_Platoon[40]} to {oCreature}
        if PlayerCreature <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[40] can navigate to {oCreature}
            clear LC8_Platoon[40] action queue
            begin loop
                PlayerCreature = get distance from {LC8_Platoon[40]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[40] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[40]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[40] can navigate to {oCreature} or PlayerCreature > 150 * 1.25
            end loop
            clear LC8_Platoon[40] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[40]} radius 150
        Catapult = get siege weapon of player 0 nearest {LC8_Platoon[40]} radius 50
        if PlayerPlatoon1 exists and LC8_Platoon[40] can navigate to {PlayerPlatoon1}
            clear LC8_Platoon[40] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[40]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[40] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[40]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[40] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC8_Platoon[40] action queue
        elsif Catapult exists and LC8_Platoon[40] can navigate to {Catapult}
            clear LC8_Platoon[40] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC8_Platoon[40]} radius 50 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC8_Platoon[40] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[40]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[40]} radius 150
                if PlayerPlatoon1 exists and LC8_Platoon[40] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[40] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC8_Platoon[40] action queue
            a = 0
        end if

        //if get size of LC8_Platoon[40] action queue < 1
            if PlatoonArrived[1] == 0
                clear LC8_Platoon[40] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PortalPos[0]} to LC8_Platoon[40] action queue
            elsif LC8_Platoon[40] can navigate to object oTownCentre
                wait number from 5 to 25 seconds
                a = 1
                clear LC8_Platoon[40] action queue
                Number = number from 1 to 4
                if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                    AttackMode = 1
                    set LC8_Platoon[40] attack PlayerTown with severity 0.2
                elsif Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[40] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[40] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[40] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[40] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[40] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[40] action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[0] < 2
                        TownCapturePlatoons[0]++
                        set LC8_Platoon[40] attack PlayerTown with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[40]} radius 150
                    TestCreature2 = get distance from {LC8_Platoon[40]} to {MyCreature}
                    NumPat1 = get number of villagers in platoon LC8_Platoon[40]
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC8_Platoon[40] can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif not LC8_Platoon[40] can navigate to object oTownCentre
                            a = 0
                        elsif LC8_Platoon[40] not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC8_Platoon[40] not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[0]--
                end if
                clear LC8_Platoon[40] action queue
            elsif LC8_Platoon[40] can navigate to {AttackPos[2]} + {-20,0,-20}
                clear LC8_Platoon[40] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[2]} + {-20,0,-20} to LC8_Platoon[40] action queue
            elsif not {LC8_Platoon[40]} near {AttackPos[3]} + {-20,0,-20} radius 25
                clear LC8_Platoon[40] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[3]} + {-20,0,-20} to LC8_Platoon[40] action queue
            end if
        //end if

        until LC8_Platoon[40] not exists
    end loop
    if LC8_Platoon[40] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[40] exists
    end if
end loop

end script LC8_Platoon40Actions

begin script LC8_Platoon41Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    PlayerSettlement = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    
start

begin loop
    a = 0
    wait until LC8_Platoon[41] exists
    begin loop

        PlayerCreature = get distance from {LC8_Platoon[41]} to {oCreature}
        if PlayerCreature <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[41] can navigate to {oCreature}
            clear LC8_Platoon[41] action queue
            begin loop
                PlayerCreature = get distance from {LC8_Platoon[41]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to LC8_Platoon[41] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[41]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[41] can navigate to {oCreature} or PlayerCreature > 150 * 1.25
            end loop
            clear LC8_Platoon[41] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[41]} radius 150
        Catapult = get siege weapon of player 0 nearest {LC8_Platoon[41]} radius 50
        if PlayerPlatoon1 exists and LC8_Platoon[41] can navigate to {PlayerPlatoon1}
            clear LC8_Platoon[41] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[41]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to LC8_Platoon[41] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[41]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[41] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC8_Platoon[41] action queue
        elsif Catapult exists and LC8_Platoon[41] can navigate to {Catapult}
            clear LC8_Platoon[41] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC8_Platoon[41]} radius 50 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to LC8_Platoon[41] action queue
                NumPat1 = get number of villagers in platoon LC8_Platoon[41]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[41]} radius 150
                if PlayerPlatoon1 exists and LC8_Platoon[41] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[41] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC8_Platoon[41] action queue
            a = 0
        end if

        //if get size of LC8_Platoon[41] action queue < 1
            if PlatoonArrived[2] == 0
                clear LC8_Platoon[41] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {PortalPos[0]} to LC8_Platoon[41] action queue
            elsif LC8_Platoon[41] can navigate to object oTownCentre
                wait number from 5 to 25 seconds
                a = 1
                clear LC8_Platoon[41] action queue
                Number = number from 1 to 4
                if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                    AttackMode = 1
                    set LC8_Platoon[41] attack PlayerTown with severity 0.2
                elsif Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[41] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[41] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[41] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[41] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[41] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC8_Platoon[41] action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[0] < 2
                        TownCapturePlatoons[0]++
                        set LC8_Platoon[41] attack PlayerTown with severity 0.3 for takeover
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[41]} radius 150
                    TestCreature2 = get distance from {LC8_Platoon[41]} to {MyCreature}
                    NumPat1 = get number of villagers in platoon LC8_Platoon[41]
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC8_Platoon[41] can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif not LC8_Platoon[41] can navigate to object oTownCentre
                            a = 0
                        elsif LC8_Platoon[41] not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC8_Platoon[41] not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[0]--
                end if
                clear LC8_Platoon[41] action queue
            elsif LC8_Platoon[41] can navigate to {AttackPos[2]}
                clear LC8_Platoon[41] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[2]} to LC8_Platoon[41] action queue
            elsif not {LC8_Platoon[41]} near {AttackPos[3]} radius 25
                clear LC8_Platoon[41] action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[3]} to LC8_Platoon[41] action queue
            end if
        //end if

        until LC8_Platoon[41] not exists
    end loop
    if LC8_Platoon[41] not exists
        //PlatoonKilled = 1
        wait until LC8_Platoon[41] exists
    end if
end loop

end script LC8_Platoon41Actions

begin script LC8_Platoon20Actions

    oCreature = get player 0 creature
    HeTeste3 = 0
    TestCreature2 = 0
    NumPat = 0
    NumPat5 = 0
    PlayerPlatoon1 = 0
    WorrNum = 0
    JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in MinorTown2 min built 1.0
    ProPlatoonsLocation = 0
    AIPlatoon1 = 0
    Armory = 0
    Town8 = get town with id 8
    RandomActionP3 = 0
    a = 1
    Timer = create timer for 0 seconds
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    oWall = 0
    PlayerCatapult1 = 0
    PlayerPlatoonInRange = 0
    TownCaptured = 0
    PlayerSettlement = 0
    
start

begin loop
    
    wait until LC8_Platoon[20] exists

    TestCreature2 = get distance from {LC8_Platoon[20]} to {oCreature}
    if TestCreature2 <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[20] can navigate to {oCreature}
        clear LC8_Platoon[20] action queue
        begin loop
            TestCreature2 = get distance from {LC8_Platoon[20]} to {oCreature}
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[20] action queue
            NumPat5 = get number of villagers in platoon LC8_Platoon[20]
            until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[20] can navigate to {oCreature} or TestCreature2 > 200 * 1.25
        end loop
        clear LC8_Platoon[20] action queue
    end if
    
    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[20]} radius 200
    PlayerCatapult1 = get siege weapon of player 0 nearest {LC8_Platoon[20]} radius 150
    if PlayerPlatoon1 exists and LC8_Platoon[20] can navigate to {PlayerPlatoon1}
        clear LC8_Platoon[20] action queue
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[20]} radius 200 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[20] action queue
            NumPat5 = get number of villagers in platoon LC8_Platoon[20]
            HeTeste3 = get number of villagers in platoon PlayerPlatoon1
            until NumPat5 == 0 or HeTeste3 == 0 or not LC8_Platoon[20] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
        end loop
        clear LC8_Platoon[20] action queue
    elsif PlayerCatapult1 exists and LC8_Platoon[20] can navigate to {PlayerCatapult1}
        clear LC8_Platoon[20] action queue
        a = 0
        begin loop
            PlayerCatapult1 = get siege weapon of player 0 nearest {LC8_Platoon[20]} radius 150 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC8_Platoon[20] action queue
            NumPat5 = get number of villagers in platoon LC8_Platoon[20]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[20]} radius 200
            if PlayerPlatoon1 exists and LC8_Platoon[20] can navigate to {PlayerPlatoon1}
                a = 1
            end if
            until NumPat5 == 0 or PlayerCatapult1 not exists or not LC8_Platoon[20] can navigate to {PlayerCatapult1} or a == 1 or PlayerCatapult1 not exists
        end loop
        clear LC8_Platoon[20] action queue
        a = 0
    end if

    if LC8_Platoon[20] can navigate to object JapaneseTownCentre and PLAYER of MinorTown2 != 1 and TownCaptured == 0
        a = 1
        clear LC8_Platoon[20] action queue
        if LC8_Platoon[20] can navigate to object JapaneseTownCentre and PLAYER of MinorTown2 != 1
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[20]} radius 150
                TestCreature2 = get distance from {LC8_Platoon[20]} to {oCreature}
                set LC8_Platoon[20] attack MinorTown2 with severity 0.7 for takeover
                if PlayerPlatoon1 exists
                    a = 0
                elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                    a = 0
                elsif not LC8_Platoon[20] can navigate to object JapaneseTownCentre
                    a = 0
                elsif LC8_Platoon[20] not exists
                    a = 0
                elsif PLAYER of MinorTown2 == 1
                    a = 0
                end if
                until a == 0 or LC8_Platoon[20] not exists
            end loop
        end if
        clear LC8_Platoon[20] action queue
    end if
    if LC8_Platoon[20] can navigate to {MinorTown2} + {20,0,20} and PLAYER of MinorTown2 == 1
        TownCaptured = 1
        clear LC8_Platoon[20] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {MinorTown2} + {20,0,20} to LC8_Platoon[20] action queue
    end if
    
end loop

end script LC8_Platoon20Actions

begin script LC8_Platoon21Actions

    oCreature = get player 0 creature
    HeTeste3 = 0
    TestCreature2 = 0
    NumPat = 0
    NumPat5 = 0
    PlayerPlatoon1 = 0
    WorrNum = 0
    JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in MinorTown2 min built 1.0
    ProPlatoonsLocation = 0
    AIPlatoon1 = 0
    Armory = 0
    Town8 = get town with id 8
    RandomActionP3 = 0
    a = 1
    Timer = create timer for 0 seconds
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    oWall = 0
    PlayerCatapult1 = 0
    PlayerPlatoonInRange = 0
    TownCaptured = 0
    PlayerSettlement = 0
    
start

begin loop
    
    wait until LC8_Platoon[21] exists

    TestCreature2 = get distance from {LC8_Platoon[21]} to {oCreature}
    if TestCreature2 <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[21] can navigate to {oCreature}
        clear LC8_Platoon[21] action queue
        begin loop
            TestCreature2 = get distance from {LC8_Platoon[21]} to {oCreature}
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC8_Platoon[21] action queue
            NumPat5 = get number of villagers in platoon LC8_Platoon[21]
            until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[21] can navigate to {oCreature} or TestCreature2 > 200 * 1.25
        end loop
        clear LC8_Platoon[21] action queue
    end if
    
    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[21]} radius 200
    PlayerCatapult1 = get siege weapon of player 0 nearest {LC8_Platoon[21]} radius 150
    if PlayerPlatoon1 exists and LC8_Platoon[21] can navigate to {PlayerPlatoon1}
        clear LC8_Platoon[21] action queue
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[21]} radius 200 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC8_Platoon[21] action queue
            NumPat5 = get number of villagers in platoon LC8_Platoon[21]
            HeTeste3 = get number of villagers in platoon PlayerPlatoon1
            until NumPat5 == 0 or HeTeste3 == 0 or not LC8_Platoon[21] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
        end loop
        clear LC8_Platoon[21] action queue
    elsif PlayerCatapult1 exists and LC8_Platoon[21] can navigate to {PlayerCatapult1}
        clear LC8_Platoon[21] action queue
        a = 0
        begin loop
            PlayerCatapult1 = get siege weapon of player 0 nearest {LC8_Platoon[21]} radius 150 * 1.25
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC8_Platoon[21] action queue
            NumPat5 = get number of villagers in platoon LC8_Platoon[21]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[21]} radius 200
            if PlayerPlatoon1 exists and LC8_Platoon[21] can navigate to {PlayerPlatoon1}
                a = 1
            end if
            until NumPat5 == 0 or PlayerCatapult1 not exists or not LC8_Platoon[21] can navigate to {PlayerCatapult1} or a == 1 or PlayerCatapult1 not exists
        end loop
        clear LC8_Platoon[21] action queue
        a = 0
    end if

    if LC8_Platoon[21] can navigate to object JapaneseTownCentre and PLAYER of MinorTown2 != 1 and TownCaptured == 0
        a = 1
        clear LC8_Platoon[21] action queue
        if LC8_Platoon[21] can navigate to object JapaneseTownCentre and PLAYER of MinorTown2 != 1
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[21]} radius 150
                TestCreature2 = get distance from {LC8_Platoon[21]} to {oCreature}
                set LC8_Platoon[21] attack MinorTown2 with severity 0.7 for takeover
                if PlayerPlatoon1 exists
                    a = 0
                elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                    a = 0
                elsif not LC8_Platoon[21] can navigate to object JapaneseTownCentre
                    a = 0
                elsif LC8_Platoon[21] not exists
                    a = 0
                elsif PLAYER of MinorTown2 == 1
                    a = 0
                end if
                until a == 0 or LC8_Platoon[21] not exists
            end loop
        end if
        clear LC8_Platoon[21] action queue
    end if
    if LC8_Platoon[21] can navigate to {MinorTown2} + {-20,0,-20} and PLAYER of MinorTown2 == 1
        TownCaptured = 1
        clear LC8_Platoon[21] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {MinorTown2} + {-20,0,-20} to LC8_Platoon[21] action queue
    end if
    
end loop

end script LC8_Platoon21Actions

begin script LC8_Platoon43Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = 0
    Number = 0
    PlatoonFirstTime = 1
    PlayerSettlement = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    TownToAttack = 0
    
start

begin loop
    a = 0
    wait until LC8_Platoon[43] exists

    PlayerCreature = get distance from {LC8_Platoon[43]} to {oCreature}
    if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC8_Platoon[43] can navigate to {oCreature}
        clear LC8_Platoon[43] action queue
        begin loop
            PlayerCreature = get distance from {LC8_Platoon[43]} to {oCreature}
            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to LC8_Platoon[43] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[43]
            until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC8_Platoon[43] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
        end loop
        clear LC8_Platoon[43] action queue
    end if
    
    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[43]} radius 200
    Catapult = get siege weapon of player 0 nearest {LC8_Platoon[43]} radius 150
    if PlayerPlatoon1 exists and LC8_Platoon[43] can navigate to {PlayerPlatoon1}
        clear LC8_Platoon[43] action queue
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[43]} radius 200 * 1.25
            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to LC8_Platoon[43] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[43]
            HeTeste1 = get number of villagers in platoon PlayerPlatoon1
            until NumPat1 == 0 or HeTeste1 == 0 or not LC8_Platoon[43] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
        end loop
        clear LC8_Platoon[43] action queue
    elsif Catapult exists and LC8_Platoon[43] can navigate to {Catapult}
        clear LC8_Platoon[43] action queue
        a = 0
        begin loop
            Catapult = get siege weapon of player 0 nearest {LC8_Platoon[43]} radius 150 * 1.25
            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to LC8_Platoon[43] action queue
            NumPat1 = get number of villagers in platoon LC8_Platoon[43]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[43]} radius 200
            if PlayerPlatoon1 exists and LC8_Platoon[43] can navigate to {PlayerPlatoon1}
                a = 1
            end if
            until NumPat1 == 0 or Catapult not exists or not LC8_Platoon[43] can navigate to {Catapult} or a == 1 or Catapult not exists
        end loop
        clear LC8_Platoon[43] action queue
        a = 0
    end if

    PlayerSettlement = get nearest town at {LC8_Platoon[43]} for player 0 radius 500
    //Not a Armory, it's a towncentre.
    Armory = get building ABODE_NUMBER_TOWN_CENTRE in PlayerSettlement min built 1.0
    if Armory exists and PlayerSettlement != PlayerTown and PLAYER of PlayerSettlement == 0 and HEALTH of Armory == 1.0 and not variable get town PlayerSettlement status == variable TOWN_STATUS_MIGRATION_STARTED
        if LC8_Platoon[43] can navigate to object Armory
            if TownCapturePlatoons[2] < 2
                TownCapturePlatoons[2]++
                clear LC8_Platoon[43] action queue
                set LC8_Platoon[43] attack PlayerSettlement with severity 0.3 for takeover
                a = 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[43]} radius 75
                    PlayerCreature = get distance from {LC8_Platoon[43]} to {oCreature}
                    if PlayerPlatoon1 exists
                        a = 0
                    elsif PlayerCreature <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                        a = 0
                    elsif not LC8_Platoon[43] can navigate to object Armory
                        a = 0
                    elsif LC8_Platoon[43] not exists
                        a = 0
                    end if
                    until a == 0 or LC8_Platoon[43] not exists or PLAYER of PlayerSettlement == 1
                end loop
                TownCapturePlatoons[2]--
            end if
            clear LC8_Platoon[43] action queue
        end if
    end if

    if PLAYER of MinorTown2 != 1
        TownToAttack = MinorTown2
    else
        TownToAttack = MinorTown3
    end if
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in TownToAttack min built 1.0
    if LC8_Platoon[43] can navigate to object oTownCentre and PLAYER of TownToAttack != 1
        //wait number from 5 to 25 seconds
        a = 1
        clear LC8_Platoon[43] action queue
        Number = 1
        if Number == 1 //Capture Town
            AttackMode = 0
            set LC8_Platoon[43] attack TownToAttack with severity 0.3 for takeover
        end if
        RecalculateTimer = create timer for 40 seconds
        begin loop
            PlayerPlatoon1 = get platoon of player 0 nearest {LC8_Platoon[43]} radius 150
            TestCreature2 = get distance from {LC8_Platoon[43]} to {MyCreature}
            NumPat1 = get number of villagers in platoon LC8_Platoon[43]
            //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC8_Platoon[43] can navigate to object TownToAttackCentre
                if PlayerPlatoon1 exists and not town TownToAttack is under takeover from player 1
                    a = 0
                elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town TownToAttack is under takeover from player 1
                    a = 0
                elsif not LC8_Platoon[43] can navigate to object oTownCentre
                    a = 0
                elsif LC8_Platoon[43] not exists
                    a = 0
                elsif AttackMode == 1 and HEALTH of MyCreature == 0
                    a = 0
                elsif AttackMode == 2 and Building not exists
                    a = 0
                elsif AttackMode == 2 and HEALTH of Building < 0.1
                    a = 0
                elsif AttackMode == 2 and Building == 0
                    a = 0
                elsif not town TownToAttack is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                    a = 0
                end if
            //end if
            until a == 0 or LC8_Platoon[43] not exists
        end loop
        clear LC8_Platoon[43] action queue
    elsif LC8_Platoon[43] can navigate to {1544.35,104.56,1523.21} and not {LC8_Platoon[43]} near {1544.35,104.56,1523.21} radius 25 and get size of LC8_Platoon[43] action queue < 1
        clear LC8_Platoon[43] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {1544.35,104.56,1523.21} to LC8_Platoon[43] action queue
    end if

end loop

end script LC8_Platoon43Actions
