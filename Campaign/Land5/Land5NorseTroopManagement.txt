///////////////////////////////////////////////////////////////////////////////
//    Land 5 Norse Troop-Management
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//    Globals
//-----------------------------------------------------------------------------

define LC5_NUM_OF_DEFENDERS               = 0 //Unused
define LC5_NUM_OF_PLATOONS                = 50 //37
define LC5_NUM_OF_SIEGE_CATAPULTS         = 20
define LC5_NUM_OF_WALL_ARCHERS            = 5
//Army Types
define Melee                              = 0
define Ranged                             = 1
//Army Behaivours
define Attacker                           = 0 //Attack PlayerTown
define Conqueror                          = 1 //Capture town defined in GetNearestSettlement script
define Patrol                             = 2 //Do some patrols
define Special                            = 3 //Special behaviour different on each map
//Attack Focus
define Default                            = 0 //Balanced attack strategy
define Houses                             = 1 //Attack Houses
define Epics                              = 2 //Attack Epics
define Altars                             = 3 //Attack Altars
define CreaturePen                        = 4 //Attack CreaturePen
define TownCenter                         = 5 //Attack Town
define Villagers                          = 6 //Attack Villagers NOT WORKING, PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA
//Aggressiveness
define Passive                            = 0 //Try to do objectives, only defend yourself
define Neutral                            = 1 //0.75 Search radius for enemy troops, and much less likely to give up objectives
define Alerted                            = 2 //1.0 Search radius for enemy troops, and less likely to give up objectives
define Aggressive                         = 3 //2.0 Search radius for enemy troops, and will always give up objectives for enemy troops

define CHANCE_TO_SPLIT = 20
define CHANCE_TO_MERGE = 40

define script Waypoints
define script AttackRndAttackLogic
define script AttackSyncTimerLogic
define script PlatoonTargetingMetric(PlatoonSize,TargetTown)
define script CatapultTargetingMetric(TargetTown)
define script LC5_StaticPlatoonsController
define script LC5_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)
define script LC5_ArmyBehaivours(Platoon,Type,Task,DefendObject,AttackFocus,Aggressiveness,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,Splitted)
define script LC5_MoveCatapultThenAttack(SiegeWeapon,Task,AttackFocus,AttackWP1,AttackWP2,AttackWP3,AttackingPoint1,AttackingPoint2)
define script LC5_AttackEnemyTown(myPlatoon,enemyTown)

global LC5_Defender[LC5_NUM_OF_DEFENDERS]
global LC5_Platoon[LC5_NUM_OF_PLATOONS]
global LC5_SiegeCatapult[LC5_NUM_OF_SIEGE_CATAPULTS]
global LC5_WallArcher[LC5_NUM_OF_WALL_ARCHERS]
global LC5_StaticPlatoonCounter = 0
global PlatoonTargetingMetricFocusResult = 0
global CatapultTargetingMetricFocusResult = 0
global AttackersSent = 0

global PlatoonPos[24]
global AttackPos[4]
global AttackPosFront[3]
global AttackPosFlank[3]
global AttackPosBack[3]
global AttackSyncTimer = 0
global SiegePlatoonPos[1]
global SiegeRoute1[3]
global PlayerWallPos = 0
global StaticPlatoonGoodPos[4]
global StaticPlatoonGoodWaypoint = 0
global StaticPlatoonEvilPos[3]
global StaticPlatoonEvilWaypoint = 0

global PatrolRouteA[5]
global WaypointsA = 0

//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
//    Setting up waypoints for AI actions
//-----------------------------------------------------------------------------

run script Waypoints

begin script Waypoints

start

    PlayerWallPos = marker at {1230.47,121.51,758.87}

    PlatoonPos[0] = marker at {574.96,150.21,827.35}
    PlatoonPos[1] = marker at {621.22,156.17,862.99}
    PlatoonPos[2] = marker at {603.49,154.59,899.03}
    PlatoonPos[3] = marker at {1575.25,158.63,786.15}
    PlatoonPos[4] = marker at {1610.29,163.69,852.09}
    PlatoonPos[5] = marker at {1940.22,258.90,1242.46}
    PlatoonPos[6] = marker at {1937.70,247.63,1391.58}
    PlatoonPos[7] = marker at {1844.46,266.70,1311.65}
    PlatoonPos[8] = marker at {1631.92,105.46,2195.38}
    PlatoonPos[9] = marker at {1560.38,90.01,2310.50}
    PlatoonPos[10] = marker at {1516.67,100.86,2237.27}
    PlatoonPos[11] = marker at {1533.39,139.70,2037.97}
    PlatoonPos[12] = marker at {1470.08,130.99,2066.80}
    
    AttackPos[0] = marker at {1393.29,167.33,723.34}//Front
    AttackPos[1] = marker at {1673.47,184.19,957.24}//Front Fallback
    AttackPos[2] = marker at {1009.53,136.47,574.79}//Back
    AttackPos[3] = marker at {683.46,119.75,646.17}//Back Fallback

    AttackPosFront[0] = marker at {1428.68,173.63,1901.30}
    AttackPosFront[1] = marker at {1740.08,195.57,1605.36}
    AttackPosFront[2] = marker at {1738.55,260.65,1183.95}
    AttackPosFlank[0] = marker at {1332.44,175.88,1919.09}
    AttackPosFlank[1] = marker at {486.99,144.17,1606.48}
    AttackPosFlank[2] = marker at {441.28,131.48,1080.50}
    AttackPosBack[0] = marker at {1332.44,175.88,1919.09}
    AttackPosBack[1] = marker at {486.99,144.17,1606.48}
    AttackPosBack[2] = marker at {441.28,131.48,1080.50}
    
    SiegePlatoonPos[0] = marker at {1313.19,294.29,1797.43}

    PatrolRouteA[0] = marker at {406.14,122.47,1603.40}
    PatrolRouteA[1] = marker at {1112.25,169.05,1954.41}
    PatrolRouteA[2] = marker at {1488.56,177.78,1882.29}
    PatrolRouteA[3] = marker at {1713.98,194.14,1646.23}
    PatrolRouteA[4] = marker at {2058.26,156.38,1695.30}

    WaypointsA = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}

    add {PatrolRouteA[0]} to waypoint list WaypointsA
    add {PatrolRouteA[1]} to waypoint list WaypointsA
    add {PatrolRouteA[2]} to waypoint list WaypointsA
    add {PatrolRouteA[3]} to waypoint list WaypointsA
    add {PatrolRouteA[4]} to waypoint list WaypointsA

    //Waypoints nearby own towns
    StaticPlatoonGoodPos[0] = marker at {1936.51,96.02,2055.86}
    StaticPlatoonGoodPos[1] = marker at {1459.48,177.20,1887.47}
    StaticPlatoonGoodPos[2] = marker at {1097.40,164.09,1968.93}
    StaticPlatoonGoodPos[3] = marker at {1499.63,135.50,2057.52}
    //Waypoints nearby neutral towns which is likely to be taken by player
    StaticPlatoonEvilPos[0] = marker at {1851.17,138.56,1788.32}
    StaticPlatoonEvilPos[1] = marker at {831.03,207.10,1724.27}
    StaticPlatoonEvilPos[2] = marker at {575.56,149.84,878.01}

end script Waypoints

begin script AttackRndAttackLogic

    RndAttackPrevious = 0

start

wait until NorseCommanderArrived == 1
wait 90 seconds
RndAttack = number from 1 to 5
RndAttackPrevious = RndAttack
//say "RndAttack = $d" with number RndAttack

begin loop
    if AttackersSent == 1
        //say "AttackersSent = 1"
        wait 150 seconds
        begin loop
            RndAttack = number from 1 to 5
            until RndAttack != RndAttackPrevious
        end loop
        //say "AttackersSent = 0"
        AttackersSent = 0
        RndAttackPrevious = RndAttack
    else
        wait 60 seconds
    end if
end loop

end script AttackRndAttackLogic

begin script AttackSyncTimerLogic

start

AttackSyncTimer = create timer for 0 seconds
begin loop
    if get AttackSyncTimer time remaining <= 0
        wait 2.5 seconds
        AttackSyncTimer = create timer for 75 seconds
    end if
end loop

end script AttackSyncTimerLogic

begin script PlatoonTargetingMetric(PlatoonSize,TargetTown)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player 0 mana > 20000
    AltarsProbability += 60
end if

if get player 0 mana > 50000
    AltarsProbability += 60
end if

if adult size of PlayerTown > 120
    VillagersProbability *= adult size of PlayerTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

PlatoonTargetingMetricFocusResult = DesiredTarget

//say "PlatoonTargetingMetricFocusResult = $d" with number PlatoonTargetingMetricFocusResult

end script PlatoonTargetingMetric

begin script CatapultTargetingMetric(TargetTown)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player 0 mana > 10000
    AltarsProbability += 60
end if

if get player 0 mana > 30000
    AltarsProbability += 60
end if

if adult size of PlayerTown > 120
    VillagersProbability *= adult size of PlayerTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

CatapultTargetingMetricFocusResult = DesiredTarget

end script CatapultTargetingMetric

//-----------------------------------------------------------------------------

begin script LC5_StaticPlatoonsController

start

begin loop
    wait 15 seconds
    if get StaticPlatoonsActionTimer time remaining <= 0
        StaticPlatoonGoodWaypoint = StaticPlatoonGoodPos[number from 0 to 3]
        StaticPlatoonEvilWaypoint = StaticPlatoonEvilPos[number from 0 to 2]
        wait 60 seconds //Give platoons 60 seconds to react to new orders
        StaticPlatoonsActionTimer = create timer for number from 300 to 1200 seconds
    end if
end loop

end script LC5_StaticPlatoonsController

begin script LC5_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)

    ThisStaticPlatoonActionTimer = create timer for 0 seconds
    ThisStaticPlatoonActive = 0
    ThisStaticPlatoonWaypoint = 0
    ThisOriginTownEmergency = 0
    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    a = 0
    PlayerSettlement = 0
    ThresholdStatic = 0

start

LC5_StaticPlatoonCounter++

begin loop

    if Type == Melee
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    if get ThisStaticPlatoonActionTimer time remaining <= 0
        ThisStaticPlatoonActionTimer = create timer for number from 25 to 35 seconds
        //If emergency in OriginTown go defend it
        PlayerPlatoon1 = get platoon of player 0 nearest {OriginTown} radius 500
        Catapult = get siege weapon of player 0 nearest {OriginTown} radius 500
        PlayerCreature = get distance from {OriginTown} to {oCreature}
        if PlayerPlatoon1 exists or Catapult exists or (PlayerCreature <= 500 and HEALTH of oCreature > 0.00)
            ThisOriginTownEmergency = 1
        else
            ThisOriginTownEmergency = 0
        end if
        if ThisOriginTownEmergency == 1
            if ThisStaticPlatoonActive == 1
                StaticPlatoonsActive--
                ThisStaticPlatoonActive = 0
            end if
        end if
    end if

    if get StaticPlatoonsActionTimer time remaining <= 0
        //say "DEBUG: StaticPlatoonsActive = $d" with number StaticPlatoonsActive
        if get ThisStaticPlatoonActionTimer time remaining <= 5
            wait 5 seconds
            if number from 1 to 4 == 4
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 0 and StaticPlatoonsActive <= LC5_StaticPlatoonCounter * 0.8 //80% of all static platoons max
                    StaticPlatoonsActive++
                    ThisStaticPlatoonActive = 1
                end if
            else
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 1
                    StaticPlatoonsActive--
                    ThisStaticPlatoonActive = 0
                end if
            end if
        end if
    end if

    if ThisStaticPlatoonActive == 0 and get size of Platoon action queue < 1 and ({Platoon} not near {Pos} radius 25 or get player 0 influence at {Pos} > 0)
        if get player 0 influence at {Pos} > 0
            ThresholdStatic = 10
            begin loop
                Pos = marker at {Pos} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {Pos} and get player 0 influence at {Pos} == 0) or ThresholdStatic > 999
            end loop
        end if
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Pos} to Platoon action queue
    elsif ThisStaticPlatoonActive == 1 and get size of Platoon action queue < 1 and ({Platoon} not near {ThisStaticPlatoonWaypoint} radius 25 or ThisStaticPlatoonWaypoint == 0 or get player 0 influence at {Pos} > 0)
        if PlayerAlignmentFinal < 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonEvilWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        elsif PlayerAlignmentFinal >= 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonGoodWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        end if
    end if

    until Platoon not exists
end loop

if ThisStaticPlatoonActive == 1
    ThisStaticPlatoonActive = 0
    StaticPlatoonsActive--
end if

LC5_StaticPlatoonCounter--

end script LC5_StaticPlatoonsActions

begin script LC5_ArmyBehaivours(Platoon,Type,Task,DefendObject,AttackFocus,Aggressiveness,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,Splitted)

    AttackWPStage = 0
    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    a = 0
    PlayerSettlement = 0
    Armory = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    Threshold = 1
    AttackRadius = 0
    AttackRadiusCatapult = 0
    AbortObjectiveProbability = 0
    AttackWP1Persistent = AttackWP1
    AttackWP2Persistent = AttackWP2
    AttackWP3Persistent = AttackWP3
    PlatoonSize = get number of villagers in platoon Platoon
    SplitUpChance = number from 100 to 100
    MergeChance = number from 1 to 100
    SplitDone = 0
    MergeDone = 0
    NewPlatoon = 0

start

if MergeChance >= SplitUpChance
    SplitUpChance = 0
else
    MergeChance = 0
end if

if Splitted == 1
    AttackWPStage = 3
end if

AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}

if Aggressiveness == Passive
    AttackRadius = 10
    AttackRadiusCatapult = 0
    AbortObjectiveProbability = 0
elsif Aggressiveness == Neutral
    AttackRadius = 100
    AttackRadiusCatapult = 75
    AbortObjectiveProbability = 25
elsif Aggressiveness == Alerted
    AttackRadius = 200
    AttackRadiusCatapult = 125
    AbortObjectiveProbability = 75
elsif Aggressiveness == Aggressive
    AttackRadius = 325
    AttackRadiusCatapult = 200
    AbortObjectiveProbability = 100
end if

//Group Attackers up first
if Platoon == LC5_Platoon[15] or Platoon == LC5_Platoon[16]
    wait until LC5_Platoon[15] exists and LC5_Platoon[16] exists
    AttackersSent = 1
end if

if Platoon == LC5_Platoon[17]
    AttackersSent = 1
end if

if Platoon == LC5_Platoon[18]
    AttackersSent = 1
end if

if Platoon == LC5_Platoon[19] or Platoon == LC5_Platoon[20] or Platoon == LC5_Platoon[21]
    wait until LC5_Platoon[19] exists and LC5_Platoon[20] exists and LC5_Platoon[21] exists
    AttackersSent = 1
end if

if Platoon == LC5_Platoon[22] or Platoon == LC5_Platoon[23]
    wait until LC5_Platoon[22] exists and LC5_Platoon[23] exists
    AttackersSent = 1
end if

if Platoon == LC5_Platoon[24]
    AttackersSent = 1
end if

begin loop
    //Attack nearby enemies
    if Type == Melee and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > AttackRadius * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
        Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > AttackRadius * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
        Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    //Capture nearby settlements
    PlayerSettlement = get nearest town at {Platoon} for player 0 radius AttackRadius * 1.5
    //Not a Armory, it's a towncentre.
    Armory = get building ABODE_NUMBER_TOWN_CENTRE in PlayerSettlement min built 1.0
    if Armory exists and PlayerSettlement != PlayerTown and PLAYER of PlayerSettlement == 0 and Task != Conqueror and HEALTH of Armory == 1.0 and not variable get town PlayerSettlement status == variable TOWN_STATUS_MIGRATION_STARTED
        if Platoon can navigate to object Armory
            if TownCapturePlatoons[0] < 2
                TownCapturePlatoons[0]++
                clear Platoon action queue
                set Platoon attack PlayerSettlement with severity 0.3 for takeover
                a = 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                    PlayerCreature = get distance from {Platoon} to {oCreature}
                    if PlayerPlatoon1 exists
                        a = 0
                    elsif PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                        a = 0
                    elsif not Platoon can navigate to object Armory
                        a = 0
                    elsif Platoon not exists
                        a = 0
                    end if
                    until a == 0 or Platoon not exists or PLAYER of PlayerSettlement == 1
                end loop
                TownCapturePlatoons[0]--
            end if
            clear Platoon action queue
        end if
    end if

    //Basic tasks
    if Task == Attacker
        //if get size of Platoon action queue < 1
            //Way to target town
            if AttackWPStage == 0
                if not Platoon can navigate to {AttackWP1}
                    Number = 0
                    begin loop
                        AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                        Number++
                        until Platoon not exists or Platoon can navigate to {AttackWP1} or Number > 10
                    end loop
                end if
                if not {Platoon} near {AttackWP1} radius 33
                    clear Platoon action queue
                    if not DefendObject exists
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP1} to Platoon action queue
                    elsif not {Platoon} near {DefendObject} radius 25
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
                if DefendObject exists and {Platoon} near {AttackWP1} radius 200
                    AttackWPStage = 1
                    //say "AttackWPStage = 1"
                elsif {Platoon} near {AttackWP1} radius 33
                    AttackWPStage = 1
                    //say "AttackWPStage = 1"
                end if
            elsif AttackWPStage == 1
                if not Platoon can navigate to {AttackWP2}
                    Number = 0
                    begin loop
                        AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                        Number++
                        until Platoon not exists or Platoon can navigate to {AttackWP2} or Number > 10
                    end loop
                end if
                if not {Platoon} near {AttackWP2} radius 33 and get AttackSyncTimer time remaining <= 0
                    clear Platoon action queue
                    if not DefendObject exists
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP2} to Platoon action queue
                    elsif not {Platoon} near {DefendObject} radius 25
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
                if DefendObject exists and {Platoon} near {AttackWP2} radius 200
                    AttackWPStage = 2
                    //say "AttackWPStage = 2"
                elsif {Platoon} near {AttackWP2} radius 33
                    AttackWPStage = 2
                    //say "AttackWPStage = 2"
                end if
            elsif AttackWPStage == 2
                if not Platoon can navigate to {AttackWP3}
                    Number = 0
                    begin loop
                        AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                        Number++
                        until Platoon not exists or Platoon can navigate to {AttackWP3} or Number > 10
                    end loop
                end if
                if not {Platoon} near {AttackWP3} radius 33
                    clear Platoon action queue
                    if not DefendObject exists
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP3} to Platoon action queue
                    elsif not {Platoon} near {DefendObject} radius 25
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
                if DefendObject exists and {Platoon} near {AttackWP3} radius 200
                    AttackWPStage = 3
                    //say "AttackWPStage = 3"
                elsif {Platoon} near {AttackWP3} radius 33
                    AttackWPStage = 3
                    //say "AttackWPStage = 3"
                end if
            end if
            //Targeting
            if AttackWPStage == 3
                wait number from 5 to 25 seconds
                //say "PLATOON ATTACKING"
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                if PLAYER of PlayerTown != 0
                    //Switch task to conqueror to attack all remaining cities
                    Task = Conqueror
                    AttackFocus = Default
                elsif Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                    //say "Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0"
                    a = 0
                    if AttackFocus == Default
                        //say "AttackFocus == Default"
                        clear Platoon action queue
                        Number = number from 1 to 4
                        if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                            AttackMode = 1
                            set Platoon attack PlayerTown with severity 0.2
                        elsif Number == 3 or Number == 4 //Destroy value buildings
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        else //Capture Town
                            AttackMode = 0
                            if TownCapturePlatoons[0] < 2
                                TownCapturePlatoons[0]++
                                set Platoon attack PlayerTown with severity 0.3 for takeover
                            end if
                        end if
                    elsif AttackFocus == Houses
                
                        //say "AttackFocus == Houses"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        //say "AttackFocus == Epics"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        //say "AttackFocus == Altars"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        //say "AttackFocus == CreaturePen"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        clear Platoon action queue
                        AttackMode = 0
                        set Platoon attack PlayerTown with severity 0.3 for takeover
                    elsif AttackFocus == Villagers
                        //say "AttackFocus == Villagers"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {Platoon} radius 250
                                if Building not exists or PLAYER of Building != 0
                                    Building = get living villager at {PlayerTown} radius 250
                                end if
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of PlayerTown <= 60
                            AttackFocus = Default
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    Number = number from 0 to 99
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif not Platoon can navigate to object oTownCentre
                                a = 2
                            elsif Platoon not exists
                                a = 2
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 2
                            elsif AttackMode == 2 and Building not exists
                                a = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                a = 2
                            elsif AttackMode == 2 and Building == 0
                                a = 2
                            elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 2
                            end if
                        //end if
                        until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                    end loop
                    //say "until ((AbortObjectiveProbability > Number and a == 1) or (a == 2))"
                    if AttackMode == 0
                        TownCapturePlatoons[0]--
                    end if
                    clear Platoon action queue
                elsif DefendObject exists and Platoon can navigate to {DefendObject}
                    //say "DefendObject exists and Platoon can navigate to {DefendObject}"
                    if not {Platoon} near {DefendObject} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                elsif Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0
                    //say "Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0"
                    if not {Platoon} near {AttackingPoint1} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    end if
                else
                    //say "else"
                    if not {Platoon} near {AttackingPoint2} radius 25 or get player 0 influence at {AttackingPoint2} > 0
                        clear Platoon action queue
                        if get player 0 influence at {AttackingPoint2} > 0
                            begin loop
                                AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                                Threshold += 5
                                until (Platoon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                            end loop
                            Threshold = 1
                        end if
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint2} to Platoon action queue
                    end if
                end if
            end if
        //end if

    elsif Task == Conqueror
        AttackWPStage = 3
        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        if DefendObject exists
            if not Platoon can navigate to object oTownCentre
                AttackingPoint1 = marker at {DefendObject} + {number from 20 to -20,0,number from 20 to -20}
                clear Platoon action queue 
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                wait 10 seconds
            end if
        else
            if Platoon can navigate to object oTownCentre and PLAYER of NearestSettlement != 1
                a = 0
                if AttackFocus == Default
                    clear Platoon action queue
                    Number = number from 1 to 4
                    if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                        AttackMode = 1
                        set Platoon attack NearestSettlement with severity 0.2
                    elsif Number == 3 or Number == 4 //Destroy value buildings
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get random abode of type ALTAR in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type TEMPLE in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type UNIVERSITY in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 7
                                Building = get random abode of type BATHHOUSE in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 8
                                Building = get random abode of type AMPITHEATRE in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                    else //Capture Town
                        AttackMode = 0
                        if TownCapturePlatoons[1] < 2
                            TownCapturePlatoons[1]++
                            set Platoon attack NearestSettlement with severity 0.3 for takeover
                        end if
                    end if
                elsif AttackFocus == Houses
                    clear Platoon action queue
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 6
                        if Number == 1
                            Building = get random abode of type ABODE_A in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 2
                            Building = get random abode of type ABODE_B in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 3
                            Building = get random abode of type ABODE_C in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get random abode of type ABODE_D in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get random abode of type ABODE_E in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get random abode of type SKYSCRAPER in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                    if (get number of type HOUSE ABODE_A in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_B in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_C in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_D in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_E in NearestSettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in NearestSettlement min built 1.0) == 0
                        AttackFocus = Default
                    end if
                elsif AttackFocus == Epics
                    clear Platoon action queue
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 1
                        if Number == 1
                            Building = get WONDER in NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75 and HEALTH of Building > 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                    if (get number of type WONDER WONDER_SIREN in NearestSettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in NearestSettlement min built 1.0) == 0
                        AttackFocus = Default
                    end if
                elsif AttackFocus == Altars
                    clear Platoon action queue
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 1
                        if Number == 1
                            Building = get random abode of type ALTAR in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                    if (get number of type HOUSE ALTAR in NearestSettlement min built 1.0) == 0
                        AttackFocus = Default
                    end if
                elsif AttackFocus == CreaturePen
                    clear Platoon action queue
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 1
                        if Number == 1
                            Building = get random abode of type CREATURE_PEN in town NearestSettlement
                            if Building exists and HEALTH of Building >= 0.75
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                    if (get number of type HOUSE CREATURE_PEN in NearestSettlement min built 1.0) == 0
                        AttackFocus = Default
                    end if
                elsif AttackFocus == TownCenter
                    clear Platoon action queue
                    AttackMode = 0
                    set Platoon attack NearestSettlement with severity 0.3 for takeover
                elsif AttackFocus == Villagers
                    clear Platoon action queue
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 1
                        if Number == 1
                            Building = get living villager at {Platoon} radius 250
                            if Building not exists or PLAYER of Building != 0
                                Building = get living villager at {NearestSettlement} radius 250
                            end if
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                    if size of NearestSettlement <= 60
                        AttackFocus = Default
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                Number = number from 0 to 99
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                    TestCreature2 = get distance from {Platoon} to {MyCreature}
                    NumPat1 = get number of villagers in platoon Platoon
                    //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town NearestSettlement is under takeover from player 1
                            a = 1
                        elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town NearestSettlement is under takeover from player 1
                            a = 1
                        elsif not Platoon can navigate to object oTownCentre
                            a = 2
                        elsif Platoon not exists
                            a = 2
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 2
                        elsif AttackMode == 2 and Building not exists
                            a = 2
                        elsif AttackMode == 2 and HEALTH of Building <= 0.0
                            a = 2
                        elsif AttackMode == 2 and Building == 0
                            a = 2
                        elsif not town NearestSettlement is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 2
                        end if
                    //end if
                    until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[2]--
                end if
                clear Platoon action queue
            else
                if not {Platoon} near {AttackingPoint1} radius 25 or get player 0 influence at {AttackingPoint1} > 0
                    AttackingPoint1 = marker at {NearestSettlement}
                    clear Platoon action queue
                    if get player 0 influence at {AttackingPoint1} > 0 or PLAYER of NearestSettlement == 2 or PLAYER of NearestSettlement == 3 or PLAYER of NearestSettlement == 4
                        begin loop
                            AttackingPoint1 = marker at {AttackingPoint1} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                            Threshold += 5
                            until (Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0) or Threshold > 999
                        end loop
                        Threshold = 1
                    end if
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                end if
            end if
        end if

    elsif Task == Patrol
        if get size of Platoon action queue < 1
            move Platoon along PatrolRoute with patrol WAYPOINTROUTE_TRAVERSAL_TYPE_CIRCULAR
        end if

    end if

    //Special Tasks
    //Split up from origin platoon - Mutually exclusive with merging
    if SplitDone == 0 and 100-SplitUpChance < CHANCE_TO_SPLIT and AttackWPStage == 3
        if get number of villagers in platoon Platoon > 30
            while get number of villagers in platoon Platoon > 30 and number from 1 to 3 != 1
                //say "SPLITTING NOW"
                wait 5 seconds
                SplitDone = 1
                Number = number from 1 to 4
                if Number == 1
                    NewPlatoon = split 15 soldiers from platoon Platoon
                elsif Number == 2
                    NewPlatoon = split 20 soldiers from platoon Platoon
                elsif Number == 3
                    NewPlatoon = split 25 soldiers from platoon Platoon
                elsif Number == 4
                    NewPlatoon = split 30 soldiers from platoon Platoon
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                wait 5 seconds
                clear NewPlatoon action queue
                run background script LC5_ArmyBehaivours(NewPlatoon,Type,Task,0,Default,Neutral,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,1)
            end while
        end if
    end if
    //Merge with target platoon - Mutually exclusive with splitting
    if MergeDone == 0 and 100-MergeChance < CHANCE_TO_MERGE and AttackWPStage == 3
        if get number of villagers in platoon Platoon < 20
            NewPlatoon = get platoon of player 1 nearest {Platoon} radius 100
            if NewPlatoon exists and ((Type == Melee and platoon NewPlatoon melee) or (Type == Ranged and platoon NewPlatoon ranged))
                say "MERGING NOW"
                wait 5 seconds
                MergeDone = 1
                merge platoon Platoon into platoon NewPlatoon
            end if
        end if
    end if
    until Platoon not exists
end loop

end script LC5_ArmyBehaivours

begin script LC5_MoveCatapultThenAttack(SiegeWeapon,Task,AttackFocus,AttackWP1,AttackWP2,AttackWP3,AttackingPoint1,AttackingPoint2)

    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
    a = 1
    Timer = create timer for 0 seconds
    Target = 0
    CatapultMoveTimer1 = create timer for 0 seconds
    ActionTimer = create timer for 0 seconds
    Wall1 = 0
    House = 0
    SiegeOnPointTimer = create timer for 0 seconds
    SiegeWeaponPoint = 0
    SiegeStucked = 0
    GateHouse = 0
    AttackWPStage = 0
    AttackWP1Persistent = AttackWP1
    AttackWP2Persistent = AttackWP2
    AttackWP3Persistent = AttackWP3
    Number = 0
    Building = 0
    objSubType = 0

start

//begin loop

    AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
    AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
    AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}

    //Group up attackers first

    disable siege weapon SiegeWeapon auto attack

    if Task == Attacker
        begin loop
            if get ActionTimer time remaining <= 0 or get AttackSyncTimer time remaining <= 0
                if AttackWPStage == 0
                    wait until get size of SiegeWeapon action queue < 1
                    ActionTimer = create timer for 2 seconds
                    if not SiegeWeapon can navigate to {AttackWP1}
                        Number = 0
                        begin loop
                            AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP1} or Number > 10
                        end loop
                    end if
                    if not {SiegeWeapon} near {AttackWP1} radius 33
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP1} to siege weapon SiegeWeapon action queue
                    end if
                    if {SiegeWeapon} near {AttackWP1} radius 33
                        AttackWPStage = 1
                    end if
                elsif AttackWPStage == 1
                    wait until get size of SiegeWeapon action queue < 1
                    ActionTimer = create timer for 2 seconds
                    if not SiegeWeapon can navigate to {AttackWP2}
                        Number = 0
                        begin loop
                            AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP2} or Number > 10
                        end loop
                    end if
                    if not {SiegeWeapon} near {AttackWP2} radius 33 and get AttackSyncTimer time remaining <= 0
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP2} to siege weapon SiegeWeapon action queue
                    end if
                    if {SiegeWeapon} near {AttackWP2} radius 33
                        AttackWPStage = 2
                    end if
                elsif AttackWPStage == 2
                    wait until get size of SiegeWeapon action queue < 1
                    ActionTimer = create timer for 2 seconds
                    if not SiegeWeapon can navigate to {AttackWP3}
                        Number = 0
                        begin loop
                            AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP3} or Number > 10
                        end loop
                    end if
                    if not {SiegeWeapon} near {AttackWP3} radius 33
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP3} to siege weapon SiegeWeapon action queue
                    end if
                    if {SiegeWeapon} near {AttackWP3} radius 33
                        AttackWPStage = 3
                    end if
                end if

                if AttackWPStage == 3
                    //say "ATTACKING"
                    enable siege weapon SiegeWeapon auto attack
                    ActionTimer = create timer for 60 seconds
                    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                    if not SiegeWeapon can navigate to object oTownCentre
                        Number = number from 1 to 3
                        if Number == 1 or Number == 2
                            objSubType = number from 33 to 34
                            GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                GateHouse = get random abode of type constant objSubType in town PlayerTown
                                if GateHouse exists and PLAYER of GateHouse == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif Number == 3
                            Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                            if Wall1 exists and PLAYER of Wall1 == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                            else
                                ActionTimer = create timer for 0.025 seconds
                            end if
                        end if
                    elsif SiegeWeapon can navigate to object oTownCentre
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 6
                                if Number == 1
                                    Building = get random abode of type ABODE_A in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 2
                                    Building = get random abode of type ABODE_B in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 3
                                    Building = get random abode of type ABODE_C in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type ABODE_D in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type ABODE_E in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type SKYSCRAPER in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get WONDER in PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type TOWN_CENTRE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get living villager at {PlayerTown} + {number from -125 to 125,number from -125 to 125} radius 100
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if size of PlayerTown <= 60
                                AttackFocus = Default
                            end if
                        end if
                    end if
                end if
            end if

            until SiegeWeapon not exists
        end loop
    elsif Task == Conqueror
        begin loop
            if get ActionTimer time remaining <= 0
                enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
                if not SiegeWeapon can navigate to object oTownCentre
                    Number = number from 1 to 3
                    if Number == 1 or Number == 2
                        objSubType = number from 33 to 34
                        GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                        if GateHouse exists and PLAYER of GateHouse == 0
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            GateHouse = get random abode of type constant objSubType in town NearestSettlement
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                ActionTimer = create timer for 0.025 seconds
                            end if
                        end if
                    elsif Number == 3
                        Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                        if Wall1 exists and PLAYER of Wall1 == 0
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                        else
                            ActionTimer = create timer for 0.025 seconds
                        end if
                    end if
                elsif SiegeWeapon can navigate to object oTownCentre
                    if AttackFocus == Default
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get random abode of type ALTAR in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type TEMPLE in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type UNIVERSITY in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 7
                                Building = get random abode of type BATHHOUSE in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 8
                                Building = get random abode of type AMPITHEATRE in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                    elsif AttackFocus == Houses
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_B in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_C in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_D in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_E in NearestSettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in NearestSettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type TOWN_CENTRE in town NearestSettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                    elsif AttackFocus == Villagers
                        clear siege weapon SiegeWeapon action queue
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {NearestSettlement} + {number from -125 to 125,number from -125 to 125} radius 100
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of NearestSettlement <= 60
                            AttackFocus = Default
                        end if
                    end if
                end if
            end if
            until SiegeWeapon not exists
        end loop
    end if

//end loop

end script LC5_MoveCatapultThenAttack


begin script LC5_AttackEnemyTown(myPlatoon,enemyTown)

start

begin loop
    wait until get size of myPlatoon action queue < 1
    if get army size in town enemyTown > 0
        set myPlatoon attack enemyTown with severity 1.0
    else
        set myPlatoon attack enemyTown with severity 1.0 for takeover
    end if
end loop

end script LC5_AttackEnemyTown