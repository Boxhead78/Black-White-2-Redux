///////////////////////////////////////////////////////////////////////////////
//    Land 6 Japanese-Strategy
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
//    Start date:     05.02.17            By: Boxhead
//    Update date:    30.09.18            By: Boxhead
///////////////////////////////////////////////////////////////////////////////

define script LC12_Aztec_Capital_Impressiveness
define script LC12_TownConversion
define script LC12_Tribute
define script LC12_GatehouseManager
define script LC12_Speeches
define script LC12_Japanese_Capital


begin script LC12_Aztec_Capital_Impressiveness

    Threshold = 0

start

    Threshold = get town MinorTown1 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown1 to PlayerTown MINOR_TOWN1_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown2 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown2 to PlayerTown MINOR_TOWN2_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown3 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown3 to PlayerTown MINOR_TOWN3_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown4 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown4 to PlayerTown MINOR_TOWN4_IMPRESSIVENESS - Threshold

    Threshold = get town AztecTown1 impressiveness
    Threshold = Threshold / 3
    set migration threshold from AztecTown1 to PlayerTown AZTEC_TOWN1_IMPRESSIVENESS - Threshold

    Threshold = get town AztecTown2 impressiveness
    Threshold = Threshold / 3
    set migration threshold from AztecTown2 to PlayerTown AZTEC_TOWN2_IMPRESSIVENESS - Threshold

    Threshold = get town AztecCapital impressiveness
    Threshold = Threshold / 3
    set migration threshold from AztecCapital to PlayerTown AZTEC_CAPITAL_IMPRESSIVENESS - Threshold

begin loop

    if PLAYER of MinorTown1 == 0
        enable migration from MinorTown2 to MinorTown1
        enable migration from MinorTown3 to MinorTown1
        enable migration from MinorTown4 to MinorTown1
        enable migration from AztecTown1 to MinorTown1
        enable migration from AztecTown2 to MinorTown1
        enable migration from AztecCapital to MinorTown1
        
    elsif PLAYER of MinorTown1 >= 1
        disable migration from MinorTown2 to MinorTown1
        disable migration from MinorTown3 to MinorTown1
        disable migration from MinorTown4 to MinorTown1
        disable migration from AztecTown1 to MinorTown1
        disable migration from AztecTown2 to MinorTown1
        disable migration from AztecCapital to MinorTown1
    end if

    if PLAYER of MinorTown2 == 0
        enable migration from MinorTown1 to MinorTown2
        enable migration from MinorTown3 to MinorTown2
        enable migration from MinorTown4 to MinorTown2
        enable migration from AztecTown1 to MinorTown2
        enable migration from AztecTown2 to MinorTown2
        enable migration from AztecCapital to MinorTown2
        
    elsif PLAYER of MinorTown2 >= 1
        disable migration from MinorTown1 to MinorTown2
        disable migration from MinorTown3 to MinorTown2
        disable migration from MinorTown4 to MinorTown2
        disable migration from AztecTown1 to MinorTown2
        disable migration from AztecTown2 to MinorTown2
        disable migration from AztecCapital to MinorTown2
    end if

    if PLAYER of MinorTown3 == 0
        enable migration from MinorTown1 to MinorTown3
        enable migration from MinorTown2 to MinorTown3
        enable migration from MinorTown4 to MinorTown3
        enable migration from AztecTown1 to MinorTown3
        enable migration from AztecTown2 to MinorTown3
        enable migration from AztecCapital to MinorTown3
        
    elsif PLAYER of MinorTown3 >= 1
        disable migration from MinorTown1 to MinorTown3
        disable migration from MinorTown2 to MinorTown3
        disable migration from MinorTown4 to MinorTown3
        disable migration from AztecTown1 to MinorTown3
        disable migration from AztecTown2 to MinorTown3
        disable migration from AztecCapital to MinorTown3
    end if

    if PLAYER of MinorTown4 == 0
        enable migration from MinorTown1 to MinorTown4
        enable migration from MinorTown2 to MinorTown4
        enable migration from MinorTown3 to MinorTown4
        enable migration from AztecTown1 to MinorTown4
        enable migration from AztecTown2 to MinorTown4
        enable migration from AztecCapital to MinorTown4
        
    elsif PLAYER of MinorTown4 >= 1
        disable migration from MinorTown1 to MinorTown4
        disable migration from MinorTown2 to MinorTown4
        disable migration from MinorTown3 to MinorTown4
        disable migration from AztecTown1 to MinorTown4
        disable migration from AztecTown2 to MinorTown4
        disable migration from AztecCapital to MinorTown4
    end if

    if PLAYER of AztecTown1 == 0
        enable migration from MinorTown1 to AztecTown1
        enable migration from MinorTown2 to AztecTown1
        enable migration from MinorTown3 to AztecTown1
        enable migration from MinorTown4 to AztecTown1
        enable migration from AztecTown2 to AztecTown1
        enable migration from AztecCapital to AztecTown1
        
    elsif PLAYER of AztecTown1 >= 1
        disable migration from MinorTown1 to AztecTown1
        disable migration from MinorTown2 to AztecTown1
        disable migration from MinorTown3 to AztecTown1
        disable migration from MinorTown4 to AztecTown1
        disable migration from AztecTown2 to AztecTown1
        disable migration from AztecCapital to AztecTown1
    end if

    if PLAYER of AztecTown2 == 0
        enable migration from MinorTown1 to AztecTown2
        enable migration from MinorTown2 to AztecTown2
        enable migration from MinorTown3 to AztecTown2
        enable migration from MinorTown4 to AztecTown2
        enable migration from AztecTown1 to AztecTown2
        enable migration from AztecCapital to AztecTown2
        
    elsif PLAYER of AztecTown2 >= 1
        disable migration from MinorTown1 to AztecTown2
        disable migration from MinorTown2 to AztecTown2
        disable migration from MinorTown3 to AztecTown2
        disable migration from MinorTown4 to AztecTown2
        disable migration from AztecTown1 to AztecTown2
        disable migration from AztecCapital to AztecTown2
    end if

    if PLAYER of AztecCapital == 0
        enable migration from MinorTown1 to AztecCapital
        enable migration from MinorTown2 to AztecCapital
        enable migration from MinorTown3 to AztecCapital
        enable migration from MinorTown4 to AztecCapital
        enable migration from AztecTown1 to AztecCapital
        enable migration from AztecTown2 to AztecCapital
        
    elsif PLAYER of AztecCapital >= 1
        disable migration from MinorTown1 to AztecCapital
        disable migration from MinorTown2 to AztecCapital
        disable migration from MinorTown3 to AztecCapital
        disable migration from MinorTown4 to AztecCapital
        disable migration from AztecTown1 to AztecCapital
        disable migration from AztecTown2 to AztecCapital
    end if

end loop

end script LC12_Aztec_Capital_Impressiveness

begin script LC12_TownConversion

    isConverted1 = 0
    isConverted2 = 0
    isConverted3 = 0
    isConverted4 = 0
    isConverted5 = 0
    isConverted6 = 0
    isConverted7 = 0
    isConverted8 = 0
    isConverted9 = 0
    isConverted10 = 0
    isConverted11 = 0
    isConverted12 = 0
    a = 0
    b = 0
    c = 0
    d = 0
    e = 0
    f = 0
    g = 0
    h = 0
    i = 0
    j = 0
    k = 0
    l = 0
    
start

begin loop

    isConverted1 = variable get town MinorTown1 method of last conversion
    isConverted2 = variable get town MinorTown2 method of last conversion
    isConverted3 = variable get town MinorTown3 method of last conversion
    isConverted4 = variable get town MinorTown4 method of last conversion
    isConverted9 = variable get town AztecTown1 method of last conversion
    isConverted10 = variable get town AztecTown2 method of last conversion
    isConverted12 = variable get town AztecCapital method of last conversion

    if isConverted1 != 0 and a == 0
        if PLAYER of MinorTown1 == 0 or get town MinorTown1 is migrating to == PlayerTown
            a = 1
            TownsConverted = TownsConverted + 1
            if isConverted1 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted1 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if

    if isConverted1 != 0
        if PLAYER of AztecCapital == 1
            disable migration from MinorTown1 to MinorTown2
            disable migration from MinorTown1 to MinorTown3
            disable migration from MinorTown1 to MinorTown4
            disable migration from MinorTown1 to AztecTown1
            disable migration from MinorTown1 to AztecTown2
            disable migration from MinorTown1 to AztecCapital
            disable migration from MinorTown1 to PlayerTown
        else
            enable migration from MinorTown1 to MinorTown2
            enable migration from MinorTown1 to MinorTown3
            enable migration from MinorTown1 to MinorTown4
            enable migration from MinorTown1 to AztecTown1
            enable migration from MinorTown1 to AztecTown2
            enable migration from MinorTown1 to AztecCapital
            enable migration from MinorTown1 to PlayerTown
        end if
    end if
    
    if isConverted2 != 0 and b == 0
        if PLAYER of MinorTown2 == 0 or get town MinorTown2 is migrating to == PlayerTown
            b = 1
            TownsConverted = TownsConverted + 1
            if isConverted2 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted2 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if

    if isConverted2 != 0
        if PLAYER of AztecCapital == 1
            disable migration from MinorTown2 to MinorTown1
            disable migration from MinorTown2 to MinorTown3
            disable migration from MinorTown2 to MinorTown4
            disable migration from MinorTown2 to AztecTown1
            disable migration from MinorTown2 to AztecTown2
            disable migration from MinorTown2 to AztecCapital
            disable migration from MinorTown2 to PlayerTown
        else
            enable migration from MinorTown2 to MinorTown1
            enable migration from MinorTown2 to MinorTown3
            enable migration from MinorTown2 to MinorTown4
            enable migration from MinorTown2 to AztecTown1
            enable migration from MinorTown2 to AztecTown2
            enable migration from MinorTown2 to AztecCapital
            enable migration from MinorTown2 to PlayerTown
        end if
    end if
    
    if isConverted3 != 0 and c == 0
        if PLAYER of MinorTown3 == 0 or get town MinorTown3 is migrating to == PlayerTown
            c = 1
            TownsConverted = TownsConverted + 1
            if isConverted3 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted3 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if

    if isConverted3 != 0
        if PLAYER of AztecCapital == 1
            disable migration from MinorTown3 to MinorTown1
            disable migration from MinorTown3 to MinorTown2
            disable migration from MinorTown3 to MinorTown4
            disable migration from MinorTown3 to AztecTown1
            disable migration from MinorTown3 to AztecTown2
            disable migration from MinorTown3 to AztecCapital
            disable migration from MinorTown3 to PlayerTown
        else
            enable migration from MinorTown3 to MinorTown1
            enable migration from MinorTown3 to MinorTown2
            enable migration from MinorTown3 to MinorTown4
            enable migration from MinorTown3 to AztecTown1
            enable migration from MinorTown3 to AztecTown2
            enable migration from MinorTown3 to AztecCapital
            enable migration from MinorTown3 to PlayerTown
        end if
    end if
    
    if isConverted4 != 0 and d == 0
        if PLAYER of MinorTown4 == 0 or get town MinorTown4 is migrating to == PlayerTown
            d = 1
            TownsConverted = TownsConverted + 1
            if isConverted4 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted4 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if

    if isConverted4 != 0
        if PLAYER of AztecCapital == 1
            disable migration from MinorTown4 to MinorTown1
            disable migration from MinorTown4 to MinorTown2
            disable migration from MinorTown4 to MinorTown3
            disable migration from MinorTown4 to AztecTown1
            disable migration from MinorTown4 to AztecTown2
            disable migration from MinorTown4 to AztecCapital
            disable migration from MinorTown4 to PlayerTown
        else
            enable migration from MinorTown4 to MinorTown1
            enable migration from MinorTown4 to MinorTown2
            enable migration from MinorTown4 to MinorTown3
            enable migration from MinorTown4 to MinorTown5
            enable migration from MinorTown4 to AztecTown1
            enable migration from MinorTown4 to AztecTown2
            enable migration from MinorTown4 to AztecCapital
            enable migration from MinorTown4 to PlayerTown
        end if
    end if
 
    if isConverted8 != 0
        if PLAYER of AztecCapital == 1
            disable migration from MinorTown8 to MinorTown1
            disable migration from MinorTown8 to MinorTown2
            disable migration from MinorTown8 to MinorTown3
            disable migration from MinorTown8 to MinorTown4
            disable migration from MinorTown8 to AztecTown1
            disable migration from MinorTown8 to AztecTown2
            disable migration from MinorTown8 to AztecCapital
            disable migration from MinorTown8 to PlayerTown
        else
            enable migration from MinorTown8 to MinorTown1
            enable migration from MinorTown8 to MinorTown2
            enable migration from MinorTown8 to MinorTown3
            enable migration from MinorTown8 to MinorTown4
            enable migration from MinorTown8 to AztecTown1
            enable migration from MinorTown8 to AztecTown2
            enable migration from MinorTown8 to AztecCapital
            enable migration from MinorTown8 to PlayerTown
        end if
    end if
    
    if isConverted9 != 0 and i == 0
        if PLAYER of AztecTown1 == 0 or get town AztecTown1 is migrating to == PlayerTown
            i = 1
            TownsConverted = TownsConverted + 1
            if isConverted9 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted9 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if

    if isConverted9 != 0
        if PLAYER of AztecCapital == 1
            disable migration from AztecTown1 to MinorTown1
            disable migration from AztecTown1 to MinorTown2
            disable migration from AztecTown1 to MinorTown3
            disable migration from AztecTown1 to MinorTown4
            disable migration from AztecTown1 to AztecTown2
            disable migration from AztecTown1 to AztecCapital
            disable migration from AztecTown1 to PlayerTown
        else
            enable migration from AztecTown1 to MinorTown1
            enable migration from AztecTown1 to MinorTown2
            enable migration from AztecTown1 to MinorTown3
            enable migration from AztecTown1 to MinorTown4
            enable migration from AztecTown1 to AztecTown2
            enable migration from AztecTown1 to AztecCapital
            enable migration from AztecTown1 to PlayerTown
        end if
    end if
    
    if isConverted10 != 0 and j == 0
        if PLAYER of AztecTown2 == 0 or get town AztecTown2 is migrating to == PlayerTown
            j = 1
            TownsConverted = TownsConverted + 1
            if isConverted10 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted10 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if

    if isConverted10 != 0
        if PLAYER of AztecCapital == 1
            disable migration from AztecTown2 to MinorTown1
            disable migration from AztecTown2 to MinorTown2
            disable migration from AztecTown2 to MinorTown3
            disable migration from AztecTown2 to MinorTown4
            disable migration from AztecTown2 to AztecTown1
            disable migration from AztecTown2 to AztecCapital
            disable migration from AztecTown2 to PlayerTown
        else
            enable migration from AztecTown2 to MinorTown1
            enable migration from AztecTown2 to MinorTown2
            enable migration from AztecTown2 to MinorTown3
            enable migration from AztecTown2 to MinorTown4
            enable migration from AztecTown2 to AztecTown1
            enable migration from AztecTown2 to AztecCapital
            enable migration from AztecTown2 to PlayerTown
        end if
    end if
 
    if isConverted12 != 0 and l == 0
        if PLAYER of AztecCapital == 0 or get town AztecCapital is migrating to == PlayerTown
            l = 1
            TownsConverted = TownsConverted + 1
            if isConverted12 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            elsif isConverted12 == 2
                TownsPeacefulConverted = TownsPeacefulConverted + 1
            end if
        end if
    end if    

    if isConverted12 != 0
        if PLAYER of AztecCapital == 1
            disable migration from AztecCapital to MinorTown1
            disable migration from AztecCapital to MinorTown2
            disable migration from AztecCapital to MinorTown3
            disable migration from AztecCapital to MinorTown4
            disable migration from AztecCapital to AztecTown1
            disable migration from AztecCapital to AztecTown2
            disable migration from AztecCapital to PlayerTown
        else
            enable migration from AztecCapital to MinorTown1
            enable migration from AztecCapital to MinorTown2
            enable migration from AztecCapital to MinorTown3
            enable migration from AztecCapital to MinorTown4
            enable migration from AztecCapital to AztecTown1
            enable migration from AztecCapital to AztecTown2
            enable migration from AztecCapital to PlayerTown
        end if
    end if
    
end loop

end script LC12_TownConversion

begin script LC12_Tribute

    mig1 = 0
    mig2 = 0
    mig3 = 0
    mig4 = 0
    mig5 = 0
    mig6 = 0
    mig7 = 0
    mig8 = 0
    mig9 = 0
    mig10 = 0
    mig11 = 0
    mig12 = 0
    a = 0

start

begin loop

    if (variable get town MinorTown1 status == variable MIGRATION_MIGRATED) and mig1 == 0 and get town MinorTown1 has migrated to == PlayerTown
        mig1 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown2 status == variable MIGRATION_MIGRATED) and mig2 == 0 and get town MinorTown2 has migrated to == PlayerTown
        mig2 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown3 status == variable MIGRATION_MIGRATED) and mig3 == 0 and get town MinorTown3 has migrated to == PlayerTown
        mig3 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown4 status == variable MIGRATION_MIGRATED) and mig4 == 0 and get town MinorTown4 has migrated to == PlayerTown
        mig4 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town AztecTown1 status == variable MIGRATION_MIGRATED) and mig9 == 0 and get town AztecTown1 has migrated to == PlayerTown
        mig9 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town AztecTown2 status == variable MIGRATION_MIGRATED) and mig10 == 0 and get town AztecTown2 has migrated to == PlayerTown
        mig10 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town AztecCapital status == variable MIGRATION_MIGRATED) and mig12 == 0 and get town AztecCapital has migrated to == PlayerTown
        mig12 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if

    if MigrationsAccepted >= 1 and a == 0
        a = 1
        increment tribute by 5000
    end if
    
    if MigrationsAccepted >= 2 and a == 1
        a = 2
        increment tribute by 10000
    end if
    
    if MigrationsAccepted >= 3 and a == 2
        a = 3
        increment tribute by 10000
    end if
    
    if MigrationsAccepted >= 4 and a == 3
        a = 4
        increment tribute by 15000
    end if
    
    if MigrationsAccepted >= 5 and a == 4
        a = 5
        increment tribute by 15000
    end if
    
    if MigrationsAccepted >= 6 and a == 5
        a = 6
        increment tribute by 20000
    end if
    
    if MigrationsAccepted >= 7 and a == 6
        a = 7
        increment tribute by 25000
    end if
    
end loop

end script LC12_Tribute

begin script LC12_GatehouseManager

    GateHouseT11 = 0
    GateHouseT12 = 0
    GateHouseT13 = 0
    GateHouseT14 = 0
    GateHouseT21 = 0
    GateHouseT22 = 0
    GateHouseT31 = 0
    GateHouseT32 = 0

    Counter = 0
    Cnt = 0

    oCreature = get player 0 creature

    PlayerPlatoonT11 = 0
    CatapultT11 = 0
    TestCreatureT11 = 0
    PlayerPlatoonT12 = 0
    CatapultT12 = 0
    TestCreatureT12 = 0

    EnemyNearDoorT11 = 0
    EnemyNearDoorT12 = 0

    PlayerPlatoonT21 = 0
    CatapultT21 = 0
    TestCreatureT21 = 0
    PlayerPlatoonT22 = 0
    CatapultT22 = 0
    TestCreatureT22 = 0

    EnemyNearDoorT21 = 0
    EnemyNearDoorT22 = 0

    PlayerPlatoonT31 = 0
    CatapultT31 = 0
    TestCreatureT31 = 0
    PlayerPlatoonT32 = 0
    CatapultT32 = 0
    TestCreatureT32 = 0
    PlayerPlatoonT33 = 0
    CatapultT33 = 0
    TestCreatureT33 = 0

    EnemyNearDoorT31 = 0
    EnemyNearDoorT32 = 0
    EnemyNearDoorT33 = 0

start

begin loop

    GateHouseT11 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {1451.19,67.80,1492.94} radius 15
    GateHouseT12 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {1809.44,63.13,1454.65} radius 15
    
    oCreature = get player 0 creature

    if PLAYER of AztecCapital == 1

        if not town AztecCapital is under takeover from player 0
            PlayerPlatoonT11 = get platoon of player 0 nearest {GateHouseT11} radius 100
            CatapultT11 = get siege weapon of player 0 nearest {GateHouseT11} radius 100
            TestCreatureT11 = get distance from {GateHouseT11} to {oCreature}
            
            if PlayerPlatoonT11 exists
                EnemyNearDoorT11 = 1
            elsif CatapultT11 exists
                EnemyNearDoorT11 = 1
            elsif TestCreatureT11 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT11 = 1
            else
                EnemyNearDoorT11 = 0
            end if
            
            if EnemyNearDoorT11 == 1
                set gate GateHouseT11 close
            else
                set gate GateHouseT11 open
            end if
            
            PlayerPlatoonT12 = get platoon of player 0 nearest {GateHouseT12} radius 100
            CatapultT12 = get siege weapon of player 0 nearest {GateHouseT12} radius 100
            TestCreatureT12 = get distance from {GateHouseT12} to {oCreature}
            
            if PlayerPlatoonT12 exists
                EnemyNearDoorT12 = 1
            elsif CatapultT12 exists
                EnemyNearDoorT12 = 1
            elsif TestCreatureT12 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT12 = 1
            else
                EnemyNearDoorT12 = 0
            end if
            
            if EnemyNearDoorT12 == 1
                set gate GateHouseT12 close
            else
                set gate GateHouseT12 open
            end if
        else
            set gate GateHouseT11 open
            set gate GateHouseT12 open
        end if
        
    end if

    GateHouseT21 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {520.66,24.68,1512.98} radius 15
    GateHouseT22 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {804.15,20.53,1662.52} radius 15
    
    oCreature = get player 0 creature

    if PLAYER of AztecTown1 == 1

        if not town AztecTown1 is under takeover from player 0
            PlayerPlatoonT21 = get platoon of player 0 nearest {GateHouseT21} radius 100
            CatapultT21 = get siege weapon of player 0 nearest {GateHouseT21} radius 100
            TestCreatureT21 = get distance from {GateHouseT21} to {oCreature}
            
            if PlayerPlatoonT21 exists
                EnemyNearDoorT21 = 1
            elsif CatapultT21 exists
                EnemyNearDoorT21 = 1
            elsif TestCreatureT21 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT21 = 1
            else
                EnemyNearDoorT21 = 0
            end if
            
            if EnemyNearDoorT21 == 1
                set gate GateHouseT21 close
            else
                set gate GateHouseT21 open
            end if


            PlayerPlatoonT22 = get platoon of player 0 nearest {GateHouseT22} radius 100
            CatapultT22 = get siege weapon of player 0 nearest {GateHouseT22} radius 100
            TestCreatureT22 = get distance from {GateHouseT22} to {oCreature}
            
            if PlayerPlatoonT22 exists
                EnemyNearDoorT22 = 1
            elsif CatapultT22 exists
                EnemyNearDoorT22 = 1
            elsif TestCreatureT22 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT22 = 1
            else
                EnemyNearDoorT22 = 0
            end if
            
            if EnemyNearDoorT22 == 1
                set gate GateHouseT22 close
            else
                set gate GateHouseT22 open
            end if
        else
            set gate GateHouseT21 open
            set gate GateHouseT22 open
        end if

    end if

    GateHouseT31 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {1138.10,21.94,1040.15} radius 15
    GateHouseT32 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {1078.92,36.02,666.42} radius 15
    GateHouseT33 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {862.58,40.80,974.04} radius 15
    
    oCreature = get player 0 creature

    if PLAYER of AztecTown2 == 1

        if not town AztecTown2 is under takeover from player 0
            PlayerPlatoonT31 = get platoon of player 0 nearest {GateHouseT31} radius 100
            CatapultT31 = get siege weapon of player 0 nearest {GateHouseT31} radius 100
            TestCreatureT31 = get distance from {GateHouseT31} to {oCreature}
            
            if PlayerPlatoonT31 exists
                EnemyNearDoorT31 = 1
            elsif CatapultT31 exists
                EnemyNearDoorT31 = 1
            elsif TestCreatureT31 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT31 = 1
            else
                EnemyNearDoorT31 = 0
            end if
            
            if EnemyNearDoorT31 == 1
                set gate GateHouseT31 close
            else
                set gate GateHouseT31 open
            end if


            PlayerPlatoonT32 = get platoon of player 0 nearest {GateHouseT32} radius 100
            CatapultT32 = get siege weapon of player 0 nearest {GateHouseT32} radius 100
            TestCreatureT32 = get distance from {GateHouseT32} to {oCreature}
            
            if PlayerPlatoonT32 exists
                EnemyNearDoorT32 = 1
            elsif CatapultT32 exists
                EnemyNearDoorT32 = 1
            elsif TestCreatureT32 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT32 = 1
            else
                EnemyNearDoorT32 = 0
            end if
            
            if EnemyNearDoorT32 == 1
                set gate GateHouseT32 close
            else
                set gate GateHouseT32 open
            end if


            PlayerPlatoonT33 = get platoon of player 0 nearest {GateHouseT33} radius 100
            CatapultT33 = get siege weapon of player 0 nearest {GateHouseT33} radius 100
            TestCreatureT33 = get distance from {GateHouseT33} to {oCreature}
            
            if PlayerPlatoonT33 exists
                EnemyNearDoorT33 = 1
            elsif CatapultT33 exists
                EnemyNearDoorT33 = 1
            elsif TestCreatureT33 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT33 = 1
            else
                EnemyNearDoorT33 = 0
            end if
            
            if EnemyNearDoorT33 == 1
                set gate GateHouseT33 close
            else
                set gate GateHouseT33 open
            end if
        else
            set gate GateHouseT31 open
            set gate GateHouseT32 open
            set gate GateHouseT33 open
        end if

    end if

end loop

end script LC12_GatehouseManager

begin script LC12_Speeches

    LoseDialogue1 = 0
    
    Number = 0
    
    AttackTimer = create timer for 0 seconds
    LoseTimer = create timer for 0 seconds
    
    a = 0
    b = 0
    c = 0
    d = 0
    e = 0
    f = 0
    g = 0
    h = 0
    i = 0
    j = 0
    jj = 0
    k = 0
    l = 0
    m = 0
    n = 0
    o = 0
    p = 0
    q = 0
    r = 0
    s = 0
    t = 0
    w = 0
    v = 0
    astory = 0
    bstory = 0
    
    ab = 0
    ac = 0
    ad = 0
    ae = 0
    af = 0
    ag = 0
    ah = 0
    ai = 0
    aj = 0
    ak = 0
    al = 0
    am = 0
    
    StoryDialogue = 0
    StoryDialogueTimer = create timer for 200 seconds
    
    EvilDialogue = 0
    GoodDialogue = 0
    
    Platoon = 0
    Catapult = 0

    EQ_NOT_PLAYED = 0

    AltarBuilt = 0

    TownSpeech1 = 0
    TownSpeech2 = 0
    TownSpeech3 = 0
    TownSpeech4 = 0
    TownSpeech5 = 0

    PlayerPlatoon = 0

    UnderAttackTimer = create timer for 0 seconds

    MohcComment = 0

    EarthquakePrepping = 0
    ArrivalComment = 0

    MockCreatureTimer = create timer for 180 seconds
    MockCreatureCommentSaid = 0

start

begin loop

    if UnderAttack >= 1 and get AttackTimer time remaining <= 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        UnderAttack = 0
        Number = number from 1 to 14
        if Number == 1
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_01"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 2
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_02"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 3
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_05"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 4
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_06"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 5
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_07"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 6
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_08"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 7
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_18"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 8
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_01"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 9
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_02"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 10
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_05"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 11
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_06"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 12
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_07"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 13
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_09"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 14
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_10"
                wait until read
                send good spirit home
            end dialogue
        end if
        GB_DialogueIsRunning = 0
        AttackTimer = create timer for 45 seconds
    end if
    
    if PLAYER of PlayerTown != 0 and PLAYER of MinorTown1 != 0 and PLAYER of MinorTown2 != 0 and PLAYER of MinorTown3 != 0 and PLAYER of MinorTown4 != 0 and PLAYER of MinorTown5 != 0 and PLAYER of MinorTown6 != 0 and PLAYER of MinorTown7 != 0 and PLAYER of MinorTown8 != 0 and PLAYER of AztecTown1 != 0 and PLAYER of AztecTown2 != 0 and PLAYER of AztecTown3 != 0 and PLAYER of AztecCapital != 0  and get LoseTimer time remaining <= 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        LoseDialogue1 = number from 1 to 5
        if LoseDialogue1 == 1
            begin dialogue
                make good spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_10"
                wait until read
                send good spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 2
            begin dialogue
                make evil spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_20"
                wait until read
                send evil spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 3
            begin dialogue
                make good spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_30"
                wait until read
                send good spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 4
            begin dialogue
                make evil spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_40"
                wait until read
                send evil spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 5
            begin dialogue
                make evil spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_50"
                wait until read
                send evil spirit home
            end dialogue
        end if
        
        GB_DialogueIsRunning = 0
        LoseTimer = create timer for 75 seconds
    end if

    /*
    if get building ALTAR in PlayerTown min built 0.0 exists and AltarBuilt == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        AltarBuilt = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_ALTAR"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if

    if get building ABODE_A in PlayerTown min built 0.0 exists and a == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        a = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_HUT"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building ABODE_B in PlayerTown min built 0.0 exists and b == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        b = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_HOUSE"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building ABODE_C in PlayerTown min built 0.0 exists and c == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        c = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_VILLA"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building ABODE_D in PlayerTown min built 0.0 exists and d == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        d = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_MANOR"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building ABODE_E in PlayerTown min built 0.0 exists and e == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        e = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_MANSION"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building SKYSCRAPER in PlayerTown min built 0.0 exists and f == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        f = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_SKYSCRAPER"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building STORAGE_YARD in PlayerTown min built 0.0 exists and g == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        g = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_STOREHOUSE"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building FIELD in PlayerTown min built 0.0 exists and h == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        h = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_FIELD"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building CREATURE_PEN in PlayerTown min built 0.0 exists and i == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        i = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_CREATURE_PEN"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if (get building WALLTOWER_TECH0 in PlayerTown max built 0.9 exists or get building WALLTOWER_TECH1 in PlayerTown max built 0.9 exists) and j == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        j = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_FORTIFIED_WALL"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if

    if (get building GATEHOUSE in PlayerTown min built 0.0 exists or get building GATEHOUSE_F in PlayerTown min built 0.9 exists) and jj == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        jj = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_GATEHOUSE"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building GRAVEYARD in PlayerTown min built 0.0 exists and k == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        k = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_GRAVEYARD"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building PUB in PlayerTown min built 0.0 exists and l == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        l = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_TAVERN"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building UNIVERSITY in PlayerTown min built 0.0 exists and n == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        n = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_UNIVERSITY"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building OLD_PERSONS_HOME in PlayerTown min built 0.0 exists and o == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        o = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_REST_HOME"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building TEMPLE in PlayerTown min built 0.0 exists and p == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        p = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_TEMPLE"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building LUMBERMILL in PlayerTown min built 0.0 exists and q == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        q = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_LUMBER_MILL"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building SMELTER in PlayerTown min built 0.0 exists and r == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        r = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_SMELTER"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building GRANARY in PlayerTown min built 0.0 exists and s == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        s = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_GRANARY"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building BATHHOUSE in PlayerTown min built 0.0 exists and t == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        t = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_BATHS"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building AMPITHEATRE in PlayerTown min built 0.0 exists and w == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        w = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_AMPHITHEATRE"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if

    if get building PRISON in PlayerTown min built 0.0 exists and v == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        v = 1
        begin dialogue
            say "BW2T_SCRIPT_09FINAL_PLAYER_BUILDS_PRISON"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    */

end loop

end script LC12_Speeches

begin script LC12_Japanese_Capital

start

end script LC12_Japanese_Capital
