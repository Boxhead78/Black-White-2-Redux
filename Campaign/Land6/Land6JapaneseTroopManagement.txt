///////////////////////////////////////////////////////////////////////////////
//    Land 6 Japanese Troop-Management
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//    Globals
//-----------------------------------------------------------------------------

define LC6_NUM_OF_DEFENDERS = 0 //Unused
define LC6_NUM_OF_PLATOONS = 50
define LC6_NUM_OF_SIEGE_CATAPULTS = 25
define LC6_NUM_OF_WALL_ARCHERS = 8
//Army Types
define Melee = 0
define Ranged = 1
//Army Behaviours
define Attacker = 0 //Attack PlayerTown
define Conqueror = 1 //Capture town defined in GetNearestSettlement script
define Patrol = 2 //Do some patrols
define Special = 3 //Special behaviour different on each map
define CaptureMonkTemple = 4 //Go and capture map-specific objective
//Attack Focus
define Default = 0 //Balanced attack strategy
define Houses = 1 //Attack Houses
define Epics = 2 //Attack Epics
define Altars = 3 //Attack Altars
define CreaturePen = 4 //Attack CreaturePen
define TownCenter = 5 //Attack Town
define Villagers = 6 //Attack Villagers NOT WORKING, PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA 
//Aggressiveness
define Passive = 0 //Try to do objectives, only defend yourself
define Neutral = 1 //0.75 Search radius for enemy troops, and much less likely to give up objectives
define Alerted = 2 //1.0 Search radius for enemy troops, and less likely to give up objectives
define Aggressive = 3 //2.0 Search radius for enemy troops, and will always give up objectives for enemy troops

define CHANCE_TO_SPLIT = 40
define CHANCE_TO_MERGE = 20

define script Waypoints
define script AttackRndAttackLogic(attackerssentnum)
define script AttackSyncTimerLogic
define script PlatoonTargetingMetric(PlatoonSize,TargetTown)
define script CatapultTargetingMetric(TargetTown)
define script LC6_StaticPlatoonsController
define script LC6_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)
define script LC6_ArmyBehaviours(Platoon,Type,Task,DefendObject,AttackFocus,Aggressiveness,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,AttackWPStage,DisableMerge,DisableSplit)
define script LC6_MoveCatapultThenAttack(SiegeWeapon,Task,AttackFocus,AttackWP1,AttackWP2,AttackWP3,AttackingPoint1,AttackingPoint2,AttackWPStage)

global LC6_Defender[LC6_NUM_OF_DEFENDERS]
global LC6_Platoon[LC6_NUM_OF_PLATOONS]
global LC6_SiegeCatapult[LC6_NUM_OF_SIEGE_CATAPULTS]
global LC6_WallArcher[LC6_NUM_OF_WALL_ARCHERS]
global LC6_StaticPlatoonCounter = 0
global PlatoonTargetingMetricFocusResult = 0
global CatapultTargetingMetricFocusResult = 0
global AttackersSent[15]

global PlatoonPos[11]
global AttackPos[8]
global AttackPosFront[3]
global AttackPosFlank[3]
global AttackPosBack[3]
global AttackSyncTimer = 0
global SiegePlatoonPos[10]
global SiegeRoute1[2]
global SiegeRoute2[2]
global SiegeRoute3[4]
global SiegeRoute4[3]
global SiegeRoute5[3]
global SiegeRoute6[3]
global Script1WP[10]
global PlayerWallPos1 = 0
global PlayerWallPos2 = 0
global StaticPlatoonGoodPos[4]
global StaticPlatoonGoodWaypoint = 0
global StaticPlatoonEvilPos[3]
global StaticPlatoonEvilWaypoint = 0

global PatrolRouteA[2]
global PatrolRouteB[2]
global PatrolRouteC[3]
global PatrolRouteD[3]
global PatrolRouteE[2]
global PatrolRouteF[2]
global PatrolRouteG[4]
global AC_ForwardRoute[5]
global WaypointsA = 0
global WaypointsB = 0
global WaypointsC = 0
global WaypointsD = 0
global WaypointsE = 0
global WaypointsF = 0
global WaypointsG = 0

run script Waypoints

begin script Waypoints

start

    PlayerWallPos1 = marker at {1192.07,19.95,1128.07}
    PlayerWallPos2 = marker at {856.80,45.36,988.87}

    PlatoonPos[0] = marker at {1215.43,298.98,1945.71}
    PlatoonPos[1] = marker at {1502.59,72.44,1491.96}
    PlatoonPos[2] = marker at {1608.93,73.16,1497.64}
    PlatoonPos[3] = marker at {1776.64,71.69,1477.21}
    PlatoonPos[4] = marker at {1403.70,41.60,1294.29}
    PlatoonPos[5] = marker at {1483.03,35.80,1144.95}
    PlatoonPos[6] = marker at {1356.95,40.67,1726.52}//JapaneseTown1
    PlatoonPos[7] = marker at {2027.82,14.26,1178.21}//JapaneseTown2
    PlatoonPos[8] = marker at {807.82,21.35,1594.66}
    PlatoonPos[9] = marker at {797.88,18.38,1734.84}
    PlatoonPos[10] = marker at {679.59,21.21,1695.12}

    AttackPos[0] = marker at {1174.20,20.83,1124.78}
    AttackPos[1] = marker at {1333.70,29.83,1205.83}//Backup if 0 is blocked
    AttackPos[2] = marker at {844.60,50.49,1007.68}
    AttackPos[3] = marker at {597.84,126.31,1260.10}//Backup if 2 is blocked
    AttackPos[4] = marker at {1367.79,47.20,1666.02}//JapaneseTown1
    AttackPos[5] = marker at {1366.89,57.42,1570.45}//Backup if 4 is blocked
    AttackPos[6] = marker at {1869.91,23.00,1187.53}//JapaneseTown2
    AttackPos[7] = marker at {1977.00,14.49,1162.50}//Backup if 6 is blocked

    AttackPosFront[0] = marker at {1403.77,64.23,1482.05}
    AttackPosFront[1] = marker at {1372.35,35.44,1209.93}
    AttackPosFront[2] = marker at {1178.58,21.68,1157.07}
    AttackPosFlank[0] = marker at {900.53,26.83,1378.71}
    AttackPosFlank[1] = marker at {608.38,134.26,1201.02}
    AttackPosFlank[2] = marker at {756.03,104.89,1061.43}
    AttackPosBack[0] = marker at {900.53,26.83,1378.71}
    AttackPosBack[1] = marker at {608.38,134.26,1201.02}
    AttackPosBack[2] = marker at {756.03,104.89,1061.43}

    SiegeRoute1[0] = marker at {1639.34,67.56,1409.23}
    SiegeRoute1[1] = marker at {1572.76,63.89,1281.53}
    SiegeRoute2[0] = marker at {1639.34,67.56,1409.23}
    SiegeRoute2[1] = marker at {1587.63,63.94,1279.14}
    SiegeRoute3[0] = marker at {1797.83,64.32,1463.26}
    SiegeRoute3[1] = marker at {1823.22,61.15,1438.92}
    SiegeRoute3[2] = marker at {1747.00,15.17,1073.58}
    SiegeRoute3[3] = marker at {1384.19,17.83,1037.65}
    SiegeRoute4[0] = marker at {1461.78,68.27,1488.75}
    SiegeRoute4[1] = marker at {1401.29,38.17,1281.56}
    SiegeRoute4[2] = marker at {1174.55,21.85,1164.32}
    SiegeRoute5[0] = marker at {1461.78,68.27,1488.75}
    SiegeRoute5[1] = marker at {1401.29,38.17,1281.56}
    SiegeRoute5[2] = marker at {1095.59,28.11,1153.31}
    SiegeRoute6[0] = marker at {897.57,25.52,1506.22}
    SiegeRoute6[1] = marker at {963.24,21.58,1316.43}
    SiegeRoute6[2] = marker at {1103.64,28.87,1172.78}

    PatrolRouteA[0] = marker at {1398.84,51.84,1666.85}
    PatrolRouteA[1] = marker at {1394.85,47.65,1332.50}
    PatrolRouteB[0] = marker at {1643.05,73.13,1532.86}
    PatrolRouteB[1] = marker at {1629.42,73.16,1517.67}
    PatrolRouteC[0] = marker at {1398.25,38.03,1272.38}
    PatrolRouteC[1] = marker at {641.23,125.60,1287.95}
    PatrolRouteC[2] = marker at {776.13,97.50,1061.34}
    PatrolRouteD[0] = marker at {1858.20,43.23,1387.68}
    PatrolRouteD[1] = marker at {1806.07,15.79,1133.56}
    PatrolRouteD[2] = marker at {1595.46,16.90,1050.21}
    PatrolRouteE[0] = marker at {1585.52,64.24,1309.70}
    PatrolRouteE[1] = marker at {1579.03,62.55,1249.15}

    SiegePlatoonPos[0] = marker at {1426.53,66.46,1487.68}
    SiegePlatoonPos[1] = marker at {1349.38,58.28,1480.89}
    
    WaypointsA = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}
    WaypointsB = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}
    WaypointsC = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}
    WaypointsD = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}
    WaypointsE = create SCRIPT_OBJECT_TYPE_WAYPOINTROUTE at {0, 0, 0}

    add {PatrolRouteA[0]} to waypoint list WaypointsA
    add {PatrolRouteA[1]} to waypoint list WaypointsA
    add {PatrolRouteB[0]} to waypoint list WaypointsB
    add {PatrolRouteB[1]} to waypoint list WaypointsB
    add {PatrolRouteC[0]} to waypoint list WaypointsC
    add {PatrolRouteC[1]} to waypoint list WaypointsC
    add {PatrolRouteC[2]} to waypoint list WaypointsC
    add {PatrolRouteD[0]} to waypoint list WaypointsD
    add {PatrolRouteD[1]} to waypoint list WaypointsD
    add {PatrolRouteD[2]} to waypoint list WaypointsD
    add {PatrolRouteE[0]} to waypoint list WaypointsE
    add {PatrolRouteE[1]} to waypoint list WaypointsE

    //Waypoints nearby own towns
    StaticPlatoonGoodPos[0] = marker at {1368.46,63.72,1519.78}
    StaticPlatoonGoodPos[1] = marker at {1796.79,16.18,1121.39}
    StaticPlatoonGoodPos[2] = marker at {1527.50,23.96,1099.50}
    StaticPlatoonGoodPos[3] = marker at {1351.37,32.20,1210.58}
    //Waypoints nearby neutral towns which is likely to be taken by player
    StaticPlatoonEvilPos[0] = marker at {1599.92,17.19,1071.67}
    StaticPlatoonEvilPos[1] = marker at {901.98,23.48,1477.97}
    StaticPlatoonEvilPos[2] = marker at {579.10,118.23,1266.73}

end script Waypoints

begin script AttackRndAttackLogic(attackerssentnum)

    RndAttackPrevious = 0

start

wait JAPANESEWAITUNTILFIRSTATTACK seconds
RndAttack[attackerssentnum] = number from 1 to 5
RndAttackPrevious = RndAttack[attackerssentnum]
//say "RndAttack[attackerssentnum] = $d" with number RndAttack

begin loop
    if AttackersSent[attackerssentnum] == 1
        //say "AttackersSent[attackerssentnum] = 1"
        wait JAPANESEDELAYBETWEENATTACK seconds
        begin loop
            RndAttack[attackerssentnum] = number from 1 to 5
            until RndAttack[attackerssentnum] != RndAttackPrevious
        end loop
        //say "AttackersSent[attackerssentnum] = 0"
        AttackersSent[attackerssentnum] = 0
        RndAttackPrevious = RndAttack[attackerssentnum]
    else
        wait 60 seconds
    end if
end loop

end script AttackRndAttackLogic

begin script AttackSyncTimerLogic

start

AttackSyncTimer = create timer for 0 seconds
begin loop
    if get AttackSyncTimer time remaining <= 0
        wait 2.5 seconds
        AttackSyncTimer = create timer for 75 seconds
    end if
end loop

end script AttackSyncTimerLogic

begin script PlatoonTargetingMetric(PlatoonSize,TargetTown)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player 0 mana > 20000
    AltarsProbability += 60
end if

if get player 0 mana > 50000
    AltarsProbability += 60
end if

if adult size of PlayerTown > 120
    VillagersProbability *= adult size of PlayerTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

PlatoonTargetingMetricFocusResult = DesiredTarget

//say "PlatoonTargetingMetricFocusResult = $d" with number PlatoonTargetingMetricFocusResult

end script PlatoonTargetingMetric

begin script CatapultTargetingMetric(TargetTown)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player 0 mana > 10000
    AltarsProbability += 60
end if

if get player 0 mana > 30000
    AltarsProbability += 60
end if

if adult size of PlayerTown > 120
    VillagersProbability *= adult size of PlayerTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

CatapultTargetingMetricFocusResult = DesiredTarget

end script CatapultTargetingMetric

begin script LC6_Platoon0Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    PlayerSettlement = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    AttackingPoint = AttackPos[2]
    AttackingPointFallBack = AttackPos[3]
    Threshold = 0
    
start

begin loop
    a = 0
    begin loop    

        wait until LC6_Platoon[0] exists
        
        PlayerCreature = get distance from {LC6_Platoon[0]} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[0] can navigate to {oCreature}
            clear LC6_Platoon[0] action queue
            begin loop
                PlayerCreature = get distance from {LC6_Platoon[0]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to LC6_Platoon[0] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[0] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear LC6_Platoon[0] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 200
        Catapult = get siege weapon of player 0 nearest {LC6_Platoon[0]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[0] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[0] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to LC6_Platoon[0] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC6_Platoon[0] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC6_Platoon[0] action queue
        elsif Catapult exists and LC6_Platoon[0] can navigate to {Catapult}
            clear LC6_Platoon[0] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC6_Platoon[0]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC6_Platoon[0] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 200
                if PlayerPlatoon1 exists and LC6_Platoon[0] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC6_Platoon[0] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC6_Platoon[0] action queue
            a = 0
        end if
        
        if get size of LC6_Platoon[0] action queue < 1
            move LC6_Platoon[0] along WaypointsA with patrol WAYPOINTROUTE_TRAVERSAL_TYPE_CIRCULAR
        end if

        if LC6_Platoon[0] not exists
            //PlatoonKilled = 1
            wait until LC6_Platoon[0] exists
        end if
        
        until TownsAggressiveConverted >= 1
    end loop

    wait 10 seconds
    clear LC6_Platoon[0] action queue

    begin loop

        wait until LC6_Platoon[0] exists

        PlayerCreature = get distance from {LC6_Platoon[0]} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[0] can navigate to {oCreature}
            clear LC6_Platoon[0] action queue
            begin loop
                PlayerCreature = get distance from {LC6_Platoon[0]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to LC6_Platoon[0] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[0] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear LC6_Platoon[0] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 200
        Catapult = get siege weapon of player 0 nearest {LC6_Platoon[0]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[0] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[0] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to LC6_Platoon[0] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC6_Platoon[0] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC6_Platoon[0] action queue
        elsif Catapult exists and LC6_Platoon[0] can navigate to {Catapult}
            clear LC6_Platoon[0] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC6_Platoon[0]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC6_Platoon[0] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 200
                if PlayerPlatoon1 exists and LC6_Platoon[0] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC6_Platoon[0] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC6_Platoon[0] action queue
            a = 0
        end if
        
        if get size of LC6_Platoon[0] action queue < 1 and not {LC6_Platoon[0]} near {PatrolRouteC[2]} radius 200
            move LC6_Platoon[0] along WaypointsC with patrol WAYPOINTROUTE_TRAVERSAL_TYPE_FORWARDS
        end if
        
        if get size of LC6_Platoon[0] action queue < 1 and {LC6_Platoon[0]} near {PatrolRouteC[2]} radius 200
            if LC6_Platoon[0] can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                //wait number from 5 to 25 seconds
                a = 1
                clear LC6_Platoon[0] action queue
                Number = number from 1 to 4
                if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                    AttackMode = 1
                    set LC6_Platoon[0] attack PlayerTown with severity 0.2
                elsif Number == 3 or Number == 4 //Destroy value buildings
                    AttackMode = 2
                    Building = 0
                    Timer = create timer for 2 seconds
                    begin loop
                        Number = number from 1 to 8
                        if Number == 1 or Number == 2 or Number == 3
                            Building = get building ALTAR in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC6_Platoon[0] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 4
                            Building = get building TEMPLE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC6_Platoon[0] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 5
                            Building = get building CREATURE_PEN in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC6_Platoon[0] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 6
                            Building = get building UNIVERSITY in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC6_Platoon[0] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 7
                            Building = get building BATHHOUSE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC6_Platoon[0] action queue
                            else
                                Building = 0
                            end if
                        elsif Number == 8
                            Building = get building AMPITHEATRE in PlayerTown min built 0.75
                            if Building exists
                                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to LC6_Platoon[0] action queue
                            else
                                Building = 0
                            end if
                        end if
                        until Building != 0 or get Timer time remaining <= 0
                    end loop
                else //Capture Town
                    AttackMode = 0
                    if TownCapturePlatoons[0] < 2
                        TownCapturePlatoons[0]++
                        set LC6_Platoon[0] attack PlayerTown with severity 0.3 for takeover
                    else
                        a = 0
                    end if
                end if
                RecalculateTimer = create timer for 40 seconds
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[0]} radius 150
                    TestCreature2 = get distance from {LC6_Platoon[0]} to {MyCreature}
                    NumPat1 = get number of villagers in platoon LC6_Platoon[0]
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC6_Platoon[0] can navigate to object PlayerTownCentre
                        if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                            a = 0
                        elsif not LC6_Platoon[0] can navigate to object oTownCentre
                            a = 0
                        elsif LC6_Platoon[0] not exists
                            a = 0
                        elsif AttackMode == 1 and HEALTH of MyCreature == 0
                            a = 0
                        elsif AttackMode == 2 and Building not exists
                            a = 0
                        elsif AttackMode == 2 and HEALTH of Building < 0.1
                            a = 0
                        elsif AttackMode == 2 and Building == 0
                            a = 0
                        elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC6_Platoon[0] not exists
                end loop
                if AttackMode == 0
                    TownCapturePlatoons[0]--
                end if
                clear LC6_Platoon[0] action queue
            elsif LC6_Platoon[0] can navigate to {AttackingPoint} and get player 0 influence at {AttackingPoint} == 0
                if not {LC6_Platoon[0]} near {AttackingPoint} radius 25
                    clear LC6_Platoon[0] action queue
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint} to LC6_Platoon[0] action queue
                end if
            elsif not {LC6_Platoon[0]} near {AttackingPointFallBack} radius 25
                clear LC6_Platoon[0] action queue
                if get player 0 influence at {AttackingPointFallBack} > 0
                    begin loop
                        AttackingPointFallBack = marker at {AttackingPointFallBack} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                        Threshold += 5
                        until (LC6_Platoon[0] can navigate to {AttackingPointFallBack} and get player 0 influence at {AttackingPointFallBack} == 0) or Threshold > 999
                    end loop
                    Threshold = 1
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPointFallBack} to LC6_Platoon[0] action queue
            end if
        end if

        until LC6_Platoon[0] not exists
    end loop
    if LC6_Platoon[0] not exists
        //PlatoonKilled = 1
        wait until LC6_Platoon[0] exists
    end if
end loop

end script LC6_Platoon0Actions

begin script LC6_Platoon1Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    HomeTown = get town with id 4
    Catapult = 0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in HomeTown min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in HomeTown min built 1.0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    PlayerSettlement = 0
    
start

begin loop
    disable platoon LC6_Platoon[1] camp
    a = 0
    wait until LC6_Platoon[1] exists
    begin loop    
        
        PlayerCreature = get distance from {LC6_Platoon[1]} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[1] can navigate to {oCreature}
            clear LC6_Platoon[1] action queue
            begin loop
                PlayerCreature = get distance from {LC6_Platoon[1]} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC6_Platoon[1] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[1]
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[1] can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear LC6_Platoon[1] action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[1]} radius 200
        Catapult = get siege weapon of player 0 nearest {LC6_Platoon[1]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[1] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[1] action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[1]} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC6_Platoon[1] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[1]
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not LC6_Platoon[1] can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear LC6_Platoon[1] action queue
        elsif Catapult exists and LC6_Platoon[1] can navigate to {Catapult}
            clear LC6_Platoon[1] action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {LC6_Platoon[1]} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to LC6_Platoon[1] action queue
                NumPat1 = get number of villagers in platoon LC6_Platoon[1]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[1]} radius 200
                if PlayerPlatoon1 exists and LC6_Platoon[1] can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not LC6_Platoon[1] can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear LC6_Platoon[1] action queue
            a = 0
        end if
        
        if get size of LC6_Platoon[1] action queue < 1 and not {LC6_Platoon[1]} near {PatrolRouteB[1]} radius 30
            move LC6_Platoon[1] along WaypointsB with patrol WAYPOINTROUTE_TRAVERSAL_TYPE_FORWARDS
        end if
        
        until LC6_Platoon[1] not exists
    end loop
    if LC6_Platoon[1] not exists
        //PlatoonKilled = 1
        wait until LC6_Platoon[1] exists
    end if
end loop

end script LC6_Platoon1Actions

begin script LC6_Platoon14Actions

    oCreature = get player 0 creature
    HeTeste3 = 0
    TestCreature2 = 0
    NumPat = 0
    NumPat5 = 0
    PlayerPlatoon1 = 0
    WorrNum = 0
    JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in JapaneseTown1 min built 1.0
    ProPlatoonsLocation = 0
    AIPlatoon1 = 0
    Armory = 0
    Town8 = get town with id 8
    RandomActionP3 = 0
    a = 1
    Timer = create timer for 0 seconds
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    oWall = 0
    PlayerCatapult1 = 0
    PlayerPlatoonInRange = 0
    TownCaptured = 0
    PlayerSettlement = 0
    
start

begin loop
    a = 1
    wait until LC6_Platoon[14] exists
    begin loop
        TestCreature2 = get distance from {LC6_Platoon[14]} to {oCreature}
        if TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[14] can navigate to {oCreature}
            clear LC6_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC6_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[14]
                TestCreature2 = get distance from {LC6_Platoon[14]} to {oCreature}
                until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[14] can navigate to {oCreature} or TestCreature2 > 150 * 1.25
            end loop
        end if
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[14]} radius 150
        PlayerCatapult1 = get siege weapon of player 0 nearest {LC6_Platoon[14]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[14] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC6_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[14]
                HeTeste3 = get number of villagers in platoon PlayerPlatoon1
                until NumPat5 == 0 or HeTeste3 == 0 or not LC6_Platoon[14] can navigate to {PlayerPlatoon1}
            end loop
        elsif PlayerCatapult1 exists and LC6_Platoon[14] can navigate to {PlayerCatapult1}
            clear LC6_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC6_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[14]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[14]} radius 150
                if PlayerPlatoon1 exists and LC6_Platoon[14] can navigate to {PlayerPlatoon1}
                    PlayerPlatoonInRange = 1
                end if
                until NumPat5 == 0 or PlayerCatapult1 not exists or not LC6_Platoon[14] can navigate to {PlayerCatapult1} or PlayerPlatoonInRange == 1
            end loop
            PlayerPlatoonInRange = 0
        end if
        if LC6_Platoon[14] can navigate to {AttackPos[5]} and get size of LC6_Platoon[14] action queue < 1
            clear LC6_Platoon[14] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[5]} to LC6_Platoon[14] action queue
        end if
        until LC6_Platoon[14] not exists or {LC6_Platoon[14]} near {AttackPos[5]} radius 80
    end loop
    
    begin loop //Attack
        TestCreature2 = get distance from {LC6_Platoon[14]} to {oCreature}
        if TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[14] can navigate to {oCreature}
            clear LC6_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC6_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[14]
                TestCreature2 = get distance from {LC6_Platoon[14]} to {oCreature}
                until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[14] can navigate to {oCreature} or TestCreature2 > 150 * 1.25
            end loop
        end if
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[14]} radius 150
        PlayerCatapult1 = get siege weapon of player 0 nearest {LC6_Platoon[14]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[14] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC6_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[14]
                HeTeste3 = get number of villagers in platoon PlayerPlatoon1
                until NumPat5 == 0 or HeTeste3 == 0 or not LC6_Platoon[14] can navigate to {PlayerPlatoon1}
            end loop
        elsif PlayerCatapult1 exists and LC6_Platoon[14] can navigate to {PlayerCatapult1}
            clear LC6_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC6_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[14]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[14]} radius 150
                if PlayerPlatoon1 exists and LC6_Platoon[14] can navigate to {PlayerPlatoon1}
                    PlayerPlatoonInRange = 1
                end if
                until NumPat5 == 0 or PlayerCatapult1 not exists or not LC6_Platoon[14] can navigate to {PlayerCatapult1} or PlayerPlatoonInRange == 1
            end loop
            PlayerPlatoonInRange = 0
        end if
        JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in JapaneseTown1 min built 1.0
        if LC6_Platoon[14] can navigate to object JapaneseTownCentre and PLAYER of JapaneseTown1 != 1
            //wait number from 5 to 25 seconds
            a = 1
            clear LC6_Platoon[14] action queue
            wait 1 seconds
            if LC6_Platoon[14] can navigate to object JapaneseTownCentre and PLAYER of JapaneseTown1 != 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[14]} radius 150
                    TestCreature2 = get distance from {LC6_Platoon[14]} to {oCreature}
                    set LC6_Platoon[14] attack JapaneseTown1 with severity 0.7 for takeover
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC6_Platoon[14] can navigate to object JapaneseTownCentre
                        if PlayerPlatoon1 exists
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                            a = 0
                        elsif not LC6_Platoon[14] can navigate to object JapaneseTownCentre
                            a = 0
                        elsif LC6_Platoon[14] not exists
                            a = 0
                        elsif PLAYER of JapaneseTown1 == 1
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC6_Platoon[14] not exists or PLAYER of JapaneseTown1 == 1
                end loop
            end if
            clear LC6_Platoon[14] action queue
        end if
        if LC6_Platoon[14] can navigate to {AttackPos[5]} and PLAYER of JapaneseTown1 != 1 and not {LC6_Platoon[14]} near {AttackPos[5]} radius 15
            clear LC6_Platoon[14] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[5]} to LC6_Platoon[14] action queue
        end if
        if LC6_Platoon[14] can navigate to {AttackPos[4]} and PLAYER of JapaneseTown1 == 1 and not {LC6_Platoon[14]} near {AttackPos[4]} radius 15
            clear LC6_Platoon[14] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[4]} to LC6_Platoon[14] action queue
        end if

        until LC6_Platoon[14] not exists
    end loop
    if LC6_Platoon[14] not exists
        //PlatoonKilled = 1
        wait until LC6_Platoon[14] exists
    end if
end loop

end script LC6_Platoon14Actions

begin script LC6_Platoon15Actions

    oCreature = get player 0 creature
    HeTeste3 = 0
    TestCreature2 = 0
    NumPat = 0
    NumPat5 = 0
    PlayerPlatoon1 = 0
    WorrNum = 0
    JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in JapaneseTown2 min built 1.0
    ProPlatoonsLocation = 0
    AIPlatoon1 = 0
    Armory = 0
    Town8 = get town with id 8
    RandomActionP3 = 0
    a = 1
    Timer = create timer for 0 seconds
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    oWall = 0
    PlayerCatapult1 = 0
    PlayerPlatoonInRange = 0
    TownCaptured = 0
    PlayerSettlement = 0
    
start

begin loop
    a = 1
    wait until LC6_Platoon[15] exists
    begin loop
        TestCreature2 = get distance from {LC6_Platoon[15]} to {oCreature}
        if TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[15] can navigate to {oCreature}
            clear LC6_Platoon[15] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC6_Platoon[15] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[15]
                TestCreature2 = get distance from {LC6_Platoon[15]} to {oCreature}
                until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[15] can navigate to {oCreature} or TestCreature2 > 150 * 1.25
            end loop
        end if
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[15]} radius 150
        PlayerCatapult1 = get siege weapon of player 0 nearest {LC6_Platoon[15]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[15] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[15] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC6_Platoon[15] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[15]
                HeTeste3 = get number of villagers in platoon PlayerPlatoon1
                until NumPat5 == 0 or HeTeste3 == 0 or not LC6_Platoon[15] can navigate to {PlayerPlatoon1}
            end loop
        elsif PlayerCatapult1 exists and LC6_Platoon[15] can navigate to {PlayerCatapult1}
            clear LC6_Platoon[15] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC6_Platoon[15] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[15]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[15]} radius 150
                if PlayerPlatoon1 exists and LC6_Platoon[15] can navigate to {PlayerPlatoon1}
                    PlayerPlatoonInRange = 1
                end if
                until NumPat5 == 0 or PlayerCatapult1 not exists or not LC6_Platoon[15] can navigate to {PlayerCatapult1} or PlayerPlatoonInRange == 1
            end loop
            PlayerPlatoonInRange = 0
        end if
        if LC6_Platoon[15] can navigate to {AttackPos[7]} and get size of LC6_Platoon[15] action queue < 1
            clear LC6_Platoon[15] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[7]} to LC6_Platoon[15] action queue
        end if
        until LC6_Platoon[15] not exists or {LC6_Platoon[15]} near {AttackPos[7]} radius 80
    end loop
    
    begin loop //Attack
        TestCreature2 = get distance from {LC6_Platoon[15]} to {oCreature}
        if TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[15] can navigate to {oCreature}
            clear LC6_Platoon[15] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC6_Platoon[15] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[15]
                TestCreature2 = get distance from {LC6_Platoon[15]} to {oCreature}
                until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[15] can navigate to {oCreature} or TestCreature2 > 150 * 1.25
            end loop
        end if
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[15]} radius 150
        PlayerCatapult1 = get siege weapon of player 0 nearest {LC6_Platoon[15]} radius 150
        if PlayerPlatoon1 exists and LC6_Platoon[15] can navigate to {PlayerPlatoon1}
            clear LC6_Platoon[15] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC6_Platoon[15] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[15]
                HeTeste3 = get number of villagers in platoon PlayerPlatoon1
                until NumPat5 == 0 or HeTeste3 == 0 or not LC6_Platoon[15] can navigate to {PlayerPlatoon1}
            end loop
        elsif PlayerCatapult1 exists and LC6_Platoon[15] can navigate to {PlayerCatapult1}
            clear LC6_Platoon[15] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC6_Platoon[15] action queue
                NumPat5 = get number of villagers in platoon LC6_Platoon[15]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[15]} radius 150
                if PlayerPlatoon1 exists and LC6_Platoon[15] can navigate to {PlayerPlatoon1}
                    PlayerPlatoonInRange = 1
                end if
                until NumPat5 == 0 or PlayerCatapult1 not exists or not LC6_Platoon[15] can navigate to {PlayerCatapult1} or PlayerPlatoonInRange == 1
            end loop
            PlayerPlatoonInRange = 0
        end if
        JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in JapaneseTown2 min built 1.0
        if LC6_Platoon[15] can navigate to object JapaneseTownCentre and PLAYER of JapaneseTown2 != 1
            //wait number from 5 to 25 seconds
            a = 1
            clear LC6_Platoon[15] action queue
            wait 1 seconds
            if LC6_Platoon[15] can navigate to object JapaneseTownCentre and PLAYER of JapaneseTown2 != 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[15]} radius 150
                    TestCreature2 = get distance from {LC6_Platoon[15]} to {oCreature}
                    set LC6_Platoon[15] attack JapaneseTown2 with severity 0.7 for takeover
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC6_Platoon[15] can navigate to object JapaneseTownCentre
                        if PlayerPlatoon1 exists
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                            a = 0
                        elsif not LC6_Platoon[15] can navigate to object JapaneseTownCentre
                            a = 0
                        elsif LC6_Platoon[15] not exists
                            a = 0
                        elsif PLAYER of JapaneseTown2 == 1
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC6_Platoon[15] not exists or PLAYER of JapaneseTown2 == 1
                end loop
            end if
            clear LC6_Platoon[15] action queue
        end if
        if LC6_Platoon[15] can navigate to {AttackPos[7]} and PLAYER of JapaneseTown2 != 1 and not {LC6_Platoon[15]} near {AttackPos[7]} radius 15
            clear LC6_Platoon[15] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[7]} to LC6_Platoon[15] action queue
        end if
        
        if LC6_Platoon[15] can navigate to {AttackPos[6]} and PLAYER of JapaneseTown2 == 1 and not {LC6_Platoon[15]} near {AttackPos[6]} radius 15
            clear LC6_Platoon[15] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackPos[6]} to LC6_Platoon[15] action queue
        end if

        until LC6_Platoon[15] not exists
    end loop
    if LC6_Platoon[15] not exists
        //PlatoonKilled = 1
        wait until LC6_Platoon[15] exists
    end if
end loop

end script LC6_Platoon15Actions

begin script LC6_Platoon23Actions

    oCreature = get player 0 creature
    HeTeste3 = 0
    TestCreature2 = 0
    NumPat = 0
    NumPat5 = 0
    PlayerPlatoon1 = 0
    WorrNum = 0
    JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in MinorTown5 min built 1.0
    ProPlatoonsLocation = 0
    AIPlatoon1 = 0
    Armory = 0
    Town8 = get town with id 8
    RandomActionP3 = 0
    a = 1
    Timer = create timer for 0 seconds
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    oWall = 0
    PlayerCatapult1 = 0
    PlayerPlatoonInRange = 0
    TownCaptured = 0
    PlayerSettlement = 0
    
start

begin loop //Attack
    wait until LC6_Platoon[23] exists

    TestCreature2 = get distance from {LC6_Platoon[23]} to {oCreature}
    if TestCreature2 <= 75 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC6_Platoon[23] can navigate to {oCreature}
        clear LC6_Platoon[23] action queue
        begin loop
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC6_Platoon[23] action queue
            NumPat5 = get number of villagers in platoon LC6_Platoon[23]
            TestCreature2 = get distance from {LC6_Platoon[23]} to {oCreature}
            until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC6_Platoon[23] can navigate to {oCreature} or TestCreature2 > 75 * 1.25
        end loop
    end if
    PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[23]} radius 75
    PlayerCatapult1 = get siege weapon of player 0 nearest {LC6_Platoon[23]} radius 75
    if PlayerPlatoon1 exists and LC6_Platoon[23] can navigate to {PlayerPlatoon1}
        clear LC6_Platoon[23] action queue
        begin loop
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC6_Platoon[23] action queue
            NumPat5 = get number of villagers in platoon LC6_Platoon[23]
            HeTeste3 = get number of villagers in platoon PlayerPlatoon1
            until NumPat5 == 0 or HeTeste3 == 0 or not LC6_Platoon[23] can navigate to {PlayerPlatoon1}
        end loop
    elsif PlayerCatapult1 exists and LC6_Platoon[23] can navigate to {PlayerCatapult1}
        clear LC6_Platoon[23] action queue
        begin loop
            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC6_Platoon[23] action queue
            NumPat5 = get number of villagers in platoon LC6_Platoon[23]
            PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[23]} radius 75
            if PlayerPlatoon1 exists and LC6_Platoon[23] can navigate to {PlayerPlatoon1}
                PlayerPlatoonInRange = 1
            end if
            until NumPat5 == 0 or PlayerCatapult1 not exists or not LC6_Platoon[23] can navigate to {PlayerCatapult1} or PlayerPlatoonInRange == 1
        end loop
        PlayerPlatoonInRange = 0
    end if
    JapaneseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in MinorTown5 min built 1.0
    if LC6_Platoon[23] can navigate to object JapaneseTownCentre and PLAYER of MinorTown5 != 1
        //wait number from 5 to 25 seconds
        a = 1
        clear LC6_Platoon[23] action queue
        wait 1 seconds
        if LC6_Platoon[23] can navigate to object JapaneseTownCentre and PLAYER of MinorTown5 != 1
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {LC6_Platoon[23]} radius 75
                TestCreature2 = get distance from {LC6_Platoon[23]} to {oCreature}
                set LC6_Platoon[23] attack MinorTown5 with severity 0.7 for takeover
                //if PlayerPlatoon1 exists or TestCreature2 <= 75 or not LC6_Platoon[23] can navigate to object JapaneseTownCentre
                    if PlayerPlatoon1 exists
                        a = 0
                    elsif TestCreature2 <= 75 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                        a = 0
                    elsif not LC6_Platoon[23] can navigate to object JapaneseTownCentre
                        a = 0
                    elsif LC6_Platoon[23] not exists
                        a = 0
                    elsif PLAYER of MinorTown5 == 1
                        a = 0
                    end if
                //end if
                until a == 0 or LC6_Platoon[23] not exists or PLAYER of MinorTown5 == 1
            end loop
        end if
        clear LC6_Platoon[23] action queue
    end if

    if LC6_Platoon[23] can navigate to {877.46,26.59,1536.59} and PLAYER of MinorTown5 == 1 and not {LC6_Platoon[23]} near {877.46,26.59,1536.59} radius 15
        clear LC6_Platoon[23] action queue
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {877.46,26.59,1536.59} to LC6_Platoon[23] action queue
    end if

end loop

end script LC6_Platoon23Actions

begin script LC6_SiegeCatapult0Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    Town0 = get town with id 0
    Town5 = get town with id 5
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in Town0 min built 1.0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in Town5 min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in Town5 min built 1.0
    Player1Town = 0
    a = 1
    AISiege = 0    
    WaypointMain[7]
    WaypointRouteMain = 0
    Counter = 0
    Town8 = get town with id 8
    Catapult = 0
    AttackingTown = 2
    NumPat5 = 0
    h = 1
    Player0Town0 = 0
    Timer = create timer for 0 seconds
    oWall = 0
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    AIPlatoon = 0
    Target = 0
    PointOn = 0
    CatapultMoveTimer1 = 5
    AttackTimer = 0
    ActionTimer = create timer for 0 seconds
    Wall1 = 0
    Wall2 = 0
    House = 0
    SiegeOnPointTimer = create timer for 0 seconds
    SiegeWeaponPoint = 0
    SiegeStucked = 0
    GateHouse = 0
    PlayerSettlement = 0
    
start

begin loop
    a = 1
    PointOn = 0
    SiegeStucked = 0
    wait until LC6_SiegeCatapult[0] exists
    wait 2 seconds
    begin loop
        PlayerCreature = get distance from {LC6_SiegeCatapult[0]} to {oCreature}
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_SiegeCatapult[0]} radius 150
        Catapult = get siege weapon of player 0 nearest {LC6_SiegeCatapult[0]} radius 150
        
        if PlayerCreature > 10 and PlayerPlatoon1 not exists and Catapult not exists
            if PlayerPlatoon1 not exists
                a = 1
            elsif PlayerCreature > 10 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                a = 1
            elsif Catapult not exists
                a = 1
            end if
        end if
        
        if PlayerCreature <= 10 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
            clear siege weapon LC6_SiegeCatapult[0] action queue
            a = 0
        elsif PlayerPlatoon1 exists and LC6_SiegeCatapult[0] can navigate to {PlayerPlatoon1}
            clear siege weapon LC6_SiegeCatapult[0] action queue
            a = 0
        elsif Catapult exists and LC6_SiegeCatapult[0] can navigate to {Catapult}
            clear siege weapon LC6_SiegeCatapult[0] action queue
            a = 0
        elsif PointOn != 2 and a == 1
            begin loop
                if LC6_SiegeCatapult[0] exists 
                    if get SiegeOnPointTimer time remaining <= 0
                        SiegeWeaponPoint = marker at {LC6_SiegeCatapult[0]}
                        SiegeOnPointTimer = create timer for 160 seconds
                    elsif get SiegeOnPointTimer time remaining <= 5
                        if {LC6_SiegeCatapult[0]} near {SiegeWeaponPoint} radius 10
                            clear siege weapon LC6_SiegeCatapult[0] action queue
                            delete LC6_SiegeCatapult[0]
                            SiegeStucked = 1
                        end if
                    end if
                    if get CatapultMoveTimer1 time remaining <= 0
                        if get size of LC6_SiegeCatapult[0] action queue < 1

                            if PointOn == 0
                                if LC6_SiegeCatapult[0] can navigate to {SiegeRoute1[0]}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {SiegeRoute1[0]} to siege weapon LC6_SiegeCatapult[0] action queue
                                end if
                    
                            elsif PointOn == 1
                                if LC6_SiegeCatapult[0] can navigate to {SiegeRoute1[1]}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {SiegeRoute1[1]} to siege weapon LC6_SiegeCatapult[0] action queue
                                end if

                            CatapultMoveTimer1 = create timer for 10 seconds
                            
                            end if
                        end if
                    end if        

                    if {LC6_SiegeCatapult[0]} near {SiegeRoute1[0]} radius 15 and PointOn != 1 or 60 seconds
                        PointOn = 1
                    elsif {LC6_SiegeCatapult[0]} near {SiegeRoute1[1]} radius 15 and PointOn != 2 or 60 seconds
                        PointOn = 2
                    elsif (not LC6_SiegeCatapult[0] can navigate to {SiegeRoute1[1]} or get player 0 influence at {SiegeRoute1[1]} > 0) and {LC6_SiegeCatapult[0]} near {SiegeRoute1[0]} radius 15 and PointOn != 2
                        PointOn = 2
                    end if
                end if
            until LC6_SiegeCatapult[0] not exists or PointOn == 2 or 180 seconds
            end loop
        end if
        
        until PointOn == 2 or LC6_SiegeCatapult[0] not exists or 180 seconds
    end loop

    wait 10 seconds

    clear siege weapon LC6_SiegeCatapult[0] action queue
    
    begin loop
        if get ActionTimer time remaining <= 0
            enable siege weapon LC6_SiegeCatapult[0] auto attack
            clear siege weapon LC6_SiegeCatapult[0] action queue
            ActionTimer = create timer for 20 seconds
            add action SIEGEWEAPON_AGENDA_ACTION_DEFEND_POSITION using {SiegeRoute1[1]} to siege weapon LC6_SiegeCatapult[0] action queue
        end if

        until LC6_SiegeCatapult[0] not exists
    end loop
    
    if SiegeStucked == 1
        wait 10 seconds
        if LC6_SiegeCatapult[0] not exists LC6_SiegeCatapult[0] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_3 town JapaneseCapital siege weapon end if
    end if

    if LC6_SiegeCatapult[0] not exists and SiegeStucked == 0
        //CatapultDestroyed = 1
    end if
    
end loop

end script LC6_SiegeCatapult0Actions

begin script LC6_SiegeCatapult1Actions

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    WorrNum = 0
    Town0 = get town with id 0
    Town5 = get town with id 5
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in Town0 min built 1.0
    Armory = get building ABODE_NUMBER_MELEE_ARMOURY in Town5 min built 1.0
    ArmoryRanged = get building ABODE_NUMBER_RANGED_ARMOURY in Town5 min built 1.0
    Player1Town = 0
    a = 1
    AISiege = 0    
    WaypointMain[7]
    WaypointRouteMain = 0
    Counter = 0
    Town8 = get town with id 8
    Catapult = 0
    AttackingTown = 2
    NumPat5 = 0
    h = 1
    Player0Town0 = 0
    Timer = create timer for 0 seconds
    oWall = 0
    GreekGateHouse1 = 0
    GreekGateHouse2 = 0
    AIPlatoon = 0
    Target = 0
    PointOn = 0
    CatapultMoveTimer1 = 5
    AttackTimer = 0
    ActionTimer = create timer for 0 seconds
    Wall1 = 0
    Wall2 = 0
    House = 0
    SiegeOnPointTimer = create timer for 0 seconds
    SiegeWeaponPoint = 0
    SiegeStucked = 0
    GateHouse = 0
    PlayerSettlement = 0
    
start

begin loop
    a = 1
    PointOn = 0
    SiegeStucked = 0
    wait until LC6_SiegeCatapult[1] exists
    wait 2 seconds
    begin loop
        PlayerCreature = get distance from {LC6_SiegeCatapult[1]} to {oCreature}
        PlayerPlatoon1 = get platoon of player 0 nearest {LC6_SiegeCatapult[1]} radius 150
        Catapult = get siege weapon of player 0 nearest {LC6_SiegeCatapult[1]} radius 150
        
        if PlayerCreature > 10 and PlayerPlatoon1 not exists and Catapult not exists
            if PlayerPlatoon1 not exists
                a = 1
            elsif PlayerCreature > 10 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                a = 1
            elsif Catapult not exists
                a = 1
            end if
        end if
        
        if PlayerCreature <= 10 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
            clear siege weapon LC6_SiegeCatapult[1] action queue
            a = 0
        elsif PlayerPlatoon1 exists and LC6_SiegeCatapult[1] can navigate to {PlayerPlatoon1}
            clear siege weapon LC6_SiegeCatapult[1] action queue
            a = 0
        elsif Catapult exists and LC6_SiegeCatapult[1] can navigate to {Catapult}
            clear siege weapon LC6_SiegeCatapult[1] action queue
            a = 0
        elsif PointOn != 2 and a == 1
            begin loop
                if LC6_SiegeCatapult[1] exists 
                    if get SiegeOnPointTimer time remaining <= 0
                        SiegeWeaponPoint = marker at {LC6_SiegeCatapult[1]}
                        SiegeOnPointTimer = create timer for 160 seconds
                    elsif get SiegeOnPointTimer time remaining <= 5
                        if {LC6_SiegeCatapult[1]} near {SiegeWeaponPoint} radius 10
                            clear siege weapon LC6_SiegeCatapult[1] action queue
                            delete LC6_SiegeCatapult[1]
                            SiegeStucked = 1
                        end if
                    end if
                    if get CatapultMoveTimer1 time remaining <= 0
                        if get size of LC6_SiegeCatapult[1] action queue < 1

                            if PointOn == 0
                                if LC6_SiegeCatapult[1] can navigate to {SiegeRoute2[0]}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {SiegeRoute2[0]} to siege weapon LC6_SiegeCatapult[1] action queue
                                end if
                    
                            elsif PointOn == 1
                                if LC6_SiegeCatapult[1] can navigate to {SiegeRoute2[1]}
                                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {SiegeRoute2[1]} to siege weapon LC6_SiegeCatapult[1] action queue
                                end if

                            CatapultMoveTimer1 = create timer for 10 seconds
                            
                            end if
                        end if
                    end if        

                    if {LC6_SiegeCatapult[1]} near {SiegeRoute2[0]} radius 15 and PointOn != 1 or 60 seconds
                        PointOn = 1
                    elsif {LC6_SiegeCatapult[1]} near {SiegeRoute2[1]} radius 15 and PointOn != 2 or 60 seconds
                        PointOn = 2
                    elsif (not LC6_SiegeCatapult[1] can navigate to {SiegeRoute2[1]} or get player 0 influence at {SiegeRoute2[1]} > 0) and {LC6_SiegeCatapult[1]} near {SiegeRoute2[0]} radius 15 and PointOn != 2
                        PointOn = 2
                    end if
                end if
            until LC6_SiegeCatapult[1] not exists or PointOn == 2 or 180 seconds
            end loop
        end if
        
        until PointOn == 2 or LC6_SiegeCatapult[1] not exists or 180 seconds
    end loop

    wait 10 seconds

    clear siege weapon LC6_SiegeCatapult[1] action queue
    
    begin loop
        if get ActionTimer time remaining <= 0
            enable siege weapon LC6_SiegeCatapult[1] auto attack
            clear siege weapon LC6_SiegeCatapult[1] action queue
            ActionTimer = create timer for 10 seconds
            add action SIEGEWEAPON_AGENDA_ACTION_DEFEND_POSITION using {SiegeRoute2[1]} to siege weapon LC6_SiegeCatapult[1] action queue
        end if
            
        until LC6_SiegeCatapult[1] not exists
    end loop
    
    if SiegeStucked == 1
        wait 10 seconds
        if LC6_SiegeCatapult[1] not exists LC6_SiegeCatapult[1] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_3 town JapaneseCapital siege weapon end if
    end if

    if LC6_SiegeCatapult[1] not exists and SiegeStucked == 0
        //CatapultDestroyed = 1
    end if
    
end loop

end script LC6_SiegeCatapult1Actions

begin script LC6_StaticPlatoonsController

start

begin loop
    wait 15 seconds
    if get StaticPlatoonsActionTimer time remaining <= 0
        StaticPlatoonGoodWaypoint = StaticPlatoonGoodPos[number from 0 to 3]
        StaticPlatoonEvilWaypoint = StaticPlatoonEvilPos[number from 0 to 2]
        wait 60 seconds //Give platoons 60 seconds to react to new orders
        StaticPlatoonsActionTimer = create timer for number from 300 to 1200 seconds
    end if
end loop

end script LC6_StaticPlatoonsController

begin script LC6_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)

    ThisStaticPlatoonActionTimer = create timer for 0 seconds
    ThisStaticPlatoonActive = 0
    ThisStaticPlatoonWaypoint = 0
    ThisOriginTownEmergency = 0
    PlayerCreature = 0
    PlayerPlatoon1 = 0
    TestSiege = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    PlayerPlatoon1Distance = 0
    PlayerCatapultDistance = 0
    a = 0
    PlayerSettlement = 0
    ThresholdStatic = 0

start

LC6_StaticPlatoonCounter++

begin loop

    if Type == Melee
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    if get ThisStaticPlatoonActionTimer time remaining <= 0
        ThisStaticPlatoonActionTimer = create timer for number from 25 to 35 seconds
        //If emergency in OriginTown go defend it
        PlayerPlatoon1 = get platoon of player 0 nearest {OriginTown} radius 500
        Catapult = get siege weapon of player 0 nearest {OriginTown} radius 500
        PlayerCreature = get distance from {OriginTown} to {oCreature}
        if PlayerPlatoon1 exists or Catapult exists or (PlayerCreature <= 500 and HEALTH of oCreature > 0.00)
            ThisOriginTownEmergency = 1
        else
            ThisOriginTownEmergency = 0
        end if
        if ThisOriginTownEmergency == 1
            if ThisStaticPlatoonActive == 1
                StaticPlatoonsActive--
                ThisStaticPlatoonActive = 0
            end if
        end if
    end if

    if get StaticPlatoonsActionTimer time remaining <= 0
        //say "DEBUG: StaticPlatoonsActive = $d" with number StaticPlatoonsActive
        if get ThisStaticPlatoonActionTimer time remaining <= 5
            wait 5 seconds
            if number from 1 to 4 == 4
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 0 and StaticPlatoonsActive <= LC6_StaticPlatoonCounter * 0.8 //80% of all static platoons max
                    StaticPlatoonsActive++
                    ThisStaticPlatoonActive = 1
                end if
            else
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 1
                    StaticPlatoonsActive--
                    ThisStaticPlatoonActive = 0
                end if
            end if
        end if
    end if

    if ThisStaticPlatoonActive == 0 and get size of Platoon action queue < 1 and ({Platoon} not near {Pos} radius 25 or get player 0 influence at {Pos} > 0)
        if get player 0 influence at {Pos} > 0
            ThresholdStatic = 10
            begin loop
                Pos = marker at {Pos} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {Pos} and get player 0 influence at {Pos} == 0) or ThresholdStatic > 999
            end loop
        end if
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Pos} to Platoon action queue
    elsif ThisStaticPlatoonActive == 1 and get size of Platoon action queue < 1 and ({Platoon} not near {ThisStaticPlatoonWaypoint} radius 25 or ThisStaticPlatoonWaypoint == 0 or get player 0 influence at {Pos} > 0)
        if PlayerAlignmentFinal < 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonEvilWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        elsif PlayerAlignmentFinal >= 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonGoodWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        end if
    end if

    until Platoon not exists
end loop

LC6_StaticPlatoonCounter--

end script LC6_StaticPlatoonsActions

begin script LC6_ArmyBehaviours(Platoon,Type,Task,DefendObject,AttackFocus,Aggressiveness,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,AttackWPStage,DisableMerge,DisableSplit)

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    a = 0
    PlayerSettlement = 0
    Armory = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    Threshold = 1
    AttackRadius = 0
    AttackRadiusCatapult = 0
    AbortObjectiveProbability = 0
    AttackWP1Persistent = AttackWP1
    AttackWP2Persistent = AttackWP2
    AttackWP3Persistent = AttackWP3
    PlatoonSize = get number of villagers in platoon Platoon
    SplitUpChance = number from 1 to 100
    MergeChance = number from 1 to 100
    SplitDone = 0
    MergeDone = 0
    NewPlatoon = 0
    AttackingPoint1Initial = 0
    ScriptFirstTime = 1
    AssumedPlatoonPos = 0
    AttackFocusSource = AttackFocus

start

wait until not Platoon recruiting

AttackingPoint1Initial = marker at {AttackingPoint1}

if MergeChance >= SplitUpChance
    SplitUpChance = 0
else
    MergeChance = 0
end if

AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}

if Aggressiveness == Passive
    AttackRadius = 10
    AttackRadiusCatapult = 5
    AbortObjectiveProbability = 0
elsif Aggressiveness == Neutral
    AttackRadius = 100
    AttackRadiusCatapult = 75
    AbortObjectiveProbability = 25
elsif Aggressiveness == Alerted
    AttackRadius = 200
    AttackRadiusCatapult = 125
    AbortObjectiveProbability = 75
elsif Aggressiveness == Aggressive
    AttackRadius = 325
    AttackRadiusCatapult = 200
    AbortObjectiveProbability = 100
end if

//Group Attackers up first
if Platoon == LC6_Platoon[27]
    wait until LC6_Platoon[27] exists
    ScriptedAttack[0] = 1
end if

if Platoon == LC6_Platoon[42] or Platoon == LC6_Platoon[43]
    wait until LC6_Platoon[42] exists and LC6_Platoon[43] exists
    ScriptedAttack[1] = 1
end if

if Platoon == LC6_Platoon[32]
    wait until LC6_SiegeCatapult[8] exists and LC6_Platoon[32] exists and ({LC6_SiegeCatapult[8]} near {JapaneseCapital} radius 750)
    AttackersSent[0] = 1
end if

if Platoon == LC6_Platoon[33]
    wait until LC6_Platoon[33] exists and LC6_SiegeCatapult[9] exists and ({LC6_SiegeCatapult[9]} near {JapaneseCapital} radius 750) and LC6_SiegeCatapult[10] exists and ({LC6_SiegeCatapult[10]} near {JapaneseCapital} radius 750)
    AttackersSent[0] = 1
end if

if Platoon == LC6_Platoon[34] or Platoon == LC6_Platoon[35] or Platoon == LC6_Platoon[36] or Platoon == LC6_Platoon[37] or Platoon == LC6_Platoon[38]
    wait until LC6_Platoon[34] exists and LC6_Platoon[35] exists and LC6_Platoon[36] exists and LC6_Platoon[37] exists and LC6_Platoon[38] exists 
    AttackersSent[0] = 1
end if

if Platoon == LC6_Platoon[39] or Platoon == LC6_Platoon[40]
    wait until LC6_Platoon[39] exists and LC6_Platoon[40] exists and LC6_SiegeCatapult[11] exists and ({LC6_SiegeCatapult[11]} near {JapaneseCapital} radius 750) and LC6_SiegeCatapult[12] exists and ({LC6_SiegeCatapult[12]} near {JapaneseCapital} radius 750)
    AttackersSent[0] = 1
end if

if Platoon == LC6_Platoon[41]
    wait until LC6_Platoon[41] exists and LC6_SiegeCatapult[13] exists and ({LC6_SiegeCatapult[13]} near {JapaneseCapital} radius 750) and LC6_SiegeCatapult[14] exists and ({LC6_SiegeCatapult[14]} near {JapaneseCapital} radius 750) and LC6_SiegeCatapult[15] exists and ({LC6_SiegeCatapult[15]} near {JapaneseCapital} radius 750)
    AttackersSent[0] = 1
end if

begin loop
    //Attack nearby enemies
    if Type == Melee and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > AttackRadius * 1.25
            end loop
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
        Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            a = 0
        end if

    elsif Type == Ranged and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > AttackRadius * 1.25
            end loop
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
        Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            a = 0
        end if
    end if

    //Capture nearby settlements
    PlayerSettlement = get nearest town at {Platoon} for player 0 radius AttackRadius * 1.5
    //Not a Armory, it's a towncentre.
    Armory = get building ABODE_NUMBER_TOWN_CENTRE in PlayerSettlement min built 1.0
    if Armory exists and PlayerSettlement != PlayerTown and PLAYER of PlayerSettlement >= 0 and PLAYER of PlayerSettlement <= 3 and Task != Conqueror and HEALTH of Armory == 1.0 and not variable get town PlayerSettlement status == variable TOWN_STATUS_MIGRATION_STARTED
        if Platoon can navigate to object Armory
            if TownCapturePlatoons[2] < 2
                TownCapturePlatoons[2]++
                clear Platoon action queue
                set Platoon attack PlayerSettlement with severity 0.3 for takeover
                a = 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                    PlayerCreature = get distance from {Platoon} to {oCreature}
                    if PlayerPlatoon1 exists
                        a = 0
                    elsif PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                        a = 0
                    elsif not Platoon can navigate to object Armory
                        a = 0
                    elsif Platoon not exists
                        a = 0
                    end if
                    until a == 0 or Platoon not exists or PLAYER of PlayerSettlement == 1
                end loop
                TownCapturePlatoons[2]--
            end if
        end if
    end if

    //Basic tasks
    if Task == Attacker
        //if get size of Platoon action queue < 1
            //Way to target town
            if AttackWPStage == 0
                if DefendObject exists and {Platoon} near {AttackWP1} radius 200
                    AttackWPStage = 1
                    //say "AttackWPStage = 1"
                elsif {Platoon} near {AttackWP1} radius 33
                    AttackWPStage = 1
                    //say "AttackWPStage = 1"
                end if
                if AttackWPStage == 0
                    if get size of Platoon action queue < 1
                        if not Platoon can navigate to {AttackWP1}
                            Number = 0
                            begin loop
                                AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until Platoon not exists or Platoon can navigate to {AttackWP1}
                            end loop
                        end if
                        if not DefendObject exists
                            clear Platoon action queue
                            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP1} to Platoon action queue
                        elsif DefendObject exists
                            clear Platoon action queue
                            add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                        end if
                    end if
                end if
            elsif AttackWPStage == 1 and get AttackSyncTimer time remaining <= 0
                if DefendObject exists and {Platoon} near {AttackWP2} radius 200
                    AttackWPStage = 2
                    //say "AttackWPStage = 2"
                elsif {Platoon} near {AttackWP2} radius 33
                    AttackWPStage = 2
                    //say "AttackWPStage = 2"
                end if
                if AttackWPStage == 1
                    if get size of Platoon action queue < 1
                        if not Platoon can navigate to {AttackWP2}
                            Number = 0
                            begin loop
                                AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until Platoon not exists or Platoon can navigate to {AttackWP2}
                            end loop
                        end if
                        if not DefendObject exists
                            clear Platoon action queue
                            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP2} to Platoon action queue
                        elsif DefendObject exists
                            clear Platoon action queue
                            add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                        end if
                    end if
                end if
            elsif AttackWPStage == 2
                if DefendObject exists and {Platoon} near {AttackWP3} radius 200
                    AttackWPStage = 3
                    //say "AttackWPStage = 3"
                elsif {Platoon} near {AttackWP3} radius 33
                    AttackWPStage = 3
                    //say "AttackWPStage = 3"
                end if
                if AttackWPStage == 2
                    if get size of Platoon action queue < 1
                        if not Platoon can navigate to {AttackWP3}
                            Number = 0
                            begin loop
                                AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until Platoon not exists or Platoon can navigate to {AttackWP3}
                            end loop
                        end if
                        if not DefendObject exists
                            clear Platoon action queue
                            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP3} to Platoon action queue
                        elsif DefendObject exists
                            clear Platoon action queue
                            add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                        end if
                    end if
                end if
            end if
            //Targeting
            if AttackWPStage == 3
                if ScriptFirstTime == 1
                    ScriptFirstTime = 0
                    wait number from 5 to 10 seconds
                end if
                //say "PLATOON ATTACKING"
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                if PLAYER of PlayerTown != 0
                    //Switch task to conqueror to attack all remaining cities
                    Task = Conqueror
                    AttackFocus = Default
                elsif Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                    //say "Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0"
                    a = 0
                    wait 2 seconds
                    if AttackFocus == Default
                        //say "AttackFocus == Default"
                        clear Platoon action queue
                        Number = number from 1 to 4
                        if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                            AttackMode = 1
                            set Platoon attack PlayerTown with severity 0.2
                        elsif Number == 3 or Number == 4 //Destroy value buildings
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        else //Capture Town
                            AttackMode = 0
                            if TownCapturePlatoons[0] < 2
                                TownCapturePlatoons[0]++
                                set Platoon attack PlayerTown with severity 0.3 for takeover
                            end if
                        end if
                    elsif AttackFocus == Houses
                        //say "AttackFocus == Houses"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        //say "AttackFocus == Epics"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        //say "AttackFocus == Altars"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        //say "AttackFocus == CreaturePen"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        //say "AttackFocus == TownCenter"
                        clear Platoon action queue
                        AttackMode = 0
                        set Platoon attack PlayerTown with severity 0.3 for takeover
                    elsif AttackFocus == Villagers
                        //say "AttackFocus == Villagers"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {Platoon} radius 250
                                if Building not exists or PLAYER of Building != 0
                                    Building = get living villager at {PlayerTown} radius 250
                                end if
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of PlayerTown <= 60
                            AttackFocus = Default
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    Number = number from 0 to 99
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif not Platoon can navigate to object oTownCentre
                                a = 2
                            elsif Platoon not exists
                                a = 2
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 2
                            elsif AttackMode == 2 and Building not exists
                                a = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                a = 2
                            elsif AttackMode == 2 and Building == 0
                                a = 2
                            elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 2
                            elsif get size of Platoon action queue < 1
                                a = 2
                            end if
                        //end if
                        until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                    end loop
                    //say "until ((AbortObjectiveProbability > Number and a == 1) or (a == 2))"
                    if AttackMode == 0
                        TownCapturePlatoons[0]--
                    end if
                    clear Platoon action queue
                elsif DefendObject exists and Platoon can navigate to {DefendObject}
                    //say "DefendObject exists and Platoon can navigate to {DefendObject}"
                    if not {Platoon} near {DefendObject} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                elsif Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} <= 0
                    //say "Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0"
                    if not {Platoon} near {AttackingPoint1} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    end if
                else
                    //say "else"
                    if get player 0 influence at {AttackingPoint2} > 0
                        begin loop
                            AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                            Threshold += 5
                            until (Platoon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                        end loop
                        Threshold = 1
                    end if
                    if not {Platoon} near {AttackingPoint2} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint2} to Platoon action queue
                    end if
                end if
            end if
        //end if

    elsif Task == Conqueror
        AttackWPStage = 3
        if PLAYER of NearestSettlement != 0
            AttackFocus = TownCenter
        else
            AttackFocus = AttackFocusSource
        end if
        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        if PLAYER of NearestSettlement != 1 and oTownCentre exists
            if not Platoon can navigate to object oTownCentre
                if DefendObject exists
                    AttackingPoint1 = marker at {DefendObject} + {number from 20 to -20,0,number from 20 to -20}
                    clear Platoon action queue 
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    wait until get size of Platoon action queue < 1 or 10 seconds
                end if
            else
                if Platoon can navigate to object oTownCentre and PLAYER of NearestSettlement != 1
                    a = 0
                    wait 2 seconds
                    if AttackFocus == Default
                        clear Platoon action queue
                        Number = number from 1 to 4
                        if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                            AttackMode = 1
                            set Platoon attack NearestSettlement with severity 0.2
                        elsif Number == 3 or Number == 4 //Destroy value buildings
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        else //Capture Town
                            AttackMode = 0
                            if TownCapturePlatoons[0] < 2
                                TownCapturePlatoons[0]++
                                set Platoon attack NearestSettlement with severity 0.3 for takeover
                            end if
                        end if
                    elsif AttackFocus == Houses
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_B in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_C in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_D in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_E in NearestSettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75 and HEALTH of Building > 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in NearestSettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        clear Platoon action queue
                        AttackMode = 0
                        set Platoon attack NearestSettlement with severity 0.3 for takeover
                    elsif AttackFocus == Villagers
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {Platoon} radius 250
                                if Building not exists or PLAYER of Building != 0
                                    Building = get living villager at {NearestSettlement} radius 250
                                end if
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of NearestSettlement <= 60
                            AttackFocus = Default
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    Number = number from 0 to 99
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town NearestSettlement is under takeover from player 1
                                a = 1
                            elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town NearestSettlement is under takeover from player 1
                                a = 1
                            elsif not Platoon can navigate to object oTownCentre
                                a = 2
                            elsif Platoon not exists
                                a = 2
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 2
                            elsif AttackMode == 2 and Building not exists
                                a = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                a = 2
                            elsif AttackMode == 2 and Building == 0
                                a = 2
                            elsif not town NearestSettlement is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 2
                            end if
                        //end if
                        until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                    end loop
                    if AttackMode == 0
                        TownCapturePlatoons[2]--
                    end if
                    clear Platoon action queue
                else
                    if not {Platoon} near {AttackingPoint1} radius 25 or get player 0 influence at {AttackingPoint1} > 0
                        AttackingPoint1 = marker at {NearestSettlement}
                        clear Platoon action queue
                        if get player 0 influence at {AttackingPoint1} > 0 or PLAYER of NearestSettlement == 2 or PLAYER of NearestSettlement == 3 or PLAYER of NearestSettlement == 4
                            begin loop
                                AttackingPoint1 = marker at {AttackingPoint1} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                                Threshold += 5
                                until (Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0) or Threshold > 999
                            end loop
                            Threshold = 1
                        end if
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    end if
                end if
            end if
        end if

    elsif Task == Patrol
        if get size of Platoon action queue < 1
            move Platoon along PatrolRoute with patrol WAYPOINTROUTE_TRAVERSAL_TYPE_CIRCULAR
        end if

    elsif Task == CaptureMonkTemple
        PlayerPlatoon1 = get platoon of player 3 nearest {Platoon} radius AttackRadius
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 3 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        end if
        if Platoon can navigate to {AttackingPoint1} and not {Platoon} near {AttackingPoint1} radius 15
            clear Platoon action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
        end if

    elsif Task == Special and LC6_LargeSiegeStartAttack == 1
        if AttackWPStage == 0
            if DefendObject exists and {Platoon} near {AttackWP1} radius 200
                AttackWPStage = 1
                //say "AttackWPStage = 1"
            elsif {Platoon} near {AttackWP1} radius 33
                AttackWPStage = 1
                //say "AttackWPStage = 1"
            end if
            if AttackWPStage == 0
                if get size of Platoon action queue < 1
                    if not Platoon can navigate to {AttackWP1}
                        Number = 0
                        begin loop
                            AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until Platoon not exists or Platoon can navigate to {AttackWP1}
                        end loop
                    end if
                    if not DefendObject exists
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP1} to Platoon action queue
                    elsif DefendObject exists
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
            end if
        elsif AttackWPStage == 1
            if DefendObject exists and {Platoon} near {AttackWP2} radius 200
                AttackWPStage = 2
                //say "AttackWPStage = 2"
            elsif {Platoon} near {AttackWP2} radius 33
                AttackWPStage = 2
                //say "AttackWPStage = 2"
            end if
            if AttackWPStage == 1
                if get size of Platoon action queue < 1
                    if not Platoon can navigate to {AttackWP2}
                        Number = 0
                        begin loop
                            AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until Platoon not exists or Platoon can navigate to {AttackWP2}
                        end loop
                    end if
                    if not DefendObject exists
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP2} to Platoon action queue
                    elsif DefendObject exists
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
            end if
        elsif AttackWPStage == 2
            if DefendObject exists and {Platoon} near {AttackWP3} radius 200
                AttackWPStage = 3
                //say "AttackWPStage = 3"
            elsif {Platoon} near {AttackWP3} radius 33
                AttackWPStage = 3
                //say "AttackWPStage = 3"
            end if
            if AttackWPStage == 2
                if get size of Platoon action queue < 1
                    if not Platoon can navigate to {AttackWP3}
                        Number = 0
                        begin loop
                            AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until Platoon not exists or Platoon can navigate to {AttackWP3}
                        end loop
                    end if
                    if not DefendObject exists
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP3} to Platoon action queue
                    elsif DefendObject exists
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
            end if
        end if
        if LC6_LargeSiegeLaunchAttack == 1 and LC6_LargeSiegeRetreat == 0 and AttackWPStage == 3
            //if get size of Platoon action queue < 1
                //Targeting
                //say "PLATOON ATTACKING"
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                if PLAYER of PlayerTown != 0
                    //Switch task to conqueror to attack all remaining cities
                    Task = Conqueror
                    AttackFocus = Default
                elsif Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                    //say "Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0"
                    a = 0
                    wait 2 seconds
                    if AttackFocus == Default
                        //say "AttackFocus == Default"
                        clear Platoon action queue
                        Number = number from 1 to 4
                        if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                            AttackMode = 1
                            set Platoon attack PlayerTown with severity 0.2
                        elsif Number == 3 or Number == 4 //Destroy value buildings
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        else //Capture Town
                            AttackMode = 0
                            if TownCapturePlatoons[0] < 2
                                TownCapturePlatoons[0]++
                                set Platoon attack PlayerTown with severity 0.3 for takeover
                            end if
                        end if
                    elsif AttackFocus == Houses
                
                        //say "AttackFocus == Houses"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        //say "AttackFocus == Epics"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        //say "AttackFocus == Altars"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        //say "AttackFocus == CreaturePen"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        //say "AttackFocus == TownCenter"
                        clear Platoon action queue
                        AttackMode = 0
                        set Platoon attack PlayerTown with severity 0.3 for takeover
                    elsif AttackFocus == Villagers
                        //say "AttackFocus == Villagers"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {Platoon} radius 250
                                if Building not exists or PLAYER of Building != 0
                                    Building = get living villager at {PlayerTown} radius 250
                                end if
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of PlayerTown <= 60
                            AttackFocus = Default
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    Number = number from 0 to 99
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif not Platoon can navigate to object oTownCentre
                                a = 2
                            elsif Platoon not exists
                                a = 2
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 2
                            elsif AttackMode == 2 and Building not exists
                                a = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                a = 2
                            elsif AttackMode == 2 and Building == 0
                                a = 2
                            elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 2
                            elsif LC6_LargeSiegeRetreat == 1
                                a = 2
                            elsif LC6_LargeSiegeLaunchAttack == 0
                                a = 2
                            elsif get size of Platoon action queue < 1
                                a = 2
                            end if
                        //end if
                        until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                    end loop
                    //say "until ((AbortObjectiveProbability > Number and a == 1) or (a == 2))"
                    if AttackMode == 0
                        TownCapturePlatoons[0]--
                    end if
                    clear Platoon action queue
                elsif DefendObject exists and Platoon can navigate to {DefendObject}
                    //say "DefendObject exists and Platoon can navigate to {DefendObject}"
                    if not {Platoon} near {DefendObject} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                elsif Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} <= 0
                    //say "Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0"
                    if not {Platoon} near {AttackingPoint1} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    end if
                else
                    //say "else"
                    if get player 0 influence at {AttackingPoint2} > 0
                        begin loop
                            AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                            Threshold += 5
                            until (Platoon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                        end loop
                        Threshold = 1
                    end if
                    if not {Platoon} near {AttackingPoint2} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint2} to Platoon action queue
                    end if
                end if
            //end if
        elsif LC6_LargeSiegeRetreat == 1
            AttackWPStage = 3
            if not {Platoon} near {AttackingPoint2} radius 25 or get player 0 influence at {AttackingPoint2} > 0
                if get player 0 influence at {AttackingPoint2} > 0
                    begin loop
                        AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                        Threshold += 5
                        until (Platoon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                    end loop
                    Threshold = 1
                end if
                clear Platoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint2} to Platoon action queue
                wait until {Platoon} near {AttackingPoint2} radius 33
            end if
        end if
    end if

    //Special Tasks
    //Split up from origin platoon - Mutually exclusive with merging
    if SplitDone == 0 and 100-SplitUpChance < CHANCE_TO_SPLIT and (AttackWPStage == 3 or get platoon of player 0 nearest {Platoon} radius AttackRadius exists or (get distance from {Platoon} to {oCreature} < AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00))
        if get number of villagers in platoon Platoon > 30
            while get number of villagers in platoon Platoon > 30 and number from 1 to 3 != 1
                //say "SPLITTING NOW"
                wait 5 seconds
                SplitDone = 1
                Number = number from 1 to 4
                if Number == 1
                    NewPlatoon = split 15 soldiers from platoon Platoon
                elsif Number == 2
                    NewPlatoon = split 20 soldiers from platoon Platoon
                elsif Number == 3
                    NewPlatoon = split 25 soldiers from platoon Platoon
                elsif Number == 4
                    NewPlatoon = split 30 soldiers from platoon Platoon
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                wait 5 seconds
                clear NewPlatoon action queue
                run background script LC6_ArmyBehaviours(NewPlatoon,Type,Task,0,Default,Neutral,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,3,1,0)
            end while
        end if
    end if

    //Merge with target platoon - Mutually exclusive with splitting
    if MergeDone == 0 and 100-MergeChance < CHANCE_TO_MERGE and (AttackWPStage == 3 or get number of villagers in platoon Platoon < 10)
        if get number of villagers in platoon Platoon <= 50
            AssumedPlatoonPos = marker at {Platoon} + {number from -100 to 100, number from -100 to 100}
            NewPlatoon = get platoon of player 1 nearest {AssumedPlatoonPos} radius 100
            if NewPlatoon exists and NewPlatoon != Platoon and not NewPlatoon recruiting and get number of villagers in platoon NewPlatoon < 150
                if ((Type == Melee and platoon NewPlatoon melee) or (Type == Ranged and platoon NewPlatoon ranged))
                    //say "MERGING PLATOON INTO NEWPLATOON NOW"
                    wait 5 seconds
                    MergeDone = 1
                    while Platoon exists and NewPlatoon exists
                        merge platoon Platoon into platoon NewPlatoon
                        wait 10 seconds
                    end while
                end if
            end if
        end if
    end if
    until Platoon not exists
end loop

end script LC6_ArmyBehaviours

begin script LC6_MoveCatapultThenAttack(SiegeWeapon,Task,AttackFocus,AttackWP1,AttackWP2,AttackWP3,AttackingPoint1,AttackingPoint2,AttackWPStage)

    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
    a = 1
    Timer = create timer for 0 seconds
    Target = 0
    CatapultMoveTimer1 = create timer for 0 seconds
    ActionTimer = create timer for 0 seconds
    Wall1 = 0
    House = 0
    SiegeOnPointTimer = create timer for 0 seconds
    SiegeWeaponPoint = 0
    SiegeStucked = 0
    GateHouse = 0
    AttackWP1Persistent = AttackWP1
    AttackWP2Persistent = AttackWP2
    AttackWP3Persistent = AttackWP3
    Number = 0
    Building = 0
    objSubType = 0
    Threshold = 1

start

//begin loop

    AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
    AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
    AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}

    //Group up
    if SiegeWeapon == LC6_SiegeCatapult[8]
        wait until LC6_SiegeCatapult[8] exists and LC6_Platoon[32] exists
    end if

    if SiegeWeapon == LC6_SiegeCatapult[9] or SiegeWeapon == LC6_SiegeCatapult[10]
        wait until LC6_Platoon[33] exists and LC6_SiegeCatapult[9] exists and LC6_SiegeCatapult[10] exists
    end if

    if SiegeWeapon == LC6_SiegeCatapult[11] or SiegeWeapon == LC6_SiegeCatapult[12]
        wait until LC6_Platoon[39] exists and LC6_Platoon[40] exists and LC6_SiegeCatapult[11] exists and LC6_SiegeCatapult[12] exists
    end if

    if SiegeWeapon == LC6_SiegeCatapult[13] or SiegeWeapon == LC6_SiegeCatapult[14] or SiegeWeapon == LC6_SiegeCatapult[15]
        wait until LC6_Platoon[41] exists and LC6_SiegeCatapult[13] exists and LC6_SiegeCatapult[14] exists and LC6_SiegeCatapult[15] exists
    end if

    disable siege weapon SiegeWeapon auto attack

    begin loop
        if Task == Attacker
            if AttackWPStage != 3
                if get SiegeOnPointTimer time remaining <= 0
                    SiegeWeaponPoint = marker at {SiegeWeapon}
                    SiegeOnPointTimer = create timer for 90 seconds
                elsif get SiegeOnPointTimer time remaining <= 5
                    if {SiegeWeapon} near {SiegeWeaponPoint} radius 10
                        clear siege weapon SiegeWeapon action queue
                        SiegeStucked = 1
                        wait until not {SiegeWeapon} viewed or 30 seconds
                        delete SiegeWeapon
                    end if
                end if
            end if

            if AttackWPStage == 0
                if {SiegeWeapon} near {AttackWP1} radius 33
                    AttackWPStage = 1
                end if
                if AttackWPStage == 0
                    if get size of siege weapon SiegeWeapon action queue < 1
                        if not SiegeWeapon can navigate to {AttackWP1}
                            Number = 0
                            begin loop
                                AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP1}
                            end loop
                        end if
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP1} to siege weapon SiegeWeapon action queue
                    end if
                end if
            elsif AttackWPStage == 1 and get AttackSyncTimer time remaining <= 0
                if {SiegeWeapon} near {AttackWP2} radius 33
                    AttackWPStage = 2
                end if
                if AttackWPStage == 1
                    if get size of siege weapon SiegeWeapon action queue < 1
                        if not SiegeWeapon can navigate to {AttackWP2}
                            Number = 0
                            begin loop
                                AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP2}
                            end loop
                        end if
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP2} to siege weapon SiegeWeapon action queue
                    end if
                end if
            elsif AttackWPStage == 2
                if {SiegeWeapon} near {AttackWP3} radius 33
                    AttackWPStage = 3
                end if
                if AttackWPStage == 2
                    if get size of siege weapon SiegeWeapon action queue < 1
                        if not SiegeWeapon can navigate to {AttackWP3}
                            Number = 0
                            begin loop
                                AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP3}
                            end loop
                        end if
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP3} to siege weapon SiegeWeapon action queue
                    end if
                end if
            end if

            if AttackWPStage == 3 and get ActionTimer time remaining <= 0
                //say "ATTACKING"
                enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                if number from 1 to 10 >= 7
                    Number = number from 1 to 3
                    if Number == 1 or Number == 2
                        objSubType = 33
                        GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                        if GateHouse exists and PLAYER of GateHouse == 0
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            GateHouse = get random abode of type constant objSubType in town PlayerTown
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                objSubType = 34
                                GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                                if GateHouse exists and PLAYER of GateHouse == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    GateHouse = get random abode of type constant objSubType in town PlayerTown
                                    if GateHouse exists and PLAYER of GateHouse == 0
                                        clear siege weapon SiegeWeapon action queue
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                    else
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                            end if
                        end if
                    elsif Number == 3
                        Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                        if Wall1 exists and PLAYER of Wall1 == 0
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                        else
                            Wall1 = get wall segment nearest {AttackingPoint1} + {number from -75 to 75, number from -75 to 75} radius 750
                            if Wall1 exists and PLAYER of Wall1 == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                            else
                                ActionTimer = create timer for 0.025 seconds
                            end if
                        end if
                    end if
                else
                    if SiegeWeapon can navigate to object oTownCentre
                        ActionTimer = create timer for 60 seconds
                        wait 2 seconds
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type TEMPLE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type UNIVERSITY in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 7
                                Building = get random abode of type BATHHOUSE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 8
                                Building = get random abode of type AMPITHEATRE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type TOWN_CENTRE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {PlayerTown} + {number from -125 to 125,number from -125 to 125} radius 100
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if size of PlayerTown <= 60
                                AttackFocus = Default
                            end if
                        end if
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                end if
            end if
        elsif Task == Conqueror
            if get ActionTimer time remaining <= 0
                enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
                if PLAYER of NearestSettlement != 1 and oTownCentre exists
                    if number from 1 to 10 >= 7
                        Number = number from 1 to 3
                        if Number == 1 or Number == 2
                            objSubType = 33
                            GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                GateHouse = get random abode of type constant objSubType in town NearestSettlement
                                if GateHouse exists and PLAYER of GateHouse == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    objSubType = 34
                                    GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                                    if GateHouse exists and PLAYER of GateHouse == 0
                                        clear siege weapon SiegeWeapon action queue
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                    else
                                        GateHouse = get random abode of type constant objSubType in town NearestSettlement
                                        if GateHouse exists and PLAYER of GateHouse == 0
                                            clear siege weapon SiegeWeapon action queue
                                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                        else
                                            ActionTimer = create timer for 0.025 seconds
                                        end if
                                    end if
                                end if
                            end if
                        elsif Number == 3
                            Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                            if Wall1 exists and PLAYER of Wall1 == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                            else
                                Wall1 = get wall segment nearest {NearestSettlement} radius 750
                                if Wall1 exists and PLAYER of Wall1 == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        end if
                    else
                        if SiegeWeapon can navigate to object oTownCentre
                            ActionTimer = create timer for 60 seconds
                            wait 2 seconds
                            if AttackFocus == Default
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                            elsif AttackFocus == Houses
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 6
                                if Number == 1
                                    Building = get random abode of type ABODE_A in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 2
                                    Building = get random abode of type ABODE_B in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 3
                                    Building = get random abode of type ABODE_C in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type ABODE_D in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type ABODE_E in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type SKYSCRAPER in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                                if (get number of type HOUSE ABODE_A in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_B in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_C in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_D in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_E in NearestSettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in NearestSettlement min built 1.0) == 0
                                    AttackFocus = Default
                                end if
                            elsif AttackFocus == Epics
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get WONDER in NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                                if (get number of type WONDER WONDER_SIREN in NearestSettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in NearestSettlement min built 1.0) == 0
                                    AttackFocus = Default
                                end if
                            elsif AttackFocus == Altars
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type ALTAR in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                                if (get number of type HOUSE ALTAR in NearestSettlement min built 1.0) == 0
                                    AttackFocus = Default
                                end if
                            elsif AttackFocus == CreaturePen
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                                if (get number of type HOUSE CREATURE_PEN in NearestSettlement min built 1.0) == 0
                                    AttackFocus = Default
                                end if
                            elsif AttackFocus == TownCenter
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type TOWN_CENTRE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                            elsif AttackFocus == Villagers
                                clear siege weapon SiegeWeapon action queue
                                Building = 0
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get living villager at {NearestSettlement} + {number from -125 to 125,number from -125 to 125} radius 100
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                                if size of NearestSettlement <= 60
                                    AttackFocus = Default
                                end if
                            end if
                        else
                            ActionTimer = create timer for 0.025 seconds
                        end if
                    end if
                end if
            end if

        elsif Task == Special and LC6_LargeSiegeStartAttack == 1
            //say "Task == Special and LC6_LargeSiegeStartAttack == 1"
            if AttackWPStage != 3
                if get SiegeOnPointTimer time remaining <= 0
                    SiegeWeaponPoint = marker at {SiegeWeapon}
                    SiegeOnPointTimer = create timer for 90 seconds
                elsif get SiegeOnPointTimer time remaining <= 5
                    if {SiegeWeapon} near {SiegeWeaponPoint} radius 10
                        clear siege weapon SiegeWeapon action queue
                        SiegeStucked = 1
                        wait until not {SiegeWeapon} viewed or 30 seconds
                        delete SiegeWeapon
                    end if
                end if
            end if

            if AttackWPStage == 0
                if {SiegeWeapon} near {AttackWP1} radius 33
                    AttackWPStage = 1
                end if
                if AttackWPStage == 0
                    if get size of siege weapon SiegeWeapon action queue < 1
                        if not SiegeWeapon can navigate to {AttackWP1}
                            Number = 0
                            begin loop
                                AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP1}
                            end loop
                        end if
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP1} to siege weapon SiegeWeapon action queue
                    end if
                end if
            elsif AttackWPStage == 1
                if {SiegeWeapon} near {AttackWP2} radius 33
                    AttackWPStage = 2
                end if
                if AttackWPStage == 1
                    if get size of siege weapon SiegeWeapon action queue < 1
                        if not SiegeWeapon can navigate to {AttackWP2}
                            Number = 0
                            begin loop
                                AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP2}
                            end loop
                        end if
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP2} to siege weapon SiegeWeapon action queue
                    end if
                end if
            elsif AttackWPStage == 2
                if {SiegeWeapon} near {AttackWP3} radius 33
                    AttackWPStage = 3
                end if
                if AttackWPStage == 2
                    if get size of siege weapon SiegeWeapon action queue < 1
                        if not SiegeWeapon can navigate to {AttackWP3}
                            Number = 0
                            begin loop
                                AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                                Number++
                                until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP3}
                            end loop
                        end if
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP3} to siege weapon SiegeWeapon action queue
                    end if
                end if
            end if
            if LC6_LargeSiegeLaunchAttack == 1 and LC6_LargeSiegeRetreat == 0 and AttackWPStage == 3 and get ActionTimer time remaining <= 0
                //say "ATTACKING"
                enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                if number from 1 to 10 >= 7
                    Number = number from 1 to 3
                    if Number == 1 or Number == 2
                        objSubType = 33
                        GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                        if GateHouse exists and PLAYER of GateHouse == 0
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            GateHouse = get random abode of type constant objSubType in town PlayerTown
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                objSubType = 34
                                GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                                if GateHouse exists and PLAYER of GateHouse == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    GateHouse = get random abode of type constant objSubType in town PlayerTown
                                    if GateHouse exists and PLAYER of GateHouse == 0
                                        clear siege weapon SiegeWeapon action queue
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                    else
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                            end if
                        end if
                    elsif Number == 3
                        Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                        if Wall1 exists and PLAYER of Wall1 == 0
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                        else
                            Wall1 = get wall segment nearest {AttackingPoint1} + {number from -75 to 75, number from -75 to 75} radius 750
                            if Wall1 exists and PLAYER of Wall1 == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                            else
                                ActionTimer = create timer for 0.025 seconds
                            end if
                        end if
                    end if
                else
                    if SiegeWeapon can navigate to object oTownCentre
                        wait 2 seconds
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type TEMPLE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type UNIVERSITY in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 7
                                Building = get random abode of type BATHHOUSE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 8
                                Building = get random abode of type AMPITHEATRE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type TOWN_CENTRE in town PlayerTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {PlayerTown} + {number from -125 to 125,number from -125 to 125} radius 100
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if size of PlayerTown <= 60
                                AttackFocus = Default
                            end if
                        end if
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                end if
            elsif LC6_LargeSiegeRetreat == 1
                AttackWPStage = 3
                //say "LC6_LargeSiegeLaunchAttack == 0"
                disable siege weapon SiegeWeapon auto attack
                wait 5 seconds
                if not {SiegeWeapon} near {AttackingPoint2} radius 25 or get player 0 influence at {AttackingPoint2} > 0
                    if get player 0 influence at {AttackingPoint2} > 0
                        begin loop
                            AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                            Threshold += 5
                            until (SiegeWeapon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                        end loop
                        Threshold = 1
                    end if
                    clear siege weapon SiegeWeapon action queue
                    add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackingPoint2} to siege weapon SiegeWeapon action queue
                    wait until {SiegeWeapon} near {AttackingPoint2} radius 33
                end if
            end if
        end if
        until SiegeWeapon not exists
    end loop

//end loop

end script LC6_MoveCatapultThenAttack