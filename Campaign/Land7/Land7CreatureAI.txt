///////////////////////////////////////////////////////////////////////////////
//    Land 7 Creature AI
//    ~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//    Globals
//-----------------------------------------------------------------------------

define script LC7_CreatureAI
define script LC7_CreatureLogic

global CreatureAttackPos[3]
global CreatureGathererPos[3]

//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------

begin script LC7_CreatureAI

start

    CreatureAttackPos[0] = marker at {2063.62,54.90,1336.72}//PlayerTown
    CreatureAttackPos[1] = marker at {1770.19,46.10,1284.13}//PlayerTownPreAttackPos

    CreatureGathererPos[0] = marker at {2049.92,139.28,529.26}//JapaneseCapital
    CreatureGathererPos[1] = marker at {1523.56,44.27,1122.55}//JapaneseTown1
    CreatureGathererPos[2] = marker at {1049.26,84.59,990.35}//JapaneseTown2

    LC7_EnemyCreature = create SCRIPT_OBJECT_TYPE_CREATURE CREATURE_TYPE_TIGER at {1997.37,131.74,569.71}
    
    set creature LC7_EnemyCreature happiness to maximum
    
    set research ARTEFACT_CREATURE_MAGIC_TYPE_WATER available to RESEARCH_AVAILABILITY_RESEARCHED player 1
    set research ARTEFACT_CREATURE_MAGIC_TYPE_HEAL available to RESEARCH_AVAILABILITY_RESEARCHED player 1
    set research ARTEFACT_CREATURE_MAGIC_TYPE_LIGHTNING available to RESEARCH_AVAILABILITY_RESEARCHED player 1
    set research ARTEFACT_CREATURE_ROLE_BUILDER_2 available to RESEARCH_AVAILABILITY_RESEARCHED player 1
    set research ARTEFACT_CREATURE_ROLE_GATHERER_3 available to RESEARCH_AVAILABILITY_RESEARCHED player 1
    set research ARTEFACT_CREATURE_ROLE_SOLDIER_2 available to RESEARCH_AVAILABILITY_RESEARCHED player 1

    FireballAvailable[1] = 0
    LightningAvailable[1] = 1
    FireballMedRangeAvailable[1] = 0
    FireballHighRangeAvailable[1] = 0

    set creature LC7_EnemyCreature CREATURE_SIZE 0.8
    CREATURE_STRENGTH of LC7_EnemyCreature = 0.7
    CREATURE_ALIGNMENT of LC7_EnemyCreature = -0.25
    CREATURE_FATNESS of LC7_EnemyCreature = 0.4

    if HardMode == 1
        set research ARTEFACT_CREATURE_MAGIC_TYPE_WATER available to RESEARCH_AVAILABILITY_RESEARCHED player 1
        set research ARTEFACT_CREATURE_MAGIC_TYPE_LIGHTNING available to RESEARCH_AVAILABILITY_RESEARCHED player 1
        set research ARTEFACT_CREATURE_MAGIC_TYPE_FIREBALL available to RESEARCH_AVAILABILITY_RESEARCHED player 1
        set research ARTEFACT_CREATURE_MAGIC_TYPE_HEAL available to RESEARCH_AVAILABILITY_RESEARCHED player 1
        set research ARTEFACT_CREATURE_ROLE_BUILDER_3 available to RESEARCH_AVAILABILITY_RESEARCHED player 1
        set research ARTEFACT_CREATURE_ROLE_GATHERER_3 available to RESEARCH_AVAILABILITY_RESEARCHED player 1
        set research ARTEFACT_CREATURE_ROLE_SOLDIER_3 available to RESEARCH_AVAILABILITY_RESEARCHED player 1

        FireballAvailable[1] = 1
        LightningAvailable[1] = 1
        FireballMedRangeAvailable[1] = 1
        FireballHighRangeAvailable[1] = 1

        set creature LC7_EnemyCreature CREATURE_SIZE 1.0
        CREATURE_STRENGTH of LC7_EnemyCreature = 1.0
        CREATURE_FATNESS of LC7_EnemyCreature = 0.5
    end if


    teach LC7_EnemyCreature all

    disable LC7_EnemyCreature action availability LA_EAT with LO_PLAYER_VILLAGER
    disable LC7_EnemyCreature action availability LA_EAT with LO_PLAYER_PLATOON
    disable LC7_EnemyCreature action availability LA_EAT with LO_ROCKS
    disable LC7_EnemyCreature action availability LA_EAT with LO_TREES
    disable LC7_EnemyCreature action availability LA_EAT with LO_TOYS
    disable LC7_EnemyCreature action availability LA_EAT with LO_POO
    disable LC7_EnemyCreature action availability LA_EAT with LO_SPELL_ORBS
    disable LC7_EnemyCreature action availability LA_POO with LO_PLAYER_VILLAGER
    disable LC7_EnemyCreature action availability LA_POO with LO_PLAYER_PLATOON
    disable LC7_EnemyCreature action availability LA_POO with LO_PLAYER_DEFENCES
    disable LC7_EnemyCreature action availability LA_POO with LO_PLAYER_STORAGE_PIT
    disable LC7_EnemyCreature action availability LA_POO with LO_PLAYER_BUILDING
    disable LC7_EnemyCreature action availability LA_PLAY
    disable LC7_EnemyCreature action availability LA_WATER with LO_PLAYER_VILLAGER
    disable LC7_EnemyCreature action availability LA_WATER with LO_PLAYER_PLATOON
    disable LC7_EnemyCreature action availability LA_HEAL with LO_OPPONENT_PLATOON
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_CREATURE_PEN
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_ROCKS
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_MINE
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_ORE_ROCKS
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_TREES
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_FIELDS
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_POO
    disable LC7_EnemyCreature action availability LA_ATTACK with LO_SPELL_ORBS
    
    set player 1 creature to LC7_EnemyCreature
    
    wait until IntroFinished == 1
    
    release LC7_EnemyCreature

    run background script LC7_CreatureLogic

end script LC7_CreatureAI

begin script LC7_CreatureLogic

    Number = 0
    AITown[17]
    AICounter = -1
    CreatureRollRoleTimer = create timer for 0 seconds
    CreatureAttackTimer = create timer for 0 seconds
    Position = 0

start

begin loop

    if AICounter > 16
        AICounter = -1
    else
        AITown[AICounter] = get town with id AICounter
    end if

    if HEALTH of LC7_EnemyCreature == 0.00
        wait until HEALTH of LC7_EnemyCreature > 0.00
        set creature LC7_EnemyCreature role to CR_NONE radius 500 at {JapaneseCapital}
        HEALTH of LC7_EnemyCreature = 1.0
    end if
    
    if town AITown[AICounter] is under takeover from player 0 and HEALTH of LC7_EnemyCreature > 0
        HEALTH of LC7_EnemyCreature = 1.0
        set creature LC7_EnemyCreature role to CR_SOLDIER radius 100 at {AITown[AICounter]}
        
        wait until HEALTH of LC7_EnemyCreature == 0.00 or not town AITown[AICounter] is under takeover from player 0 or 1000 seconds

    elsif LC7_Platoon[17] exists and {LC7_Platoon[17]} near {JapaneseCapital} radius 500 and HEALTH of LC7_EnemyCreature > 0.00 and get CreatureAttackTimer time remaining <= 0
        CreatureAttackTimer = create timer for 1800 * RecruitModifier seconds
        HEALTH of LC7_EnemyCreature = 1.0
        begin loop
            if LC7_Platoon[17] exists and not {LC7_Platoon[17]} near {AttackPos[0]} radius 350
                set creature LC7_EnemyCreature role to CR_SOLDIER radius 50 at {LC7_Platoon[17]}
            else
                set creature LC7_EnemyCreature role to CR_SOLDIER radius 300 at {CreatureAttackPos[0]}
            end if
            until HEALTH of LC7_EnemyCreature == 0.00 or 750 seconds
        end loop

    elsif HEALTH of LC7_EnemyCreature > 0.00 and get CreatureRollRoleTimer time remaining <= 0
        if PLAYER of AITown[AICounter] == 1
            Position = marker at {AITown[AICounter]} + {number from 50 to -50,number from 50 to -50}
            set creature LC7_EnemyCreature role to CR_GATHERER radius 200 at {Position}
            CreatureRollRoleTimer = create timer for 360 seconds
        
        end if
    end if

    AICounter += number from 0 to 16
    until LandWon == 1
end loop

//wait until HEALTH of LC7_EnemyCreature == 0.00
wait until get distance from camera position to {LC7_EnemyCreature} < 500 and not {LC7_EnemyCreature} viewed
delete LC7_EnemyCreature

end script LC7_CreatureLogic