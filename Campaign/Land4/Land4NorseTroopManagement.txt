///////////////////////////////////////////////////////////////////////////////
//    Land 4 Norse Troop-Management
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//    Globals
//-----------------------------------------------------------------------------

define LC4_NUM_OF_DEFENDERS = 0 //Unused
define LC4_NUM_OF_PLATOONS = 50 //37
define LC4_NUM_OF_SIEGE_CATAPULTS = 20
define LC4_NUM_OF_WALL_ARCHERS = 5
//Army Types
define Melee = 0
define Ranged = 1
//Army Behaivours
define Attacker = 0 //Attack PlayerTown
define Conqueror = 1 //Capture town defined in GetNearestSettlement script
define Patrol = 2 //Do some patrols
define Special = 3 //Special behaviour different on each map
//Attack Focus
define Default = 0 //Balanced attack strategy
define Houses = 1 //Attack Houses
define Epics = 2 //Attack Epics
define Altars = 3 //Attack Altars
define CreaturePen = 4 //Attack CreaturePen
define TownCenter = 5 //Attack Town
define Villagers = 6 //Attack Villagers NOT WORKING, PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA 
//Aggressiveness
define Passive = 0 //Try to do objectives, only defend yourself
define Neutral = 1 //0.75 Search radius for enemy troops, and much less likely to give up objectives
define Alerted = 2 //1.0 Search radius for enemy troops, and less likely to give up objectives
define Aggressive = 3 //2.0 Search radius for enemy troops, and will always give up objectives for enemy troops

define CHANCE_TO_SPLIT = 20
define CHANCE_TO_MERGE = 40

define script Waypoints
define script AttackRndAttackLogic(attackerssentnum)
define script AttackSyncTimerLogic
define script PlatoonTargetingMetric(PlatoonSize,TargetTown)
define script CatapultTargetingMetric(TargetTown)
define script LC4_StaticPlatoonsController
define script LC4_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)
define script LC4_ArmyBehaivours(Platoon,Type,Task,DefendObject,AttackFocus,Aggressiveness,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,AttackWPStage)
define script LC4_MoveCatapultThenAttack(SiegeWeapon,Task,AttackFocus,AttackWP1,AttackWP2,AttackWP3,AttackingPoint1,AttackingPoint2,AttackWPStage)

global LC4_Defender[LC4_NUM_OF_DEFENDERS]
global LC4_Platoon[LC4_NUM_OF_PLATOONS]
global LC4_SiegeCatapult[LC4_NUM_OF_SIEGE_CATAPULTS]
global LC4_WallArcher[LC4_NUM_OF_WALL_ARCHERS]
global LC4_StaticPlatoonCounter = 0
global PlatoonTargetingMetricFocusResult = 0
global CatapultTargetingMetricFocusResult = 0
global AttackersSent[15]

global PlatoonPos[12]
global AttackPos[4]
global AttackPosFront[3]
global AttackPosFlank[3]
global AttackPosBack[3]
global AttackSyncTimer = 0
global SiegePlatoonPos[1]
global SiegeRoute1[3]
global PlayerWallPos = 0
global StaticPlatoonGoodPos[4]
global StaticPlatoonGoodWaypoint = 0
global StaticPlatoonEvilPos[3]
global StaticPlatoonEvilWaypoint = 0

//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
//    Setting up waypoints for AI actions
//-----------------------------------------------------------------------------

run script Waypoints

begin script Waypoints

start

    PlayerWallPos = marker at {1230.47,121.51,758.87}

    PlatoonPos[0] = marker at {840.24,160.47,1061.00}
    PlatoonPos[1] = marker at {799.07,160.31,1123.30}
    PlatoonPos[2] = marker at {800.20,160.41,1190.00}
    PlatoonPos[3] = marker at {783.55,177.69,1411.56}
    PlatoonPos[4] = marker at {996.26,162.57,1107.54}
    PlatoonPos[5] = marker at {702.50,156.94,1871.13}
    PlatoonPos[6] = marker at {711.74,157.47,1820.22}
    PlatoonPos[7] = marker at {1556.00,227.89,961.09}
    PlatoonPos[8] = marker at {1511.09,227.53,985.98}
    PlatoonPos[9] = marker at {1255.63,162.60,1136.64}
    PlatoonPos[10] = marker at {1119.25,154.10,1337.26}
    PlatoonPos[11] = marker at {1088.52,154.44,1319.83}
    
    AttackPos[0] = marker at {1701.21,219.56,1121.39}//Front
    AttackPos[1] = marker at {1496.55,222.70,958.69}//Front Fallback
    AttackPos[2] = marker at {1280.88,190.79,1568.96}//Back
    AttackPos[3] = marker at {1111.55,152.13,1324.45}//Back Fallback

    AttackPosFront[0] = marker at {999.35,162.95,1106.79}
    AttackPosFront[1] = marker at {1240.53,177.39,1084.05}
    AttackPosFront[2] = marker at {1496.55,222.70,958.69}
    AttackPosFlank[0] = marker at {999.35,162.95,1106.79}
    AttackPosFlank[1] = marker at {1240.53,177.39,1084.05}
    AttackPosFlank[2] = marker at {1496.55,222.70,958.69}
    AttackPosBack[0] = marker at {999.35,162.95,1106.79}
    AttackPosBack[1] = marker at {1108.64,161.93,1279.96}
    AttackPosBack[2] = marker at {1111.55,152.13,1324.45}
    
    SiegePlatoonPos[0] = marker at {1313.19,294.29,1797.43}

    //Waypoints nearby own towns
    StaticPlatoonGoodPos[0] = marker at {820.95,160.34,1108.41}
    StaticPlatoonGoodPos[1] = marker at {820.95,160.34,1108.41}
    StaticPlatoonGoodPos[2] = marker at {697.46,157.56,1813.62}
    StaticPlatoonGoodPos[3] = marker at {1094.37,160.90,1108.53}
    //Waypoints nearby neutral towns which is likely to be taken by player
    StaticPlatoonEvilPos[0] = marker at {1108.14,161.30,1105.21}
    StaticPlatoonEvilPos[1] = marker at {1279.05,245.20,775.51}
    StaticPlatoonEvilPos[2] = marker at {820.95,160.34,1108.41}

end script Waypoints

begin script AttackRndAttackLogic(attackerssentnum)

    RndAttackPrevious = 0

start

wait 300 * NORSERECRUITMENTMODIFIER * RecruitModifier seconds
wait until ScriptedAttackStart == 2
RndAttack = number from 1 to 5
RndAttackPrevious = RndAttack
//say "RndAttack = $d" with number RndAttack

begin loop
    if AttackersSent[attackerssentnum] == 1
        //say "AttackersSent[attackerssentnum] = 1"
        wait NORSEDELAYBETWEENATTACK seconds
        begin loop
            RndAttack = number from 1 to 5
            until RndAttack != RndAttackPrevious
        end loop
        //say "AttackersSent[attackerssentnum] = 0"
        AttackersSent[attackerssentnum] = 0
        RndAttackPrevious = RndAttack
    else
        wait 60 seconds
    end if
end loop

end script AttackRndAttackLogic

begin script AttackSyncTimerLogic

start

AttackSyncTimer = create timer for 0 seconds
begin loop
    if get AttackSyncTimer time remaining <= 0
        wait 2.5 seconds
        AttackSyncTimer = create timer for 75 seconds
    end if
end loop

end script AttackSyncTimerLogic

begin script PlatoonTargetingMetric(PlatoonSize,TargetTown)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player 0 mana > 20000
    AltarsProbability += 60
end if

if get player 0 mana > 50000
    AltarsProbability += 60
end if

if adult size of PlayerTown > 120
    VillagersProbability *= adult size of PlayerTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

PlatoonTargetingMetricFocusResult = DesiredTarget

//say "PlatoonTargetingMetricFocusResult = $d" with number PlatoonTargetingMetricFocusResult

end script PlatoonTargetingMetric

begin script CatapultTargetingMetric(TargetTown)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player 0 mana > 10000
    AltarsProbability += 60
end if

if get player 0 mana > 30000
    AltarsProbability += 60
end if

if adult size of PlayerTown > 120
    VillagersProbability *= adult size of PlayerTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

CatapultTargetingMetricFocusResult = DesiredTarget

end script CatapultTargetingMetric

//-----------------------------------------------------------------------------

begin script LC4_Platoon14Actions

    oCreature = get player 0 creature
    HeTeste3 = 0
    TestCreature2 = 0
    NumPat = 0
    NumPat5 = 0
    PlayerPlatoon1 = 0
    WorrNum = 0
    NorseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NorseTown1 min built 1.0
    ProPlatoonsLocation = 0
    AIPlatoon1 = 0
    Armory = 0
    Town8 = get town with id 8
    RandomActionP3 = 0
    a = 1
    Timer = create timer for 0 seconds
    PlayerCatapult1 = 0
    PlayerPlatoonInRange = 0
    TownCaptured = 0
    PlayerSettlement = 0
    
start

begin loop
    a = 1
    wait until LC4_Platoon[14] exists    
    begin loop //Attack
        TestCreature2 = get distance from {LC4_Platoon[14]} to {oCreature}
        if TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and LC4_Platoon[14] can navigate to {oCreature}
            clear LC4_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to LC4_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC4_Platoon[14]
                TestCreature2 = get distance from {LC4_Platoon[14]} to {oCreature}
                until NumPat5 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not LC4_Platoon[14] can navigate to {oCreature} or TestCreature2 > 150 * 1.25
            end loop
        end if
        PlayerPlatoon1 = get platoon of player 0 nearest {LC4_Platoon[14]} radius 150
        PlayerCatapult1 = get siege weapon of player 0 nearest {LC4_Platoon[14]} radius 150
        if PlayerPlatoon1 exists and LC4_Platoon[14] can navigate to {PlayerPlatoon1}
            clear LC4_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to LC4_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC4_Platoon[14]
                HeTeste3 = get number of villagers in platoon PlayerPlatoon1
                until NumPat5 == 0 or HeTeste3 == 0 or not LC4_Platoon[14] can navigate to {PlayerPlatoon1}
            end loop
        elsif PlayerCatapult1 exists and LC4_Platoon[14] can navigate to {PlayerCatapult1}
            clear LC4_Platoon[14] action queue
            begin loop
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using PlayerCatapult1 to LC4_Platoon[14] action queue
                NumPat5 = get number of villagers in platoon LC4_Platoon[14]
                PlayerPlatoon1 = get platoon of player 0 nearest {LC4_Platoon[14]} radius 150
                if PlayerPlatoon1 exists and LC4_Platoon[14] can navigate to {PlayerPlatoon1}
                    PlayerPlatoonInRange = 1
                end if
                until NumPat5 == 0 or PlayerCatapult1 not exists or not LC4_Platoon[14] can navigate to {PlayerCatapult1} or PlayerPlatoonInRange == 1
            end loop
            PlayerPlatoonInRange = 0
        end if
        NorseTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NorseTown1 min built 1.0
        if LC4_Platoon[14] can navigate to object NorseTownCentre and PLAYER of NorseTown1 != 1 and TownCaptured == 0
            //wait number from 5 to 25 seconds
            a = 1
            clear LC4_Platoon[14] action queue
            wait 1 seconds
            if LC4_Platoon[14] can navigate to object NorseTownCentre and PLAYER of NorseTown1 != 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {LC4_Platoon[14]} radius 150
                    TestCreature2 = get distance from {LC4_Platoon[14]} to {oCreature}
                    set LC4_Platoon[14] attack NorseTown1 with severity 0.7 for takeover
                    //if PlayerPlatoon1 exists or TestCreature2 <= 150 or not LC4_Platoon[14] can navigate to object NorseTownCentre
                        if PlayerPlatoon1 exists
                            a = 0
                        elsif TestCreature2 <= 150 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                            a = 0
                        elsif not LC4_Platoon[14] can navigate to object NorseTownCentre
                            a = 0
                        elsif LC4_Platoon[14] not exists
                            a = 0
                        elsif PLAYER of NorseTown1 == 1
                            a = 0
                        end if
                    //end if
                    until a == 0 or LC4_Platoon[14] not exists
                end loop
            end if
            clear LC4_Platoon[14] action queue
        elsif LC4_Platoon[14] can navigate to {769.69,170.31,1668.10} and PLAYER of NorseTown1 != 1 and not {LC4_Platoon[14]} near {769.69,170.31,1668.10} radius 15
            clear LC4_Platoon[14] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {769.69,170.31,1668.10} to LC4_Platoon[14] action queue
        end if
        
        if LC4_Platoon[14] can navigate to {708.26,157.53,1815.61} and PLAYER of NorseTown1 == 1 and not {LC4_Platoon[14]} near {708.26,157.53,1815.61} radius 15
            TownCaptured = 1
            clear LC4_Platoon[14] action queue
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {708.26,157.53,1815.61} to LC4_Platoon[14] action queue
        end if

        until LC4_Platoon[14] not exists
    end loop
end loop

end script LC4_Platoon14Actions

begin script LC4_StaticPlatoonsController

start

begin loop
    wait 15 seconds
    if get StaticPlatoonsActionTimer time remaining <= 0
        StaticPlatoonGoodWaypoint = StaticPlatoonGoodPos[number from 0 to 3]
        StaticPlatoonEvilWaypoint = StaticPlatoonEvilPos[number from 0 to 2]
        wait 60 seconds //Give platoons 60 seconds to react to new orders
        StaticPlatoonsActionTimer = create timer for number from 300 to 1200 seconds
    end if
end loop

end script LC4_StaticPlatoonsController

begin script LC4_StaticPlatoonsActions(Pos,Type,Platoon,OriginTown)

    ThisStaticPlatoonActionTimer = create timer for 0 seconds
    ThisStaticPlatoonActive = 0
    ThisStaticPlatoonWaypoint = 0
    ThisOriginTownEmergency = 0
    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    a = 0
    PlayerSettlement = 0
    ThresholdStatic = 0

start

LC4_StaticPlatoonCounter++

begin loop

    if Type == Melee
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > 200 * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
        Catapult = get siege weapon of player 0 nearest {Platoon} radius 150
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius 150 * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius 200
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    if get ThisStaticPlatoonActionTimer time remaining <= 0
        ThisStaticPlatoonActionTimer = create timer for number from 25 to 35 seconds
        //If emergency in OriginTown go defend it
        PlayerPlatoon1 = get platoon of player 0 nearest {OriginTown} radius 500
        Catapult = get siege weapon of player 0 nearest {OriginTown} radius 500
        PlayerCreature = get distance from {OriginTown} to {oCreature}
        if PlayerPlatoon1 exists or Catapult exists or (PlayerCreature <= 500 and HEALTH of oCreature > 0.00)
            ThisOriginTownEmergency = 1
        else
            ThisOriginTownEmergency = 0
        end if
        if ThisOriginTownEmergency == 1
            if ThisStaticPlatoonActive == 1
                StaticPlatoonsActive--
                ThisStaticPlatoonActive = 0
            end if
        end if
    end if

    if get StaticPlatoonsActionTimer time remaining <= 0
        //say "DEBUG: StaticPlatoonsActive = $d" with number StaticPlatoonsActive
        if get ThisStaticPlatoonActionTimer time remaining <= 5
            wait 5 seconds
            if number from 1 to 4 == 4
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 0 and StaticPlatoonsActive <= LC4_StaticPlatoonCounter * 0.8 //80% of all static platoons max
                    StaticPlatoonsActive++
                    ThisStaticPlatoonActive = 1
                end if
            else
                ThisStaticPlatoonActionTimer = create timer for 60 seconds
                if ThisStaticPlatoonActive == 1
                    StaticPlatoonsActive--
                    ThisStaticPlatoonActive = 0
                end if
            end if
        end if
    end if

    if ThisStaticPlatoonActive == 0 and get size of Platoon action queue < 1 and ({Platoon} not near {Pos} radius 25 or get player 0 influence at {Pos} > 0)
        if get player 0 influence at {Pos} > 0
            ThresholdStatic = 10
            begin loop
                Pos = marker at {Pos} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {Pos} and get player 0 influence at {Pos} == 0) or ThresholdStatic > 999
            end loop
        end if
        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Pos} to Platoon action queue
    elsif ThisStaticPlatoonActive == 1 and get size of Platoon action queue < 1 and ({Platoon} not near {ThisStaticPlatoonWaypoint} radius 25 or ThisStaticPlatoonWaypoint == 0 or get player 0 influence at {Pos} > 0)
        if PlayerAlignmentFinal < 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonEvilWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        elsif PlayerAlignmentFinal >= 0.0
            ThresholdStatic = 75
            begin loop
                ThisStaticPlatoonWaypoint = marker at {StaticPlatoonGoodWaypoint} + {number from -ThresholdStatic to ThresholdStatic,number from -ThresholdStatic to ThresholdStatic}
                ThresholdStatic += 5
                until (Platoon can navigate to {ThisStaticPlatoonWaypoint} and not get platoon of player 1 nearest {ThisStaticPlatoonWaypoint} radius 25 exists and get player 0 influence at {ThisStaticPlatoonWaypoint} == 0) or a > 50
            end loop
            if ThresholdStatic > 999
                wait 15 seconds
            end if
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {ThisStaticPlatoonWaypoint} to Platoon action queue
        end if
    end if

    until Platoon not exists
end loop

if ThisStaticPlatoonActive == 1
    ThisStaticPlatoonActive = 0
    StaticPlatoonsActive--
end if

LC4_StaticPlatoonCounter--

end script LC4_StaticPlatoonsActions

begin script LC4_ArmyBehaivours(Platoon,Type,Task,DefendObject,AttackFocus,Aggressiveness,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,AttackWPStage)

    PlayerCreature = 0
    PlayerPlatoon1 = 0
    oCreature = get player 0 creature
    NumPat1 = 0
    HeTeste1 = 0
    Catapult = 0
    a = 0
    PlayerSettlement = 0
    Armory = 0
    oTown = get town with id 0
    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in oTown min built 1.0
    Number = 0
    AttackMode = 0
    Building = 0
    TestCreature2 = 0
    Timer = 0
    RecalculateTimer = create timer for 0 seconds
    Threshold = 1
    AttackRadius = 0
    AttackRadiusCatapult = 0
    AbortObjectiveProbability = 0
    AttackWP1Persistent = AttackWP1
    AttackWP2Persistent = AttackWP2
    AttackWP3Persistent = AttackWP3
    PlatoonSize = get number of villagers in platoon Platoon
    SplitUpChance = number from 1 to 100
    MergeChance = number from 1 to 100
    SplitDone = 0
    MergeDone = 0
    NewPlatoon = 0
    AttackingPoint1Initial = 0

start

AttackingPoint1Initial = marker at {AttackingPoint1}

if MergeChance >= SplitUpChance
    SplitUpChance = 0
else
    MergeChance = 0
end if

AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}

if Aggressiveness == Passive
    AttackRadius = 10
    AttackRadiusCatapult = 0
    AbortObjectiveProbability = 0
elsif Aggressiveness == Neutral
    AttackRadius = 100
    AttackRadiusCatapult = 75
    AbortObjectiveProbability = 25
elsif Aggressiveness == Alerted
    AttackRadius = 200
    AttackRadiusCatapult = 125
    AbortObjectiveProbability = 75
elsif Aggressiveness == Aggressive
    AttackRadius = 325
    AttackRadiusCatapult = 200
    AbortObjectiveProbability = 100
end if

//Group Attackers up first
if Platoon == LC4_Platoon[5] or Platoon == LC4_Platoon[6] or Platoon == LC4_Platoon[7]
    wait until LC4_Platoon[5] exists and LC4_Platoon[6] exists and LC4_Platoon[7] exists
    ScriptedAttack[0] = 1
end if

if Platoon == LC4_Platoon[13]
    wait until LC4_SiegeCatapult[0] exists and LC4_Platoon[13] exists and ({LC4_SiegeCatapult[0]} near {NorseCapital} radius 300)
    AttackersSent[0] = 1
end if

if Platoon == LC4_Platoon[26]
    wait until LC4_Platoon[26] exists and LC4_SiegeCatapult[5] exists and ({LC4_SiegeCatapult[5]} near {NorseCapital} radius 300)
    AttackersSent[0] = 1
end if

if Platoon == LC4_Platoon[27] or Platoon == LC4_Platoon[28]
    wait until LC4_Platoon[27] exists and LC4_Platoon[28] exists
    AttackersSent[0] = 1
end if

if Platoon == LC4_Platoon[29] or Platoon == LC4_Platoon[30]
    wait until LC4_Platoon[29] exists and LC4_Platoon[30] exists and LC4_SiegeCatapult[6] exists and ({LC4_SiegeCatapult[6]} near {NorseCapital} radius 300) and LC4_SiegeCatapult[7] exists and ({LC4_SiegeCatapult[7]} near {NorseCapital} radius 300)
    AttackersSent[0] = 1
end if

if Platoon == LC4_Platoon[31] or Platoon == LC4_Platoon[32]
    wait until LC4_Platoon[31] exists and LC4_Platoon[32] exists and LC4_SiegeCatapult[8] exists and ({LC4_SiegeCatapult[8]} near {NorseCapital} radius 300) and LC4_SiegeCatapult[9] exists and ({LC4_SiegeCatapult[9]} near {NorseCapital} radius 300)
    AttackersSent[0] = 1
end if

if Platoon == LC4_Platoon[33] or Platoon == LC4_Platoon[34]
    wait until LC4_Platoon[33] exists and LC4_Platoon[34] exists and LC4_SiegeCatapult[10] exists and ({LC4_SiegeCatapult[10]} near {NorseCapital} radius 300) and LC4_SiegeCatapult[11] exists and ({LC4_SiegeCatapult[11]} near {NorseCapital} radius 300)
    AttackersSent[0] = 1
end if

begin loop
    //Attack nearby enemies
    if Type == Melee and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > AttackRadius * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
        Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult * 1.25
                add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if

    elsif Type == Ranged and Task != Special
        PlayerCreature = get distance from {Platoon} to {oCreature}
        if PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00 and Platoon can navigate to {oCreature}
            clear Platoon action queue
            begin loop
                PlayerCreature = get distance from {Platoon} to {oCreature}
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using oCreature to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                until NumPat1 == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature == 0.00 or not Platoon can navigate to {oCreature} or PlayerCreature > AttackRadius * 1.25
            end loop
            clear Platoon action queue
        end if
        
        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
        Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult
        if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
            clear Platoon action queue
            begin loop
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using PlayerPlatoon1 to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                HeTeste1 = get number of villagers in platoon PlayerPlatoon1
                until NumPat1 == 0 or HeTeste1 == 0 or not Platoon can navigate to {PlayerPlatoon1} or PlayerPlatoon1 not exists
            end loop
            clear Platoon action queue
        elsif Catapult exists and Platoon can navigate to {Catapult}
            clear Platoon action queue
            a = 0
            begin loop
                Catapult = get siege weapon of player 0 nearest {Platoon} radius AttackRadiusCatapult * 1.25
                add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using Catapult to Platoon action queue
                NumPat1 = get number of villagers in platoon Platoon
                PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                if PlayerPlatoon1 exists and Platoon can navigate to {PlayerPlatoon1}
                    a = 1
                end if
                until NumPat1 == 0 or Catapult not exists or not Platoon can navigate to {Catapult} or a == 1 or Catapult not exists
            end loop
            clear Platoon action queue
            a = 0
        end if
    end if

    //Capture nearby settlements
    PlayerSettlement = get nearest town at {Platoon} for player 0 radius AttackRadius * 1.5
    //Not a Armory, it's a towncentre.
    Armory = get building ABODE_NUMBER_TOWN_CENTRE in PlayerSettlement min built 1.0
    if Armory exists and PlayerSettlement != PlayerTown and PLAYER of PlayerSettlement == 0 and Task != Conqueror and HEALTH of Armory == 1.0 and not variable get town PlayerSettlement status == variable TOWN_STATUS_MIGRATION_STARTED
        if Platoon can navigate to object Armory
            if TownCapturePlatoons[0] < 2
                TownCapturePlatoons[0]++
                clear Platoon action queue
                set Platoon attack PlayerSettlement with severity 0.3 for takeover
                a = 1
                begin loop
                    PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                    PlayerCreature = get distance from {Platoon} to {oCreature}
                    if PlayerPlatoon1 exists
                        a = 0
                    elsif PlayerCreature <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                        a = 0
                    elsif not Platoon can navigate to object Armory
                        a = 0
                    elsif Platoon not exists
                        a = 0
                    end if
                    until a == 0 or Platoon not exists or PLAYER of PlayerSettlement == 1
                end loop
                TownCapturePlatoons[0]--
            end if
            clear Platoon action queue
        end if
    end if

    //Basic tasks
    if Task == Attacker
        //if get size of Platoon action queue < 1
            //Way to target town
            if AttackWPStage == 0
                if not Platoon can navigate to {AttackWP1}
                    Number = 0
                    begin loop
                        AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                        Number++
                        until Platoon not exists or Platoon can navigate to {AttackWP1} or Number > 10
                    end loop
                end if
                if not {Platoon} near {AttackWP1} radius 33
                    clear Platoon action queue
                    if not DefendObject exists
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP1} to Platoon action queue
                    elsif not {Platoon} near {DefendObject} radius 25
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
                if DefendObject exists and {Platoon} near {AttackWP1} radius 200
                    AttackWPStage = 1
                    //say "AttackWPStage = 1"
                elsif {Platoon} near {AttackWP1} radius 33
                    AttackWPStage = 1
                    //say "AttackWPStage = 1"
                end if
            elsif AttackWPStage == 1
                if not Platoon can navigate to {AttackWP2}
                    Number = 0
                    begin loop
                        AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                        Number++
                        until Platoon not exists or Platoon can navigate to {AttackWP2} or Number > 10
                    end loop
                end if
                if not {Platoon} near {AttackWP2} radius 33 and get AttackSyncTimer time remaining <= 0
                    clear Platoon action queue
                    if not DefendObject exists
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP2} to Platoon action queue
                    elsif not {Platoon} near {DefendObject} radius 25
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
                if DefendObject exists and {Platoon} near {AttackWP2} radius 200
                    AttackWPStage = 2
                    //say "AttackWPStage = 2"
                elsif {Platoon} near {AttackWP2} radius 33
                    AttackWPStage = 2
                    //say "AttackWPStage = 2"
                end if
            elsif AttackWPStage == 2
                if not Platoon can navigate to {AttackWP3}
                    Number = 0
                    begin loop
                        AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                        Number++
                        until Platoon not exists or Platoon can navigate to {AttackWP3} or Number > 10
                    end loop
                end if
                if not {Platoon} near {AttackWP3} radius 33
                    clear Platoon action queue
                    if not DefendObject exists
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackWP3} to Platoon action queue
                    elsif not {Platoon} near {DefendObject} radius 25
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                end if
                if DefendObject exists and {Platoon} near {AttackWP3} radius 200
                    AttackWPStage = 3
                    //say "AttackWPStage = 3"
                elsif {Platoon} near {AttackWP3} radius 33
                    AttackWPStage = 3
                    //say "AttackWPStage = 3"
                end if
            end if
            //Targeting
            if AttackWPStage == 3
                wait number from 5 to 25 seconds
                //say "PLATOON ATTACKING"
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                if PLAYER of PlayerTown != 0
                    //Switch task to conqueror to attack all remaining cities
                    Task = Conqueror
                    AttackFocus = Default
                elsif Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0
                    //say "Platoon can navigate to object oTownCentre and PLAYER of PlayerTown == 0"
                    a = 0
                    if AttackFocus == Default
                        //say "AttackFocus == Default"
                        clear Platoon action queue
                        Number = number from 1 to 4
                        if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                            AttackMode = 1
                            set Platoon attack PlayerTown with severity 0.2
                        elsif Number == 3 or Number == 4 //Destroy value buildings
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town PlayerTown
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        else //Capture Town
                            AttackMode = 0
                            if TownCapturePlatoons[0] < 2
                                TownCapturePlatoons[0]++
                                set Platoon attack PlayerTown with severity 0.3 for takeover
                            end if
                        end if
                    elsif AttackFocus == Houses
                
                        //say "AttackFocus == Houses"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        //say "AttackFocus == Epics"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        //say "AttackFocus == Altars"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        //say "AttackFocus == CreaturePen"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town PlayerTown
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        //say "AttackFocus == TownCenter"
                        clear Platoon action queue
                        AttackMode = 0
                        set Platoon attack PlayerTown with severity 0.3 for takeover
                    elsif AttackFocus == Villagers
                        //say "AttackFocus == Villagers"
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {Platoon} radius 250
                                if Building not exists or PLAYER of Building != 0
                                    Building = get living villager at {PlayerTown} radius 250
                                end if
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of PlayerTown <= 60
                            AttackFocus = Default
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    Number = number from 0 to 99
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town PlayerTown is under takeover from player 1
                                a = 1
                            elsif not Platoon can navigate to object oTownCentre
                                a = 2
                            elsif Platoon not exists
                                a = 2
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 2
                            elsif AttackMode == 2 and Building not exists
                                a = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                a = 2
                            elsif AttackMode == 2 and Building == 0
                                a = 2
                            elsif not town PlayerTown is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 2
                            end if
                        //end if
                        until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                    end loop
                    //say "until ((AbortObjectiveProbability > Number and a == 1) or (a == 2))"
                    if AttackMode == 0
                        TownCapturePlatoons[0]--
                    end if
                    clear Platoon action queue
                elsif DefendObject exists and Platoon can navigate to {DefendObject}
                    //say "DefendObject exists and Platoon can navigate to {DefendObject}"
                    if not {Platoon} near {DefendObject} radius 25
                        clear Platoon action queue
                        add action PLATOON_AGENDA_ACTION_DEFEND_OBJECT using DefendObject to Platoon action queue
                    end if
                elsif Platoon can navigate to {AttackingPoint1Initial} or get player 0 influence at {AttackingPoint1} > 0
                    //say "Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0"
                    if Platoon can navigate to {AttackingPoint1Initial}
                        if not {Platoon} near {AttackingPoint1} radius 25
                            clear Platoon action queue
                            if get player 0 influence at {AttackingPoint1} > 0
                                begin loop
                                    AttackingPoint1 = marker at {AttackingPoint1} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                                    Threshold += 5
                                    until (Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0) or Threshold > 999
                                end loop
                                Threshold = 1
                            end if
                            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                        end if
                    else
                        if not {Platoon} near {AttackingPoint2} radius 25 or get player 0 influence at {AttackingPoint2} > 0
                            clear Platoon action queue
                            if get player 0 influence at {AttackingPoint2} > 0
                                begin loop
                                    AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                                    Threshold += 5
                                    until (Platoon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                                end loop
                                Threshold = 1
                            end if
                            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint2} to Platoon action queue
                        end if
                    end if
                else
                    //say "else"
                    if not {Platoon} near {AttackingPoint2} radius 25 or get player 0 influence at {AttackingPoint2} > 0
                        clear Platoon action queue
                        if get player 0 influence at {AttackingPoint2} > 0
                            begin loop
                                AttackingPoint2 = marker at {AttackingPoint2} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                                Threshold += 5
                                until (Platoon can navigate to {AttackingPoint2} and get player 0 influence at {AttackingPoint2} == 0) or Threshold > 999
                            end loop
                            Threshold = 1
                        end if
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint2} to Platoon action queue
                    end if
                end if
            end if
        //end if

    elsif Task == Conqueror
        AttackWPStage = 3
        oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        if PLAYER of NearestSettlement != 1 and oTownCentre exists
            if DefendObject exists
                if not Platoon can navigate to object oTownCentre
                    AttackingPoint1 = marker at {DefendObject} + {number from 20 to -20,0,number from 20 to -20}
                    clear Platoon action queue 
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    wait 10 seconds
                end if
            else
                if Platoon can navigate to object oTownCentre and PLAYER of NearestSettlement != 1
                    a = 0
                    if AttackFocus == Default
                        clear Platoon action queue
                        Number = number from 1 to 4
                        if Number == 2 and HEALTH of MyCreature > 0 //Hunt down platoons or destroy buildings
                            AttackMode = 1
                            set Platoon attack NearestSettlement with severity 0.2
                        elsif Number == 3 or Number == 4 //Destroy value buildings
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town NearestSettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        else //Capture Town
                            AttackMode = 0
                            if TownCapturePlatoons[0] < 2
                                TownCapturePlatoons[0]++
                                set Platoon attack NearestSettlement with severity 0.3 for takeover
                            end if
                        end if
                    elsif AttackFocus == Houses
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ABODE_A in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_B in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_C in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_D in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_E in NearestSettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Epics
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75 and HEALTH of Building > 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type WONDER WONDER_SIREN in NearestSettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == Altars
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE ALTAR in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == CreaturePen
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                if Building exists and HEALTH of Building >= 0.75
                                    add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if (get number of type HOUSE CREATURE_PEN in NearestSettlement min built 1.0) == 0
                            AttackFocus = Default
                        end if
                    elsif AttackFocus == TownCenter
                        clear Platoon action queue
                        AttackMode = 0
                        set Platoon attack NearestSettlement with severity 0.3 for takeover
                    elsif AttackFocus == Villagers
                        clear Platoon action queue
                        AttackMode = 2
                        Building = 0
                        Timer = create timer for 2 seconds
                        begin loop
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {Platoon} radius 250
                                if Building not exists or PLAYER of Building != 0
                                    Building = get living villager at {NearestSettlement} radius 250
                                end if
                                if Building exists
                                    add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                else
                                    Building = 0
                                end if
                            end if
                            until Building != 0 or get Timer time remaining <= 0
                        end loop
                        if size of NearestSettlement <= 60
                            AttackFocus = Default
                        end if
                    end if
                    RecalculateTimer = create timer for 40 seconds
                    Number = number from 0 to 99
                    begin loop
                        PlayerPlatoon1 = get platoon of player 0 nearest {Platoon} radius AttackRadius
                        TestCreature2 = get distance from {Platoon} to {MyCreature}
                        NumPat1 = get number of villagers in platoon Platoon
                        //if PlayerPlatoon1 exists or TestCreature2 <= AttackRadius or not Platoon can navigate to object PlayerTownCentre
                            if PlayerPlatoon1 exists and not town NearestSettlement is under takeover from player 1
                                a = 1
                            elsif TestCreature2 <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of MyCreature > 0.00 and not town NearestSettlement is under takeover from player 1
                                a = 1
                            elsif not Platoon can navigate to object oTownCentre
                                a = 2
                            elsif Platoon not exists
                                a = 2
                            elsif AttackMode == 1 and HEALTH of MyCreature == 0
                                a = 2
                            elsif AttackMode == 2 and Building not exists
                                a = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                a = 2
                            elsif AttackMode == 2 and Building == 0
                                a = 2
                            elsif not town NearestSettlement is under takeover from player 1 and get RecalculateTimer time remaining <= 0
                                a = 2
                            end if
                        //end if
                        until (AbortObjectiveProbability > Number and a == 1) or (a == 2)
                    end loop
                    if AttackMode == 0
                        TownCapturePlatoons[2]--
                    end if
                    clear Platoon action queue
                else
                    if not {Platoon} near {AttackingPoint1} radius 25 or get player 0 influence at {AttackingPoint1} > 0
                        AttackingPoint1 = marker at {NearestSettlement}
                        clear Platoon action queue
                        if get player 0 influence at {AttackingPoint1} > 0 or PLAYER of NearestSettlement == 2 or PLAYER of NearestSettlement == 3 or PLAYER of NearestSettlement == 4
                            begin loop
                                AttackingPoint1 = marker at {AttackingPoint1} + {number from -Threshold to Threshold,number from -Threshold to Threshold}
                                Threshold += 5
                                until (Platoon can navigate to {AttackingPoint1} and get player 0 influence at {AttackingPoint1} == 0) or Threshold > 999
                            end loop
                            Threshold = 1
                        end if
                        add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {AttackingPoint1} to Platoon action queue
                    end if
                end if
            end if
        end if

    elsif Task == Patrol
        if get size of Platoon action queue < 1
            move Platoon along PatrolRoute with patrol WAYPOINTROUTE_TRAVERSAL_TYPE_CIRCULAR
        end if

    end if

    //Special Tasks
    //Split up from origin platoon - Mutually exclusive with merging
    if SplitDone == 0 and 100-SplitUpChance < CHANCE_TO_SPLIT and AttackWPStage == 3
        if get number of villagers in platoon Platoon > 30
            while get number of villagers in platoon Platoon > 30 and number from 1 to 3 != 1
                //say "SPLITTING NOW"
                wait 5 seconds
                SplitDone = 1
                Number = number from 1 to 4
                if Number == 1
                    NewPlatoon = split 15 soldiers from platoon Platoon
                elsif Number == 2
                    NewPlatoon = split 20 soldiers from platoon Platoon
                elsif Number == 3
                    NewPlatoon = split 25 soldiers from platoon Platoon
                elsif Number == 4
                    NewPlatoon = split 30 soldiers from platoon Platoon
                end if
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                wait 5 seconds
                clear NewPlatoon action queue
                run background script LC4_ArmyBehaivours(NewPlatoon,Type,Task,0,Default,Neutral,AttackingPoint1,AttackingPoint2,AttackWP1,AttackWP2,AttackWP3,PatrolRoute,Town,3)
            end while
        end if
    end if
    //Merge with target platoon - Mutually exclusive with splitting
    if MergeDone == 0 and 100-MergeChance < CHANCE_TO_MERGE and AttackWPStage == 3
        if get number of villagers in platoon Platoon < 20
            NewPlatoon = get platoon of player 1 nearest {Platoon} radius 100
            if NewPlatoon exists and ((Type == Melee and platoon NewPlatoon melee) or (Type == Ranged and platoon NewPlatoon ranged))
                say "MERGING NOW"
                wait 5 seconds
                MergeDone = 1
                merge platoon Platoon into platoon NewPlatoon
                wait until Platoon not exists or NewPlatoon not exists
            end if
        end if
    end if
    until Platoon not exists
end loop

end script LC4_ArmyBehaivours

begin script LC4_MoveCatapultThenAttack(SiegeWeapon,Task,AttackFocus,AttackWP1,AttackWP2,AttackWP3,AttackingPoint1,AttackingPoint2,AttackWPStage)

    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
    a = 1
    Timer = create timer for 0 seconds
    Target = 0
    CatapultMoveTimer1 = create timer for 0 seconds
    ActionTimer = create timer for 0 seconds
    Wall1 = 0
    House = 0
    SiegeOnPointTimer = create timer for 0 seconds
    SiegeWeaponPoint = 0
    SiegeStucked = 0
    GateHouse = 0
    AttackWP1Persistent = AttackWP1
    AttackWP2Persistent = AttackWP2
    AttackWP3Persistent = AttackWP3
    Number = 0
    Building = 0
    objSubType = 0

start

//begin loop

    AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
    AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
    AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}

    if SiegeWeapon == LC4_SiegeCatapult[0]
        wait until LC4_SiegeCatapult[0] exists and LC4_Platoon[13] exists
    end if

    if SiegeWeapon == LC4_SiegeCatapult[5]
        wait until LC4_SiegeCatapult[5] exists and LC4_Platoon[26] exists
    end if

    if SiegeWeapon == LC4_SiegeCatapult[6] or SiegeWeapon == LC4_SiegeCatapult[7]
        wait until LC4_SiegeCatapult[6] exists and LC4_SiegeCatapult[7] exists and LC4_Platoon[29] exists and LC4_Platoon[30] exists
    end if

    if SiegeWeapon == LC4_SiegeCatapult[8] or SiegeWeapon == LC4_SiegeCatapult[9]
        wait until LC4_SiegeCatapult[8] exists and LC4_SiegeCatapult[9] exists and LC4_Platoon[31] exists and LC4_Platoon[32] exists
    end if

    if SiegeWeapon == LC4_SiegeCatapult[10] or SiegeWeapon == LC4_SiegeCatapult[11]
        wait until LC4_SiegeCatapult[10] exists and LC4_SiegeCatapult[11] exists and LC4_Platoon[33] exists and LC4_Platoon[34] exists
    end if

    disable siege weapon SiegeWeapon auto attack

    if Task == Attacker
        begin loop
            if AttackWPStage != 3
                if get SiegeOnPointTimer time remaining <= 0
                    SiegeWeaponPoint = marker at {SiegeWeapon}
                    SiegeOnPointTimer = create timer for 90 seconds
                elsif get SiegeOnPointTimer time remaining <= 5
                    if {SiegeWeapon} near {SiegeWeaponPoint} radius 10
                        clear siege weapon SiegeWeapon action queue
                        SiegeStucked = 1
                        wait until not {SiegeWeapon} viewed or 30 seconds
                        delete SiegeWeapon
                    end if
                end if
            end if

            if get ActionTimer time remaining <= 0 or get AttackSyncTimer time remaining <= 0
                if AttackWPStage == 0
                    wait until get size of siege weapon SiegeWeapon action queue < 1
                    ActionTimer = create timer for 2 seconds
                    if not SiegeWeapon can navigate to {AttackWP1}
                        Number = 0
                        begin loop
                            AttackWP1 = marker at {AttackWP1Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP1} or Number > 10
                        end loop
                    end if
                    if not {SiegeWeapon} near {AttackWP1} radius 33
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP1} to siege weapon SiegeWeapon action queue
                    end if
                    if {SiegeWeapon} near {AttackWP1} radius 33
                        AttackWPStage = 1
                    end if
                elsif AttackWPStage == 1
                    wait until get size of siege weapon SiegeWeapon action queue < 1
                    ActionTimer = create timer for 2 seconds
                    if not SiegeWeapon can navigate to {AttackWP2}
                        Number = 0
                        begin loop
                            AttackWP2 = marker at {AttackWP2Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP2} or Number > 10
                        end loop
                    end if
                    if not {SiegeWeapon} near {AttackWP2} radius 33 and get AttackSyncTimer time remaining <= 0
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP2} to siege weapon SiegeWeapon action queue
                    end if
                    if {SiegeWeapon} near {AttackWP2} radius 33
                        AttackWPStage = 2
                    end if
                elsif AttackWPStage == 2
                    wait until get size of siege weapon SiegeWeapon action queue < 1
                    ActionTimer = create timer for 2 seconds
                    if not SiegeWeapon can navigate to {AttackWP3}
                        Number = 0
                        begin loop
                            AttackWP3 = marker at {AttackWP3Persistent} + {number from -66 to 66,number from -66 to 66}
                            Number++
                            until SiegeWeapon not exists or SiegeWeapon can navigate to {AttackWP3} or Number > 10
                        end loop
                    end if
                    if not {SiegeWeapon} near {AttackWP3} radius 33
                        add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {AttackWP3} to siege weapon SiegeWeapon action queue
                    end if
                    if {SiegeWeapon} near {AttackWP3} radius 33
                        AttackWPStage = 3
                    end if
                end if

                if AttackWPStage == 3
                    //say "ATTACKING"
                    enable siege weapon SiegeWeapon auto attack
                    ActionTimer = create timer for 60 seconds
                    oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in PlayerTown min built 1.0
                    if not SiegeWeapon can navigate to object oTownCentre
                        Number = number from 1 to 3
                        if Number == 1 or Number == 2
                            objSubType = number from 33 to 34
                            GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                GateHouse = get random abode of type constant objSubType in town PlayerTown
                                if GateHouse exists and PLAYER of GateHouse == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif Number == 3
                            if number from 1 to 2 == 1
                                Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                                if Wall1 exists and PLAYER of Wall1 == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            
                            else
                                Wall1 = get wall segment nearest {AttackingPoint1} radius 750
                                if Wall1 exists and PLAYER of Wall1 == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        end if
                    elsif SiegeWeapon can navigate to object oTownCentre
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 6
                                if Number == 1
                                    Building = get random abode of type ABODE_A in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 2
                                    Building = get random abode of type ABODE_B in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 3
                                    Building = get random abode of type ABODE_C in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type ABODE_D in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type ABODE_E in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type SKYSCRAPER in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ABODE_A in PlayerTown min built 1.0 + get number of type HOUSE ABODE_B in PlayerTown min built 1.0 + get number of type HOUSE ABODE_C in PlayerTown min built 1.0 + get number of type HOUSE ABODE_D in PlayerTown min built 1.0 + get number of type HOUSE ABODE_E in PlayerTown min built 1.0 + get number of type HOUSE SKYSCRAPER in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get WONDER in PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type WONDER WONDER_SIREN in PlayerTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in PlayerTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in PlayerTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type ALTAR in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ALTAR in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type CREATURE_PEN in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE CREATURE_PEN in PlayerTown min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type TOWN_CENTRE in town PlayerTown
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get living villager at {PlayerTown} + {number from -125 to 125,number from -125 to 125} radius 100
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if size of PlayerTown <= 60
                                AttackFocus = Default
                            end if
                        end if
                    end if
                end if
            end if

            until SiegeWeapon not exists
        end loop
    elsif Task == Conqueror
        begin loop
            if AttackWPStage != 3
                if get SiegeOnPointTimer time remaining <= 0
                    SiegeWeaponPoint = marker at {SiegeWeapon}
                    SiegeOnPointTimer = create timer for 90 seconds
                elsif get SiegeOnPointTimer time remaining <= 5
                    if {SiegeWeapon} near {SiegeWeaponPoint} radius 10
                        clear siege weapon SiegeWeapon action queue
                        SiegeStucked = 1
                        wait until not {SiegeWeapon} viewed or 30 seconds
                        delete SiegeWeapon
                    end if
                end if
            end if

            if get ActionTimer time remaining <= 0
                enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                oTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
                if PLAYER of NearestSettlement != 1 and oTownCentre exists
                    if not SiegeWeapon can navigate to object oTownCentre
                        Number = number from 1 to 3
                        if Number == 1 or Number == 2
                            objSubType = number from 33 to 34
                            GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius 250
                            if GateHouse exists and PLAYER of GateHouse == 0
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                GateHouse = get random abode of type constant objSubType in town NearestSettlement
                                if GateHouse exists and PLAYER of GateHouse == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif Number == 3
                            if number from 1 to 2 == 1
                                Wall1 = get wall segment nearest {SiegeWeapon} radius 750
                                if Wall1 exists and PLAYER of Wall1 == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            
                            else
                                Wall1 = get wall segment nearest {AttackingPoint1} radius 750
                                if Wall1 exists and PLAYER of Wall1 == 0
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                                else
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        end if
                    elsif SiegeWeapon can navigate to object oTownCentre
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 8
                                if Number == 1 or Number == 2 or Number == 3
                                    Building = get random abode of type ALTAR in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type TEMPLE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type UNIVERSITY in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 7
                                    Building = get random abode of type BATHHOUSE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 8
                                    Building = get random abode of type AMPITHEATRE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 6
                                if Number == 1
                                    Building = get random abode of type ABODE_A in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 2
                                    Building = get random abode of type ABODE_B in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 3
                                    Building = get random abode of type ABODE_C in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type ABODE_D in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type ABODE_E in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type SKYSCRAPER in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ABODE_A in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_B in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_C in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_D in NearestSettlement min built 1.0 + get number of type HOUSE ABODE_E in NearestSettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in NearestSettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get WONDER in NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type WONDER WONDER_SIREN in NearestSettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in NearestSettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in NearestSettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type ALTAR in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ALTAR in NearestSettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type CREATURE_PEN in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE CREATURE_PEN in NearestSettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type TOWN_CENTRE in town NearestSettlement
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get living villager at {NearestSettlement} + {number from -125 to 125,number from -125 to 125} radius 100
                                    if Building exists and HEALTH of Building > 0.0
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if size of NearestSettlement <= 60
                                AttackFocus = Default
                            end if
                        end if
                    end if
                end if
            end if
            until SiegeWeapon not exists
        end loop
    end if

//end loop

end script LC4_MoveCatapultThenAttack