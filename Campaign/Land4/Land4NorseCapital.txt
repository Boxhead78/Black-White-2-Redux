///////////////////////////////////////////////////////////////////////////////
//    Land 4 Norse-Strategy
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

define script LC4_Norse_Capital_Impressiveness
define script LC4_TownConversion
define script LC4_Tribute
define script LC4_GatehouseManager
define script LC4_Speeches
define script LC4_Norse_Capital
define script LC4_DefendPlatoons
define script LC4_GetNearestSettlement
define script LC4_ResourceManagerNorseCapital
define script LC4_VillagerManagerNorseCapital
define script LC4_ResourceManagerNorseTown
define script LC4_VillagerManagerNorseTown
define script LC4_NorseScript1
define script DisableLocalPlatoonResponse
define script LC4_VolcanoResourceManager

begin script LC4_Norse_Capital_Impressiveness

    Threshold = 0

start

    Threshold = get town MinorTown1 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown1 to PlayerTown MINOR_TOWN1_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown2 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown2 to PlayerTown MINOR_TOWN2_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown3 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown3 to PlayerTown MINOR_TOWN3_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown4 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown4 to PlayerTown MINOR_TOWN4_IMPRESSIVENESS - Threshold

    Threshold = get town MinorTown5 impressiveness
    Threshold = Threshold / 3
    set migration threshold from MinorTown5 to PlayerTown MINOR_TOWN5_IMPRESSIVENESS - Threshold

    Threshold = get town NorseTown1 impressiveness
    Threshold = Threshold / 3
    set migration threshold from NorseTown1 to PlayerTown NORSE_TOWN1_IMPRESSIVENESS - Threshold

    Threshold = get town NorseCapital impressiveness
    Threshold = Threshold / 3
    set migration threshold from NorseCapital to PlayerTown NORSE_CAPITAL_IMPRESSIVENESS - Threshold

end script LC4_Norse_Capital_Impressiveness

begin script LC4_TownConversion

    isConverted1 = 0
    isConverted2 = 0
    isConverted3 = 0
    isConverted4 = 0
    isConverted5 = 0
    isConverted6 = 0
    isConverted7 = 0
    a = 0
    b = 0
    c = 0
    d = 0
    e = 0
    f = 0
    g = 0

start

disable migration from PlayerTown to MinorTown1
disable migration from PlayerTown to MinorTown2
disable migration from PlayerTown to MinorTown3
disable migration from PlayerTown to MinorTown4
disable migration from PlayerTown to MinorTown5
disable migration from PlayerTown to NorseTown1
disable migration from PlayerTown to NorseCapital

begin loop

    isConverted1 = variable get town MinorTown1 method of last conversion
    isConverted2 = variable get town MinorTown2 method of last conversion
    isConverted3 = variable get town MinorTown3 method of last conversion
    isConverted4 = variable get town MinorTown4 method of last conversion
    isConverted5 = variable get town MinorTown5 method of last conversion
    isConverted6 = variable get town NorseTown1 method of last conversion
    isConverted7 = variable get town NorseCapital method of last conversion

    if isConverted1 != 0 and a == 0
        if PLAYER of MinorTown1 == 0 or get town MinorTown1 is migrating to == PlayerTown
            a = 1
            TownsConverted = TownsConverted + 1
            if isConverted1 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if

    if isConverted1 == 1
        if PLAYER of NorseCapital == 1
            disable migration from MinorTown1 to MinorTown2
            disable migration from MinorTown1 to MinorTown3
            disable migration from MinorTown1 to MinorTown4
            disable migration from MinorTown1 to MinorTown5
            disable migration from MinorTown1 to NorseTown1
            disable migration from MinorTown1 to NorseCapital
            disable migration from MinorTown1 to PlayerTown
        else
            enable migration from MinorTown1 to MinorTown2
            enable migration from MinorTown1 to MinorTown3
            enable migration from MinorTown1 to MinorTown4
            enable migration from MinorTown1 to MinorTown5
            enable migration from MinorTown1 to NorseTown1
            enable migration from MinorTown1 to NorseCapital
            enable migration from MinorTown1 to PlayerTown
        end if
    else
        enable migration from MinorTown1 to MinorTown2
        enable migration from MinorTown1 to MinorTown3
        enable migration from MinorTown1 to MinorTown4
        enable migration from MinorTown1 to MinorTown5
        enable migration from MinorTown1 to NorseTown1
        enable migration from MinorTown1 to NorseCapital
        enable migration from MinorTown1 to PlayerTown
    end if
    
    if isConverted2 != 0 and b == 0
        if PLAYER of MinorTown2 == 0 or get town MinorTown2 is migrating to == PlayerTown
            b = 1
            TownsConverted = TownsConverted + 1
            if isConverted2 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if
    
    if isConverted2 == 1
        if PLAYER of NorseCapital == 1
            disable migration from MinorTown2 to MinorTown1
            disable migration from MinorTown2 to MinorTown3
            disable migration from MinorTown2 to MinorTown4
            disable migration from MinorTown2 to MinorTown5
            disable migration from MinorTown2 to NorseTown1
            disable migration from MinorTown2 to NorseCapital
            disable migration from MinorTown2 to PlayerTown
        else
            enable migration from MinorTown2 to MinorTown1
            enable migration from MinorTown2 to MinorTown3
            enable migration from MinorTown2 to MinorTown4
            enable migration from MinorTown2 to MinorTown5
            enable migration from MinorTown2 to NorseTown1
            enable migration from MinorTown2 to NorseCapital
            enable migration from MinorTown2 to PlayerTown
        end if
    else
        enable migration from MinorTown2 to MinorTown1
        enable migration from MinorTown2 to MinorTown3
        enable migration from MinorTown2 to MinorTown4
        enable migration from MinorTown2 to MinorTown5
        enable migration from MinorTown2 to NorseTown1
        enable migration from MinorTown2 to NorseCapital
        enable migration from MinorTown2 to PlayerTown
    end if

    if isConverted3 != 0 and c == 0
        if PLAYER of MinorTown3 == 0 or get town MinorTown3 is migrating to == PlayerTown
            c = 1
            TownsConverted = TownsConverted + 1
            if isConverted3 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if

    if isConverted3 == 1
        if PLAYER of NorseCapital == 1
            disable migration from MinorTown3 to MinorTown1
            disable migration from MinorTown3 to MinorTown2
            disable migration from MinorTown3 to MinorTown4
            disable migration from MinorTown3 to MinorTown5
            disable migration from MinorTown3 to NorseTown1
            disable migration from MinorTown3 to NorseCapital
            disable migration from MinorTown3 to PlayerTown
        else
            enable migration from MinorTown3 to MinorTown1
            enable migration from MinorTown3 to MinorTown2
            enable migration from MinorTown3 to MinorTown4
            enable migration from MinorTown3 to MinorTown5
            enable migration from MinorTown3 to NorseTown1
            enable migration from MinorTown3 to NorseCapital
            enable migration from MinorTown3 to PlayerTown
        end if
    else
        enable migration from MinorTown3 to MinorTown1
        enable migration from MinorTown3 to MinorTown2
        enable migration from MinorTown3 to MinorTown4
        enable migration from MinorTown3 to MinorTown5
        enable migration from MinorTown3 to NorseTown1
        enable migration from MinorTown3 to NorseCapital
        enable migration from MinorTown3 to PlayerTown
    end if
    
    if isConverted4 != 0 and d == 0
        if PLAYER of MinorTown4 == 0 or get town MinorTown4 is migrating to == PlayerTown
            d = 1
            TownsConverted = TownsConverted + 1
            if isConverted4 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if

    if isConverted4 == 1
        if PLAYER of NorseCapital == 1
            disable migration from MinorTown4 to MinorTown1
            disable migration from MinorTown4 to MinorTown2
            disable migration from MinorTown4 to MinorTown3
            disable migration from MinorTown4 to MinorTown5
            disable migration from MinorTown4 to NorseTown1
            disable migration from MinorTown4 to NorseCapital
            disable migration from MinorTown4 to PlayerTown
        else
            enable migration from MinorTown4 to MinorTown1
            enable migration from MinorTown4 to MinorTown2
            enable migration from MinorTown4 to MinorTown3
            enable migration from MinorTown4 to MinorTown5
            enable migration from MinorTown4 to NorseTown1
            enable migration from MinorTown4 to NorseCapital
            enable migration from MinorTown4 to PlayerTown
        end if
    else
        enable migration from MinorTown4 to MinorTown1
        enable migration from MinorTown4 to MinorTown2
        enable migration from MinorTown4 to MinorTown3
        enable migration from MinorTown4 to MinorTown5
        enable migration from MinorTown4 to NorseTown1
        enable migration from MinorTown4 to NorseCapital
        enable migration from MinorTown4 to PlayerTown
    end if
    
    if isConverted5 != 0 and e == 0
        if PLAYER of MinorTown5 == 0 or get town MinorTown5 is migrating to == PlayerTown
            e = 1
            TownsConverted = TownsConverted + 1
            if isConverted5 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if

    if isConverted5 == 1
        if PLAYER of NorseCapital == 1
            disable migration from MinorTown5 to MinorTown1
            disable migration from MinorTown5 to MinorTown2
            disable migration from MinorTown5 to MinorTown3
            disable migration from MinorTown5 to MinorTown4
            disable migration from MinorTown5 to NorseTown1
            disable migration from MinorTown5 to NorseCapital
            disable migration from MinorTown5 to PlayerTown
        else
            enable migration from MinorTown5 to MinorTown1
            enable migration from MinorTown5 to MinorTown2
            enable migration from MinorTown5 to MinorTown3
            enable migration from MinorTown5 to MinorTown4
            enable migration from MinorTown5 to NorseTown1
            enable migration from MinorTown5 to NorseCapital
            enable migration from MinorTown5 to PlayerTown
        end if
    else
        enable migration from MinorTown5 to MinorTown1
        enable migration from MinorTown5 to MinorTown2
        enable migration from MinorTown5 to MinorTown3
        enable migration from MinorTown5 to MinorTown4
        enable migration from MinorTown5 to NorseTown1
        enable migration from MinorTown5 to NorseCapital
        enable migration from MinorTown5 to PlayerTown
    end if
    
    if isConverted6 != 0 and f == 0
        if PLAYER of NorseTown1 == 0 or get town NorseTown1 is migrating to == PlayerTown
            f = 1
            TownsConverted = TownsConverted + 1
            if isConverted6 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if
    
    if isConverted6 == 1
        if PLAYER of NorseCapital == 1
            disable migration from NorseTown1 to MinorTown1
            disable migration from NorseTown1 to MinorTown2
            disable migration from NorseTown1 to MinorTown3
            disable migration from NorseTown1 to MinorTown4
            disable migration from NorseTown1 to MinorTown5
            disable migration from NorseTown1 to NorseCapital
            disable migration from NorseTown1 to PlayerTown
        else
            enable migration from NorseTown1 to MinorTown1
            enable migration from NorseTown1 to MinorTown2
            enable migration from NorseTown1 to MinorTown3
            enable migration from NorseTown1 to MinorTown4
            enable migration from NorseTown1 to MinorTown5
            enable migration from NorseTown1 to NorseCapital
            enable migration from NorseTown1 to PlayerTown
        end if
    else
        enable migration from NorseTown1 to MinorTown1
        enable migration from NorseTown1 to MinorTown2
        enable migration from NorseTown1 to MinorTown3
        enable migration from NorseTown1 to MinorTown4
        enable migration from NorseTown1 to MinorTown5
        enable migration from NorseTown1 to NorseCapital
        enable migration from NorseTown1 to PlayerTown
    end if

    if isConverted7 != 0 and g == 0
        if PLAYER of NorseCapital == 0 or get town NorseCapital is migrating to == PlayerTown
            g = 1
            TownsConverted = TownsConverted + 1
            if isConverted7 == 1
                TownsAggressiveConverted = TownsAggressiveConverted + 1
            end if
        end if
    end if

    if isConverted7 == 1
        if PLAYER of NorseCapital == 1
            disable migration from NorseCapital to MinorTown1
            disable migration from NorseCapital to MinorTown2
            disable migration from NorseCapital to MinorTown3
            disable migration from NorseCapital to MinorTown4
            disable migration from NorseCapital to MinorTown5
            disable migration from NorseCapital to NorseTown1
            disable migration from NorseCapital to PlayerTown
        else
            enable migration from NorseCapital to MinorTown1
            enable migration from NorseCapital to MinorTown2
            enable migration from NorseCapital to MinorTown3
            enable migration from NorseCapital to MinorTown4
            enable migration from NorseCapital to MinorTown5
            enable migration from NorseCapital to NorseTown1
            enable migration from NorseCapital to PlayerTown
        end if
    else
        enable migration from NorseCapital to MinorTown1
        enable migration from NorseCapital to MinorTown2
        enable migration from NorseCapital to MinorTown3
        enable migration from NorseCapital to MinorTown4
        enable migration from NorseCapital to MinorTown5
        enable migration from NorseCapital to NorseTown1
        enable migration from NorseCapital to PlayerTown
    end if    
    
end loop

end script LC4_TownConversion

begin script LC4_Tribute

    mig1 = 0
    mig2 = 0
    mig3 = 0
    mig4 = 0
    mig5 = 0
    mig6 = 0
    mig7 = 0
    a = 0

start

begin loop

    if (variable get town MinorTown1 status == variable MIGRATION_MIGRATED) and mig1 == 0
        mig1 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown2 status == variable MIGRATION_MIGRATED) and mig2 == 0
        mig2 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown3 status == variable MIGRATION_MIGRATED) and mig3 == 0
        mig3 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown4 status == variable MIGRATION_MIGRATED) and mig4 == 0
        mig4 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town MinorTown5 status == variable MIGRATION_MIGRATED) and mig5 == 0
        mig5 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town NorseTown1 status == variable MIGRATION_MIGRATED) and mig6 == 0
        mig6 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if
    
    if (variable get town NorseCapital status == variable MIGRATION_MIGRATED) and mig7 == 0
        mig7 = 1
        MigrationsAccepted = MigrationsAccepted + 1
    end if

    if MigrationsAccepted >= 1 and a == 0
        a = 1
        increment tribute by 5000
    end if
    
    if MigrationsAccepted >= 2 and a == 1
        a = 2
        increment tribute by 5000
    end if
    
    if MigrationsAccepted >= 3 and a == 2
        a = 3
        increment tribute by 10000
    end if
    
    if MigrationsAccepted >= 4 and a == 3
        a = 4
        increment tribute by 10000
    end if
    
    if MigrationsAccepted >= 5 and a == 4
        a = 5
        increment tribute by 15000
    end if
    
    if MigrationsAccepted >= 6 and a == 5
        a = 6
        increment tribute by 20000
    end if
    
    if MigrationsAccepted >= 7 and a == 6
        a = 7
        increment tribute by 25000
    end if
    
end loop
    
end script LC4_Tribute

begin script LC4_Speeches

    isConverted1 = 0
    isConverted2 = 0
    isConverted3 = 0
    isConverted4 = 0
    isConverted5 = 0
    isConverted6 = 0
    isConverted7 = 0
    
    mig1 = 0
    mig2 = 0
    mig3 = 0
    mig4 = 0
    mig5 = 0
    mig6 = 0
    mig7 = 0
    
    LoseDialogue1 = 0
    
    Number = 0
    
    AttackTimer = create timer for 0 seconds
    LoseTimer = create timer for 0 seconds

    Conv1 = 0
    Conv2 = 0
    Conv3 = 0
    Conv4 = 0
    Conv5 = 0
    Conv6 = 0
    Conv7 = 0
    
    PlayerPlatoon = 0
    
    a = 0
    b = 0
    c = 0
    d = 0
    e = 0
    f = 0
    g = 0
    astory = 0
    bstory = 0
    
    Armory = 0
    ArmoryRanged = 0
    Granary = 0
    Market = 0
    Nursery = 0
    Store = 0
    Tavern = 0
    Temple = 0
    Altar = 0
    Theatre = 0
    Bath = 0
    Pen = 0
    Field = 0
    Wall = 0
    Granary2 = 0
    Graveyard = 0
    Lumber = 0
    Nursery2 = 0
    Rest = 0
    Sky = 0
    Smelter = 0
    Storehouse = 0
    Tavern2 = 0
    Temple2 = 0
    Uni = 0
    
    ab = 0
    bb = 0
    cb = 0
    db = 0
    eb = 0
    fb = 0
    gb = 0
    
    Dialogue1said = 0
    Dialogue2 = 0
    TownDialogue = 1
    
    StoryDialogue = 0
    StoryDialogueTimer = create timer for 400 seconds

    StartDialogueSaid = 0
    ObjectiveCommentSaid = 0
    ArmyCommentSaid = 0
    Army100CommentSaid = 0
    Army200CommentSaid = 0
    PlayerPlatoonWithinNorseWallsSaid = 0
    PlayerPlatoonAttackingNorseTCSaid = 0
    PlatoonDummy = 0

    PlatoonKilledTimer = create timer for 0 seconds

    NumberPlatoon = 0

start

begin loop
    
    if PlatoonKilled == 1
        PlatoonKilled = 0
        if get PlatoonKilledTimer time remaining <= 0
            NumberPlatoon = number from 1 to 4
            PlatoonKilledTimer = create timer for 120 seconds
            GB_DialogueIsRunning = 1
            wait until dialogue ready
            if NumberPlatoon == 1
                begin dialogue
                    say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_170"
                    wait until read
                end dialogue
            elsif NumberPlatoon == 2 
                begin dialogue
                    say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_220"
                    wait until read
                end dialogue
            elsif NumberPlatoon == 3
                begin dialogue
                    say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_340"
                    wait until read
                end dialogue
            elsif NumberPlatoon == 4
                begin dialogue
                    say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEKS_WIN_BATTLES_90"
                    wait until read
                end dialogue
            end if
            GB_DialogueIsRunning = 0
        end if
    end if

    if PlayerPlatoonWithinNorseWallsSaid == 0
        PlatoonDummy = get platoon of player 0 nearest {NorseCapital} radius 400
        if PlatoonDummy exists
            PlayerPlatoonWithinNorseWallsSaid = 1
            wait until dialogue ready
            begin dialogue
                eject evil spirit
                //EA: Here we go, here we go, here we go!
                say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_60"
                wait until read
                //EA "Yeah! This is it! Attack!"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_280"
                wait until read
                send evil spirit home
                //GEN: Their force is overwhelming.
                say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_70"
                wait until read
            end dialogue
        end if
    end if

    if PlayerPlatoonAttackingNorseTCSaid == 0
        if town NorseCapital is under takeover from player 0
            PlayerPlatoonAttackingNorseTCSaid = 1
            wait until dialogue ready
            begin dialogue
            //GEN: All troops to me! We must defend against the brutal Greeks!
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_80"
            wait until read

            eject evil spirit
            //EA: Yes - we've got them!
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_90"
            wait until read
                
            send evil spirit home
            end dialogue
        end if
    end if

    //----Check if players army reaches 50 warriors----//            
    if get army size in town PlayerTown >= 50 and Army100CommentSaid == 0 
        Army100CommentSaid = 1
        GB_DialogueIsRunning = 1
        wait until dialogue ready
        begin dialogue
            //GEN: "Their strength grows. We must prepare for war."
            say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_260"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
        
    //----Check if players army reaches 100 warriors----//        
    if get army size in town PlayerTown >= 100 and Army200CommentSaid == 0 
        GB_DialogueIsRunning = 1
        wait until dialogue ready
        begin dialogue
            Army200CommentSaid = 1    
            //GEN: "They have an impressive army."    
            say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_270"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if

    if ArmyCommentSaid == 0
        PlatoonDummy = get platoon of player 0 nearest {PlayerTown} radius 400
        if PlatoonDummy exists and not PlatoonDummy recruiting
            GB_DialogueIsRunning = 1
            wait until dialogue ready
            begin dialogue
                //GEN: So the Greeks have recruited a platoon? Let's see how it fares against Norse iron!
                say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_180"
                wait until read
            end dialogue
            GB_DialogueIsRunning = 0
            ArmyCommentSaid = 1
        end if
    end if

    if StartDialogueSaid == 0
        GB_DialogueIsRunning = 1
        StartDialogueSaid = 1
        wait until dialogue ready
        begin dialogue
            eject good spirit
            //GA: "Come along, Leader. We need to start building." 
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_470"
                wait until read
            //GA: "We should start making houses."
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_490"
                wait until read
            send good spirit home
        end dialogue
        GB_DialogueIsRunning = 0
    end if

    if get total of stat STATS_AGC_OBJECTIVES_NUM_COMPLETED >= 1 and ObjectiveCommentSaid == 0
        GB_DialogueIsRunning = 1
        wait until dialogue ready
        begin dialogue
            eject good spirit
            //GA: "If you need a reminder of what your objectives are, go to the objectives part of the Menu."
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_410"
                wait until read
            send good spirit home
        end dialogue
        ObjectiveCommentSaid = 1
        GB_DialogueIsRunning = 0
    end if

    isConverted1 = variable get town MinorTown1 method of last conversion
    isConverted2 = variable get town MinorTown2 method of last conversion
    isConverted3 = variable get town MinorTown3 method of last conversion
    isConverted4 = variable get town MinorTown4 method of last conversion
    isConverted5 = variable get town MinorTown5 method of last conversion
    isConverted6 = variable get town NorseTown1 method of last conversion
    isConverted7 = variable get town NorseCapital method of last conversion

    if PLAYER of MinorTown1 != 1 and Conv1 == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        if isConverted1 == 1//aggressive
            wait until dialogue ready
            begin dialogue
                //GEN: Turn that settlement into a military outpost. Build armies there for defence against these people!
                say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_160"
                wait until read
                eject evil spirit
                //EA: "wow, he's getting pretty jumpy"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_500"
                wait until read

                eject good spirit
                //GA: "look, we need to get our defenses going"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_510"
                wait until read

                //EA: "we should really get an army going"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_520"
                wait until read
                        
                send evil spirit home
                send good spirit home
            end dialogue
            isConverted1 = 0
            Conv1 = 1
        elsif isConverted1 == 2//passive
            wait until dialogue ready
            begin dialogue
                eject good spirit
                //GA: "Look! Those people are migrating! They want to live in our Town! They're bringing all their worldly goods. Hooray!"
                say "BW2T_SCRIPT_03FINAL_ADVISORS_TUT_680"
                wait until read
                send good spirit home
                //GEN: Turn that settlement into a military outpost. Build armies there for defence against these people!
                say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_160"
                wait until read
                eject evil spirit
                //EA: "wow, he's getting pretty jumpy"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_500"
                wait until read

                eject good spirit
                //GA: "look, we need to get our defenses going"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_510"
                wait until read

                //EA: "we should really get an army going"
                say "BW2T_SCRIPT_03FINAL_PLAYTHROUGH29_520"
                wait until read
                        
                send evil spirit home
                send good spirit home
            end dialogue
            isConverted1 = 0
            Conv1 = 1
        end if
        GB_DialogueIsRunning = 0
    end if 
    
    if UnderAttack >= 1 and get AttackTimer time remaining <= 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        UnderAttack = 0
        Number = number from 1 to 14
        wait until dialogue ready
        if Number == 1
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_01"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 2
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_02"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 3
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_05"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 4
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_06"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 5
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_07"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 6
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_08"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 7
            begin dialogue
                make evil spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_EA_18"
                wait until read
                send evil spirit home
            end dialogue
        end if
        if Number == 8
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_01"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 9
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_02"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 10
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_05"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 11
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_06"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 12
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_07"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 13
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_09"
                wait until read
                send good spirit home
            end dialogue
        end if
        if Number == 14
            begin dialogue
                make good spirit appear
                say "BW2T_HELP_TEXT_GUIDANCE_BATTLE_ALERT_GA_10"
                wait until read
                send good spirit home
            end dialogue
        end if
        GB_DialogueIsRunning = 0
        AttackTimer = create timer for 45 seconds
    end if
    
    if (PLAYER of PlayerTown != 0 and PLAYER of MinorTown1 != 0 and PLAYER of MinorTown2 != 0 and PLAYER of MinorTown3 != 0 and PLAYER of MinorTown4 != 0 and PLAYER of MinorTown5 != 0 and PLAYER of NorseTown1 != 0 and PLAYER of NorseCapital != 0) and get LoseTimer time remaining <= 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        LoseDialogue1 = number from 1 to 5
        wait until dialogue ready
        if LoseDialogue1 == 1
            begin dialogue
                make good spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_10"
                wait until read
                send good spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 2
            begin dialogue
                make evil spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_20"
                wait until read
                send evil spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 3
            begin dialogue
                make good spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_30"
                wait until read
                send good spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 4
            begin dialogue
                make evil spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_40"
                wait until read
                send evil spirit home
            end dialogue
        end if
        
        if LoseDialogue1 == 5
            begin dialogue
                make evil spirit appear
                say "BW2T_SCRIPT_GENERIC_ADVISORS_SUGGEST_RESTART_50"
                wait until read
                send evil spirit home
            end dialogue
        end if
        
        GB_DialogueIsRunning = 0
        LoseTimer = create timer for 75 seconds
    end if
    
    if a == 0 PlayerPlatoon = get platoon of player 0 nearest {PlayerTown} radius 500 end if
    if PlayerPlatoon exists and a == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        a = 1
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_240"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get building ABODE_NUMBER_RANGED_ARMOURY in PlayerTown min built 0.0 exists and bb == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        bb = 1
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_230"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if cb == 0 and L4BuildWallComplete == 1 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        cb = 1
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_280"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if TownsConverted >= 1 and TownDialogue == 1 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        TownDialogue = 2
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEK_IMPRESS_150"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get player 0 impressiveness >= NORSE_CAPITAL_IMPRESSIVENESS * 0.2 + 7500 and Dialogue2 == 0 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        Dialogue2 = 2
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEK_IMPRESS_160"
            wait until read
            say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEK_IMPRESS_170"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get player 0 impressiveness >= NORSE_CAPITAL_IMPRESSIVENESS * 0.4 + 7500 and Dialogue2 == 2 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        Dialogue2 = 3
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEK_IMPRESS_180"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get player 0 impressiveness >= NORSE_CAPITAL_IMPRESSIVENESS * 0.6 + 7500 and Dialogue2 == 3 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        Dialogue2 = 4
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEK_IMPRESS_190"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get player 0 impressiveness >= NORSE_CAPITAL_IMPRESSIVENESS * 0.75 + 7500 and Dialogue2 == 4 and GB_DialogueIsRunning == 0
        GB_DialogueIsRunning = 1
        Dialogue2 = 5
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_NORSE_TAUNTS_GREEK_IMPRESS_30"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if get player 0 impressiveness >= NORSE_CAPITAL_IMPRESSIVENESS * 0.9 + 7500 and Dialogue2 == 5 and GB_DialogueIsRunning == 0 and get player 0 alignment > 0
        GB_DialogueIsRunning = 1
        Dialogue2 = 6
        wait until dialogue ready
        begin dialogue
            // GEN: "These Greeks are impressive"
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_10"
            wait until read
            // GEN: "Their dedication to culture and fairness are second to none"
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_20"
            wait until read
            // GEN: "Maybe an alliance would be to our advantage."
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_30"
            wait until read
            eject good spirit
            // GA: "Their people are impressed; they are waivering. If we just build up a bit more the Norse will surely join us."
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_40"
            wait until read
            eject evil spirit
            // EA: "It's never too late to attack though!"
            say "BW2T_SCRIPT_04FINAL_PLAYTHROUGH30_50"
            wait until read
            send good spirit home
            send evil spirit home
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if TownsConverted >= 2 and GB_DialogueIsRunning == 0 and bstory == 0
        GB_DialogueIsRunning = 1
        bstory = 1
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_ADVISORS_LAND_DONE_200"
            wait until read
        end dialogue
        GB_DialogueIsRunning = 0
    end if
    
    if VolcanoFired == 1
        VolcanoFired = 2
        wait until dialogue ready
        begin dialogue
            say "BW2T_SCRIPT_04FINAL_EPIC_VOLCANO_READY"
            wait until read
        end dialogue
    end if

end loop
    
end script LC4_Speeches

begin script LC4_GatehouseManager

    GateHouseT11 = 0
    GateHouseT12 = 0
    GateHouseT13 = 0
    Counter = 0
    Cnt = 0


    //T1 = AztecCapital
    //T2 = AztecFirstTown
    oCreature = get player 0 creature
    PlayerPlatoonT11 = 0
    CatapultT11 = 0
    TestCreatureT11 = 0
    PlayerPlatoonT12 = 0
    CatapultT12 = 0
    TestCreatureT12 = 0
    PlayerPlatoonT13 = 0
    CatapultT13 = 0
    TestCreatureT13 = 0
    EnemyNearDoorT11 = 0
    EnemyNearDoorT12 = 0
    EnemyNearDoorT13 = 0
    GatehouseTimer[3]

start

begin loop
    GateHouseT11 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {781.82,160.50,1246.74} radius 15
    GateHouseT12 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {906.58,160.50,1098.11} radius 15
    GateHouseT13 = get SCRIPT_OBJECT_TYPE_ABODE ABODE_NUMBER_GATEHOUSE_F at {807.22,150.74,957.35} radius 15
    
    oCreature = get player 0 creature

    if PLAYER of NorseCapital == 1

        if not town NorseCapital is under takeover from player 0
            PlayerPlatoonT11 = get platoon of player 0 nearest {GateHouseT11} radius 100
            CatapultT11 = get siege weapon of player 0 nearest {GateHouseT11} radius 100
            TestCreatureT11 = get distance from {GateHouseT11} to {oCreature}
            
            if PlayerPlatoonT11 exists
                EnemyNearDoorT11 = 1
            elsif CatapultT11 exists
                EnemyNearDoorT11 = 1
            elsif TestCreatureT11 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT11 = 1
            else
                EnemyNearDoorT11 = 0
            end if
            
            if EnemyNearDoorT11 == 1 and get number of platoon of player 1 at {GateHouseT11} radius 100 < 5
                set gate GateHouseT11 close
            else
                set gate GateHouseT11 open
            end if
            
            PlayerPlatoonT12 = get platoon of player 0 nearest {GateHouseT12} radius 100
            CatapultT12 = get siege weapon of player 0 nearest {GateHouseT12} radius 100
            TestCreatureT12 = get distance from {GateHouseT12} to {oCreature}
            
            if PlayerPlatoonT12 exists
                EnemyNearDoorT12 = 1
            elsif CatapultT12 exists
                EnemyNearDoorT12 = 1
            elsif TestCreatureT12 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT12 = 1
            else
                EnemyNearDoorT12 = 0
            end if
            
            if EnemyNearDoorT12 == 1 and get number of platoon of player 1 at {GateHouseT12} radius 100 < 5
                set gate GateHouseT12 close
            else
                set gate GateHouseT12 open
            end if
            
            PlayerPlatoonT13 = get platoon of player 0 nearest {GateHouseT13} radius 100
            CatapultT13 = get siege weapon of player 0 nearest {GateHouseT13} radius 100
            TestCreatureT13 = get distance from {GateHouseT13} to {oCreature}
            
            if PlayerPlatoonT13 exists
                EnemyNearDoorT13 = 1
            elsif CatapultT13 exists
                EnemyNearDoorT13 = 1
            elsif TestCreatureT13 < 200 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of oCreature > 0.00
                EnemyNearDoorT13 = 1
            else
                EnemyNearDoorT13 = 0
            end if
            
            if EnemyNearDoorT13 == 1 and get number of platoon of player 1 at {GateHouseT13} radius 100 < 5
                set gate GateHouseT13 close
            else
                set gate GateHouseT13 open
            end if
        else
            set gate GateHouseT11 open
            set gate GateHouseT12 open
            set gate GateHouseT13 open
        end if
        
    end if
    
end loop

end script LC4_GatehouseManager

begin script LC4_Norse_Capital

    RecruitTimer1 = 0
    RecruitTimer2 = 0
    Wall[5]
    Script1Triggered = 0
    Script1Timer = create timer for 0 seconds
    NorseTownScriptStarted = 0
    WallCounter = 0
    PlannedWall[8]
    PlannedWallPos[8]
    NearestSettlementTownCentre = 0
    AttackingPlatoons = 0
    PlayerGateHouse = 0
    PlayerPlatoon = 0
    AttackingPosition = 0
    AttackingPositionFallBack = 0
    CatapultScriptFired = 1
    HardModeAttackTimer = create timer for 999999 seconds
    VolcanoBuilt = 0
    VolcanoWarning = 0
    VolcanoTimer = create timer for 0 seconds
    VOLCANODELAY = 2500
    EpicVolc = 0
    SiegeWaypoint1 = 0
    SiegeWaypoint2 = 0
    SiegeWaypoint3 = 0
    RecruitTimerGeneric[16]
    GenericTown = 0
    GenericTownCounter = 0
    GenericTownBuildingInitialTimer = create timer for 1800 * BuilderModifier seconds
    GenericTownBuildingTimer = create timer for 0 * BuilderModifier seconds
    GenericTownPlatoonTimer = create timer for 0 * RecruitModifier seconds
    AlignmentTownBuildingTimer1 = create timer for 600 * BuilderModifier seconds
    AlignmentTownBuildingTimer2 = create timer for 1200 * BuilderModifier seconds
    AlignmentTownBuildingTimer3 = create timer for 2400 * BuilderModifier seconds
    AlignmentTownBuildingTimer4 = create timer for 3000 * BuilderModifier seconds
    AlignmentTownBuildingTimer5 = create timer for 4200 * BuilderModifier seconds
    AlignmentTownBuildingPhase = 0
    ConquerorTimer = create timer for 4000 * RecruitModifier seconds
    ConquerorResetTimer = create timer for 0 seconds
    AnotherPlatoon = 0
    Number = 0

start

    //extend town NorseCapital influence by 40

    PlayerGateHouse = get HOUSE GATEHOUSE at {1734.16,230.89,1248.38} radius 100
    if PlayerGateHouse not exists
        PlayerGateHouse = get HOUSE GATEHOUSE_F at {1734.16,230.89,1248.38} radius 100
    end if
    set gate PlayerGateHouse open

    add resource WOOD 2131 to MinorTown3
    add resource ORE 431 to MinorTown3
    add resource FOOD 1341 to MinorTown3

    add resource WOOD 6543 to MinorTown4
    add resource ORE 612 to MinorTown4
    add resource FOOD 8658 to MinorTown4

    if Difficulty >= 4
        add resource WOOD 5000 to PlayerTown
        add resource ORE 5000 to PlayerTown
        add resource FOOD 5000 to PlayerTown
    elsif Difficulty == 3
        add resource WOOD 7500 to PlayerTown
        add resource ORE 7500 to PlayerTown
        add resource FOOD 7500 to PlayerTown
    elsif Difficulty == 2
        add resource WOOD 10000 to PlayerTown
        add resource ORE 10000 to PlayerTown
        add resource FOOD 10000 to PlayerTown
    elsif Difficulty == 1
        add resource WOOD 12500 to PlayerTown
        add resource ORE 12500 to PlayerTown
        add resource FOOD 12500 to PlayerTown
    end if

    if PlayerAlignmentFinal < 0.0
        ConquerorTimer = create timer for 2400 * RecruitModifier seconds
    elsif PlayerAlignmentFinal >= 0.0
        ConquerorTimer = create timer for 4800 * RecruitModifier seconds
    end if

    //----Create town static defenders platoons----//
    LC4_Platoon[0] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {PlatoonPos[0]} with 25 * RecruitSizeModifier men and 0 women
    attach LC4_Platoon[0] to NorseCapital
    PLAYER of LC4_Platoon[0] = 1
    run background script LC4_StaticPlatoonsActions(PlatoonPos[0],Melee,LC4_Platoon[0],NorseCapital)
    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[0],1)
    enable platoon LC4_Platoon[0] respond to town NorseCapital attack
    set LC4_Platoon[0] focus to {PlatoonPos[0]}
    
    LC4_Platoon[1] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {PlatoonPos[1]} with 25 * RecruitSizeModifier men and 0 women
    attach LC4_Platoon[1] to NorseCapital
    PLAYER of LC4_Platoon[1] = 1
    run background script LC4_StaticPlatoonsActions(PlatoonPos[1],Melee,LC4_Platoon[1],NorseCapital)
    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[1],1)
    enable platoon LC4_Platoon[1] respond to town NorseCapital attack
    set LC4_Platoon[1] focus to {PlatoonPos[1]}
    
    if HardMode == 1
        LC4_Platoon[21] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {PlatoonPos[7]} with 30 * RecruitSizeModifier men and 0 women
        attach LC4_Platoon[21] to NorseCapital
        PLAYER of LC4_Platoon[21] = 1
        run background script LC4_StaticPlatoonsActions(PlatoonPos[7],Melee,LC4_Platoon[21],NorseCapital)
        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[21],1)
        enable platoon LC4_Platoon[21] respond to town NorseCapital attack
        set LC4_Platoon[21] focus to {PlayerTown}

        LC4_Platoon[22] = create platoon PLATOON_INFO_NORSE_RANGED_2 at {PlatoonPos[8]} with 30 * RecruitSizeModifier men and 0 women
        attach LC4_Platoon[22] to NorseCapital
        PLAYER of LC4_Platoon[22] = 1
        run background script LC4_StaticPlatoonsActions(PlatoonPos[8],Ranged,LC4_Platoon[22],NorseCapital)
        run background script PT_CreateBasicNorsePlatoonRanged(LC4_Platoon[22],1)
        enable platoon LC4_Platoon[22] respond to town NorseCapital attack
        set LC4_Platoon[22] focus to {PlayerTown}

        LC4_Platoon[23] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {PlatoonPos[9]} with 30 * RecruitSizeModifier men and 0 women
        attach LC4_Platoon[23] to NorseCapital
        PLAYER of LC4_Platoon[23] = 1
        run background script LC4_StaticPlatoonsActions(PlatoonPos[9],Melee,LC4_Platoon[23],NorseCapital)
        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[23],1)
        enable platoon LC4_Platoon[23] respond to town NorseCapital attack
        set LC4_Platoon[23] focus to {PlayerTown}

        LC4_Platoon[24] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {PlatoonPos[10]} with 30 * RecruitSizeModifier men and 0 women
        attach LC4_Platoon[24] to NorseCapital
        PLAYER of LC4_Platoon[24] = 1
        run background script LC4_StaticPlatoonsActions(PlatoonPos[10],Melee,LC4_Platoon[24],NorseCapital)
        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[24],1)
        enable platoon LC4_Platoon[24] respond to town NorseCapital attack
        set LC4_Platoon[24] focus to {PlayerTown}

        LC4_Platoon[25] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {PlatoonPos[11]} with 30 * RecruitSizeModifier men and 0 women
        attach LC4_Platoon[25] to NorseCapital
        PLAYER of LC4_Platoon[25] = 1
        run background script LC4_StaticPlatoonsActions(PlatoonPos[11],Melee,LC4_Platoon[25],NorseCapital)
        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[25],1)
        enable platoon LC4_Platoon[25] respond to town NorseCapital attack
        set LC4_Platoon[25] focus to {PlayerTown}
    end if

    //RecruitTimers for different towns
    RecruitTimer1 = create timer for 60 seconds
    RecruitTimer2 = create timer for 60 seconds
    
    run background script LC4_Platoon14Actions

    begin loop
        set player 1 alignment 0.0

        NearestSettlementTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in NearestSettlement min built 1.0
        if TownsConverted >= 3 or TownsAggressiveConverted >= 1 or LC4_Platoon[0] not exists or LC4_Platoon[1] not exists
            //NorseCapitalWalls
            Wall[1] = get wall segment nearest {906.72,160.31,1139.25} radius 15
            Wall[2] = get wall segment nearest {762.84,160.47,1253.27} radius 15
            Wall[3] = get wall segment nearest {779.25,149.70,972.67} radius 15
            if get RecruitTimer1 time remaining <= 0
                //NorseCapital Production
                if LC4_Platoon[0] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[0] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 180 * RecruitModifier seconds
                    enable platoon LC4_Platoon[0] respond to town NorseCapital attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[0],Melee,LC4_Platoon[0],NorseCapital)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[0],1)

                elsif LC4_Platoon[1] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[1] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 180 * RecruitModifier seconds
                    enable platoon LC4_Platoon[1] respond to town NorseCapital attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[1],Melee,LC4_Platoon[1],NorseCapital)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[1],1)

                elsif LC4_Platoon[2] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[2] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 180 * RecruitModifier seconds
                    enable platoon LC4_Platoon[2] respond to town NorseCapital attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[2],Melee,LC4_Platoon[2],NorseCapital)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[2],1)

                elsif LC4_Platoon[3] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[3] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 120 * RecruitModifier seconds
                    enable platoon LC4_Platoon[3] respond to town NorseCapital attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[3],Melee,LC4_Platoon[3],NorseCapital)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[3],1)

                elsif LC4_Platoon[4] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[4] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 120 * RecruitModifier seconds
                    enable platoon LC4_Platoon[4] respond to town NorseCapital attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[4],Melee,LC4_Platoon[4],NorseCapital)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[4],1)

                elsif LC4_Platoon[14] not exists and PLAYER of NorseCapital == 1 and PLAYER of NorseTown1 != 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[14] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 120 * RecruitModifier seconds
                    run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[14],1)

                elsif LC4_WallArcher[0] not exists and Wall[1] exists and PLAYER of Wall[1] == 1 and HEALTH of Wall[1] == 1.0 and not town NorseCapital is under takeover from player 0 and get RecruitTimer1 time remaining <= 0
                    LC4_WallArcher[0] = recruit ARMY_UNIT_TYPE_RANGED_2 town NorseCapital platoon of size number from 15 to 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 75 * RecruitModifier seconds
                    run background script PT_CreateBasicNorsePlatoonRanged(LC4_WallArcher[0],1)
                    wait until not LC4_WallArcher[0] recruiting
                    enable platoon LC4_WallArcher[0] respond to town NorseCapital attack
                    add action PLATOON_AGENDA_ACTION_GET_ON_WALL using Wall[1] to LC4_WallArcher[0] action queue
                    
                elsif LC4_WallArcher[1] not exists and Wall[2] exists and PLAYER of Wall[2] == 1 and HEALTH of Wall[2] == 1.0 and not town NorseCapital is under takeover from player 0 and get RecruitTimer1 time remaining <= 0
                    LC4_WallArcher[1] = recruit ARMY_UNIT_TYPE_RANGED_2 town NorseCapital platoon of size number from 15 to 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 75 * RecruitModifier seconds
                    run background script PT_CreateBasicNorsePlatoonRanged(LC4_WallArcher[1],1)
                    wait until not LC4_WallArcher[1] recruiting
                    enable platoon LC4_WallArcher[1] respond to town NorseCapital attack
                    add action PLATOON_AGENDA_ACTION_GET_ON_WALL using Wall[2] to LC4_WallArcher[1] action queue
                    
                elsif LC4_WallArcher[2] not exists and Wall[3] exists and PLAYER of Wall[3] == 1 and HEALTH of Wall[3] == 1.0 and not town NorseCapital is under takeover from player 0 and get RecruitTimer1 time remaining <= 0
                    LC4_WallArcher[2] = recruit ARMY_UNIT_TYPE_RANGED_2 town NorseCapital platoon of size number from 15 to 20 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 75 * RecruitModifier seconds
                    run background script PT_CreateBasicNorsePlatoonRanged(LC4_WallArcher[2],1)
                    wait until not LC4_WallArcher[2] recruiting
                    enable platoon LC4_WallArcher[2] respond to town NorseCapital attack
                    add action PLATOON_AGENDA_ACTION_GET_ON_WALL using Wall[3] to LC4_WallArcher[2] action queue

                //-- Attacker Logic ALWAYS AT BOTTOM --//
                //Scripted Attack #1 Evil Alignment - Only execute once
                elsif ScriptedAttack[0] == 0 and PlayerAlignmentFinal < 0.0 and LC4_Platoon[5] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[5] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 15 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 75 * RecruitModifier seconds
                    AttackingPosition = marker at {1691.67,219.86,1116.92}
                    AttackingPositionFallBack = marker at {1525.46,227.15,961.87}
                    run script PlatoonTargetingMetric(15 * RecruitSizeModifier,PlayerTown)
                    run background script LC4_ArmyBehaivours(LC4_Platoon[5],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[5],1)

                elsif ScriptedAttack[0] == 0 and PlayerAlignmentFinal < 0.0 and LC4_Platoon[6] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[6] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 15 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 75 * RecruitModifier seconds
                    AttackingPosition = marker at {1647.17,222.51,1087.04}
                    AttackingPositionFallBack = marker at {1466.23,220.61,996.92}
                    run script PlatoonTargetingMetric(15 * RecruitSizeModifier,PlayerTown)
                    run background script LC4_ArmyBehaivours(LC4_Platoon[6],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[6],1)

                elsif ScriptedAttack[0] == 0 and PlayerAlignmentFinal < 0.0 and LC4_Platoon[7] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                    LC4_Platoon[7] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 15 * RecruitSizeModifier
                    RecruitTimer1 = create timer for 75 * RecruitModifier seconds
                    AttackingPosition = marker at {1745.02,222.30,1067.20}
                    AttackingPositionFallBack = marker at {1478.01,225.63,907.39}
                    run script PlatoonTargetingMetric(15 * RecruitSizeModifier,PlayerTown)
                    run background script LC4_ArmyBehaivours(LC4_Platoon[7],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[7],1)

                //Random Attacks Evil Alignment
                //Direct small attack #2
                elsif (RndAttack == 1 or RndAttack == 2) and PlayerAlignmentFinal < 0.0 and AttackersSent == 0
                    if LC4_Platoon[26] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[26] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {0,0}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {0,0}
                        run script PlatoonTargetingMetric(20 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[26],Melee,Attacker,LC4_SiegeCatapult[5],PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[26],Melee,Conqueror,LC4_SiegeCatapult[5],PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[26],1)

                    elsif LC4_SiegeCatapult[5] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[5] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {0,0}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {0,0}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[5],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[5],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if
                    end if

                //Guerilla small attack #3
                elsif RndAttack == 3 and PlayerAlignmentFinal < 0.0 and AttackersSent == 0
                    if LC4_Platoon[27] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[27] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 25 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {40,40}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {40,40}
                        run script PlatoonTargetingMetric(25 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[27],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Passive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[27],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Passive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        end if
                        run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[27],1)

                    elsif LC4_Platoon[28] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[28] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 25 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {40,40}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {40,40}
                        run script PlatoonTargetingMetric(25 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[28],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Passive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[28],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Passive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        end if
                        run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[28],1)
                    end if

                //Balanced attack direct and backdoor #4
                elsif RndAttack == 4 and PlayerAlignmentFinal < 0.0 and AttackersSent == 0
                    if LC4_Platoon[29] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[29] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script PlatoonTargetingMetric(20 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[29],Melee,Attacker,LC4_SiegeCatapult[6],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[29],Melee,Conqueror,LC4_SiegeCatapult[6],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[29],1)

                    elsif LC4_SiegeCatapult[6] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[6] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)     
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[6],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[6],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if    

                    elsif LC4_Platoon[30] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[30] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                        run script PlatoonTargetingMetric(20 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[30],Melee,Attacker,LC4_SiegeCatapult[7],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[30],Melee,Conqueror,LC4_SiegeCatapult[7],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[30],1)
                        
                    elsif LC4_SiegeCatapult[7] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[7] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[7],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[7],Conqueror,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        end if    
                    end if

                //Large direct attack #5
                elsif RndAttack == 5 and PlayerAlignmentFinal < 0.0 and AttackersSent == 0
                    if LC4_Platoon[31] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[31] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 30 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {30,30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {30,30}
                        run script PlatoonTargetingMetric(30 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[31],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[31],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[31],1)

                    elsif LC4_Platoon[32] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[32] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 30 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script PlatoonTargetingMetric(30 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[32],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[32],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[32],1)
                        
                    elsif LC4_SiegeCatapult[8] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[8] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {30,30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {30,30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[8],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[8],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if

                    elsif LC4_SiegeCatapult[9] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[9] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[9],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[9],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if
                    end if

                //Random Attacks Good Alignment
                //Direct small attack #2
                elsif (RndAttack == 1 or RndAttack == 2) and PlayerAlignmentFinal >= 0.0 and AttackersSent == 0
                    if LC4_Platoon[26] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[26] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 40 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {0,0}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {0,0}
                        run script PlatoonTargetingMetric(40 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[26],Melee,Attacker,LC4_SiegeCatapult[5],PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[26],Melee,Conqueror,LC4_SiegeCatapult[5],PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[26],1)

                    elsif LC4_SiegeCatapult[5] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[5] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {0,0}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {0,0}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[5],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[5],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if
                    end if

                //Large direct attack #3
                elsif RndAttack == 3 and PlayerAlignmentFinal >= 0.0 and AttackersSent == 0
                    if LC4_Platoon[31] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[31] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 60 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script PlatoonTargetingMetric(60 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[31],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[31],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[31],1)

                    elsif LC4_Platoon[32] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[32] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 60 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {30,30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {30,30}
                        run script PlatoonTargetingMetric(60 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[32],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[32],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[32],1)
                        
                    elsif LC4_SiegeCatapult[8] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[8] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[8],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[8],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if

                    elsif LC4_SiegeCatapult[9] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[9] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {30,30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {30,30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[9],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[9],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if
                    end if

                //Large backdoor attack #4
                elsif RndAttack == 4 and PlayerAlignmentFinal >= 0.0 and AttackersSent == 0
                    if LC4_Platoon[33] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[33] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 60 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                        run script PlatoonTargetingMetric(60 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[33],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[33],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        end if
                        run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[33],1)

                    elsif LC4_Platoon[34] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[34] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 60 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {30,30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {30,30}
                        run script PlatoonTargetingMetric(60 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[34],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[34],Melee,Conqueror,0,PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        end if
                        run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[34],1)
                        
                    elsif LC4_SiegeCatapult[10] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[10] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[10],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[10],Conqueror,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        end if

                    elsif LC4_SiegeCatapult[11] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[11] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {30,30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {30,30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[11],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[11],Conqueror,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        end if
                    end if

                //Balance front and back attack #5
                elsif RndAttack == 5 and PlayerAlignmentFinal >= 0.0 and AttackersSent == 0
                    if LC4_Platoon[29] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[29] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 45 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script PlatoonTargetingMetric(45 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[29],Melee,Attacker,LC4_SiegeCatapult[6],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[29],Melee,Conqueror,LC4_SiegeCatapult[6],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[29],1)

                    elsif LC4_SiegeCatapult[6] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[6] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[0]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[1]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)     
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[6],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[6],Conqueror,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)
                        end if    

                    elsif LC4_Platoon[30] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_Platoon[30] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 45 * RecruitSizeModifier
                        RecruitTimer1 = create timer for 320 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                        run script PlatoonTargetingMetric(45 * RecruitSizeModifier,PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_ArmyBehaivours(LC4_Platoon[30],Melee,Attacker,LC4_SiegeCatapult[7],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        elsif AttackingPlatoons == 1
                            run background script LC4_ArmyBehaivours(LC4_Platoon[30],Melee,Conqueror,LC4_SiegeCatapult[7],PlatoonTargetingMetricFocusResult,Alerted,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                        end if
                        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[30],1)
                        
                    elsif LC4_SiegeCatapult[7] not exists and PLAYER of NorseCapital == 1 and get RecruitTimer1 time remaining <= 0 and not town NorseCapital is under takeover from player 0
                        LC4_SiegeCatapult[7] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_1 town NorseCapital siege weapon
                        RecruitTimer1 = create timer for 160 * RecruitModifier seconds
                        AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                        AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                        run script CatapultTargetingMetric(PlayerTown)
                        if AttackingPlatoons == 0
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[7],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        elsif AttackingPlatoons == 1
                            run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[7],Conqueror,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                        end if    
                    end if
                end if
            end if

            if get RecruitTimer2 time remaining <= 0
                //NorseTown1 Production
                if LC4_Platoon[14] not exists and PLAYER of NorseTown1 == 1 and get RecruitTimer2 time remaining <= 0 and not town NorseTown1 is under takeover from player 0
                    LC4_Platoon[14] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseTown1 platoon of size 20 * RecruitSizeModifier
                    RecruitTimer2 = create timer for 180 * RecruitModifier seconds
                    enable platoon LC4_Platoon[14] respond to town NorseTown1 attack
                    run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[14],1)

                elsif LC4_Platoon[15] not exists and PLAYER of NorseTown1 == 1 and get RecruitTimer2 time remaining <= 0 and not town NorseTown1 is under takeover from player 0
                    LC4_Platoon[15] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseTown1 platoon of size 15 * RecruitSizeModifier
                    RecruitTimer2 = create timer for 180 * RecruitModifier seconds
                    enable platoon LC4_Platoon[15] respond to town NorseTown1 attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[5],Melee,LC4_Platoon[15],NorseTown1)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[15],1)

                elsif LC4_Platoon[16] not exists and PLAYER of NorseTown1 == 1 and get RecruitTimer2 time remaining <= 0 and not town NorseTown1 is under takeover from player 0
                    LC4_Platoon[16] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseTown1 platoon of size 15 * RecruitSizeModifier
                    RecruitTimer2 = create timer for 120 * RecruitModifier seconds
                    enable platoon LC4_Platoon[16] respond to town NorseTown1 attack
                    run background script LC4_StaticPlatoonsActions(PlatoonPos[6],Melee,LC4_Platoon[16],NorseTown1)
                    run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[16],1)

                end if
            end if
        end if

        //Generic Town production
        //Dynamically build a few armories and minimum needed buildings for all towns + platoon recruitment for minor towns
        if get GenericTownBuildingInitialTimer time remaining <= 0
            GenericTown = get town with id GenericTownCounter
            if GenericTown exists
                if PLAYER of GenericTown == 1
                    if PlayerAlignmentFinal < 0.0
                        //Buildings
                        if get GenericTownBuildingTimer time remaining <= 0
                            if get number of type HOUSE ABODE_NUMBER_STORAGE_PIT in GenericTown min built 0.0 < 1
                                run background script AGB_BuildBuilding(GenericTown,AGB_STORAGEPIT,AGB_NORSE)

                            elsif get number of type HOUSE ABODE_NUMBER_MELEE_ARMOURY in GenericTown min built 0.0 < 2
                                run background script AGB_BuildBuilding(GenericTown,AGB_ARMORYMELEE,AGB_NORSE)

                            elsif get number of type HOUSE ABODE_NUMBER_RANGED_ARMOURY in GenericTown min built 0.0 < 2
                                run background script AGB_BuildBuilding(GenericTown,AGB_ARMORYRANGED,AGB_NORSE)

                            elsif adult capacity of GenericTown < 60
                                run background script AGB_BuildBuilding(GenericTown,AGB_HOUSE,AGB_NORSE)

                            end if
                            GenericTownBuildingTimer = create timer for 75 * BuilderModifier seconds
                        end if

                        //Platoons
                        if GenericTown != NorseCapital and GenericTown != NorseTown1
                            if get GenericTownPlatoonTimer time remaining <= 0
                                if get army size in town GenericTown < 30 * RecruitModifier
                                    Number = number from 1 to 3
                                    if Number == 1 or Number == 2
                                        AnotherPlatoon = recruit ARMY_UNIT_TYPE_MELEE_1 town GenericTown platoon of size 20 * RecruitSizeModifier
                                        enable platoon AnotherPlatoon respond to town GenericTown attack
                                        run background script LC4_StaticPlatoonsActions(marker at {GenericTown} + {number from -50 to 50,number from -50 to 50},Melee,AnotherPlatoon,GenericTown)
                                        run background script PT_CreateBasicNorsePlatoon(AnotherPlatoon,1)
                                    else
                                        AnotherPlatoon = recruit ARMY_UNIT_TYPE_RANGED_1 town GenericTown platoon of size 20 * RecruitSizeModifier
                                        enable platoon AnotherPlatoon respond to town GenericTown attack
                                        run background script LC4_StaticPlatoonsActions(marker at {GenericTown} + {number from -50 to 50,number from -50 to 50},Melee,AnotherPlatoon,GenericTown)
                                        run background script PT_CreateBasicNorsePlatoon(AnotherPlatoon,1)
                                    end if
                                    GenericTownPlatoonTimer = create timer for 240 * RecruitModifier seconds
                                end if
                            end if
                        end if

                    elsif PlayerAlignmentFinal >= 0.0
                        //Buildings
                        if get GenericTownBuildingTimer time remaining <= 0
                            if get number of type HOUSE ABODE_NUMBER_STORAGE_PIT in GenericTown min built 0.0 < 1
                                run background script AGB_BuildBuilding(GenericTown,AGB_STORAGEPIT,AGB_NORSE)

                            elsif get number of type HOUSE ABODE_NUMBER_TEMPLE in GenericTown min built 0.0 < 1
                                run background script AGB_BuildBuilding(GenericTown,AGB_ARMORYRANGED,AGB_NORSE)

                            elsif get number of type HOUSE ABODE_NUMBER_MELEE_ARMOURY in GenericTown min built 0.0 < 1
                                run background script AGB_BuildBuilding(GenericTown,AGB_ARMORYMELEE,AGB_NORSE)

                            elsif get number of type HOUSE ABODE_NUMBER_RANGED_ARMOURY in GenericTown min built 0.0 < 1
                                run background script AGB_BuildBuilding(GenericTown,AGB_ARMORYRANGED,AGB_NORSE)

                            elsif adult capacity of GenericTown < 100
                                run background script AGB_BuildBuilding(GenericTown,AGB_HOUSE,AGB_NORSE)

                            end if
                            GenericTownBuildingTimer = create timer for 75 * BuilderModifier seconds
                        end if

                        //Platoons
                        if GenericTown != NorseCapital and GenericTown != NorseTown1
                            if get GenericTownPlatoonTimer time remaining <= 0
                                if get army size in town GenericTown < 30 * RecruitModifier
                                    Number = number from 1 to 3
                                    if Number == 1 or Number == 2
                                        AnotherPlatoon = recruit ARMY_UNIT_TYPE_MELEE_1 town GenericTown platoon of size 20 * RecruitSizeModifier
                                        enable platoon AnotherPlatoon respond to town GenericTown attack
                                        run background script LC4_StaticPlatoonsActions(marker at {GenericTown} + {number from -50 to 50,number from -50 to 50},Melee,AnotherPlatoon,GenericTown)
                                        run background script PT_CreateBasicNorsePlatoon(AnotherPlatoon,1)
                                    else
                                        AnotherPlatoon = recruit ARMY_UNIT_TYPE_RANGED_1 town GenericTown platoon of size 20 * RecruitSizeModifier
                                        enable platoon AnotherPlatoon respond to town GenericTown attack
                                        run background script LC4_StaticPlatoonsActions(marker at {GenericTown} + {number from -50 to 50,number from -50 to 50},Melee,AnotherPlatoon,GenericTown)
                                        run background script PT_CreateBasicNorsePlatoon(AnotherPlatoon,1)
                                    end if
                                    GenericTownPlatoonTimer = create timer for 480 * RecruitModifier seconds
                                end if
                            end if
                        end if
                    end if
                end if
            end if
            GenericTownCounter = number from 0 to 16
        end if

        //Town building depending on alignment
        if PLAYER of NorseCapital == 1
            if PlayerAlignmentFinal >= 0.0
                if AlignmentTownBuildingPhase == 0 and get AlignmentTownBuildingTimer1 time remaining <= 0
                    AlignmentTownBuildingPhase = 1
                    build all town NorseCapital buildings in group 20

                elsif AlignmentTownBuildingPhase == 1 and get AlignmentTownBuildingTimer2 time remaining <= 0
                    AlignmentTownBuildingPhase = 2
                    build all town NorseCapital buildings in group 21

                elsif AlignmentTownBuildingPhase == 2 and get AlignmentTownBuildingTimer3 time remaining <= 0
                    AlignmentTownBuildingPhase = 3
                    build all town NorseCapital buildings in group 22

                elsif AlignmentTownBuildingPhase == 3 and get AlignmentTownBuildingTimer4 time remaining <= 0
                    AlignmentTownBuildingPhase = 4
                    build all town NorseCapital buildings in group 23

                elsif AlignmentTownBuildingPhase == 4 and get AlignmentTownBuildingTimer5 time remaining <= 0
                    AlignmentTownBuildingPhase = 5
                    build all town NorseCapital buildings in group 24

                end if
            elsif PlayerAlignmentFinal < 0.0
                if AlignmentTownBuildingPhase == 0 and get AlignmentTownBuildingTimer1 time remaining <= 0
                    AlignmentTownBuildingPhase = 1
                    build all town NorseCapital buildings in group 30

                elsif AlignmentTownBuildingPhase == 1 and get AlignmentTownBuildingTimer2 time remaining <= 0
                    AlignmentTownBuildingPhase = 2
                    build all town NorseCapital buildings in group 31

                elsif AlignmentTownBuildingPhase == 2 and get AlignmentTownBuildingTimer3 time remaining <= 0
                    AlignmentTownBuildingPhase = 3
                    build all town NorseCapital buildings in group 32

                elsif AlignmentTownBuildingPhase == 3 and get AlignmentTownBuildingTimer4 time remaining <= 0
                    AlignmentTownBuildingPhase = 4
                    build all town NorseCapital buildings in group 33

                elsif AlignmentTownBuildingPhase == 4 and get AlignmentTownBuildingTimer5 time remaining <= 0
                    AlignmentTownBuildingPhase = 5
                    build all town NorseCapital buildings in group 34

                end if
            end if
        end if

        //Build volcano, trigger a large attack after timer if hard mode
        if HardMode == 1
            if VolcanoBuilt == 0
                VolcanoBuilt = 1
                build all town NorseCapital buildings in group 11
                run background script LC4_VolcanoResourceManager
            end if
            //Trigger Attack
            if get HardModeAttackTimer time remaining <= 0
                HardModeAttackTimer = create timer for 1350 * RecruitModifier seconds
                if LC4_Platoon[19] not exists and PLAYER of NorseCapital == 1
                    wait number from 2 to 4 seconds
                    LC4_Platoon[19] = recruit ARMY_UNIT_TYPE_MELEE_3 town NorseCapital platoon of size 45 * RecruitSizeModifier
                    run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[19],1)
                    wait until not LC4_Platoon[19] recruiting
                    AttackingPosition = marker at {AttackPos[2]} + {30,30}
                    AttackingPositionFallBack = marker at {AttackPos[3]} + {30,30}
                    run script PlatoonTargetingMetric(45 * RecruitSizeModifier,PlayerTown)
                    run background script LC4_ArmyBehaivours(LC4_Platoon[19],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Aggressive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                end if

                if LC4_Platoon[20] not exists and PLAYER of NorseCapital == 1
                    wait number from 2 to 4 seconds
                    LC4_Platoon[20] = recruit ARMY_UNIT_TYPE_RANGED_3 town NorseCapital platoon of size 45 * RecruitSizeModifier
                    run background script PT_CreateArtyNorsePlatoonRanged(LC4_Platoon[20],1)
                    wait until not LC4_Platoon[20] recruiting
                    AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                    AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                    run script PlatoonTargetingMetric(45 * RecruitSizeModifier,PlayerTown)
                    run background script LC4_ArmyBehaivours(LC4_Platoon[19],Ranged,Attacker,0,PlatoonTargetingMetricFocusResult,Aggressive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
                end if

                if LC4_SiegeCatapult[2] not exists and PLAYER of NorseCapital == 1
                    wait number from 1 to 3 seconds
                    LC4_SiegeCatapult[2] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_3 town NorseCapital siege weapon
                    disable siege weapon LC4_SiegeCatapult[2] auto attack
                    AttackingPosition = marker at {AttackPos[2]} + {30,30}
                    AttackingPositionFallBack = marker at {AttackPos[3]} + {30,30}
                    run script CatapultTargetingMetric(PlayerTown)
                    run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[2],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                end if

                if LC4_SiegeCatapult[3] not exists and PLAYER of NorseCapital == 1
                    wait number from 1 to 3 seconds
                    LC4_SiegeCatapult[3] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_3 town NorseCapital siege weapon
                    disable siege weapon LC4_SiegeCatapult[3] auto attack
                    AttackingPosition = marker at {AttackPos[2]} + {-30,-30}
                    AttackingPositionFallBack = marker at {AttackPos[3]} + {-30,-30}
                    run script CatapultTargetingMetric(PlayerTown)
                    run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[3],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                end if

                if LC4_SiegeCatapult[4] not exists and PLAYER of NorseCapital == 1
                    wait number from 1 to 3 seconds
                    LC4_SiegeCatapult[4] = recruit SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_3 town NorseCapital siege weapon
                    disable siege weapon LC4_SiegeCatapult[4] auto attack
                    AttackingPosition = marker at {AttackPos[2]}
                    AttackingPositionFallBack = marker at {AttackPos[3]}
                    run script CatapultTargetingMetric(PlayerTown)
                    run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[4],Attacker,CatapultTargetingMetricFocusResult,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],AttackingPosition,AttackingPositionFallBack)
                end if
            end if

            if get VolcanoTimer time remaining <= 300 and HEALTH of AIVolcano >= 1.0 and CHARGE of AIVolcano != 1.0 and PLAYER of NorseCapital == 1
                CHARGE of AIVolcano = 1.0
            end if

            if HEALTH of AIVolcano >= 1.0 and get VolcanoTimer time remaining <= 0 and PLAYER of NorseCapital == 1 and not town PlayerTown is under takeover from player 1 and PLAYER of PlayerTown == 0
                if TownsConverted >= 4 or size of PlayerTown > 225 or PLAYER of NorseTown1 == 0

                    WT_SkyTransitionAllowed = 0
                    enable predefined sky "VOLCANO" time 9
                    VolcanoFired = 1

                    run script EpicTargeter(PlayerTown,marker at {PlayerTown},0,4,1)
                        
                    VolcanoWarning = create visual effect VISUAL_EFFECT_EPIC_TARGET_WARNING at {ET_FireEpicLocation} time 15 target {ET_FireEpicLocation}
                    wait 15 seconds
                    EpicVolc = create volcano at {ET_FireEpicLocation} player 1
                        
                    run background script LC4_Volcano(AIVolcano, EpicVolc)

                    VolcanoTimer = create timer for VOLCANODELAY * EpicModifier seconds
                    VOLCANODELAY += 500
                end if
            end if
        end if

        if PLAYER of NorseTown1 == 0 or PLAYER of NorseCapital == 0 or get ConquerorTimer time remaining <= 0
            //Use platoons for settlements or minor towns
            if AttackingPlatoons == 0 and NearestSettlement != 0
                ConquerorResetTimer = create timer for 3000 seconds
                AttackingPlatoons = 1
            end if
        end if

        if AttackingPlatoons == 1 and get ConquerorResetTimer time remaining <= 0
            //Use platoons for PlayerTown
            ConquerorTimer = create timer for 2400 * RecruitModifier seconds
            AttackingPlatoons = 0
        end if
        
        if L4BuildWallComplete == 1 and ScriptAttackerSent == 0
            ScriptAttackerSent = 1
            LC4_Platoon[12] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 20 * RecruitSizeModifier
            run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[12],1)
            wait until not LC4_Platoon[12] recruiting
            AttackingPosition = marker at {AttackPos[2]}
            AttackingPositionFallBack = marker at {AttackPos[3]}
            run script PlatoonTargetingMetric(20 * RecruitSizeModifier,PlayerTown)
            run background script LC4_ArmyBehaivours(LC4_Platoon[12],Melee,Attacker,0,PlatoonTargetingMetricFocusResult,Passive,AttackingPosition,AttackingPositionFallBack,AttackPosBack[0],AttackPosBack[1],AttackPosBack[2],0,0,0)
        end if
        
        if TownsConverted >= 2 or TownsAggressiveConverted >= 1
            if NorseTownScriptStarted == 0
                HardModeAttackTimer = create timer for 300 seconds
                NorseTownScriptStarted = 1
                LC4_Platoon[14] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size 25 * RecruitSizeModifier
                run background script PT_CreateChargerNorsePlatoon(LC4_Platoon[14],1)
                enable platoon LC4_Platoon[14] respond to town NorseCapital attack
                wait until not LC4_Platoon[14] recruiting
            end if
        end if
    
    end loop
    
end script LC4_Norse_Capital

begin script LC4_VolcanoResourceManager

    Angle = 0
    Pos = 0
    Counter = 0
    Tree = 0

start

begin loop
    AIVolcano = get SCRIPT_OBJECT_TYPE_WONDER EPIC_WONDER_NUMBER_VOLCANO at {1218.12,301.75,1875.03} radius 150
    
until AIVolcano exists
end loop

disable AIVolcano hurt by fire

begin loop
    
    while Counter < 100 and not {AIVolcano} viewed
        add resource ORE number from 50 to 60 to AIVolcano
        add resource WOOD number from 100 to 110 to AIVolcano
        
        wait number from 2 to 6 seconds
        
        Counter++
    end while
    
    until Counter == 100
end loop

wait until HEALTH of AIVolcano >= 1.0

//Rebuild the epic
begin loop
    wait until HEALTH of AIVolcano < 1.0 and HEALTH of AIVolcano > 0.8
    wait 600 seconds
    if HEALTH of AIVolcano < 1.0 and HEALTH of AIVolcano > 0.8
        wait until get distance from camera position to {AIVolcano} > 300 and not {AIVolcano} viewed
        Angle = ANGLE of AIVolcano
        Pos = marker at {AIVolcano}
        delete AIVolcano
        AIVolcano = create WONDER EPIC_WONDER_NUMBER_VOLCANO at {Pos}
        ANGLE of AIVolcano = Angle
        PLAYER of AIVolcano = 1
        attach AIVolcano to NorseCapital
        BUILT of AIVolcano = 0.75
        disable AIVolcano hurt by fire
        wait until HEALTH of AIVolcano == 1.0
    end if
end loop

end script LC4_VolcanoResourceManager

begin script LC4_DefendPlatoons

    PlayerPlatoon = 0
    DefendRecruitTimer1 = create timer for 0 seconds
    DefendRecruitTimer2 = create timer for 0 seconds

start

begin loop

    PlayerPlatoon = get platoon of player 0 nearest {NorseCapital} radius 300
    if PlayerPlatoon exists and LC4_Platoon[8] not exists and LC4_Platoon[9] not exists and get DefendRecruitTimer1 time remaining == 0 and PLAYER of NorseCapital == 1
        DefendRecruitTimer1 = create timer for 300 * RecruitModifier seconds
        LC4_Platoon[8] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size number from 12 to 12 * RecruitSizeModifier
        run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[8],1)
        enable platoon LC4_Platoon[8] respond to town NorseCapital attack
        wait until not LC4_Platoon[8] recruiting
            
        LC4_Platoon[9] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseCapital platoon of size number from 12 to 12 * RecruitSizeModifier
        run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[9],1)
        enable platoon LC4_Platoon[9] respond to town NorseCapital attack
        wait until not LC4_Platoon[9] recruiting
    end if
        
    PlayerPlatoon = get platoon of player 0 nearest {NorseTown1} radius 300
    if PlayerPlatoon exists and LC4_Platoon[10] not exists and LC4_Platoon[11] not exists and get DefendRecruitTimer2 time remaining == 0 and PLAYER of NorseTown1 == 1
        DefendRecruitTimer2 = create timer for 300 * RecruitModifier seconds
        LC4_Platoon[10] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseTown1 platoon of size 10 * RecruitSizeModifier
        run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[10],1)
        enable platoon LC4_Platoon[10] respond to town NorseTown1 attack
        wait until not LC4_Platoon[10] recruiting
            
        LC4_Platoon[11] = recruit ARMY_UNIT_TYPE_MELEE_1 town NorseTown1 platoon of size 10 * RecruitSizeModifier
        run background script PT_CreateHeavyNorsePlatoon(LC4_Platoon[11],1)
        enable platoon LC4_Platoon[11] respond to town NorseTown1 attack
        wait until not LC4_Platoon[11] recruiting
    end if

end loop

end script LC4_DefendPlatoons

begin script LC4_GetNearestSettlement

    NearestTown = 0

start

begin loop
    if PLAYER of NorseCapital != 1
        NearestTown = NorseCapital

    elsif PLAYER of NorseTown1 != 1
        NearestTown = NorseTown1

    elsif PLAYER of NorseCapital == 1 and PLAYER of NorseTown1 == 1
        begin loop
            NearestTown = get town with id number from 0 to 15
            if NearestTown exists
                if variable get town NearestTown status == variable TOWN_STATUS_MIGRATION_STARTED
                    NearestTown = 0
                end if
            end if
            until PLAYER of NearestTown != 1 and NearestTown exists
        end loop
    end if
    if NearestTown exists
        NearestSettlement = NearestTown
        wait until PLAYER of NearestSettlement == 1 or NearestSettlement not exists or 1200 seconds
    end if
end loop

end script LC4_GetNearestSettlement

begin script LC4_ResourceManagerNorseCapital

start

begin loop

    wait 5 seconds //To evade the sound bug if storage is burning...
    wait until get distance from camera position to {NorseCapital} > 300

    if PLAYER of NorseCapital == 1
        if (get town NorseCapital RESOURCE_TYPE_ORE total < 10297)
            add resource RESOURCE_TYPE_ORE number from 100 to 500 to NorseCapital
        elsif (get town NorseCapital RESOURCE_TYPE_WOOD total < 16322)
            add resource RESOURCE_TYPE_WOOD number from 500 to 1000 to NorseCapital
        elsif (get town NorseCapital RESOURCE_TYPE_FOOD total < 17624)
            add resource RESOURCE_TYPE_FOOD number from 500 to 1500 to NorseCapital
        end if
    end if
    
    until PLAYER of NorseCapital != 1
end loop    

end script LC4_ResourceManagerNorseCapital

begin script LC4_VillagerManagerNorseCapital

    Counter = 0
    Villager = 0
    HousesBuilt = 0

start

begin loop

    wait 1450 * BuilderModifier seconds
    Counter = 0

    if PLAYER of NorseCapital == 1
        if HousesBuilt == 0
            HousesBuilt = 1
            build all town NorseCapital buildings in group 10
        end if
        begin loop
            wait until get distance from camera position to {NorseCapital} > 300
            Villager = create random villager of tribe TRIBE_TYPE_NORSE at {NorseCapital} + {number from -12 to 12, 0, number from -12 to 12}//create VILLAGER VILLAGER_INFO_JAPANESE_FORESTER_MALE at {1013.581, 132.333, 2002.798} + {number from -3 to 3, 0, number from -3 to 3}
            attach Villager to NorseCapital
            release Villager
            
            wait number from 6 to 10 seconds
            Counter++
            until Counter >= 30 or PLAYER of NorseCapital != 1 or size of NorseCapital >= 200
        end loop
    end if

end loop

end script LC4_VillagerManagerNorseCapital

begin script LC4_VillagerManagerNorseTown

    Counter = 0
    Villager = 0
    HousesBuilt = 0

start

begin loop

    wait 1450 * BuilderModifier seconds
    Counter = 0

    if PLAYER of NorseTown1 == 1
        if HousesBuilt == 0
            HousesBuilt = 1
            build all town NorseTown1 buildings in group 10
        end if
        begin loop
            wait until get distance from camera position to {NorseTown1} > 300
            Villager = create random villager of tribe TRIBE_TYPE_NORSE at {NorseTown1} + {number from -12 to 12, 0, number from -12 to 12}//create VILLAGER VILLAGER_INFO_JAPANESE_FORESTER_MALE at {1013.581, 132.333, 2002.798} + {number from -3 to 3, 0, number from -3 to 3}
            attach Villager to NorseTown1
            release Villager
            
            wait number from 6 to 10 seconds
            Counter++
            until Counter >= 20 or PLAYER of NorseTown1 != 1 or size of NorseTown1 >= 90
        end loop
    end if

end loop

end script LC4_VillagerManagerNorseTown

begin script LC4_ResourceManagerNorseTown

    Counter = 0

start

begin loop

    wait 5 seconds //To evade the sound bug if storage is burning...
    wait until get distance from camera position to {NorseTown1} > 300

    if PLAYER of NorseTown1 == 1
        if (get town NorseTown1 RESOURCE_TYPE_ORE total < 10495)
            add resource RESOURCE_TYPE_ORE number from 100 to 500 to NorseTown1
        elsif (get town NorseTown1 RESOURCE_TYPE_WOOD total < 13267)
            add resource RESOURCE_TYPE_WOOD number from 500 to 1000 to NorseTown1
        elsif (get town NorseTown1 RESOURCE_TYPE_FOOD total < 10495)
            add resource RESOURCE_TYPE_FOOD number from 500 to 1500 to NorseTown1
        end if
    end if
    
    until PLAYER of NorseTown1 != 1
end loop    

end script LC4_ResourceManagerNorseTown

begin script LC4_NorseScript1

    AttackingPosition = marker at {AttackPos[0]}
    AttackingPositionFallBack = marker at {AttackPos[1]}
    AtmosMixer = create mixer

start

    wait until TownsConverted >= 3 or TownsAggressiveConverted >= 1

    wait 30 seconds

    wait until dialogue ready and camera ready

    DM_DynamicMusicDisallowed = 1
    begin cinema
        store camera details
        set fade red 0 green 0 blue 0 time 2
        disable atmos sound
        //set atmos volume 0
        set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_MAP to 0.45
        set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_POSITIONAL to 0.45
        wait 4 seconds
        ScriptedAttackStart = 1

        LC4_Platoon[13] = create platoon PLATOON_INFO_NORSE_MELEE_2 at {846.69,160.38,1135.10} with 25 * RecruitSizeModifier men and 0 women
        attach LC4_Platoon[13] to NorseCapital
        PLAYER of LC4_Platoon[13] = 1
        run background script PT_CreateBasicNorsePlatoon(LC4_Platoon[13],1)
            
        LC4_SiegeCatapult[0] = create siege weapon SIEGE_BALANCE_TYPE_CATAPULT_LEVEL_2 belonging to NorseCapital at {846.69,160.38,1135.10}
        attach LC4_SiegeCatapult[0] to NorseCapital
        PLAYER of LC4_SiegeCatapult[0] = 1

        AttackingPosition = marker at {AttackPos[0]}
        AttackingPositionFallBack = marker at {AttackPos[1]}
        run script PlatoonTargetingMetric(25 * RecruitSizeModifier,PlayerTown)
        run background script LC4_ArmyBehaivours(LC4_Platoon[13],Melee,Attacker,LC4_SiegeCatapult[0],PlatoonTargetingMetricFocusResult,Neutral,AttackingPosition,AttackingPositionFallBack,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],0,0,0)
        run script CatapultTargetingMetric(PlayerTown)
        run background script LC4_MoveCatapultThenAttack(LC4_SiegeCatapult[0],Attacker,CatapultTargetingMetricFocusResult,AttackPosFront[0],AttackPosFront[1],AttackPosFront[2],AttackingPosition,AttackingPositionFallBack)

        set game time 23.00
        start music "norsemarchingmedium_01"
        set LC4_EnemyCreature position to {846.69,160.38,1135.10}
        ENEMY_CREATURE_ALLOWED_TO_ATTACK = 1
        set camera position to {893.21,172.00,1109.34}
        set camera focus to {855.93,164.38,1129.95}
        set fade in time 2
        wait 8 seconds
        set camera position to {862.05,169.00,1095.03}
        set camera focus to {892.06,165.00,1103.72}
        wait 7 seconds
        set fade red 0 green 0 blue 0 time 2
        wait 2 seconds
        restore camera details
        enable atmos sound
        //set atmos volume 0.45
        set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_MAP to 0.45
        set mixer AtmosMixer channel AUDIO_MIXER_CHANNEL_ATMOS_POSITIONAL to 0.45
        set fade in time 4
    end cinema
    wait 20 seconds
    ScriptedAttackStart = 2
    stop music with fadetime 5
    DM_DynamicMusicDisallowed = 0

end script LC4_NorseScript1

begin script DisableLocalPlatoonResponse

    Counter = 0

start

begin loop
    if Counter > 99
        Counter = 0
        wait 30 seconds
    end if
    if LC4_Platoon[Counter] exists
        disable platoon LC4_Platoon[Counter] respond to local platoon attack
    end if
    if LC4_WallArcher[Counter] exists
        disable platoon LC4_WallArcher[Counter] respond to local platoon attack
    end if
    Counter++
end loop

end script DisableLocalPlatoonResponse