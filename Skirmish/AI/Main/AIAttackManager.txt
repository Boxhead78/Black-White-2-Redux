///////////////////////////////////////////////////////////////////////////////
//        Skirmish AI Attack Manager
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//-----------------------------------------------------------------------------
//    Globals
//-----------------------------------------------------------------------------

//Army Types
define Melee = 0
define Ranged = 1
define Random = 2
//Army Behaivours
define Attacker = 0
define Escort = 1
define Conqueror = 2 //Nearest Settlement Attacker
define Patrol = 3
define Special = 4
//Attack Focus
define Default = 0 //Balanced attack strategy
define Houses = 1 //Attack Houses
define Epics = 2 //Attack Epics
define Altars = 3 //Attack Altars
define CreaturePen = 4 //Attack CreaturePen
define TownCenter = 5 //Attack Town
define Villagers = 6 //Attack Villagers NOT WORKING, PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA
//Aggressiveness
define Passive = 0 //Try to do objectives, only defend yourself
define Neutral = 1 //0.75 Search radius for enemy troops, and much less likely to give up objectives
define Alerted = 2 //1.0 Search radius for enemy troops, and less likely to give up objectives
define Aggressive = 3 //2.0 Search radius for enemy troops, and will always give up objectives for enemy troops

define CHANCE_TO_SPLIT = 40
define CHANCE_TO_MERGE = 20

define PlatoonWaitTime = 30 //Wait for other Platoons

define script SK_ChooseEnemy(PlayerID,EnemyID)
define script SK_AttackLogic(PlayerID)
define script SK_ArmyBehaivours(PlayerID,Platoon,Type,Task,AttackFocus,Aggressiveness,AttackImmediately,Waypoint1,Waypoint2,Waypoint3,Waypoint4,AICapital,DisableMerge,DisableSplit)
define script SK_SiegeWeaponBehaivours(PlayerID,SiegeWeapon,AttackFocus,AttackImmediately,Waypoint1,Waypoint2,Waypoint3,Waypoint4,AICapital)
define script SK_ArmyTimers(PlayerID)
define script PlatoonTargetingMetric(PlayerID,PlatoonSize,TargetTown,EnemyPlayer)
define script CatapultTargetingMetric(PlayerID,TargetTown,EnemyPlayer)

global AttackPathCenterPlayer1[4]
global AttackPathFlankPlayer1[4]
global AttackPathBackdoorPlayer1[4]
global AttackPathCenterPlayer2[4]
global AttackPathFlankPlayer2[4]
global AttackPathBackdoorPlayer2[4]
global AttackPathCenterPlayer3[4]
global AttackPathFlankPlayer3[4]
global AttackPathBackdoorPlayer3[4]
global EnemyIDFinal[SK_MaxPlayers]

global PlatoonMoveTimer1[SK_MaxPlayers]
global PlatoonMoveTimer2[SK_MaxPlayers]
global PlatoonMoveTimer3[SK_MaxPlayers]
global PlatoonMoveTimer4[SK_MaxPlayers]
global PlatoonWaitTimer[SK_MaxPlayers]
global ReadyToAttack[SK_MaxPlayers]

global script1[SK_MaxPlayers]
global script2[SK_MaxPlayers]
global script3[SK_MaxPlayers]
global script4[SK_MaxPlayers]
global script5[SK_MaxPlayers]
global script6[SK_MaxPlayers]

global PlatoonTargetingMetricFocusResult[SK_MaxPlayers]
global CatapultTargetingMetricFocusResult[SK_MaxPlayers]

//-----------------------------------------------------------------------------

//Choose random neighbor player
begin script SK_ChooseEnemy(PlayerID,EnemyID)

    AbortLoop = 0
    EnemySet = 0
    EnemySuccessful = 0
    Number = 0
    NumberOfTowns = 0
    Timer = create timer for number from 900 to 1800 seconds

start

run background script SK_ArmyTimers(PlayerID)

begin loop

    //say "Get Enemy"
    if EnemyID == 4
        EnemyID = 0
    end if

    if PlayerID == 1 and EnemyID == 3
        NumberOfTowns = get player 0 town total
        if NumberOfTowns == 0
            NumberOfTowns = get player 2 town total
            if NumberOfTowns == 0
                //Neighbors are dead, so set enemy
                EnemySet = 1
            else
                run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
                AbortLoop = 1
            end if
        else
            run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
            AbortLoop = 1
        end if

    elsif PlayerID == 2 and EnemyID == 0
        NumberOfTowns = get player 1 town total
        if NumberOfTowns == 0
            NumberOfTowns = get player 3 town total
            if NumberOfTowns == 0
                //Neighbors are dead, so set enemy
                EnemySet = 1
            else
                run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
                AbortLoop = 1
            end if
        else
            run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
            AbortLoop = 1
        end if

    elsif PlayerID == 3 and EnemyID == 1
        NumberOfTowns = get player 0 town total
        if NumberOfTowns == 0
            NumberOfTowns = get player 2 town total
            if NumberOfTowns == 0
                //Neighbors are dead, so set enemy
                EnemySet = 1
            else
                run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
                AbortLoop = 1
            end if
        else
            run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
            AbortLoop = 1
        end if
    end if

    if EnemySet == 0 and AbortLoop == 0
        NumberOfTowns = get player EnemyID town total
        if PlayerID == EnemyID
            run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
            AbortLoop = 1

        elsif NumberOfTowns == 0
            run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
            AbortLoop = 1

        end if
    end if

    if AbortLoop == 0
        wait 2.5 seconds
        //say "EnemyID = $d" with number EnemyID
        SK_EnemyID[PlayerID] = EnemyID

        //Set Attack Paths
        //Confusing code ahead. It sets attack paths for players with Id 1 to 3.
        //Look into Land**Waypoints.txt for the waypoints
        //2 Player Maps
        if SK_PlayerAmount == 1
            if PlayerID == 1
                if EnemyID == 0
                    //Center
                    AttackPathCenterPlayer1[0] = Center1[3]
                    AttackPathCenterPlayer1[1] = Center1[2]
                    AttackPathCenterPlayer1[2] = Center1[1]
                    AttackPathCenterPlayer1[3] = Center1[0]
                    //Flank
                    AttackPathFlankPlayer1[0] = Flank1[3]
                    AttackPathFlankPlayer1[1] = Flank1[2]
                    AttackPathFlankPlayer1[2] = Flank1[1]
                    AttackPathFlankPlayer1[3] = Flank1[0]
                    //Backdoor
                    AttackPathBackdoorPlayer1[0] = Backdoor1[3]
                    AttackPathBackdoorPlayer1[1] = Backdoor1[2]
                    AttackPathBackdoorPlayer1[2] = Backdoor1[1]
                    AttackPathBackdoorPlayer1[3] = Backdoor1[0]

                end if
            end if
        end if
        //3 Player Maps
        if SK_PlayerAmount == 2
            if PlayerID == 1
                if EnemyID == 0
                    //Center
                    AttackPathCenterPlayer1[0] = Center1[3]
                    AttackPathCenterPlayer1[1] = Center1[2]
                    AttackPathCenterPlayer1[2] = Center1[1]
                    AttackPathCenterPlayer1[3] = Center1[0]
                    //Flank
                    AttackPathFlankPlayer1[0] = Flank1[3]
                    AttackPathFlankPlayer1[1] = Flank1[2]
                    AttackPathFlankPlayer1[2] = Flank1[1]
                    AttackPathFlankPlayer1[3] = Flank1[0]
                    //Backdoor
                    AttackPathBackdoorPlayer1[0] = Backdoor1[3]
                    AttackPathBackdoorPlayer1[1] = Backdoor1[2]
                    AttackPathBackdoorPlayer1[2] = Backdoor1[1]
                    AttackPathBackdoorPlayer1[3] = Backdoor1[0]

                elsif EnemyID == 2
                    //Center
                    AttackPathCenterPlayer1[0] = Center2[0]
                    AttackPathCenterPlayer1[1] = Center2[1]
                    AttackPathCenterPlayer1[2] = Center2[2]
                    AttackPathCenterPlayer1[3] = Center2[3]
                    //Flank
                    AttackPathFlankPlayer1[0] = Flank2[0]
                    AttackPathFlankPlayer1[1] = Flank2[1]
                    AttackPathFlankPlayer1[2] = Flank2[2]
                    AttackPathFlankPlayer1[3] = Flank2[3]
                    //Backdoor
                    AttackPathBackdoorPlayer1[0] = Backdoor2[0]
                    AttackPathBackdoorPlayer1[1] = Backdoor2[1]
                    AttackPathBackdoorPlayer1[2] = Backdoor2[2]
                    AttackPathBackdoorPlayer1[3] = Backdoor2[3]

                end if

            elsif PlayerID == 2
                if EnemyID == 0
                    //Center
                    AttackPathCenterPlayer2[0] = Center3[0]
                    AttackPathCenterPlayer2[1] = Center3[1]
                    AttackPathCenterPlayer2[2] = Center3[2]
                    AttackPathCenterPlayer2[3] = Center3[3]
                    //Flank
                    AttackPathFlankPlayer2[0] = Flank3[0]
                    AttackPathFlankPlayer2[1] = Flank3[1]
                    AttackPathFlankPlayer2[2] = Flank3[2]
                    AttackPathFlankPlayer2[3] = Flank3[3]
                    //Backdoor
                    AttackPathBackdoorPlayer2[0] = Backdoor3[0]
                    AttackPathBackdoorPlayer2[1] = Backdoor3[1]
                    AttackPathBackdoorPlayer2[2] = Backdoor3[2]
                    AttackPathBackdoorPlayer2[3] = Backdoor3[3]
                    
                elsif EnemyID == 1
                    //Center
                    AttackPathCenterPlayer2[0] = Center2[3]
                    AttackPathCenterPlayer2[1] = Center2[2]
                    AttackPathCenterPlayer2[2] = Center2[1]
                    AttackPathCenterPlayer2[3] = Center2[0]
                    //Flank
                    AttackPathFlankPlayer2[0] = Flank2[3]
                    AttackPathFlankPlayer2[1] = Flank2[2]
                    AttackPathFlankPlayer2[2] = Flank2[1]
                    AttackPathFlankPlayer2[3] = Flank2[0]
                    //Backdoor
                    AttackPathBackdoorPlayer2[0] = Backdoor2[3]
                    AttackPathBackdoorPlayer2[1] = Backdoor2[2]
                    AttackPathBackdoorPlayer2[2] = Backdoor2[1]
                    AttackPathBackdoorPlayer2[3] = Backdoor2[0]
                    
                end if
            end if
        end if

        //4 Player Maps
        if SK_PlayerAmount == 3
            if PlayerID == 1
                if EnemyID == 0
                    //Center
                    AttackPathCenterPlayer1[0] = Center1[3]
                    AttackPathCenterPlayer1[1] = Center1[2]
                    AttackPathCenterPlayer1[2] = Center1[1]
                    AttackPathCenterPlayer1[3] = Center1[0]
                    //Flank
                    AttackPathFlankPlayer1[0] = Flank1[3]
                    AttackPathFlankPlayer1[1] = Flank1[2]
                    AttackPathFlankPlayer1[2] = Flank1[1]
                    AttackPathFlankPlayer1[3] = Flank1[0]
                    //Backdoor
                    AttackPathBackdoorPlayer1[0] = Backdoor1[3]
                    AttackPathBackdoorPlayer1[1] = Backdoor1[2]
                    AttackPathBackdoorPlayer1[2] = Backdoor1[1]
                    AttackPathBackdoorPlayer1[3] = Backdoor1[0]

                elsif EnemyID == 2
                    //Center
                    AttackPathCenterPlayer1[0] = Center2[0]
                    AttackPathCenterPlayer1[1] = Center2[1]
                    AttackPathCenterPlayer1[2] = Center2[2]
                    AttackPathCenterPlayer1[3] = Center2[3]
                    //Flank
                    AttackPathFlankPlayer1[0] = Flank2[0]
                    AttackPathFlankPlayer1[1] = Flank2[1]
                    AttackPathFlankPlayer1[2] = Flank2[2]
                    AttackPathFlankPlayer1[3] = Flank2[3]
                    //Backdoor
                    AttackPathBackdoorPlayer1[0] = Backdoor2[0]
                    AttackPathBackdoorPlayer1[1] = Backdoor2[1]
                    AttackPathBackdoorPlayer1[2] = Backdoor2[2]
                    AttackPathBackdoorPlayer1[3] = Backdoor2[3]

                elsif EnemyID == 3
                    Number = number from 1 to 2
                    if Number == 1
                        //Center
                        AttackPathCenterPlayer1[0] = Center4[3]
                        AttackPathCenterPlayer1[1] = Center4[2]
                        AttackPathCenterPlayer1[2] = Center4[1]
                        AttackPathCenterPlayer1[3] = Center4[0]
                        //Flank
                        AttackPathFlankPlayer1[0] = Flank4[3]
                        AttackPathFlankPlayer1[1] = Flank4[2]
                        AttackPathFlankPlayer1[2] = Flank4[1]
                        AttackPathFlankPlayer1[3] = Flank4[0]
                        //Backdoor
                        AttackPathBackdoorPlayer1[0] = Backdoor4[3]
                        AttackPathBackdoorPlayer1[1] = Backdoor4[2]
                        AttackPathBackdoorPlayer1[2] = Backdoor4[1]
                        AttackPathBackdoorPlayer1[3] = Backdoor4[0]

                    else
                        //Center
                        AttackPathCenterPlayer1[0] = Center3[0]
                        AttackPathCenterPlayer1[1] = Center3[1]
                        AttackPathCenterPlayer1[2] = Center3[2]
                        AttackPathCenterPlayer1[3] = Center3[3]
                        //Flank
                        AttackPathFlankPlayer1[0] = Flank3[0]
                        AttackPathFlankPlayer1[1] = Flank3[1]
                        AttackPathFlankPlayer1[2] = Flank3[2]
                        AttackPathFlankPlayer1[3] = Flank3[3]
                        //Backdoor
                        AttackPathBackdoorPlayer1[0] = Backdoor3[0]
                        AttackPathBackdoorPlayer1[1] = Backdoor3[1]
                        AttackPathBackdoorPlayer1[2] = Backdoor3[2]
                        AttackPathBackdoorPlayer1[3] = Backdoor3[3]

                    end if
                end if

            elsif PlayerID == 2
                if EnemyID == 0
                    Number = number from 1 to 2
                    if Number == 1
                        //Center
                        AttackPathCenterPlayer2[0] = Center4[0]
                        AttackPathCenterPlayer2[1] = Center4[1]
                        AttackPathCenterPlayer2[2] = Center4[2]
                        AttackPathCenterPlayer2[3] = Center4[3]
                        //Flank
                        AttackPathFlankPlayer2[0] = Flank4[0]
                        AttackPathFlankPlayer2[1] = Flank4[1]
                        AttackPathFlankPlayer2[2] = Flank4[2]
                        AttackPathFlankPlayer2[3] = Flank4[3]
                        //Backdoor
                        AttackPathBackdoorPlayer2[0] = Backdoor4[0]
                        AttackPathBackdoorPlayer2[1] = Backdoor4[1]
                        AttackPathBackdoorPlayer2[2] = Backdoor4[2]
                        AttackPathBackdoorPlayer2[3] = Backdoor4[3]

                    else
                        //Center
                        AttackPathCenterPlayer2[0] = Center1[3]
                        AttackPathCenterPlayer2[1] = Center1[2]
                        AttackPathCenterPlayer2[2] = Center1[1]
                        AttackPathCenterPlayer2[3] = Center1[0]
                        //Flank
                        AttackPathFlankPlayer2[0] = Flank1[3]
                        AttackPathFlankPlayer2[1] = Flank1[2]
                        AttackPathFlankPlayer2[2] = Flank1[1]
                        AttackPathFlankPlayer2[3] = Flank1[0]
                        //Backdoor
                        AttackPathBackdoorPlayer2[0] = Backdoor1[3]
                        AttackPathBackdoorPlayer2[1] = Backdoor1[2]
                        AttackPathBackdoorPlayer2[2] = Backdoor1[1]
                        AttackPathBackdoorPlayer2[3] = Backdoor1[0]

                    end if
                    
                elsif EnemyID == 1
                    //Center
                    AttackPathCenterPlayer2[0] = Center2[3]
                    AttackPathCenterPlayer2[1] = Center2[2]
                    AttackPathCenterPlayer2[2] = Center2[1]
                    AttackPathCenterPlayer2[3] = Center2[0]
                    //Flank
                    AttackPathFlankPlayer2[0] = Flank2[3]
                    AttackPathFlankPlayer2[1] = Flank2[2]
                    AttackPathFlankPlayer2[2] = Flank2[1]
                    AttackPathFlankPlayer2[3] = Flank2[0]
                    //Backdoor
                    AttackPathBackdoorPlayer2[0] = Backdoor2[3]
                    AttackPathBackdoorPlayer2[1] = Backdoor2[2]
                    AttackPathBackdoorPlayer2[2] = Backdoor2[1]
                    AttackPathBackdoorPlayer2[3] = Backdoor2[0]

                elsif EnemyID == 3
                    //Center
                    AttackPathCenterPlayer2[0] = Center3[0]
                    AttackPathCenterPlayer2[1] = Center3[1]
                    AttackPathCenterPlayer2[2] = Center3[2]
                    AttackPathCenterPlayer2[3] = Center3[3]
                    //Flank
                    AttackPathFlankPlayer2[0] = Flank3[0]
                    AttackPathFlankPlayer2[1] = Flank3[1]
                    AttackPathFlankPlayer2[2] = Flank3[2]
                    AttackPathFlankPlayer2[3] = Flank3[3]
                    //Backdoor
                    AttackPathBackdoorPlayer2[0] = Backdoor3[0]
                    AttackPathBackdoorPlayer2[1] = Backdoor3[1]
                    AttackPathBackdoorPlayer2[2] = Backdoor3[2]
                    AttackPathBackdoorPlayer2[3] = Backdoor3[3]

                end if

            elsif PlayerID == 3
                if EnemyID == 0
                    //Center
                    AttackPathCenterPlayer3[0] = Center4[0]
                    AttackPathCenterPlayer3[1] = Center4[1]
                    AttackPathCenterPlayer3[2] = Center4[2]
                    AttackPathCenterPlayer3[3] = Center4[3]
                    //Flank
                    AttackPathFlankPlayer3[0] = Flank4[0]
                    AttackPathFlankPlayer3[1] = Flank4[1]
                    AttackPathFlankPlayer3[2] = Flank4[2]
                    AttackPathFlankPlayer3[3] = Flank4[3]
                    //Backdoor
                    AttackPathBackdoorPlayer3[0] = Backdoor4[0]
                    AttackPathBackdoorPlayer3[1] = Backdoor4[1]
                    AttackPathBackdoorPlayer3[2] = Backdoor4[2]
                    AttackPathBackdoorPlayer3[3] = Backdoor4[3]
                    
                elsif EnemyID == 1
                    Number = number from 1 to 2
                    if Number == 1
                        //Center
                        AttackPathCenterPlayer3[0] = Center1[0]
                        AttackPathCenterPlayer3[1] = Center1[1]
                        AttackPathCenterPlayer3[2] = Center1[2]
                        AttackPathCenterPlayer3[3] = Center1[3]
                        //Flank
                        AttackPathFlankPlayer3[0] = Flank1[0]
                        AttackPathFlankPlayer3[1] = Flank1[1]
                        AttackPathFlankPlayer3[2] = Flank1[2]
                        AttackPathFlankPlayer3[3] = Flank1[3]
                        //Backdoor
                        AttackPathBackdoorPlayer3[0] = Backdoor1[0]
                        AttackPathBackdoorPlayer3[1] = Backdoor1[1]
                        AttackPathBackdoorPlayer3[2] = Backdoor1[2]
                        AttackPathBackdoorPlayer3[3] = Backdoor1[3]

                    else
                        //Center
                        AttackPathCenterPlayer3[0] = Center2[3]
                        AttackPathCenterPlayer3[1] = Center2[2]
                        AttackPathCenterPlayer3[2] = Center2[1]
                        AttackPathCenterPlayer3[3] = Center2[0]
                        //Flank
                        AttackPathFlankPlayer3[0] = Flank2[3]
                        AttackPathFlankPlayer3[1] = Flank2[2]
                        AttackPathFlankPlayer3[2] = Flank2[1]
                        AttackPathFlankPlayer3[3] = Flank2[0]
                        //Backdoor
                        AttackPathBackdoorPlayer3[0] = Backdoor2[3]
                        AttackPathBackdoorPlayer3[1] = Backdoor2[2]
                        AttackPathBackdoorPlayer3[2] = Backdoor2[1]
                        AttackPathBackdoorPlayer3[3] = Backdoor2[0]
                    
                    end if

                elsif EnemyID == 2
                    //Center
                    AttackPathCenterPlayer3[0] = Center3[3]
                    AttackPathCenterPlayer3[1] = Center3[2]
                    AttackPathCenterPlayer3[2] = Center3[1]
                    AttackPathCenterPlayer3[3] = Center3[0]
                    //Flank
                    AttackPathFlankPlayer3[0] = Flank3[3]
                    AttackPathFlankPlayer3[1] = Flank3[2]
                    AttackPathFlankPlayer3[2] = Flank3[1]
                    AttackPathFlankPlayer3[3] = Flank3[0]
                    //Backdoor
                    AttackPathBackdoorPlayer3[0] = Backdoor3[3]
                    AttackPathBackdoorPlayer3[1] = Backdoor3[2]
                    AttackPathBackdoorPlayer3[2] = Backdoor3[1]
                    AttackPathBackdoorPlayer3[3] = Backdoor3[0]

                end if
            end if
        end if

        EnemyIDFinal[PlayerID] = EnemyID

        begin loop
            NumberOfTowns = get player EnemyID town total
            if get Timer time remaining <= 0 or NumberOfTowns == 0
                run background script SK_ChooseEnemy(PlayerID,number from 0 to 3)
                AbortLoop = 1    
            end if
            until AbortLoop == 1
        end loop
    end if
    until AbortLoop == 1
end loop

end script SK_ChooseEnemy

begin script SK_AttackLogic(PlayerID)

    AttackTimer = 0
    Counter = 0
    PlayerCounter = 0
    AITown[SK_MaxTowns]

start

if SK_AIPersonality[PlayerID] == 1
    AttackTimer = create timer for number from 600 to 1200 seconds
elsif SK_AIPersonality[PlayerID] == 2
    AttackTimer = create timer for number from 750 to 1500 seconds
elsif SK_AIPersonality[PlayerID] == 3
    AttackTimer = create timer for number from 1200 to 2100 seconds
end if

SK_ALLOWED_TO_ATTACK[PlayerID] = 0

begin loop
    if Counter >= SK_MaxTowns
        Counter = 0
    end if

    if PlayerCounter >= SK_MaxPlayers
        PlayerCounter = 0
    end if

    AITown[Counter] = get town with id Counter
    if PLAYER of AITown[Counter] == PlayerID
        while PlayerCounter < SK_MaxPlayers
            if get AttackTimer time remaining <= 0 or town AITown[Counter] is under takeover from player PlayerCounter or SK_PlatoonCounter[PlayerID] >= 8
                SK_ALLOWED_TO_ATTACK[PlayerID] = 1
                wait 12 seconds
                SK_ALLOWED_TO_ATTACK[PlayerID] = 0
                if SK_AIPersonality[PlayerID] == 1
                    AttackTimer = create timer for number from 600 to 900 seconds
                elsif SK_AIPersonality[PlayerID] == 2
                    AttackTimer = create timer for number from 600 to 1200 seconds
                elsif SK_AIPersonality[PlayerID] == 3
                    AttackTimer = create timer for 2400 seconds
                end if
            end if

            PlayerCounter++
        end while
    end if

    Counter++
end loop

end script SK_AttackLogic

begin script SK_ArmyBehaivours(PlayerID,Platoon,Type,Task,AttackFocus,Aggressiveness,AttackImmediately,Waypoint1,Waypoint2,Waypoint3,Waypoint4,AICapital,DisableMerge,DisableSplit)

    AttackMode = 0
    AttackRadiusTown = 500
    Building = 0
    Counter = 0
    EnemyCreature = 0
    EnemyCreatureDist = 0
    EnemyPlatoon = 0
    EnemyPlayer = 0
    EnemyCatapult = 0
    EnemySettlement = 0
    EnemyTownCentre = 0
    startAttack = 0
    myPlatoon = 0
    Number = 0
    RandomHome = 0
    PlatoonSize = 0
    PlatoonSizeEnemy = 0
    AttackWPStage = 0
    RecalculateTimer = create timer for 0 seconds
    Timer = create timer for 0 seconds
    TownCaptureStarted = 0
    TownsTemp = 0
    CurrTowns = 0
    VariableA = 0
    VariableB = 0
    WaypointTown = 0
    WaypointTimer = create timer for 0 seconds

    AttackRadius = 0
    AttackRadiusCatapult = 0
    AbortObjectiveProbability = 0
    SplitUpChance = number from 1 to 100
    MergeChance = number from 1 to 100
    SplitDone = 0
    MergeDone = 0
    NewPlatoon = 0
    AssumedPlatoonPos = 0

    CurrWP1 = 0
    CurrWP2 = 0
    CurrWP3 = 0
    CurrWP4 = 0

start

if Aggressiveness == Passive
    AttackRadius = 10
    AttackRadiusCatapult = 5
    AbortObjectiveProbability = 0
elsif Aggressiveness == Neutral
    AttackRadius = 100
    AttackRadiusCatapult = 75
    AbortObjectiveProbability = 25
elsif Aggressiveness == Alerted
    AttackRadius = 200
    AttackRadiusCatapult = 125
    AbortObjectiveProbability = 75
elsif Aggressiveness == Aggressive
    AttackRadius = 325
    AttackRadiusCatapult = 200
    AbortObjectiveProbability = 100
end if

if MergeChance >= SplitUpChance
    SplitUpChance = 0
else
    MergeChance = 0
end if

if DisableMerge == 1
    MergeChance = 0
end if

if DisableSplit == 1
    SplitUpChance = 0
end if

AttackWPStage = 0
wait 5 seconds
TownsTemp = get player PlayerID town total

begin loop
    //Group up before Attack
    if SK_AIPersonality[PlayerID] == 1 and SK_AIOpeningMoves[PlayerID] == 2 and script1[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 4
        wait 5 seconds
        script1[PlayerID] = 1
    end if

    if SK_AIPersonality[PlayerID] == 1 and SK_AIOpeningMoves[PlayerID] == 5 and script2[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 2
        wait 5 seconds
        script2[PlayerID] = 1
    end if
    if SK_AIPersonality[PlayerID] == 2 and SK_AIOpeningMoves[PlayerID] == 5 and script2[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 2
        wait 5 seconds
        script2[PlayerID] = 1
    end if
    if SK_AIPersonality[PlayerID] == 1 and SK_AIOpeningMoves[PlayerID] == 7 and script4[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 3
        wait 5 seconds
        script4[PlayerID] = 1
    end if
    if SK_AIPersonality[PlayerID] == 2 and SK_AIOpeningMoves[PlayerID] == 7 and script4[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 3
        wait 5 seconds
        script4[PlayerID] = 1
    end if
    if SK_AIPersonality[PlayerID] == 2 and SK_AIOpeningMoves[PlayerID] == 8 and script5[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 4
        wait 5 seconds
        script5[PlayerID] = 1
    end if

    if Counter >= SK_MaxPlayers
        Counter = 0
    end if

    if PlayerID != Counter
        //say "PlayerID != Counter"
        if Type == Melee
            EnemyCreature = get player Counter creature
            EnemyCreatureDist = get distance from {Platoon} to {EnemyCreature}
            if EnemyCreatureDist <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of EnemyCreature > 0.00 and Platoon can navigate to {EnemyCreature}
                clear Platoon action queue
                begin loop
                    EnemyCreatureDist = get distance from {Platoon} to {EnemyCreature}
                    if get size of Platoon action queue < 1
                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_MOVING_OBJECT using EnemyCreature to Platoon action queue
                    end if
                    PlatoonSize = get number of villagers in platoon Platoon
                    until PlatoonSize == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of EnemyCreature == 0.00 or not Platoon can navigate to {EnemyCreature} or EnemyCreatureDist > AttackRadius * 1.25
                end loop
                clear Platoon action queue
            end if
            
            EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius
            EnemyCatapult = get siege weapon of player Counter nearest {Platoon} radius AttackRadiusCatapult
            if EnemyPlatoon exists and Platoon can navigate to {EnemyPlatoon}
                clear Platoon action queue
                begin loop
                    EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius * 1.25
                    if get size of Platoon action queue < 1
                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_PLATOON using EnemyPlatoon to Platoon action queue
                    end if
                    PlatoonSize = get number of villagers in platoon Platoon
                    PlatoonSizeEnemy = get number of villagers in platoon EnemyPlatoon
                    until PlatoonSize == 0 or PlatoonSizeEnemy == 0 or not Platoon can navigate to {EnemyPlatoon} or EnemyPlatoon not exists
                end loop
                clear Platoon action queue

            elsif EnemyCatapult exists and Platoon can navigate to {EnemyCatapult}
                clear Platoon action queue
                VariableA = 0
                begin loop
                    EnemyCatapult = get siege weapon of player Counter nearest {Platoon} radius AttackRadiusCatapult * 1.25
                    if get size of Platoon action queue < 1
                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using EnemyCatapult to Platoon action queue
                    end if
                    PlatoonSize = get number of villagers in platoon Platoon
                    EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius
                    if EnemyPlatoon exists and Platoon can navigate to {EnemyPlatoon}
                        VariableA = 1
                    end if
                    until PlatoonSize == 0 or EnemyCatapult not exists or not Platoon can navigate to {EnemyCatapult} or VariableA == 1 or EnemyCatapult not exists
                end loop
                clear Platoon action queue
                VariableA = 0
            end if

        elsif Type == Ranged
            EnemyCreature = get player Counter creature
            EnemyCreatureDist = get distance from {Platoon} to {EnemyCreature}
            if EnemyCreatureDist <= AttackRadius and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of EnemyCreature > 0.00 and Platoon can navigate to {EnemyCreature}
                clear Platoon action queue
                begin loop
                    EnemyCreatureDist = get distance from {Platoon} to {EnemyCreature}
                    if get size of Platoon action queue < 1
                        if SK_AIDifficulty[PlayerID] < 66
                            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using EnemyCreature to Platoon action queue
                        else
                            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK_MAINTAINING_DISTANCE using EnemyCreature to Platoon action queue
                        end if
                    end if
                    PlatoonSize = get number of villagers in platoon Platoon
                    until PlatoonSize == 0 or SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of EnemyCreature == 0.00 or not Platoon can navigate to {EnemyCreature} or EnemyCreatureDist > AttackRadius * 1.25
                end loop
                clear Platoon action queue
            end if
            
            EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius
            EnemyCatapult = get siege weapon of player Counter nearest {Platoon} radius AttackRadiusCatapult
            if EnemyPlatoon exists and Platoon can navigate to {EnemyPlatoon}
                clear Platoon action queue
                begin loop
                    EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius * 1.25
                    if get size of Platoon action queue < 1
                        if SK_AIDifficulty[PlayerID] < 66
                            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using EnemyPlatoon to Platoon action queue
                        else
                            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK_MAINTAINING_DISTANCE using EnemyPlatoon to Platoon action queue
                        end if
                    end if
                    PlatoonSize = get number of villagers in platoon Platoon
                    PlatoonSizeEnemy = get number of villagers in platoon EnemyPlatoon
                    until PlatoonSize == 0 or PlatoonSizeEnemy == 0 or not Platoon can navigate to {EnemyPlatoon} or EnemyPlatoon not exists
                end loop
                clear Platoon action queue

            elsif EnemyCatapult exists and Platoon can navigate to {EnemyCatapult}
                clear Platoon action queue
                VariableA = 0
                begin loop
                    EnemyCatapult = get siege weapon of player Counter nearest {Platoon} radius AttackRadiusCatapult * 1.25
                    if get size of Platoon action queue < 1
                        if SK_AIDifficulty[PlayerID] < 66
                            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK using EnemyCatapult to Platoon action queue
                        else
                            add action PLATOON_AGENDA_ACTION_RANGED_ATTACK_MAINTAINING_DISTANCE using EnemyCatapult to Platoon action queue
                        end if
                    end if
                    PlatoonSize = get number of villagers in platoon Platoon
                    EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius
                    if EnemyPlatoon exists and Platoon can navigate to {EnemyPlatoon}
                        VariableA = 1
                    end if
                    until PlatoonSize == 0 or EnemyCatapult not exists or not Platoon can navigate to {EnemyCatapult} or VariableA == 1 or EnemyCatapult not exists
                end loop
                clear Platoon action queue
                VariableA = 0
            end if
        end if

        // Task = 0: Normal Attack, wait for SK_ALLOWED_TO_ATTACK[PlayerID]
        // Task = 1: Capture nearest town, AttackFocus = TownCenter
        // Task = 2: Capture spec town, AttackFocus = TownCenter
        // Task = 3: Capture town nearest enemy, AttackFocus = TownCenter
        if SK_ALLOWED_TO_ATTACK[PlayerID] == 1 or AttackImmediately == 1
            startAttack = 1
        end if
        if startAttack == 1
            //say "PLATOON ATTACKING"
            if AttackWPStage != 4
                if Task == 0
                    EnemySettlement = get nearest town at {Platoon} for player Counter radius AttackRadiusTown
                elsif Task == 1
                    AttackFocus = TownCenter
                    EnemySettlement = get TOWN at {Platoon} radius AttackRadiusTown
                elsif Task == 2
                    AttackFocus = TownCenter
                    AttackRadiusTown = 1500
                    if SpecTown3 != 0 and PLAYER of SpecTown3 != PlayerID
                        //say "SpecTown3"
                        EnemySettlement = get TOWN at {SpecTown3} radius AttackRadiusTown
                    elsif SpecTown2 != 0 and PLAYER of SpecTown2 != PlayerID
                        //say "SpecTown2"
                        EnemySettlement = get TOWN at {SpecTown2} radius AttackRadiusTown
                    elsif SpecTown1 != 0 and PLAYER of SpecTown1 != PlayerID
                        //say "SpecTown1"
                        EnemySettlement = get TOWN at {SpecTown1} radius AttackRadiusTown
                    else
                        //say "Else"
                        EnemySettlement = get TOWN at {Platoon} radius AttackRadiusTown
                    end if
                elsif Task == 3
                    AttackFocus = TownCenter
                    AttackRadiusTown = 1500
                    if SK_LandNumber == 23
                        if EnemyIDFinal[PlayerID] == 0
                            EnemySettlement = get TOWN at {686.97,127.75,1457.80} radius AttackRadiusTown
                        end if
                    elsif SK_LandNumber == 24
                        if EnemyIDFinal[PlayerID] == 0
                            EnemySettlement = get TOWN at {1051.16,104.69,534.31} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 1
                            EnemySettlement = get TOWN at {2273.49,171.13,725.10} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 2
                            EnemySettlement = get TOWN at {1560.96,47.57,2202.56} radius AttackRadiusTown
                        end if
                    elsif SK_LandNumber == 25
                        if EnemyIDFinal[PlayerID] == 0
                            EnemySettlement = get TOWN at {624.51,34.63,1719.57} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 1
                            EnemySettlement = get TOWN at {669.92,35.54,1139.67} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 2
                            EnemySettlement = get TOWN at {1950.19,39.22,1134.12} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 3
                            EnemySettlement = get TOWN at {1858.62,35.28,1760.99} radius AttackRadiusTown
                        end if
                    elsif SK_LandNumber == 26
                        if EnemyIDFinal[PlayerID] == 0
                            EnemySettlement = get TOWN at {1474.02,93.27,1187.69} radius AttackRadiusTown
                        end if
                    elsif SK_LandNumber == 27
                        if EnemyIDFinal[PlayerID] == 0
                            EnemySettlement = get TOWN at {1664.55,54.80,1828.09} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 1
                            EnemySettlement = get TOWN at {1419.06,56.04,1163.26} radius AttackRadiusTown
                        elsif EnemyIDFinal[PlayerID] == 2
                            EnemySettlement = get TOWN at {1486.39,38.08,368.98} radius AttackRadiusTown
                        end if
                    end if
                end if
            else
                if EnemyIDFinal[PlayerID] == 0
                    EnemySettlement = PlayerTown1
                elsif EnemyIDFinal[PlayerID] == 1
                    EnemySettlement = PlayerTown2
                elsif EnemyIDFinal[PlayerID] == 2
                    EnemySettlement = PlayerTown3
                elsif EnemyIDFinal[PlayerID] == 3
                    EnemySettlement = PlayerTown4
                end if
            end if
            EnemyTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in EnemySettlement min built 1.0
            CurrTowns = get player PlayerID town total
            //Attack valid towns
            if EnemySettlement exists and EnemyTownCentre exists and HEALTH of EnemyTownCentre == 1.0 and not variable get town EnemySettlement status == variable TOWN_STATUS_MIGRATION_STARTED
                if Platoon can navigate to object EnemyTownCentre
                    if PLAYER of EnemySettlement != PlayerID and (CurrTowns <= TownsTemp or (PLAYER of EnemySettlement >= 0 and PLAYER of EnemySettlement <= 5))
                       //say "EnemySettlement exists and EnemyTownCentre exists and Platoon can navigate to object EnemySettlement"
                        VariableB = 0
                        if AttackFocus == Default
                            //say "AttackFocus == Default"
                            clear Platoon action queue
                            Number = number from 1 to 4
                            if Number == 2 and HEALTH of EnemyCreature > 0 //Hunt down platoons or destroy buildings
                                AttackMode = 1
                                set Platoon attack EnemySettlement with severity 0.2
                            elsif Number == 3 or Number == 4 //Destroy value buildings
                                AttackMode = 2
                                Building = 0
                                Timer = create timer for 2 seconds
                                begin loop
                                    Number = number from 1 to 8
                                    if Number == 1 or Number == 2 or Number == 3
                                        Building = get random abode of type ALTAR in town EnemySettlement
                                        if Building exists and HEALTH of Building >= 0.75
                                            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                        else
                                            Building = 0
                                        end if
                                    elsif Number == 4
                                        Building = get random abode of type TEMPLE in town EnemySettlement
                                        if Building exists and HEALTH of Building >= 0.75
                                            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                        else
                                            Building = 0
                                        end if
                                    elsif Number == 5
                                        Building = get random abode of type CREATURE_PEN in town EnemySettlement
                                        if Building exists and HEALTH of Building >= 0.75
                                            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                        else
                                            Building = 0
                                        end if
                                    elsif Number == 6
                                        Building = get random abode of type UNIVERSITY in town EnemySettlement
                                        if Building exists and HEALTH of Building >= 0.75
                                            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                        else
                                            Building = 0
                                        end if
                                    elsif Number == 7
                                        Building = get random abode of type BATHHOUSE in town EnemySettlement
                                        if Building exists and HEALTH of Building >= 0.75
                                            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                        else
                                            Building = 0
                                        end if
                                    elsif Number == 8
                                        Building = get random abode of type AMPITHEATRE in town EnemySettlement
                                        if Building exists and HEALTH of Building >= 0.75
                                            add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                        else
                                            Building = 0
                                        end if
                                    end if
                                    until Building != 0 or get Timer time remaining <= 0
                                end loop
                            else //Capture Town
                                AttackMode = 0
                                if Task == 0
                                    if PlayerID == 1
                                        if SK_TownCapturePlatoons[0] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[0]++
                                        end if
                                    elsif PlayerID == 2
                                        if SK_TownCapturePlatoons[4] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[4]++
                                        end if
                                    elsif PlayerID == 3
                                        if SK_TownCapturePlatoons[7] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[7]++                                        
                                        end if
                                    end if
                                end if
                                if Task == 1
                                    if PlayerID == 1
                                        if SK_TownCapturePlatoons[1] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[1]++
                                        end if
                                    elsif PlayerID == 2
                                        if SK_TownCapturePlatoons[5] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[5]++
                                        end if
                                    elsif PlayerID == 3
                                        if SK_TownCapturePlatoons[8] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[8]++                                        
                                        end if
                                    end if
                                end if
                                if Task == 2
                                    if PlayerID == 1
                                        if SK_TownCapturePlatoons[2] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[2]++
                                        end if
                                    elsif PlayerID == 2
                                        if SK_TownCapturePlatoons[6] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[6]++
                                        end if
                                    elsif PlayerID == 3
                                        if SK_TownCapturePlatoons[9] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[9]++                                        
                                        end if
                                    end if
                                end if
                                if Task == 3
                                    if PlayerID == 1
                                        if SK_TownCapturePlatoons[3] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[3]++
                                        end if
                                    elsif PlayerID == 2
                                        if SK_TownCapturePlatoons[7] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[7]++
                                        end if
                                    elsif PlayerID == 3
                                        if SK_TownCapturePlatoons[10] < 2
                                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                                            SK_TownCapturePlatoons[10]++                                        
                                        end if
                                    end if
                                end if
                            end if
                        elsif AttackFocus == Houses
                            //say "AttackFocus == Houses"
                            clear Platoon action queue
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 6
                                if Number == 1
                                    Building = get random abode of type ABODE_A in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 2
                                    Building = get random abode of type ABODE_B in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 3
                                    Building = get random abode of type ABODE_C in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 4
                                    Building = get random abode of type ABODE_D in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 5
                                    Building = get random abode of type ABODE_E in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                elsif Number == 6
                                    Building = get random abode of type SKYSCRAPER in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ABODE_A in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_B in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_C in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_D in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_E in EnemySettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            //say "AttackFocus == Epics"
                            clear Platoon action queue
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get WONDER in EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type WONDER WONDER_SIREN in EnemySettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in EnemySettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in EnemySettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            //say "AttackFocus == Altars"
                            clear Platoon action queue
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type ALTAR in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE ALTAR in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            //say "AttackFocus == CreaturePen"
                            clear Platoon action queue
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get random abode of type CREATURE_PEN in town EnemySettlement
                                    if Building exists and HEALTH of Building >= 0.75
                                        add action PLATOON_AGENDA_ACTION_MELEE_ATTACK_THING using Building to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if (get number of type HOUSE CREATURE_PEN in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            //say "AttackFocus == TownCenter"
                            clear Platoon action queue
                            AttackMode = 0
                            set Platoon attack EnemySettlement with severity 0.3 for takeover
                        elsif AttackFocus == Villagers
                            //say "AttackFocus == Villagers"
                            clear Platoon action queue
                            AttackMode = 2
                            Building = 0
                            Timer = create timer for 2 seconds
                            begin loop
                                Number = number from 1 to 1
                                if Number == 1
                                    Building = get living villager at {Platoon} radius 250
                                    if Building not exists or PLAYER of Building != 0
                                        Building = get living villager at {EnemySettlement} radius 250
                                    end if
                                    if Building exists
                                        add action PLATOON_AGENDA_ACTION_ATTACK_ANY_ENEMY_IN_AREA using {Building} to Platoon action queue
                                    else
                                        Building = 0
                                    end if
                                end if
                                until Building != 0 or get Timer time remaining <= 0
                            end loop
                            if size of EnemySettlement <= 60
                                AttackFocus = Default
                            end if
                        end if
                        RecalculateTimer = create timer for 40 seconds
                        Number = number from 0 to 99
                        begin loop
                            EnemyPlatoon = get platoon of player Counter nearest {Platoon} radius AttackRadius * 1.25
                            EnemyCreature = get player Counter creature
                            EnemyCreatureDist = get distance from {Platoon} to {EnemyCreature}
                            if EnemyPlatoon exists and not town EnemySettlement is under takeover from player PlayerID
                                VariableB = 1
                            elsif EnemyCreatureDist <= AttackRadius * 1.25 and SCRIPT_OBJECT_PROPERTY_TYPE_HEALTH of EnemyCreature > 0.00 and not town EnemySettlement is under takeover from player PlayerID
                                VariableB = 1
                            elsif not Platoon can navigate to object EnemyTownCentre
                                VariableB = 2
                            elsif Platoon not exists
                                VariableB = 2
                            elsif AttackMode == 1 and HEALTH of EnemyCreature == 0
                                VariableB = 2
                            elsif AttackMode == 2 and Building not exists
                                VariableB = 2
                            elsif AttackMode == 2 and HEALTH of Building <= 0.0
                                VariableB = 2
                            elsif AttackMode == 2 and Building == 0
                                VariableB = 2
                            elsif not town EnemySettlement is under takeover from player PlayerID and get RecalculateTimer time remaining <= 0
                                VariableB = 2
                            end if
                            until (AbortObjectiveProbability > Number and VariableB == 1) or (VariableB == 2)
                        end loop
                       //say "until (AbortObjectiveProbability > Number and VariableB == 1) or (VariableB == 2)"
                        if AttackMode == 0
                            if Task == 0
                                if PlayerID == 1
                                    if SK_TownCapturePlatoons[0] < 2
                                        SK_TownCapturePlatoons[0]--
                                    end if
                                elsif PlayerID == 2
                                    if SK_TownCapturePlatoons[4] < 2
                                        SK_TownCapturePlatoons[4]--
                                    end if
                                elsif PlayerID == 3
                                    if SK_TownCapturePlatoons[7] < 2
                                        SK_TownCapturePlatoons[7]--
                                    end if
                                end if
                            end if
                            if Task == 1
                                if PlayerID == 1
                                    if SK_TownCapturePlatoons[1] < 2
                                        SK_TownCapturePlatoons[1]--
                                    end if
                                elsif PlayerID == 2
                                    if SK_TownCapturePlatoons[5] < 2
                                        SK_TownCapturePlatoons[5]--
                                    end if
                                elsif PlayerID == 3
                                    if SK_TownCapturePlatoons[8] < 2
                                        SK_TownCapturePlatoons[8]--
                                    end if
                                end if
                            end if
                            if Task == 2
                                if PlayerID == 1
                                    if SK_TownCapturePlatoons[2] < 2
                                        SK_TownCapturePlatoons[2]--
                                    end if
                                elsif PlayerID == 2
                                    if SK_TownCapturePlatoons[6] < 2
                                        SK_TownCapturePlatoons[6]--
                                    end if
                                elsif PlayerID == 3
                                    if SK_TownCapturePlatoons[9] < 2
                                        SK_TownCapturePlatoons[9]--
                                    end if
                                end if
                            end if
                            if Task == 3
                                if PlayerID == 1
                                    if SK_TownCapturePlatoons[3] < 2
                                        SK_TownCapturePlatoons[3]--
                                    end if
                                elsif PlayerID == 2
                                    if SK_TownCapturePlatoons[7] < 2
                                        SK_TownCapturePlatoons[7]--
                                    end if
                                elsif PlayerID == 3
                                    if SK_TownCapturePlatoons[10] < 2
                                        SK_TownCapturePlatoons[10]--
                                    end if
                                end if
                            end if
                        end if
                        clear Platoon action queue
                    end if
                end if
            end if

            //Move troops through map
            if get PlatoonMoveTimer1[PlayerID] time remaining <= 0 or get PlatoonMoveTimer2[PlayerID] time remaining <= 0 or get PlatoonMoveTimer3[PlayerID] time remaining <= 0 or get PlatoonMoveTimer4[PlayerID] time remaining <= 0
                if AttackWPStage != 4 and get PlatoonWaitTimer[PlayerID] time remaining <= 0
                    if AttackWPStage == 0
                        if {Platoon} near {CurrWP1} radius 33
                            AttackWPStage = 1
                           //say "AttackWPStage = 1"
                        end if
                        if AttackWPStage == 0
                            if get size of Platoon action queue < 1
                                if not Platoon can navigate to {CurrWP1}
                                    Number = 0
                                    begin loop
                                        CurrWP1 = marker at {Waypoint1} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until Platoon not exists or Platoon can navigate to {CurrWP1}
                                    end loop
                                end if
                                clear Platoon action queue
                                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {CurrWP1} to Platoon action queue
                            end if
                        end if
                    elsif AttackWPStage == 1
                        if {Platoon} near {CurrWP2} radius 33
                            AttackWPStage = 2
                           //say "AttackWPStage = 2"
                        end if
                        if AttackWPStage == 1
                            if get size of Platoon action queue < 1
                                if not Platoon can navigate to {CurrWP2}
                                    Number = 0
                                    begin loop
                                        CurrWP2 = marker at {Waypoint2} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until Platoon not exists or Platoon can navigate to {CurrWP2}
                                    end loop
                                end if
                                clear Platoon action queue
                                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {CurrWP2} to Platoon action queue
                            end if
                        end if
                    elsif AttackWPStage == 2
                        if {Platoon} near {CurrWP3} radius 33
                            AttackWPStage = 3
                           //say "AttackWPStage = 3"
                        end if
                        if AttackWPStage == 2
                            if get size of Platoon action queue < 1
                                if not Platoon can navigate to {CurrWP3}
                                    Number = 0
                                    begin loop
                                        CurrWP3 = marker at {Waypoint3} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until Platoon not exists or Platoon can navigate to {CurrWP3}
                                    end loop
                                end if
                                clear Platoon action queue
                                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {CurrWP3} to Platoon action queue
                            end if
                        end if
                    elsif AttackWPStage == 3
                        if {Platoon} near {CurrWP4} radius 33
                            AttackWPStage = 4
                           //say "AttackWPStage = 4"
                        end if
                        if AttackWPStage == 3
                            if get size of Platoon action queue < 1
                                if not Platoon can navigate to {CurrWP4}
                                    Number = 0
                                    begin loop
                                        CurrWP4 = marker at {Waypoint4} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until Platoon not exists or Platoon can navigate to {CurrWP4}
                                    end loop
                                end if
                                clear Platoon action queue
                                add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {CurrWP4} to Platoon action queue
                            end if
                        end if
                    end if
                end if
            end if

        //Move them to idle position in home town
        elsif get WaypointTimer time remaining <= 0
            if not Platoon can navigate to {WaypointTown} or WaypointTown == 0
                begin loop
                    RandomHome = get random home in town SK_AIHomeTown[PlayerID]
                    if RandomHome exists
                        WaypointTown = marker at {RandomHome} + {number from -75 to 75,number from -75 to 75}
                    else
                        WaypointTown = marker at {SK_AIHomeTown[PlayerID]} + {number from -150 to 150,number from -150 to 150}
                    end if
                    until Platoon can navigate to {WaypointTown}
                end loop
            end if
            WaypointTimer = create timer for 200 seconds
            add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {WaypointTown} to Platoon action queue
        end if

    elsif PlayerID == Counter
        //Special Tasks
        //Split up from origin platoon - Mutually exclusive with merging
        if SplitDone == 0 and 100-SplitUpChance < CHANCE_TO_SPLIT and startAttack == 1
            if get number of villagers in platoon Platoon > 30
                while get number of villagers in platoon Platoon > 30 and number from 1 to 3 != 1
                   //say "SPLITTING NOW"
                    wait 5 seconds
                    SplitDone = 1
                    Number = number from 1 to 4
                    if Number == 1
                        NewPlatoon = split 15 soldiers from platoon Platoon
                    elsif Number == 2
                        NewPlatoon = split 20 soldiers from platoon Platoon
                    elsif Number == 3
                        NewPlatoon = split 25 soldiers from platoon Platoon
                    elsif Number == 4
                        NewPlatoon = split 30 soldiers from platoon Platoon
                    end if
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                    add action PLATOON_AGENDA_ACTION_MOVE_TO_POS_AGGRESSIVE using {Platoon} + {number from -50 to 50,number from -50 to 50} to NewPlatoon action queue
                    wait 5 seconds
                    clear NewPlatoon action queue
                    run background script SK_ArmyBehaivours(PlayerID,Platoon,Type,Task,AttackFocus,Aggressiveness,AttackImmediately,Waypoint1,Waypoint2,Waypoint3,Waypoint4,AICapital,1,0)
                end while
            end if
        end if
        //Merge with target platoon - Mutually exclusive with splitting
        if MergeDone == 0 and 100-MergeChance < CHANCE_TO_MERGE and (startAttack == 1 or get number of villagers in platoon Platoon < 10)
            if get number of villagers in platoon Platoon <= 50
                AssumedPlatoonPos = marker at {Platoon} + {number from -100 to 100, number from -100 to 100}
                NewPlatoon = get platoon of player PlayerID nearest {AssumedPlatoonPos} radius 100
                if NewPlatoon exists and NewPlatoon != Platoon and not NewPlatoon recruiting and get number of villagers in platoon NewPlatoon < 150
                    if ((Type == Melee and platoon NewPlatoon melee) or (Type == Ranged and platoon NewPlatoon ranged))
                       //say "MERGING PLATOON INTO NEWPLATOON NOW"
                        wait 5 seconds
                        MergeDone = 1
                        while Platoon exists and NewPlatoon exists
                            merge platoon Platoon into platoon NewPlatoon
                            wait 10 seconds
                        end while
                    end if
                end if
            end if
        end if
    end if
    Counter++
    until Platoon not exists
end loop

say "Platoon Script Ended"

end script SK_ArmyBehaivours

begin script SK_SiegeWeaponBehaivours(PlayerID,SiegeWeapon,AttackFocus,AttackImmediately,Waypoint1,Waypoint2,Waypoint3,Waypoint4,AICapital)

    ActionTimer = create timer for 0 seconds
    AttackMode = 0
    AttackRadiusTown = 750
    Building = 0
    Counter = 0
    EnemyCreature = 0
    EnemyCreatureDist = 0
    EnemyPlatoon = 0
    EnemyPlayer = 0
    EnemyCatapult = 0
    EnemySettlement = 0
    EnemyTownCentre = 0
    GateHouse = 0
    House = 0
    startAttack = 0
    myPlatoon = 0
    Number = 0
    PlatoonSize = 0
    PlatoonSizeEnemy = 0
    AttackWPStage = 0
    Rand = 0
    RandomHome = 0
    RecalculateTimer = create timer for 0 seconds
    Target = 0
    Timer = create timer for 0 seconds
    VariableA = 0
    VariableB = 0
    Wall1 = 0
    WaypointTown = 0
    WaypointTimer = create timer for 0 seconds

    objSubType = 0

    CurrWP1 = 0
    CurrWP2 = 0
    CurrWP3 = 0
    CurrWP4 = 0

start

AttackWPStage = 0
wait 5 seconds
disable siege weapon SiegeWeapon auto attack

begin loop
    if SK_AIOpeningMoves[PlayerID] == 6 and script3[PlayerID] == 0
        wait until SK_SiegeWeaponCounter[PlayerID] >= 4
        wait 5 seconds
        script3[PlayerID] = 1
    end if
    if SK_AIPersonality[PlayerID] == 2 and SK_AIOpeningMoves[PlayerID] == 8 and script5[PlayerID] == 0
        wait until SK_PlatoonCounter[PlayerID] >= 4
        wait 5 seconds
        script5[PlayerID] = 1
    end if

    //say "Siege Script Running"

    if Counter >= SK_MaxPlayers
        Counter = 0
    end if

    if PlayerID != Counter
        //Normal Behaivor | With SK_AllowedToAttack
        if SK_ALLOWED_TO_ATTACK[PlayerID] == 1 or startAttack == 1
            startAttack = 1
            EnemySettlement = get nearest town at {SiegeWeapon} for player Counter radius AttackRadiusTown
            if EnemySettlement not exists and AttackWPStage == 4
                if EnemyIDFinal[PlayerID] == 0
                    EnemySettlement = PlayerTown1
                elsif EnemyIDFinal[PlayerID] == 1
                    EnemySettlement = PlayerTown2
                elsif EnemyIDFinal[PlayerID] == 2
                    EnemySettlement = PlayerTown3
                elsif EnemyIDFinal[PlayerID] == 3
                    EnemySettlement = PlayerTown4
                end if
            end if
            EnemyTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in EnemySettlement min built 1.0
            if EnemySettlement exists and EnemyTownCentre exists and PLAYER of EnemySettlement != PlayerID and get ActionTimer time remaining <= 0
                //enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                if number from 1 to 10 >= 7
                    Number = number from 1 to 3
                    if Number == 1 or Number == 2
                        objSubType = 33
                        GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius AttackRadiusTown
                        if GateHouse exists and PLAYER of GateHouse == Counter
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            GateHouse = get random abode of type constant objSubType in town EnemySettlement
                            if GateHouse exists and PLAYER of GateHouse == Counter
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                objSubType = 34
                                GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius AttackRadiusTown
                                if GateHouse exists and PLAYER of GateHouse == Counter
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    GateHouse = get random abode of type constant objSubType in town EnemySettlement
                                    if GateHouse exists and PLAYER of GateHouse == Counter
                                        clear siege weapon SiegeWeapon action queue
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                    else
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                            end if
                        end if
                    elsif Number == 3
                        Wall1 = get wall segment nearest {SiegeWeapon} radius AttackRadiusTown * 3
                        if Wall1 exists and PLAYER of Wall1 == Counter
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                        else
                            Wall1 = get wall segment nearest {EnemySettlement} radius AttackRadiusTown * 3
                            if Wall1 exists and PLAYER of Wall1 == Counter
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                            else
                                ActionTimer = create timer for 0.025 seconds
                            end if
                        end if
                    end if
                else
                    if SiegeWeapon can navigate to object EnemyTownCentre
                        ActionTimer = create timer for 60 seconds
                        wait 2 seconds
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get random abode of type ALTAR in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type TEMPLE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type CREATURE_PEN in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type UNIVERSITY in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 7
                                Building = get random abode of type BATHHOUSE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 8
                                Building = get random abode of type AMPITHEATRE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ABODE_A in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_B in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_C in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_D in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_E in EnemySettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type WONDER WONDER_SIREN in EnemySettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in EnemySettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in EnemySettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ALTAR in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE CREATURE_PEN in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type TOWN_CENTRE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {EnemySettlement} + {number from -125 to 125,number from -125 to 125} radius AttackRadiusTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if size of EnemySettlement <= 60
                                AttackFocus = Default
                            end if
                        end if
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                end if
            end if

            if get PlatoonMoveTimer1[PlayerID] time remaining <= 0 or get PlatoonMoveTimer2[PlayerID] time remaining <= 0 or get PlatoonMoveTimer3[PlayerID] time remaining <= 0 or get PlatoonMoveTimer4[PlayerID] time remaining <= 0
                if AttackWPStage != 4 and get PlatoonWaitTimer[PlayerID] time remaining <= 0
                    if AttackWPStage == 0
                        if {SiegeWeapon} near {CurrWP1} radius 33
                            AttackWPStage = 1
                        end if
                        if AttackWPStage == 0
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP1}
                                    Number = 0
                                    begin loop
                                        CurrWP1 = marker at {Waypoint1} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP1}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP1} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    elsif AttackWPStage == 1
                        if {SiegeWeapon} near {CurrWP2} radius 33
                            AttackWPStage = 2
                        end if
                        if AttackWPStage == 1
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP2}
                                    Number = 0
                                    begin loop
                                        CurrWP2 = marker at {Waypoint2} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP2}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP2} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    elsif AttackWPStage == 2
                        if {SiegeWeapon} near {CurrWP3} radius 33
                            AttackWPStage = 3
                        end if
                        if AttackWPStage == 2
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP3}
                                    Number = 0
                                    begin loop
                                        CurrWP3 = marker at {Waypoint3} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP3}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP3} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    elsif AttackWPStage == 3
                        if {SiegeWeapon} near {CurrWP4} radius 33
                            AttackWPStage = 4
                        end if
                        if AttackWPStage == 3
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP4}
                                    Number = 0
                                    begin loop
                                        CurrWP4 = marker at {Waypoint4} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP4}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP4} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    end if
                end if
            end if

        elsif AttackImmediately == 1
            EnemySettlement = get nearest town at {SiegeWeapon} for player Counter radius AttackRadiusTown
            if EnemySettlement not exists and AttackWPStage == 4
                if EnemyIDFinal[PlayerID] == 0
                    EnemySettlement = PlayerTown1
                elsif EnemyIDFinal[PlayerID] == 1
                    EnemySettlement = PlayerTown2
                elsif EnemyIDFinal[PlayerID] == 2
                    EnemySettlement = PlayerTown3
                elsif EnemyIDFinal[PlayerID] == 3
                    EnemySettlement = PlayerTown4
                end if
            end if
            EnemyTownCentre = get building ABODE_NUMBER_TOWN_CENTRE in EnemySettlement min built 1.0
            if EnemySettlement exists and EnemyTownCentre exists and PLAYER of EnemySettlement != PlayerID and get ActionTimer time remaining <= 0
                //enable siege weapon SiegeWeapon auto attack
                ActionTimer = create timer for 60 seconds
                if number from 1 to 10 >= 7
                    Number = number from 1 to 3
                    if Number == 1 or Number == 2
                        objSubType = 33
                        GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius AttackRadiusTown
                        if GateHouse exists and PLAYER of GateHouse == Counter
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                        else
                            GateHouse = get random abode of type constant objSubType in town EnemySettlement
                            if GateHouse exists and PLAYER of GateHouse == Counter
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                            else
                                objSubType = 34
                                GateHouse = get HOUSE constant objSubType at {SiegeWeapon} radius AttackRadiusTown
                                if GateHouse exists and PLAYER of GateHouse == Counter
                                    clear siege weapon SiegeWeapon action queue
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                else
                                    GateHouse = get random abode of type constant objSubType in town EnemySettlement
                                    if GateHouse exists and PLAYER of GateHouse == Counter
                                        clear siege weapon SiegeWeapon action queue
                                        add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using GateHouse to siege weapon SiegeWeapon action queue
                                    else
                                        ActionTimer = create timer for 0.025 seconds
                                    end if
                                end if
                            end if
                        end if
                    elsif Number == 3
                        Wall1 = get wall segment nearest {SiegeWeapon} radius AttackRadiusTown * 3
                        if Wall1 exists and PLAYER of Wall1 == Counter
                            clear siege weapon SiegeWeapon action queue
                            add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                        else
                            Wall1 = get wall segment nearest {EnemySettlement} radius AttackRadiusTown * 3
                            if Wall1 exists and PLAYER of Wall1 == Counter
                                clear siege weapon SiegeWeapon action queue
                                add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Wall1 to siege weapon SiegeWeapon action queue
                            else
                                ActionTimer = create timer for 0.025 seconds
                            end if
                        end if
                    end if
                else
                    if SiegeWeapon can navigate to object EnemyTownCentre
                        ActionTimer = create timer for 60 seconds
                        wait 2 seconds
                        if AttackFocus == Default
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 8
                            if Number == 1 or Number == 2 or Number == 3
                                Building = get random abode of type ALTAR in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type TEMPLE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type CREATURE_PEN in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type UNIVERSITY in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 7
                                Building = get random abode of type BATHHOUSE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 8
                                Building = get random abode of type AMPITHEATRE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Houses
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 6
                            if Number == 1
                                Building = get random abode of type ABODE_A in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 2
                                Building = get random abode of type ABODE_B in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 3
                                Building = get random abode of type ABODE_C in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 4
                                Building = get random abode of type ABODE_D in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 5
                                Building = get random abode of type ABODE_E in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            elsif Number == 6
                                Building = get random abode of type SKYSCRAPER in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ABODE_A in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_B in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_C in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_D in EnemySettlement min built 1.0 + get number of type HOUSE ABODE_E in EnemySettlement min built 1.0 + get number of type HOUSE SKYSCRAPER in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Epics
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get WONDER in EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type WONDER WONDER_SIREN in EnemySettlement min built 1.0 + get number of type WONDER WONDER_HURRICANE in EnemySettlement min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in EnemySettlement min built 1.0 + get number of type WONDER WONDER_VOLCANO in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == Altars
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type ALTAR in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE ALTAR in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == CreaturePen
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type CREATURE_PEN in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if (get number of type HOUSE CREATURE_PEN in EnemySettlement min built 1.0) == 0
                                AttackFocus = Default
                            end if
                        elsif AttackFocus == TownCenter
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get random abode of type TOWN_CENTRE in town EnemySettlement
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                        elsif AttackFocus == Villagers
                            clear siege weapon SiegeWeapon action queue
                            Building = 0
                            Number = number from 1 to 1
                            if Number == 1
                                Building = get living villager at {EnemySettlement} + {number from -125 to 125,number from -125 to 125} radius AttackRadiusTown
                                if Building exists and HEALTH of Building > 0.0
                                    add action SIEGEWEAPON_AGENDA_ACTION_ATTACK_THING using Building to siege weapon SiegeWeapon action queue
                                else
                                    Building = 0
                                    ActionTimer = create timer for 0.025 seconds
                                end if
                            end if
                            if size of EnemySettlement <= 60
                                AttackFocus = Default
                            end if
                        end if
                    else
                        ActionTimer = create timer for 0.025 seconds
                    end if
                end if
            end if

            if get PlatoonMoveTimer1[PlayerID] time remaining <= 0 or get PlatoonMoveTimer2[PlayerID] time remaining <= 0 or get PlatoonMoveTimer3[PlayerID] time remaining <= 0 or get PlatoonMoveTimer4[PlayerID] time remaining <= 0
                if AttackWPStage != 4 and get PlatoonWaitTimer[PlayerID] time remaining <= 0
                    if AttackWPStage == 0
                        if {SiegeWeapon} near {CurrWP1} radius 33
                            AttackWPStage = 1
                        end if
                        if AttackWPStage == 0
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP1}
                                    Number = 0
                                    begin loop
                                        CurrWP1 = marker at {Waypoint1} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP1}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP1} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    elsif AttackWPStage == 1
                        if {SiegeWeapon} near {CurrWP2} radius 33
                            AttackWPStage = 2
                        end if
                        if AttackWPStage == 1
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP2}
                                    Number = 0
                                    begin loop
                                        CurrWP2 = marker at {Waypoint2} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP2}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP2} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    elsif AttackWPStage == 2
                        if {SiegeWeapon} near {CurrWP3} radius 33
                            AttackWPStage = 3
                        end if
                        if AttackWPStage == 2
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP3}
                                    Number = 0
                                    begin loop
                                        CurrWP3 = marker at {Waypoint3} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP3}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP3} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    elsif AttackWPStage == 3
                        if {SiegeWeapon} near {CurrWP4} radius 33
                            AttackWPStage = 4
                        end if
                        if AttackWPStage == 3
                            if get size of siege weapon SiegeWeapon action queue < 1
                                if not SiegeWeapon can navigate to {CurrWP4}
                                    Number = 0
                                    begin loop
                                        CurrWP4 = marker at {Waypoint4} + {number from -66 to 66,number from -66 to 66}
                                        Number++
                                        until SiegeWeapon not exists or SiegeWeapon can navigate to {CurrWP4}
                                    end loop
                                end if
                                add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {CurrWP4} to siege weapon SiegeWeapon action queue
                            end if
                        end if
                    end if
                end if
            end if

        elsif SK_ALLOWED_TO_ATTACK[PlayerID] == 0 and startAttack == 0 and get WaypointTimer time remaining <= 0
            if not SiegeWeapon can navigate to {WaypointTown} or WaypointTown == 0
                begin loop
                    RandomHome = get random home in town SK_AIHomeTown[PlayerID]
                    if RandomHome exists
                        WaypointTown = marker at {RandomHome} + {number from -75 to 75,number from -75 to 75}
                    else
                        WaypointTown = marker at {SK_AIHomeTown[PlayerID]} + {number from -150 to 150,number from -150 to 150}
                    end if
                    until SiegeWeapon can navigate to {WaypointTown}
                end loop
            end if
            WaypointTimer = create timer for 200 seconds
            add action SIEGEWEAPON_AGENDA_ACTION_MOVE_TO_POS using {WaypointTown} to siege weapon SiegeWeapon action queue
        end if

    end if

    Counter++
    until SiegeWeapon not exists
end loop

//say "Siege Script Ended"

end script SK_SiegeWeaponBehaivours

begin script SK_ArmyTimers(PlayerID)

start

PlatoonMoveTimer1[PlayerID] = create timer for 0 seconds
PlatoonMoveTimer2[PlayerID] = create timer for 0 seconds
PlatoonMoveTimer3[PlayerID] = create timer for 0 seconds
PlatoonMoveTimer4[PlayerID] = create timer for 0 seconds

begin loop
    /*if get PlatoonMoveTimer1[PlayerID] time remaining <= 0 or get PlatoonMoveTimer2[PlayerID] time remaining <= 0 or get PlatoonMoveTimer3[PlayerID] time remaining <= 0
        wait 5 seconds
        PlatoonMoveTimer1[PlayerID] = create timer for 15 seconds
        PlatoonMoveTimer2[PlayerID] = create timer for 15 seconds
        PlatoonMoveTimer4[PlayerID] = create timer for 15 seconds
    end if*/
    if get PlatoonMoveTimer3[PlayerID] time remaining <= 0 or ReadyToAttack[PlayerID] >= 5
        wait 100 seconds
        ReadyToAttack[PlayerID] = 0
        PlatoonMoveTimer3[PlayerID] = create timer for 250 seconds
    end if
end loop

end script SK_ArmyTimers

begin script PlatoonTargetingMetric(PlayerID,PlatoonSize,TargetTown,EnemyPlayer)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player EnemyPlayer mana > 20000
    AltarsProbability += 60
end if

if get player EnemyPlayer mana > 50000
    AltarsProbability += 60
end if

if adult size of TargetTown > 120
    VillagersProbability *= adult size of TargetTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

PlatoonTargetingMetricFocusResult[PlayerID] = DesiredTarget

//say "PlatoonTargetingMetricFocusResult = $d" with number PlatoonTargetingMetricFocusResult

end script PlatoonTargetingMetric

begin script CatapultTargetingMetric(PlayerID,TargetTown,EnemyPlayer)

    HousesProbability = 30
    EpicsProbability = 50
    AltarsProbability = 60
    CreaturePenProbability = 30
    TownProbability = 50
    VillagersProbability = 0
    DefaultProbability = 100
    ProbabilityCombined = 0
    Percentage = 0
    DesiredTarget = 0
    TargetChance = 0
    PlayerCreature = 0

start

//Modify Probabilities based on different factors
if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 1
    CreaturePenProbability += 50
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) > 1
    AltarsProbability *= get number of type HOUSE ALTAR in TargetTown min built 1.0
end if

if get player EnemyPlayer mana > 10000
    AltarsProbability += 60
end if

if get player EnemyPlayer mana > 30000
    AltarsProbability += 60
end if

if adult size of TargetTown > 120
    VillagersProbability *= adult size of TargetTown / 100
end if

//Then again set probability to zero of no building exists
if (get number of type HOUSE ABODE_A in TargetTown min built 1.0 + get number of type HOUSE ABODE_B in TargetTown min built 1.0 + get number of type HOUSE ABODE_C in TargetTown min built 1.0 + get number of type HOUSE ABODE_D in TargetTown min built 1.0 + get number of type HOUSE ABODE_E in TargetTown min built 1.0 + get number of type HOUSE SKYSCRAPER in TargetTown min built 1.0) == 0
    HousesProbability = 0
end if

if (get number of type WONDER WONDER_SIREN in TargetTown min built 1.0 + get number of type WONDER WONDER_HURRICANE in TargetTown min built 1.0 + get number of type WONDER WONDER_EARTHQUAKE in TargetTown min built 1.0 + get number of type WONDER WONDER_VOLCANO in TargetTown min built 1.0) == 0
    EpicsProbability = 0
end if

if (get number of type HOUSE ALTAR in TargetTown min built 1.0) == 0
    AltarsProbability = 0
end if

if (get number of type HOUSE CREATURE_PEN in TargetTown min built 1.0) == 0
    CreaturePenProbability = 0
end if

if size of TargetTown <= 60
    VillagersProbability = 0
end if

//Determine random target
ProbabilityCombined = HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability + DefaultProbability
Percentage = number from 0 to ProbabilityCombined
if Percentage < (HousesProbability)
    DesiredTarget = Houses

elsif Percentage < (HousesProbability + EpicsProbability)
    DesiredTarget = Epics

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability)
    DesiredTarget = Altars

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability)
    DesiredTarget = CreaturePen

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability)
    DesiredTarget = TownCenter

elsif Percentage < (HousesProbability + EpicsProbability + AltarsProbability + CreaturePenProbability + TownProbability + VillagersProbability)
    DesiredTarget = Villagers

else
    DesiredTarget = Default

end if

CatapultTargetingMetricFocusResult[PlayerID] = DesiredTarget

end script CatapultTargetingMetric