///////////////////////////////////////////////////////////////////////////////
//          Weather Script
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//TODO: visual effects for gods in town

define minWeatherDelay = 225
define maxWeatherDelay = 975
define minActive = 300
define maxActive = 600
define minLightningDelay = 5
define maxLightningDelay = 50

define script Weather
define script WeatherSkyTransitions
define script WeatherVisuals

global WT_SkyTransitionAllowed = 1
global WT_SkyTransitionGlobalInfluence = 0

run script Weather

begin script Weather

    Counter = 0
    WeatherMode = 0
    PlayerAlignment = 0
    LightningAmount = 0
    LightningCounter = 0
    Number = 0
    WaitTimer = 0
    Weather[265]
    WeatherAmount = 0
    WeatherEndTimer = create timer for 0 seconds
    WeatherGroup = 0
    WeatherNumber = 0

start

run background script WeatherSkyTransitions
run background script WeatherVisuals

//No weather in land 9
if get land number != 9
    begin loop
        wait number from minWeatherDelay to maxWeatherDelay seconds

        if get player 0 alignment > -0.5 and get player 0 alignment < 0.5 //Neutral weather
            Counter = 0
            WeatherMode = number from 1 to 6
            if WeatherMode == 1 //Rainy weather
                WeatherAmount = number from 1 to 50
                WeatherGroup = number from 3 to 11
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 2 //Light rainy weather
                WeatherAmount = number from 1 to 33
                WeatherGroup = number from 3 to 8
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 3 //Cloudy
                WeatherAmount = number from 1 to 45
                WeatherGroup = number from 3 to 11
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 4 //Light clouds
                WeatherAmount = number from 1 to 15
                WeatherGroup = number from 2 to 5
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while
            end if
        elsif get player 0 alignment >= 0.5 //Good weather
            Counter = 0
            WeatherMode = number from 1 to 6
            if WeatherMode == 1 //Rainy weather
                WeatherAmount = number from 1 to 33
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 2 //Light rainy weather
                WeatherAmount = number from 1 to 15
                WeatherGroup = number from 3 to 5
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 3 //Cloudy
                WeatherAmount = number from 1 to 25
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 4 //Light clouds
                WeatherAmount = number from 1 to 7
                WeatherGroup = number from 2 to 3
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 5 //Rainy and lightning
                WeatherAmount = number from 1 to 27
                WeatherGroup = number from 2 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while
            end if

        elsif get player 0 alignment <= -0.5 //Evil weather
            Counter = 0
            WeatherMode = number from 1 to 7
            if WeatherMode == 1 //Rainy weather
                WeatherAmount = number from 1 to 33
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 2 //Light rainy weather
                WeatherAmount = number from 1 to 15
                WeatherGroup = number from 3 to 5
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 3 //Cloudy
                WeatherAmount = number from 1 to 25
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 4 //Light clouds
                WeatherAmount = number from 1 to 7
                WeatherGroup = number from 2 to 3
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 5 //Rainy and lightning
                WeatherAmount = number from 1 to 37
                WeatherGroup = number from 4 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 6 //Rainy and more lightning
                WeatherAmount = number from 1 to 37
                WeatherGroup = number from 4 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        SCALE of Weather[Counter] = 5
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while
            end if
        end if

        WeatherEndTimer = create timer for number from minActive to maxActive seconds
        while get WeatherEndTimer time remaining > 0
            wait number from minLightningDelay to maxLightningDelay seconds
            LightningCounter = 0
            if WeatherMode == 5
                LightningAmount = number from 1 to 4
                while LightningCounter <= LightningAmount
                    Number = number from 0 to 254
                    if Weather[Number] exists
                        set lightning strike at {Weather[Number]} + {number from -80 to 80,0,number from -80 to 80} from Weather[Number] scale 1
                        wait number from 2 to 6 seconds
                        LightningCounter++
                    end if
                end while
            elsif WeatherMode == 6
                LightningAmount = number from 2 to 16
                while LightningCounter <= LightningAmount
                    Number = number from 0 to 254
                    if Weather[Number] exists
                        set lightning strike at {Weather[Number]} + {number from -80 to 80,0,number from -80 to 80} from Weather[Number] scale 1
                        wait number from 0 to 4 seconds
                        LightningCounter++
                    end if
                end while
            end if
        end while

        Counter = 0
        while Counter < WeatherAmount
            if Weather[Counter] exists
                wait until not {Weather[Counter]} viewed
                delete Weather[Counter]
            end if
            Counter++
        end while
    end loop
end if

end script Weather


begin script WeatherSkyTransitions
    PAlignment = 0
    PInfluence = 0
    PInfluenceCounter = 0
    PlayerID = 0
    PTown = 0
    SkySettingsActive = 0
    ChangeSkyTimer = create timer for 0 seconds

start

begin loop
    if PlayerID >= 4
        PlayerID = 0
    end if
    if WT_SkyTransitionAllowed == 1 //Skytransition is disabled during epic or scripted predefined sky
        if WT_SkyTransitionGlobalInfluence == 0 and get player 0 influence at camera position == 0 and get player 1 influence at camera position == 0 and get player 2 influence at camera position == 0 and get player 3 influence at camera position == 0 and SkySettingsActive != 0
            //say "DEFAULT"
            SkySettingsActive = 0
            enable predefined sky "DEFAULT" time 2.5
            wait 2.5 seconds
        else
            if WT_SkyTransitionGlobalInfluence == 1 //If player has won only use him as a base
                PlayerID = 0
            end if
            PInfluence = get player PlayerID influence at camera position
            if PInfluence > 0 or WT_SkyTransitionGlobalInfluence == 1
                PAlignment = get player PlayerID alignment
                if (get game time >= 17.5 and get game time <= 20.5) or (get game time >= 6 and get game time <= 9) //Sunrise, Sunset
                    if PAlignment >= 0.9 and PAlignment <= 1.0
                        if SkySettingsActive != 1
                            //say "ALIGN-GS3"
                            SkySettingsActive = 1
                            if get land number != 9
                                enable predefined sky "ALIGN-GS3" time 2.5
                            else
                                enable predefined sky "ALIGN-GS3L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment >= 0.65 and PAlignment < 0.9
                        if SkySettingsActive != 2
                            //say "ALIGN-GS2"
                            SkySettingsActive = 2
                            if get land number != 9
                                enable predefined sky "ALIGN-GS2" time 2.5
                            else
                                enable predefined sky "ALIGN-GS2L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment >= 0.3 and PAlignment < 0.65
                        if SkySettingsActive != 3
                            //say "ALIGN-GS1"
                            SkySettingsActive = 3
                            if get land number != 9
                                enable predefined sky "ALIGN-GS1" time 2.5
                            else
                                enable predefined sky "ALIGN-GS1L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.3 and PAlignment > -0.65
                        if SkySettingsActive != 4
                            //say "ALIGN-ES1"
                            SkySettingsActive = 4
                            if get land number != 9
                                enable predefined sky "ALIGN-ES1" time 2.5
                            else
                                enable predefined sky "ALIGN-ES1L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.65 and PAlignment > -0.9
                        if SkySettingsActive != 5
                            //say "ALIGN-ES2"
                            SkySettingsActive = 5
                            if get land number != 9
                                enable predefined sky "ALIGN-ES2" time 2.5
                            else
                                enable predefined sky "ALIGN-ES2L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.9 and PAlignment >= -1.0
                        if SkySettingsActive != 6
                            //say "ALIGN-ES3"
                            SkySettingsActive = 6
                            if get land number != 9
                                enable predefined sky "ALIGN-ES3" time 2.5
                            else
                                enable predefined sky "ALIGN-ES3L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    end if
                elsif get game time < 17.5 and get game time > 9 //Day
                    if PAlignment >= 0.9 and PAlignment <= 1.0
                        if SkySettingsActive != 7
                            //say "ALIGN-G3"
                            SkySettingsActive = 7
                            if get land number != 9
                                enable predefined sky "ALIGN-G3" time 2.5
                            else
                                enable predefined sky "ALIGN-G3L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment >= 0.65 and PAlignment < 0.9
                        if SkySettingsActive != 8
                            //say "ALIGN-G2"
                            SkySettingsActive = 8
                            if get land number != 9
                                enable predefined sky "ALIGN-G2" time 2.5
                            else
                                enable predefined sky "ALIGN-G2L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment >= 0.3 and PAlignment < 0.65
                        if SkySettingsActive != 9
                            //say "ALIGN-G1"
                            SkySettingsActive = 9
                            if get land number != 9
                                enable predefined sky "ALIGN-G1" time 2.5
                            else
                                enable predefined sky "ALIGN-G1L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.3 and PAlignment > -0.65
                        if SkySettingsActive != 10
                            //say "ALIGN-E1"
                            SkySettingsActive = 10
                            if get land number != 9
                                enable predefined sky "ALIGN-E1" time 2.5
                            else
                                enable predefined sky "ALIGN-E1L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.65 and PAlignment > -0.9
                        if SkySettingsActive != 11
                            //say "ALIGN-E2"
                            SkySettingsActive = 11
                            if get land number != 9
                                enable predefined sky "ALIGN-E2" time 2.5
                            else
                                enable predefined sky "ALIGN-E2L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.9 and PAlignment >= -1.0
                        if SkySettingsActive != 12
                            //say "ALIGN-E3"
                            SkySettingsActive = 12
                            if get land number != 9
                                enable predefined sky "ALIGN-E3" time 2.5
                            else
                                enable predefined sky "ALIGN-E3L9" time 2.5
                            end if
                            wait 2.5 seconds
                        end if
                    end if
                elsif get game time > 20.5 or get game time < 6 //Night
                    if PAlignment >= 0.9 and PAlignment <= 1.0
                        if SkySettingsActive != 13
                            //say "ALIGN-GN3"
                            SkySettingsActive = 13
                            enable predefined sky "ALIGN-GN3" time 2.5
                            wait 2.5 seconds
                        end if
                    elsif PAlignment >= 0.65 and PAlignment < 0.9
                        if SkySettingsActive != 14
                            //say "ALIGN-GN2"
                            SkySettingsActive = 14
                            enable predefined sky "ALIGN-GN2" time 2.5
                            wait 2.5 seconds
                        end if
                    elsif PAlignment >= 0.3 and PAlignment < 0.65
                        if SkySettingsActive != 15
                            //say "ALIGN-GN1"
                            SkySettingsActive = 15
                            enable predefined sky "ALIGN-GN1" time 2.5
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.3 and PAlignment > -0.65
                        if SkySettingsActive != 16
                            //say "ALIGN-EN1"
                            SkySettingsActive = 16
                            enable predefined sky "ALIGN-EN1" time 2.5
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.65 and PAlignment > -0.9
                        if SkySettingsActive != 17
                            //say "ALIGN-EN2"
                            SkySettingsActive = 17
                            enable predefined sky "ALIGN-EN2" time 2.5
                            wait 2.5 seconds
                        end if
                    elsif PAlignment <= -0.9 and PAlignment >= -1.0
                        if SkySettingsActive != 18
                            //say "ALIGN-EN3"
                            SkySettingsActive = 18
                            enable predefined sky "ALIGN-EN3" time 2.5
                            wait 2.5 seconds
                        end if
                    end if
                end if
            end if
        end if
    else
        wait until WT_SkyTransitionAllowed == 1
        wait 2.5 seconds
    end if
    PlayerID++
end loop

end script WeatherSkyTransitions


begin script WeatherVisuals

start

end script WeatherVisuals