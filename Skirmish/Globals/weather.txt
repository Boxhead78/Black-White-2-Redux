///////////////////////////////////////////////////////////////////////////////
//          Weather Script
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//TODO: visual effects for gods in town

define minWeatherDelay = 225
define maxWeatherDelay = 975
define minActive = 300
define maxActive = 600
define minLightningDelay = 5
define maxLightningDelay = 50

define script Weather
define script WeatherSkyTransitions
define script WeatherVisuals

global WT_SkyTransitionAllowed = 1
global WT_SkyTransitionGlobalInfluence = 0

run script Weather

begin script Weather

    Counter = 0
    WeatherMode = 0
    PlayerAlignment = 0
    LightningAmount = 0
    LightningCounter = 0
    Number = 0
    WaitTimer = 0
    Weather[265]
    WeatherAmount = 0
    WeatherEndTimer = create timer for 0 seconds
    WeatherGroup = 0
    WeatherNumber = 0

start

run background script WeatherSkyTransitions
run background script WeatherVisuals

//No weather in land 9
if get land number == 9
    stop script "Weather"
end if

begin loop
    wait number from minWeatherDelay to maxWeatherDelay seconds

    if get player 0 alignment > -0.5 and get player 0 alignment < 0.5 //Neutral weather
        Counter = 0
        WeatherMode = number from 1 to 6
        if WeatherMode == 1 //Rainy weather
            WeatherAmount = number from 1 to 50
            WeatherGroup = number from 3 to 11
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 2 //Light rainy weather
            WeatherAmount = number from 1 to 33
            WeatherGroup = number from 3 to 8
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 3 //Cloudy
            WeatherAmount = number from 1 to 45
            WeatherGroup = number from 3 to 11
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 4 //Light clouds
            WeatherAmount = number from 1 to 15
            WeatherGroup = number from 2 to 5
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while
        end if
    elsif get player 0 alignment >= 0.5 //Good weather
        Counter = 0
        WeatherMode = number from 1 to 6
        if WeatherMode == 1 //Rainy weather
            WeatherAmount = number from 1 to 33
            WeatherGroup = number from 3 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 2 //Light rainy weather
            WeatherAmount = number from 1 to 15
            WeatherGroup = number from 3 to 5
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 3 //Cloudy
            WeatherAmount = number from 1 to 25
            WeatherGroup = number from 3 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 4 //Light clouds
            WeatherAmount = number from 1 to 7
            WeatherGroup = number from 2 to 3
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 5 //Rainy and lightning
            WeatherAmount = number from 1 to 27
            WeatherGroup = number from 2 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while
        end if

    elsif get player 0 alignment <= -0.5 //Evil weather
        Counter = 0
        WeatherMode = number from 1 to 7
        if WeatherMode == 1 //Rainy weather
            WeatherAmount = number from 1 to 33
            WeatherGroup = number from 3 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 2 //Light rainy weather
            WeatherAmount = number from 1 to 15
            WeatherGroup = number from 3 to 5
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 3 //Cloudy
            WeatherAmount = number from 1 to 25
            WeatherGroup = number from 3 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 4 //Light clouds
            WeatherAmount = number from 1 to 7
            WeatherGroup = number from 2 to 3
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 5 //Rainy and lightning
            WeatherAmount = number from 1 to 37
            WeatherGroup = number from 4 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while

        elsif WeatherMode == 6 //Rainy and more lightning
            WeatherAmount = number from 1 to 37
            WeatherGroup = number from 4 to 7
            while Counter < WeatherAmount and Counter < 255
                WeatherNumber = number from 1 to 3
                if WeatherNumber == 1
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                elsif WeatherNumber == 2
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                else
                    Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                end if
                set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                SCALE of Weather[Counter] = 5
                enable Weather[Counter] affected by wind
                Counter++
                while Counter < WeatherGroup and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    SCALE of Weather[Counter] = 5
                    enable Weather[Counter] affected by wind
                    Counter++
                end while
            end while
        end if
    end if

    WeatherEndTimer = create timer for number from minActive to maxActive seconds
    while get WeatherEndTimer time remaining > 0
        wait number from minLightningDelay to maxLightningDelay seconds
        LightningCounter = 0
        if WeatherMode == 5
            LightningAmount = number from 1 to 4
            while LightningCounter <= LightningAmount
                Number = number from 0 to 254
                if Weather[Number] exists
                    set lightning strike at {Weather[Number]} + {number from -80 to 80,0,number from -80 to 80} from Weather[Number] scale 1
                    wait number from 2 to 6 seconds
                    LightningCounter++
                end if
            end while
        elsif WeatherMode == 6
            LightningAmount = number from 2 to 16
            while LightningCounter <= LightningAmount
                Number = number from 0 to 254
                if Weather[Number] exists
                    set lightning strike at {Weather[Number]} + {number from -80 to 80,0,number from -80 to 80} from Weather[Number] scale 1
                    wait number from 0 to 4 seconds
                    LightningCounter++
                end if
            end while
        end if
    end while

    Counter = 0
    while Counter < WeatherAmount
        if Weather[Counter] exists
            wait until not {Weather[Counter]} viewed
            delete Weather[Counter]
        end if
        Counter++
    end while
end loop

end script Weather


begin script WeatherSkyTransitions
    PAlignment = 0
    PInfluence = 0
    PInfluenceCounter = 0
    PlayerID = 0
    PTown = 0
    SkySettingsActive = 0

start

begin loop
    if PlayerID >= 4
        PlayerID = 0
    end if
    if WT_SkyTransitionAllowed == 1 //Skytransition is disabled during epic or scripted predefined sky
        if WT_SkyTransitionGlobalInfluence == 0 and get player 0 influence at camera position == 0 and get player 1 influence at camera position == 0 and get player 2 influence at camera position == 0 and get player 3 influence at camera position == 0 and SkySettingsActive != 0
            //say "DEFAULT"
            SkySettingsActive = 0
            enable predefined sky "DEFAULT" time 0.75
            wait 0.75 seconds
        else
            if WT_SkyTransitionGlobalInfluence == 1 //If player has won only use him as a base
                PlayerID = 0
            end if
            PInfluence = get player PlayerID influence at camera position
            if PInfluence > 0 or WT_SkyTransitionGlobalInfluence == 1
                PAlignment = get player PlayerID alignment
                if get game time <= 20 and get game time >= 6
                    if PAlignment >= 0.9 and PAlignment <= 1.0
                        if SkySettingsActive != 3
                            //say "ALIGNMENTG3"
                            SkySettingsActive = 3
                            if get land number != 9
                                enable predefined sky "ALIGNMENTG3" time 0.75
                            else
                                enable predefined sky "ALIGNMENTG3L9" time 0.75
                            end if
                            wait 0.75 seconds
                        end if
                    elsif PAlignment >= 0.65 and PAlignment < 0.9
                        if SkySettingsActive != 2
                            //say "ALIGNMENTG2"
                            SkySettingsActive = 2
                            if get land number != 9
                                enable predefined sky "ALIGNMENTG2" time 0.75
                            else
                                enable predefined sky "ALIGNMENTG2L9" time 0.75
                            end if
                            wait 0.75 seconds
                        end if
                    elsif PAlignment >= 0.3 and PAlignment < 0.65
                        if SkySettingsActive != 1
                            //say "ALIGNMENTG1"
                            SkySettingsActive = 1
                            if get land number != 9
                                enable predefined sky "ALIGNMENTG1" time 0.75
                            else
                                enable predefined sky "ALIGNMENTG1L9" time 0.75
                            end if
                            wait 0.75 seconds
                        end if
                    elsif PAlignment <= -0.3 and PAlignment > -0.65
                        if SkySettingsActive != -1
                            //say "ALIGNMENTE1"
                            SkySettingsActive = -1
                            if get land number != 9
                                enable predefined sky "ALIGNMENTE3" time 0.75
                            else
                                enable predefined sky "ALIGNMENTE3L9" time 0.75
                            end if
                            wait 0.75 seconds
                        end if
                    elsif PAlignment <= -0.65 and PAlignment > -0.9
                        if SkySettingsActive != -2
                            //say "ALIGNMENTE2"
                            SkySettingsActive = -2
                            if get land number != 9
                                enable predefined sky "ALIGNMENTE2" time 0.75
                            else
                                enable predefined sky "ALIGNMENTE2L9" time 0.75
                            end if
                            wait 0.75 seconds
                        end if
                    elsif PAlignment <= -0.9 and PAlignment >= -1.0
                        if SkySettingsActive != -3
                            //say "ALIGNMENTE3"
                            SkySettingsActive = -3
                            if get land number != 9
                                enable predefined sky "ALIGNMENTE1" time 0.75
                            else
                                enable predefined sky "ALIGNMENTE1L9" time 0.75
                            end if
                            wait 0.75 seconds
                        end if
                    end if
                elsif get game time > 20 or get game time < 6
                    if PAlignment >= 0.9 and PAlignment <= 1.0
                        if SkySettingsActive != 6
                            //say "ALIGNMENTGN3"
                            SkySettingsActive = 6
                            enable predefined sky "ALIGNMENTGN3" time 0.75
                            wait 0.75 seconds
                        end if
                    elsif PAlignment >= 0.65 and PAlignment < 0.9
                        if SkySettingsActive != 5
                            //say "ALIGNMENTGN2"
                            SkySettingsActive = 5
                            enable predefined sky "ALIGNMENTGN2" time 0.75
                            wait 0.75 seconds
                        end if
                    elsif PAlignment >= 0.3 and PAlignment < 0.65
                        if SkySettingsActive != 4
                            //say "ALIGNMENTGN1"
                            SkySettingsActive = 4
                            enable predefined sky "ALIGNMENTGN1" time 0.75
                            wait 0.75 seconds
                        end if
                    elsif PAlignment <= -0.3 and PAlignment > -0.65
                        if SkySettingsActive != -4
                            //say "ALIGNMENTEN1"
                            SkySettingsActive = -4
                            enable predefined sky "ALIGNMENTEN1" time 0.75
                            wait 0.75 seconds
                        end if
                    elsif PAlignment <= -0.65 and PAlignment > -0.9
                        if SkySettingsActive != -5
                            //say "ALIGNMENTEN2"
                            SkySettingsActive = -5
                            enable predefined sky "ALIGNMENTEN2" time 0.75
                            wait 0.75 seconds
                        end if
                    elsif PAlignment <= -0.9 and PAlignment >= -1.0
                        if SkySettingsActive != -6
                            //say "ALIGNMENTEN3"
                            SkySettingsActive = -6
                            enable predefined sky "ALIGNMENTEN3" time 0.75
                            wait 0.75 seconds
                        end if
                    end if
                end if
            end if
        end if
    else
        wait until WT_SkyTransitionAllowed == 1
        wait 2.5 seconds
    end if
    PlayerID++
end loop

end script WeatherSkyTransitions


begin script WeatherVisuals

start

end script WeatherVisuals