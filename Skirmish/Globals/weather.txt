///////////////////////////////////////////////////////////////////////////////
//          Weather Script
//    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
///////////////////////////////////////////////////////////////////////////////

//TODO: visual effects for gods in town

define minWeatherDelay = 225
define maxWeatherDelay = 975
define minActive = 300
define maxActive = 600
define minLightningDelay = 5
define maxLightningDelay = 50
define skyTransitionDuration = 2.5
define skyTransitionWaitTime = 3
define WT_SUNSET = 0
define WT_DAY = 1
define WT_NIGHT = 2

define SK_DEFAULT = 0
//Evil skies
define ALIGNE1 = 1
define ALIGNE1L9 = 2
define ALIGNE2 = 3
define ALIGNE2L9 = 4
define ALIGNE3 = 5
define ALIGNE3L9 = 6
define ALIGNEN1 = 7
define ALIGNEN2 = 8
define ALIGNEN3 = 9
define ALIGNES1 = 10
define ALIGNES1L9 = 11
define ALIGNES2 = 12
define ALIGNES2L9 = 13
define ALIGNES3 = 14
define ALIGNES3L9 = 15
//Good skies
define ALIGNG1 = 16
define ALIGNG1L9 = 17
define ALIGNG2 = 18
define ALIGNG2L9 = 19
define ALIGNG3 = 20
define ALIGNG3L9 = 21
define ALIGNGN1 = 22
define ALIGNGN2 = 23
define ALIGNGN3 = 24
define ALIGNGS1 = 25
define ALIGNGS1L9 = 26
define ALIGNGS2 = 27
define ALIGNGS2L9 = 28
define ALIGNGS3 = 29
define ALIGNGS3L9 = 30

define script Weather
define script WeatherSkyTransitions
define script WeatherSetSkySetting(PlayerID,whichSkySetting)
define script WeatherSetSkySettingSetter(whichSkySetting)
define script WeatherVisuals

//DON'T CHANGE THESE
global WT_SkyTransitionAllowed = 1
global WT_SkyTransitionGlobalInfluence = 0
global WT_ExitLoop = 0
global WT_SkySetRunning = 0
global WT_ChangeSkyTimer = 0
global WT_skyTransitionDuration = skyTransitionDuration
global WT_skyTransitionWaitTime = skyTransitionWaitTime

run script Weather

begin script Weather

    Counter = 0
    WeatherMode = 0
    PlayerAlignment = 0
    LightningAmount = 0
    LightningCounter = 0
    Number = 0
    WaitTimer = 0
    Weather[265]
    WeatherAmount = 0
    WeatherEndTimer = create timer for 0 seconds
    WeatherGroup = 0
    WeatherNumber = 0

start

run background script WeatherSkyTransitions
run background script WeatherVisuals

//No weather in land 9
if get land number != 9
    begin loop
        wait number from minWeatherDelay to maxWeatherDelay seconds

        if get player 0 alignment > -0.5 and get player 0 alignment < 0.5 //Neutral weather
            Counter = 0
            WeatherMode = number from 1 to 6
            if WeatherMode == 1 //Rainy weather
                WeatherAmount = number from 1 to 50
                WeatherGroup = number from 3 to 11
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 2 //Light rainy weather
                WeatherAmount = number from 1 to 33
                WeatherGroup = number from 3 to 8
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 3 //Cloudy
                WeatherAmount = number from 1 to 45
                WeatherGroup = number from 3 to 11
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 4 //Light clouds
                WeatherAmount = number from 1 to 15
                WeatherGroup = number from 2 to 5
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while
            end if
        elsif get player 0 alignment >= 0.5 //Good weather
            Counter = 0
            WeatherMode = number from 1 to 6
            if WeatherMode == 1 //Rainy weather
                WeatherAmount = number from 1 to 33
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 2 //Light rainy weather
                WeatherAmount = number from 1 to 15
                WeatherGroup = number from 3 to 5
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 3 //Cloudy
                WeatherAmount = number from 1 to 25
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 4 //Light clouds
                WeatherAmount = number from 1 to 7
                WeatherGroup = number from 2 to 3
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 5 //Rainy and lightning
                WeatherAmount = number from 1 to 27
                WeatherGroup = number from 2 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while
            end if

        elsif get player 0 alignment <= -0.5 //Evil weather
            Counter = 0
            WeatherMode = number from 1 to 7
            if WeatherMode == 1 //Rainy weather
                WeatherAmount = number from 1 to 33
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 2 //Light rainy weather
                WeatherAmount = number from 1 to 15
                WeatherGroup = number from 3 to 5
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0.5 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 3 //Cloudy
                WeatherAmount = number from 1 to 25
                WeatherGroup = number from 3 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 4 //Light clouds
                WeatherAmount = number from 1 to 7
                WeatherGroup = number from 2 to 3
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 0 snowfall 0 overcast 0.4
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 5 //Rainy and lightning
                WeatherAmount = number from 1 to 37
                WeatherGroup = number from 4 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while

            elsif WeatherMode == 6 //Rainy and more lightning
                WeatherAmount = number from 1 to 37
                WeatherGroup = number from 4 to 7
                while Counter < WeatherAmount and Counter < 255
                    WeatherNumber = number from 1 to 3
                    if WeatherNumber == 1
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    elsif WeatherNumber == 2
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    else
                        Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {0,number from 300 to 500,0} + {number from 0 to 2500,0,number from 0 to 2500}
                    end if
                    set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                    set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                    set cloud Weather[Counter] points to number from 1 to 4
                    enable Weather[Counter] affected by wind
                    Counter++
                    while Counter < WeatherGroup and Counter < 255
                        WeatherNumber = number from 1 to 3
                        if WeatherNumber == 1
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_MEDIUM_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        elsif WeatherNumber == 2
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_LARGE_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        else
                            Weather[Counter] = create SCRIPT_OBJECT_TYPE_WEATHER_THING WEATHER_INFO_DISTANT_CLOUD at {Weather[Counter]} + {number from -100 to 100,0,number from -100 to 100}
                        end if
                        set cloud for Weather[Counter] above {Weather[Counter]} + {0, 30, 0}
                        set Weather[Counter] properties rainfall 1 snowfall 0 overcast 0.9
                        set cloud Weather[Counter] points to number from 1 to 4
                        enable Weather[Counter] affected by wind
                        Counter++
                    end while
                end while
            end if
        end if

        WeatherEndTimer = create timer for number from minActive to maxActive seconds
        while get WeatherEndTimer time remaining > 0
            wait number from minLightningDelay to maxLightningDelay seconds
            LightningCounter = 0
            if WeatherMode == 5
                LightningAmount = number from 1 to 4
                while LightningCounter <= LightningAmount
                    Number = number from 0 to 254
                    if Weather[Number] exists
                        set lightning strike at {Weather[Number]} + {number from -80 to 80,0,number from -80 to 80} from Weather[Number] scale 1
                        wait number from 2 to 6 seconds
                        LightningCounter++
                    end if
                end while
            elsif WeatherMode == 6
                LightningAmount = number from 2 to 16
                while LightningCounter <= LightningAmount
                    Number = number from 0 to 254
                    if Weather[Number] exists
                        set lightning strike at {Weather[Number]} + {number from -80 to 80,0,number from -80 to 80} from Weather[Number] scale 1
                        wait number from 0 to 4 seconds
                        LightningCounter++
                    end if
                end while
            end if
        end while

        Counter = 0
        while Counter < WeatherAmount
            if Weather[Counter] exists
                wait until not {Weather[Counter]} viewed
                delete Weather[Counter]
            end if
            Counter++
        end while
    end loop
end if

end script Weather


begin script WeatherSkyTransitions
    PAlignment = 0
    PInfluence = 0
    PInfluenceCounter = 0
    PlayerID = 0
    PTown = 0
    SkySettingsActive = 0
    ChangeSkyTimer = create timer for 0 seconds
    DayTime = 0
    CauseOfChangeIsTime = 0
    SkySettingsActivated
start

SkySettingsActivated = persistent data "SKYSETTING_CHANGE"
if SkySettingsActivated == 1
    begin loop
        if PlayerID >= 4
            PlayerID = 0
        end if
        WT_ChangeSkyTimer = create timer for WT_skyTransitionWaitTime seconds
        if WT_SkyTransitionAllowed == 1 //Skytransition is disabled during epic or scripted predefined sky
            PInfluence = get player PlayerID influence at camera position
            if WT_SkyTransitionGlobalInfluence == 0 and SkySettingsActive != 0 and PInfluence == 0
                if get player PlayerID influence at camera position == 0
                    wait until get WT_ChangeSkyTimer time remaining <= 0 or get player PlayerID influence at camera position > 0
                    if get player PlayerID influence at camera position == 0
                        //say "DEFAULT"
                        SkySettingsActive = 0
                        WT_ExitLoop = 1
                        wait until WT_SkySetRunning == 0
                        WT_ExitLoop = 0
                        run background script WeatherSetSkySetting(PlayerID,SK_DEFAULT)
                        wait WT_skyTransitionDuration seconds
                    end if
                end if
            else
                if WT_SkyTransitionGlobalInfluence == 1 //If player has won only use him as a base
                    PlayerID = 0
                end if
                if PInfluence > 0 or WT_SkyTransitionGlobalInfluence == 1
                    wait until get WT_ChangeSkyTimer time remaining <= 0 or get player PlayerID influence at camera position == 0 or WT_SkyTransitionGlobalInfluence == 1 or (DayTime == WT_SUNSET and (get game time < 17.5 or get game time > 20.5)) or (DayTime == WT_DAY and (get game time >= 17.5 or get game time <= 9)) or (DayTime == WT_NIGHT and (get game time <= 20.5 or get game time >= 6))
                    PInfluence = get player PlayerID influence at camera position
                    if PInfluence > 0 or WT_SkyTransitionGlobalInfluence == 1
                        PAlignment = get player PlayerID alignment
                        if (DayTime == WT_SUNSET and (get game time < 17.5 or get game time > 20.5)) or (DayTime == WT_DAY and (get game time >= 17.5 or get game time <= 9)) or (DayTime == WT_NIGHT and (get game time <= 20.5 or get game time >= 6))
                            CauseOfChangeIsTime = 1
                            WT_skyTransitionDuration = 40
                        end if
                        if (get game time >= 17.5 and get game time <= 20.5) or (get game time >= 6 and get game time <= 9) //Sunrise, Sunset
                            DayTime = WT_SUNSET
                            if PAlignment >= 0.9 and PAlignment <= 1.0
                                if SkySettingsActive != 1
                                    //say "ALIGN-GS3"
                                    SkySettingsActive = 1
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNGS3)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNGS3L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment >= 0.65 and PAlignment < 0.9
                                if SkySettingsActive != 2
                                    //say "ALIGN-GS2"
                                    SkySettingsActive = 2
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNGS2)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNGS2L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment >= 0.3 and PAlignment < 0.65
                                if SkySettingsActive != 3
                                    //say "ALIGN-GS1"
                                    SkySettingsActive = 3
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNGS1)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNGS1L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.3 and PAlignment > -0.65
                                if SkySettingsActive != 4
                                    //say "ALIGN-ES1"
                                    SkySettingsActive = 4
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNES1)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNES1L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.65 and PAlignment > -0.9
                                if SkySettingsActive != 5
                                    //say "ALIGN-ES2"
                                    SkySettingsActive = 5
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNES2)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNES2L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.9 and PAlignment >= -1.0
                                if SkySettingsActive != 6
                                    //say "ALIGN-ES3"
                                    SkySettingsActive = 6
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNES3)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNES3L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            end if
                        elsif get game time < 17.5 and get game time > 9 //Day
                            DayTime = WT_DAY
                            if PAlignment >= 0.9 and PAlignment <= 1.0
                                if SkySettingsActive != 7
                                    //say "ALIGN-G3"
                                    SkySettingsActive = 7
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNG3)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNG3L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment >= 0.65 and PAlignment < 0.9
                                if SkySettingsActive != 8
                                    //say "ALIGN-G2"
                                    SkySettingsActive = 8
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNG2)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNG2L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment >= 0.3 and PAlignment < 0.65
                                if SkySettingsActive != 9
                                    //say "ALIGN-G1"
                                    SkySettingsActive = 9
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNG1)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNG1L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.3 and PAlignment > -0.65
                                if SkySettingsActive != 10
                                    //say "ALIGN-E1"
                                    SkySettingsActive = 10
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNE1)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNE1L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.65 and PAlignment > -0.9
                                if SkySettingsActive != 11
                                    //say "ALIGN-E2"
                                    SkySettingsActive = 11
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNE2)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNE2L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.9 and PAlignment >= -1.0
                                if SkySettingsActive != 12
                                    //say "ALIGN-E3"
                                    SkySettingsActive = 12
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    if get land number != 9
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNE3)
                                    else
                                        run background script WeatherSetSkySetting(PlayerID,ALIGNE3L9)
                                    end if
                                    wait WT_skyTransitionDuration seconds
                                end if
                            end if
                        elsif get game time > 20.5 or get game time < 6 //Night
                            DayTime = WT_NIGHT
                            if PAlignment >= 0.9 and PAlignment <= 1.0
                                if SkySettingsActive != 13
                                    //say "ALIGN-GN3"
                                    SkySettingsActive = 13
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    run background script WeatherSetSkySetting(PlayerID,ALIGNGN3)
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment >= 0.65 and PAlignment < 0.9
                                if SkySettingsActive != 14
                                    //say "ALIGN-GN2"
                                    SkySettingsActive = 14
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    run background script WeatherSetSkySetting(PlayerID,ALIGNGN2)
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment >= 0.3 and PAlignment < 0.65
                                if SkySettingsActive != 15
                                    //say "ALIGN-GN1"
                                    SkySettingsActive = 15
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    run background script WeatherSetSkySetting(PlayerID,ALIGNGN1)
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.3 and PAlignment > -0.65
                                if SkySettingsActive != 16
                                    //say "ALIGN-EN1"
                                    SkySettingsActive = 16
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    run background script WeatherSetSkySetting(PlayerID,ALIGNEN1)
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.65 and PAlignment > -0.9
                                if SkySettingsActive != 17
                                    //say "ALIGN-EN2"
                                    SkySettingsActive = 17
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    run background script WeatherSetSkySetting(PlayerID,ALIGNEN2)
                                    wait WT_skyTransitionDuration seconds
                                end if
                            elsif PAlignment <= -0.9 and PAlignment >= -1.0
                                if SkySettingsActive != 18
                                    //say "ALIGN-EN3"
                                    SkySettingsActive = 18
                                    WT_ExitLoop = 1
                                    wait until WT_SkySetRunning == 0
                                    WT_ExitLoop = 0
                                    run background script WeatherSetSkySetting(PlayerID,ALIGNEN3)
                                    wait WT_skyTransitionDuration seconds
                                end if
                            end if
                        end if
                        if CauseOfChangeIsTime == 1
                            CauseOfChangeIsTime = 0
                            WT_skyTransitionDuration = skyTransitionWaitTime
                        end if
                    end if
                end if
            end if
        else
            PAlignment = 0
            PInfluence = 0
            PInfluenceCounter = 0
            PlayerID = 0
            PTown = 0
            SkySettingsActive = 0
            ChangeSkyTimer = create timer for 0 seconds
            DayTime = 0
            wait until WT_SkyTransitionAllowed == 1
            wait WT_skyTransitionDuration seconds
        end if
        if SkySettingsActive == 0 PlayerID++ end if
    end loop
end if

end script WeatherSkyTransitions


begin script WeatherSetSkySetting(PlayerID,whichSkySetting)

    PAlignment = 0

start

WT_SkySetRunning = 1

//PAlignment = get player PlayerID alignment
if whichSkySetting == SK_DEFAULT
    if WT_SkyTransitionAllowed == 1 enable predefined sky "DEFAULT" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNE1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E1" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.3 or PAlignment <= -0.65 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNE1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E1L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.3 or PAlignment <= -0.65 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNE2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E2" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.65 or PAlignment <= -0.9 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNE2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E2L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.3 or PAlignment <= -0.65 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNE3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E3" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.9 or PAlignment < -1.0 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNE3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E3L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.9 or PAlignment < -1.0 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNEN1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN1" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.3 or PAlignment <= -0.65 or get game time <= 20.5 or get game time >= 6
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNEN2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN2" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.65 or PAlignment <= -0.9 or get game time <= 20.5 or get game time >= 6
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNEN3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN3" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.9 or PAlignment < -1.0 or get game time <= 20.5 or get game time >= 6
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNES1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES1" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.3 and PAlignment <= -0.65 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNES1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES1L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.3 and PAlignment <= -0.65 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNES2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES2" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.65 or PAlignment <= -0.9 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNES2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES2L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.65 or PAlignment <= -0.9 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNES3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES3" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.9 and PAlignment < -1.0 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNES3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES3L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment > -0.9 and PAlignment < -1.0 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNG1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G1" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.3 or PAlignment >= 0.65 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNG1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G1L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.3 or PAlignment >= 0.65 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNG2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G2" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.65 or PAlignment >= 0.9 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNG2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G2L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.65 or PAlignment >= 0.9 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNG3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G3" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.9 or PAlignment > 1.0 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNG3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G3L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.9 or PAlignment > 1.0 or get game time >= 17.5 or get game time <= 9
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGN1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN1" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.3 or PAlignment >= 0.65 or get game time <= 20.5 or get game time >= 6
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGN2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN2" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.65 or PAlignment >= 0.9 or get game time <= 20.5 or get game time >= 6
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGN3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN3" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.9 or PAlignment > 1.0 or get game time <= 20.5 or get game time >= 6
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGS1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS1" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.3 and PAlignment >= 0.65 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGS1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS1L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.3 and PAlignment >= 0.65 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGS2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS2" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.65 or PAlignment >= 0.9 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGS2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS2L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.65 or PAlignment >= 0.9 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGS3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS3" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.9 and PAlignment > 1.0 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
elsif whichSkySetting == ALIGNGS3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS3L9" time WT_skyTransitionDuration end if
    wait WT_skyTransitionDuration seconds
    begin loop
        run script WeatherSetSkySettingSetter(whichSkySetting)
        //PAlignment = get player PlayerID alignment
        //until get player PlayerID influence at camera position == 0 or PAlignment < 0.9 and PAlignment > 1.0 or (get game time < 17.5 or get game time > 20.5) or (get game time < 6 or get game time > 9)
        until WT_ExitLoop == 1 or WT_SkyTransitionAllowed == 0
    end loop
    WT_SkySetRunning = 0
end if

end script WeatherSetSkySetting


begin script WeatherSetSkySettingSetter(whichSkySetting)

start

if whichSkySetting == ALIGNE1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E1" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E1-CC" time 0 end if
elsif whichSkySetting == ALIGNE1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E1L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E1L9-CC" time 0 end if
elsif whichSkySetting == ALIGNE2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E2" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E2-CC" time 0 end if
elsif whichSkySetting == ALIGNE2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E2L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E2L9-CC" time 0 end if
elsif whichSkySetting == ALIGNE3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E3" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E3-CC" time 0 end if
elsif whichSkySetting == ALIGNE3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E3L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-E3L9-CC" time 0 end if
elsif whichSkySetting == ALIGNEN1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN1" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN1-CC" time 0 end if
elsif whichSkySetting == ALIGNEN2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN2" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN2-CC" time 0 end if
elsif whichSkySetting == ALIGNEN3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN3" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-EN3-CC" time 0 end if
elsif whichSkySetting == ALIGNES1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES1" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES1-CC" time 0 end if
elsif whichSkySetting == ALIGNES1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES1L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES1L9-CC" time 0 end if
elsif whichSkySetting == ALIGNES2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES2L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES2L9-CC" time 0 end if
elsif whichSkySetting == ALIGNES3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES3" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES3-CC" time 0 end if
elsif whichSkySetting == ALIGNES3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES3L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-ES3L9-CC" time 0 end if
elsif whichSkySetting == ALIGNG1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G1" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G1-CC" time 0 end if
elsif whichSkySetting == ALIGNG1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G1L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G1L9-CC" time 0 end if
elsif whichSkySetting == ALIGNG2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G2" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G2-CC" time 0 end if
elsif whichSkySetting == ALIGNG2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G2L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G2L9-CC" time 0 end if
elsif whichSkySetting == ALIGNG3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G3" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G3-CC" time 0 end if
elsif whichSkySetting == ALIGNG3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G3L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-G3L9-CC" time 0 end if
elsif whichSkySetting == ALIGNGN1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN1" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN1-CC" time 0 end if
elsif whichSkySetting == ALIGNGN2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN2" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN2-CC" time 0 end if
elsif whichSkySetting == ALIGNGN3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN3" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GN3-CC" time 0 end if
elsif whichSkySetting == ALIGNGS1
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS1" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS1-CC" time 0 end if
elsif whichSkySetting == ALIGNGS1L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS1L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS1L9-CC" time 0 end if
elsif whichSkySetting == ALIGNGS2
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS2" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS2-CC" time 0 end if
elsif whichSkySetting == ALIGNGS2L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS2L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS2L9-CC" time 0 end if
elsif whichSkySetting == ALIGNGS3
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS3" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS3-CC" time 0 end if
elsif whichSkySetting == ALIGNGS3L9
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS3L9" time 0 end if
    wait 0.2 seconds
    if WT_SkyTransitionAllowed == 1 enable predefined sky "ALIGN-GS3L9-CC" time 0 end if
end if

end script WeatherSetSkySettingSetter


begin script WeatherVisuals

start

end script WeatherVisuals